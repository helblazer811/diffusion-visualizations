var ZR=Object.defineProperty;var JR=(t,e,n)=>e in t?ZR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ig=(t,e,n)=>JR(t,typeof e!="symbol"?e+"":e,n);import{t as Es,a as ir,n as x4,c as QR}from"../chunks/CX2K7TYd.js";import"../chunks/B0T2ilwj.js";import{a3 as eD,o as tD,ao as P8,w as og,m as yr,a1 as nD,n as rD,g as at,P as _2,q as sD,v as K3,x as ag,B as Zu,ae as iD,y as B8,z as V8,A as oD,ap as lg,ai as W8,F as aD,a6 as Y3,aq as y4,ar as Z3,as as v4,I as yo,at as J3,aa as lD,au as uD,av as cD,ah as hD,aw as fD,ax as dD,ay as pD,ac as mD,az as gD,aA as bD,aB as xD,aC as yD,aD as vD,aE as wD,b as kD,D as SD,C as U8,aF as CD,p as Do,aG as Ja,aH as Qa,j as Mo,L as ka,k as Qt,l as Vt,t as fo,s as _r,aI as A2,aJ as $D,e as jr,i as ID}from"../chunks/meokjlVe.js";import{a as TD,l as G8,e as H8,s as Q3}from"../chunks/DDaNDqAB.js";import{i as el}from"../chunks/DI3TRFz5.js";import{i as E2,s as Tu,a as vr,c as ND,p as ut,b as w4}from"../chunks/CZT4bbpY.js";import{b as jl}from"../chunks/BvdmPtzG.js";import{w as Rs,a as q8,o as _D,g as Ju}from"../chunks/S28w7HDG.js";function AD(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}function k4(t,e){return e}function ED(t,e,n,r){for(var s=[],i=e.length,o=0;o<i;o++)cD(e[o].e,s,!0);var a=i>0&&s.length===0&&n!==null;if(a){var l=n.parentNode;hD(l),l.append(n),r.clear(),ro(t,e[0].prev,e[i-1].next)}fD(s,()=>{for(var u=0;u<i;u++){var c=e[u];a||(r.delete(c.k),ro(t,c.prev,c.next)),dD(c.e,!a)}})}function S4(t,e,n,r,s,i=null){var o=t,a={flags:e,items:new Map,first:null},l=(e&P8)!==0;if(l){var u=t;o=yr?og(nD(u)):u.appendChild(eD())}yr&&rD();var c=null,h=!1,f=_2(()=>{var d=n();return lD(d)?d:d==null?[]:W8(d)});tD(()=>{var d=at(f),p=d.length;if(h&&p===0)return;h=p===0;let g=!1;if(yr){var m=o.data===sD;m!==(p===0)&&(o=K3(),og(o),ag(!1),g=!0)}if(yr){for(var b=null,x,v=0;v<p;v++){if(Zu.nodeType===8&&Zu.data===iD){o=Zu,g=!0,ag(!1);break}var y=d[v],w=r(y,v);x=X8(Zu,a,b,null,y,w,v,s,e,n),a.items.set(w,x),b=x}p>0&&og(K3())}yr||RD(d,a,o,s,e,r,n),i!==null&&(p===0?c?B8(c):c=V8(()=>i(o)):c!==null&&oD(c,()=>{c=null})),g&&ag(!0),at(f)}),yr&&(o=Zu)}function RD(t,e,n,r,s,i,o){var A,E,D,P;var a=(s&uD)!==0,l=(s&(y4|v4))!==0,u=t.length,c=e.items,h=e.first,f=h,d,p=null,g,m=[],b=[],x,v,y,w;if(a)for(w=0;w<u;w+=1)x=t[w],v=i(x,w),y=c.get(v),y!==void 0&&((A=y.a)==null||A.measure(),(g??(g=new Set)).add(y));for(w=0;w<u;w+=1){if(x=t[w],v=i(x,w),y=c.get(v),y===void 0){var C=f?f.e.nodes_start:n;p=X8(C,e,p,p===null?e.first:p.next,x,v,w,r,s,o),c.set(v,p),m=[],b=[],f=p.next;continue}if(l&&DD(y,x,w,s),(y.e.f&lg)!==0&&(B8(y.e),a&&((E=y.a)==null||E.unfix(),(g??(g=new Set)).delete(y))),y!==f){if(d!==void 0&&d.has(y)){if(m.length<b.length){var T=b[0],N;p=T.prev;var $=m[0],_=m[m.length-1];for(N=0;N<m.length;N+=1)ew(m[N],T,n);for(N=0;N<b.length;N+=1)d.delete(b[N]);ro(e,$.prev,_.next),ro(e,p,$),ro(e,_,T),f=T,p=_,w-=1,m=[],b=[]}else d.delete(y),ew(y,f,n),ro(e,y.prev,y.next),ro(e,y,p===null?e.first:p.next),ro(e,p,y),p=y;continue}for(m=[],b=[];f!==null&&f.k!==v;)(f.e.f&lg)===0&&(d??(d=new Set)).add(f),b.push(f),f=f.next;if(f===null)continue;y=f}m.push(y),p=y,f=y.next}if(f!==null||d!==void 0){for(var S=d===void 0?[]:W8(d);f!==null;)(f.e.f&lg)===0&&S.push(f),f=f.next;var M=S.length;if(M>0){var F=(s&P8)!==0&&u===0?n:null;if(a){for(w=0;w<M;w+=1)(D=S[w].a)==null||D.measure();for(w=0;w<M;w+=1)(P=S[w].a)==null||P.fix()}ED(e,S,F,c)}}a&&aD(()=>{var z;if(g!==void 0)for(y of g)(z=y.a)==null||z.apply()}),Y3.first=e.first&&e.first.e,Y3.last=p&&p.e}function DD(t,e,n,r){(r&y4)!==0&&Z3(t.v,e),(r&v4)!==0?Z3(t.i,n):t.i=n}function X8(t,e,n,r,s,i,o,a,l,u){var c=(l&y4)!==0,h=(l&pD)===0,f=c?h?yo(s):J3(s):s,d=(l&v4)===0?o:J3(o),p={i:d,v:f,k:i,a:null,e:null,prev:n,next:r};try{return p.e=V8(()=>a(t,f,d,u),yr),p.e.prev=n&&n.e,p.e.next=r&&r.e,n===null?e.first=p:(n.next=p,n.e.next=p.e),r!==null&&(r.prev=p,r.e.prev=p.e),p}finally{}}function ew(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,s=e?e.e.nodes_start:n,i=t.e.nodes_start;i!==r;){var o=mD(i);s.before(i),i=o}}function ro(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function j8(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(n=j8(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function MD(){for(var t,e,n=0,r="",s=arguments.length;n<s;n++)(t=arguments[n])&&(e=j8(t))&&(r&&(r+=" "),r+=e);return r}function FD(t){return typeof t=="object"?MD(t):t??""}function OD(t,e,n){var r=t==null?"":""+t;return r=r?r+" "+e:e,r===""?null:r}function LD(t,e){return t==null?null:String(t)}function zD(t,e,n,r,s,i){var o=t.__className;if(yr||o!==n||o===void 0){var a=OD(n,r);(!yr||a!==t.getAttribute("class"))&&(a==null?t.removeAttribute("class"):t.className=a),t.__className=n}return i}function Ap(t,e,n,r){var s=t.__style;if(yr||s!==e){var i=LD(e);(!yr||i!==t.getAttribute("style"))&&(i==null?t.removeAttribute("style"):t.style.cssText=i),t.__style=e}return r}const PD=Symbol("is custom element"),BD=Symbol("is html");function VD(t){if(yr){var e=!1,n=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var r=t.value;Fr(t,"value",null),t.value=r}if(t.hasAttribute("checked")){var s=t.checked;Fr(t,"checked",null),t.checked=s}}};t.__on_r=n,yD(n),TD()}}function Fr(t,e,n,r){var s=WD(t);yr&&(s[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||s[e]!==(s[e]=n)&&(e==="loading"&&(t[vD]=n),n==null?t.removeAttribute(e):typeof n!="string"&&UD(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function WD(t){return t.__attributes??(t.__attributes={[PD]:t.nodeName.includes("-"),[BD]:t.namespaceURI===gD})}var tw=new Map;function UD(t){var e=tw.get(t.nodeName);if(e)return e;tw.set(t.nodeName,e=[]);for(var n,r=t,s=Element.prototype;s!==r;){n=xD(r);for(var i in n)n[i].set&&e.push(i);r=bD(r)}return e}function GD(t,e,n=e){var r=wD();G8(t,"input",s=>{var i=s?t.defaultValue:t.value;if(i=ug(t)?cg(i):i,n(i),r&&i!==(i=e())){var o=t.selectionStart,a=t.selectionEnd;t.value=i??"",a!==null&&(t.selectionStart=o,t.selectionEnd=Math.min(a,t.value.length))}}),(yr&&t.defaultValue!==t.value||kD(e)==null&&t.value)&&n(ug(t)?cg(t.value):t.value),SD(()=>{var s=e();ug(t)&&s===cg(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function ug(t){var e=t.type;return e==="number"||e==="range"}function cg(t){return t===""?null:+t}function K8(t,e,n){if(t.multiple)return XD(t,e);for(var r of t.options){var s=_c(r);if(CD(s,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function HD(t,e){U8(()=>{var n=new MutationObserver(()=>{var r=t.__value;K8(t,r)});return n.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function qD(t,e,n=e){var r=!0;G8(t,"change",s=>{var i=s?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(i),_c);else{var a=t.querySelector(i)??t.querySelector("option:not([disabled])");o=a&&_c(a)}n(o)}),U8(()=>{var s=e();if(K8(t,s,r),r&&s===void 0){var i=t.querySelector(":checked");i!==null&&(s=_c(i),n(s))}t.__value=s,r=!1}),HD(t)}function XD(t,e){for(var n of t.options)n.selected=~e.indexOf(_c(n))}function _c(t){return"__value"in t?t.__value:t.value}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jD=1e-7,KD=1e-4;class Y8{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class C4{refCount(e){return mr("refCount")}incRef(e){return mr("incRef")}timerAvailable(){return!0}time(e){return mr("time")}read(e){return mr("read")}readSync(e){return mr("readSync")}readToGPU(e,n){return mr("readToGPU")}numDataIds(){return mr("numDataIds")}disposeData(e,n){return mr("disposeData")}write(e,n,r){return mr("write")}move(e,n,r,s,i){return mr("move")}createTensorFromGPUData(e,n,r){return mr("createTensorFromGPUData")}memory(){return mr("memory")}floatPrecision(){return mr("floatPrecision")}epsilon(){return this.floatPrecision()===32?jD:KD}dispose(){return mr("dispose")}}function mr(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YD(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,Al(t,e,n)}function Sa(t,e,n){return Math.max(t,Math.min(e,n))}function $4(t){return t%2===0?t:t+1}function Al(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function ZD(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function L(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function ls(t,e,n=""){L(ft(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function Z8(t){L(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function se(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function ft(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Kl(t){return t%1===0}function R2(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Ol(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function nw(t,e=s=>0,n,r){return new Promise((s,i)=>{let o=0;const a=()=>{if(t()){s();return}o++;const l=e(o);if(n!=null&&o>=n){i();return}r!=null?r(a,l):setTimeout(a,l)};a()})}function J8(t,e){let n=1,r=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(r===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const s=t.slice();return s[r]=e/n,s}function et(t,e){const n=e.length;return t=t==null?e.map((r,s)=>s):[].concat(t),L(t.every(r=>r>=-n&&r<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),L(t.every(r=>Kl(r)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(r=>r<0?n+r:r)}function Fo(t,e){const n=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||s?null:et(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[o]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[o]==null||i[o]>a)&&t[a]===1&&(n.push(t[a]),r.push(a)),i[o]<=a&&o++}t[a]!==1&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}}function Nn(t,e){return Gt(t,e)}function Gt(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function JD(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function QD(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function Q8(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function ad(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function eM(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function gh(t){return typeof t=="string"||t instanceof String}function tM(t){return typeof t=="boolean"}function D2(t){return typeof t=="number"}function Nu(t){return Array.isArray(t)?Nu(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":D2(t)?"float32":gh(t)?"string":tM(t)?"bool":"float32"}function M2(t){return!!(t&&t.constructor&&t.call&&t.apply)}function F2(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Re(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function ek(t,e,n,r=!1){const s=new Array;if(e.length===1){const i=e[0]*(r?2:1);for(let o=0;o<i;o++)s[o]=n[t+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(r?2:1);for(let l=0;l<i;l++)s[l]=ek(t+l*a,o,n,r)}return s}function ks(t,e,n=!1){if(t.length===0)return e[0];const r=t.reduce((s,i)=>s*i)*(n?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return ek(0,t,e,n)}function nM(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function I4(t,e){const n=_n(t,e);for(let r=0;r<n.length;r++)n[r]=1;return n}function _n(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function tk(t,e){const n=t.reduce((r,s)=>r*s,1);if(e==null||e==="float32")return ks(t,new Float32Array(n));if(e==="int32")return ks(t,new Int32Array(n));if(e==="bool")return ks(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function Wi(t){t.forEach(e=>{L(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function Xs(t,e,n){if(e===0)return 0;if(e===1)return t[0];let r=t[t.length-1];for(let s=0;s<t.length-1;++s)r+=n[s]*t[s];return r}function _u(t,e,n){if(e===0)return[];if(e===1)return[t];const r=new Array(e);for(let s=0;s<r.length-1;++s)r[s]=Math.floor(t/n[s]),t-=r[s]*n[s];return r[r.length-1]=t,r}function T4(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rw="tfjsflags";class rM{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=sM,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(ee().getBool("IS_TEST")||ee().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,r){if(this.flagRegistry[e]={evaluationFn:n,setHook:r},this.urlFlags[e]!=null){const s=this.urlFlags[e];ee().getBool("IS_TEST")||ee().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${s}.`),this.set(e,s)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(T4(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);rw in e&&e[rw].split(",").forEach(r=>{const[s,i]=r.split(":");this.urlFlags[s]=oM(s,i)})}}function sM(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...r)=>(iM(e,r[0],r[1]),r.join("="))),e}function iM(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function oM(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function ee(){return nk}let nk=null;function aM(t){nk=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let hg;function rk(){if(hg==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");hg=t}return hg}function lM(){const t=rk();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function N4(t,e){const n=lM();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}const Ep="Abs",bh="Acos",xh="Acosh",Au="Add",_4="AddN",A4="All",E4="Any",Rp="ArgMax",Dp="ArgMin",yh="Asin",vh="Asinh",wh="Atan",kh="Atanh",Sh="Atan2",Mp="AvgPool",R4="AvgPoolGrad",Fp="AvgPool3D",D4="AvgPool3DGrad",Op="BatchMatMul",Lp="BatchToSpaceND",M4="Bincount",F4="BitwiseAnd",uM="BroadcastTo",sk="BroadcastArgs",Ch="Cast",$h="Ceil",Ih="ClipByValue",O4="Complex",zp="ComplexAbs",Pp="Concat",Bp="Conv2D",L4="Conv2DBackpropFilter",Vp="Conv2DBackpropInput",Wp="Conv3D",z4="Conv3DBackpropFilterV2",P4="Conv3DBackpropInputV2",Th="Cos",Nh="Cosh",B4="Cumprod",Up="Cumsum",V4="CropAndResize",W4="DenseBincount",U4="DepthToSpace",Gp="DepthwiseConv2dNative",G4="DepthwiseConv2dNativeBackpropFilter",H4="DepthwiseConv2dNativeBackpropInput",ik="Diag",Hp="Dilation2D",O2="Dilation2DBackpropInput",L2="Dilation2DBackpropFilter",cM="Draw",_h="RealDiv",q4="Einsum",Ah="Elu",X4="EluGrad",Eh="Erf",qp="Equal",Rh="Exp",Xp="ExpandDims",Dh="Expm1",j4="FFT",K4="Fill",Y4="FlipLeftRight",Mh="Floor",Fh="FloorDiv",jp="FusedBatchNorm",Kp="GatherV2",ok="GatherNd",Yp="Greater",Oh="GreaterEqual",Lh="Identity",Z4="IFFT",J4="Imag",zh="IsFinite",Ph="IsInf",Bh="IsNan",Zp="LeakyRelu",Jp="Less",Qp="LessEqual",Q4="LinSpace",Vh="Log",Wh="Log1p",e1="LogicalAnd",t1="LogicalNot",n1="LogicalOr",hM="LogSoftmax",r1="LRN",ex="LRNGrad",s1="Max",Uh="Maximum",i1="MaxPool",tx="MaxPoolGrad",o1="MaxPool3D",nx="MaxPool3DGrad",ak="MaxPoolWithArgmax",a1="Mean",l1="Min",Gh="Minimum",u1="MirrorPad",Hh="Mod",lk="Multinomial",qh="Multiply",c1="Neg",h1="NotEqual",rx="NonMaxSuppressionV3",sx="NonMaxSuppressionV4",ix="NonMaxSuppressionV5",f1="OnesLike",d1="OneHot",p1="Pack",m1="PadV2",Xh="Pow",g1="Prelu",b1="Prod",uk="RaggedGather",ck="RaggedRange",hk="RaggedTensorToTensor",ox="Range",ax="Real",jh="Reciprocal",Kh="Relu",x1="Reshape",y1="ResizeNearestNeighbor",lx="ResizeNearestNeighborGrad",v1="ResizeBilinear",ux="ResizeBilinearGrad",Yh="Relu6",w1="Reverse",Zh="Round",Jh="Rsqrt",fk="ScatterNd",dk="TensorScatterUpdate",pk="SearchSorted",k1="Select",Qh="Selu",S1="Slice",e0="Sin",t0="Sinh",n0="Sign",r0="Sigmoid",s0="Softplus",i0="Sqrt",C1="Sum",$1="SpaceToBatchND",I1="SplitV",T1="Softmax",mk="SparseFillEmptyRows",gk="SparseReshape",bk="SparseSegmentMean",xk="SparseSegmentSum",yk="SparseToDense",o0="SquaredDifference",cx="Square",hx="StaticRegexReplace",fx="StridedSlice",vk="StringNGrams",wk="StringSplit",kk="StringToHashBucketFast",a0="Sub",l0="Tan",u0="Tanh",c0="Tile",dx="TopK",px="Transform",Ll="Transpose",mx="Unique",N1="Unpack",_1="UnsortedSegmentSum",A1="ZerosLike",h0="Step",fM="FromPixels",gx="RotateWithOffset",ld="_FusedMatMul",ud="FusedConv2D",Sk="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rr(...t){ee().getBool("IS_TEST")||ee().getBool("PROD")||console.warn(...t)}function dM(...t){ee().getBool("IS_TEST")||ee().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cd=N4("kernelRegistry",()=>new Map),z2=N4("gradRegistry",()=>new Map);function sw(t,e){const n=$k(t,e);return cd.get(n)}function iw(t){return z2.get(t)}function ow(t){const e=cd.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[i,o]=s,[a]=i.split("_");a===t&&n.push(o)}return n}function Ck(t){const{kernelName:e,backendName:n}=t,r=$k(e,n);cd.has(r)&&Rr(`The kernel '${e}' for backend '${n}' is already registered`),cd.set(r,t)}function pM(t){const{kernelName:e}=t;z2.has(e)&&ee().getBool("DEBUG")&&Rr(`Overriding the gradient for '${e}'`),z2.set(e,t)}function $k(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ik(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function mM(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function gM(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var fg,aw;function bM(){if(aw)return fg;aw=1,fg=e;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(_,S,M){this.low=_|0,this.high=S|0,this.unsigned=!!M}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function n(_){return(_&&_.__isLong__)===!0}e.isLong=n;var r={},s={};function i(_,S){var M,F,A;return S?(_>>>=0,(A=0<=_&&_<256)&&(F=s[_],F)?F:(M=a(_,(_|0)<0?-1:0,!0),A&&(s[_]=M),M)):(_|=0,(A=-128<=_&&_<128)&&(F=r[_],F)?F:(M=a(_,_<0?-1:0,!1),A&&(r[_]=M),M))}e.fromInt=i;function o(_,S){if(isNaN(_))return S?x:b;if(S){if(_<0)return x;if(_>=p)return T}else{if(_<=-9223372036854776e3)return N;if(_+1>=g)return C}return _<0?o(-_,S).neg():a(_%d|0,_/d|0,S)}e.fromNumber=o;function a(_,S,M){return new e(_,S,M)}e.fromBits=a;var l=Math.pow;function u(_,S,M){if(_.length===0)throw Error("empty string");if(_==="NaN"||_==="Infinity"||_==="+Infinity"||_==="-Infinity")return b;if(typeof S=="number"?(M=S,S=!1):S=!!S,M=M||10,M<2||36<M)throw RangeError("radix");var F;if((F=_.indexOf("-"))>0)throw Error("interior hyphen");if(F===0)return u(_.substring(1),S,M).neg();for(var A=o(l(M,8)),E=b,D=0;D<_.length;D+=8){var P=Math.min(8,_.length-D),z=parseInt(_.substring(D,D+P),M);if(P<8){var B=o(l(M,P));E=E.mul(B).add(o(z))}else E=E.mul(A),E=E.add(o(z))}return E.unsigned=S,E}e.fromString=u;function c(_,S){return typeof _=="number"?o(_,S):typeof _=="string"?u(_,S):a(_.low,_.high,typeof S=="boolean"?S:_.unsigned)}e.fromValue=c;var h=65536,f=1<<24,d=h*h,p=d*d,g=p/2,m=i(f),b=i(0);e.ZERO=b;var x=i(0,!0);e.UZERO=x;var v=i(1);e.ONE=v;var y=i(1,!0);e.UONE=y;var w=i(-1);e.NEG_ONE=w;var C=a(-1,2147483647,!1);e.MAX_VALUE=C;var T=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=T;var N=a(0,-2147483648,!1);e.MIN_VALUE=N;var $=e.prototype;return $.toInt=function(){return this.unsigned?this.low>>>0:this.low},$.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},$.toString=function(S){if(S=S||10,S<2||36<S)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(N)){var M=o(S),F=this.div(M),A=F.mul(M).sub(this);return F.toString(S)+A.toInt().toString(S)}else return"-"+this.neg().toString(S);for(var E=o(l(S,6),this.unsigned),D=this,P="";;){var z=D.div(E),B=D.sub(z.mul(E)).toInt()>>>0,G=B.toString(S);if(D=z,D.isZero())return G+P;for(;G.length<6;)G="0"+G;P=""+G+P}},$.getHighBits=function(){return this.high},$.getHighBitsUnsigned=function(){return this.high>>>0},$.getLowBits=function(){return this.low},$.getLowBitsUnsigned=function(){return this.low>>>0},$.getNumBitsAbs=function(){if(this.isNegative())return this.eq(N)?64:this.neg().getNumBitsAbs();for(var S=this.high!=0?this.high:this.low,M=31;M>0&&(S&1<<M)==0;M--);return this.high!=0?M+33:M+1},$.isZero=function(){return this.high===0&&this.low===0},$.eqz=$.isZero,$.isNegative=function(){return!this.unsigned&&this.high<0},$.isPositive=function(){return this.unsigned||this.high>=0},$.isOdd=function(){return(this.low&1)===1},$.isEven=function(){return(this.low&1)===0},$.equals=function(S){return n(S)||(S=c(S)),this.unsigned!==S.unsigned&&this.high>>>31===1&&S.high>>>31===1?!1:this.high===S.high&&this.low===S.low},$.eq=$.equals,$.notEquals=function(S){return!this.eq(S)},$.neq=$.notEquals,$.ne=$.notEquals,$.lessThan=function(S){return this.comp(S)<0},$.lt=$.lessThan,$.lessThanOrEqual=function(S){return this.comp(S)<=0},$.lte=$.lessThanOrEqual,$.le=$.lessThanOrEqual,$.greaterThan=function(S){return this.comp(S)>0},$.gt=$.greaterThan,$.greaterThanOrEqual=function(S){return this.comp(S)>=0},$.gte=$.greaterThanOrEqual,$.ge=$.greaterThanOrEqual,$.compare=function(S){if(n(S)||(S=c(S)),this.eq(S))return 0;var M=this.isNegative(),F=S.isNegative();return M&&!F?-1:!M&&F?1:this.unsigned?S.high>>>0>this.high>>>0||S.high===this.high&&S.low>>>0>this.low>>>0?-1:1:this.sub(S).isNegative()?-1:1},$.comp=$.compare,$.negate=function(){return!this.unsigned&&this.eq(N)?N:this.not().add(v)},$.neg=$.negate,$.add=function(S){n(S)||(S=c(S));var M=this.high>>>16,F=this.high&65535,A=this.low>>>16,E=this.low&65535,D=S.high>>>16,P=S.high&65535,z=S.low>>>16,B=S.low&65535,G=0,j=0,Z=0,ne=0;return ne+=E+B,Z+=ne>>>16,ne&=65535,Z+=A+z,j+=Z>>>16,Z&=65535,j+=F+P,G+=j>>>16,j&=65535,G+=M+D,G&=65535,a(Z<<16|ne,G<<16|j,this.unsigned)},$.subtract=function(S){return n(S)||(S=c(S)),this.add(S.neg())},$.sub=$.subtract,$.multiply=function(S){if(this.isZero())return b;if(n(S)||(S=c(S)),t){var M=t.mul(this.low,this.high,S.low,S.high);return a(M,t.get_high(),this.unsigned)}if(S.isZero())return b;if(this.eq(N))return S.isOdd()?N:b;if(S.eq(N))return this.isOdd()?N:b;if(this.isNegative())return S.isNegative()?this.neg().mul(S.neg()):this.neg().mul(S).neg();if(S.isNegative())return this.mul(S.neg()).neg();if(this.lt(m)&&S.lt(m))return o(this.toNumber()*S.toNumber(),this.unsigned);var F=this.high>>>16,A=this.high&65535,E=this.low>>>16,D=this.low&65535,P=S.high>>>16,z=S.high&65535,B=S.low>>>16,G=S.low&65535,j=0,Z=0,ne=0,le=0;return le+=D*G,ne+=le>>>16,le&=65535,ne+=E*G,Z+=ne>>>16,ne&=65535,ne+=D*B,Z+=ne>>>16,ne&=65535,Z+=A*G,j+=Z>>>16,Z&=65535,Z+=E*B,j+=Z>>>16,Z&=65535,Z+=D*z,j+=Z>>>16,Z&=65535,j+=F*G+A*B+E*z+D*P,j&=65535,a(ne<<16|le,j<<16|Z,this.unsigned)},$.mul=$.multiply,$.divide=function(S){if(n(S)||(S=c(S)),S.isZero())throw Error("division by zero");if(t){if(!this.unsigned&&this.high===-2147483648&&S.low===-1&&S.high===-1)return this;var M=(this.unsigned?t.div_u:t.div_s)(this.low,this.high,S.low,S.high);return a(M,t.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?x:b;var F,A,E;if(this.unsigned){if(S.unsigned||(S=S.toUnsigned()),S.gt(this))return x;if(S.gt(this.shru(1)))return y;E=x}else{if(this.eq(N)){if(S.eq(v)||S.eq(w))return N;if(S.eq(N))return v;var D=this.shr(1);return F=D.div(S).shl(1),F.eq(b)?S.isNegative()?v:w:(A=this.sub(S.mul(F)),E=F.add(A.div(S)),E)}else if(S.eq(N))return this.unsigned?x:b;if(this.isNegative())return S.isNegative()?this.neg().div(S.neg()):this.neg().div(S).neg();if(S.isNegative())return this.div(S.neg()).neg();E=b}for(A=this;A.gte(S);){F=Math.max(1,Math.floor(A.toNumber()/S.toNumber()));for(var P=Math.ceil(Math.log(F)/Math.LN2),z=P<=48?1:l(2,P-48),B=o(F),G=B.mul(S);G.isNegative()||G.gt(A);)F-=z,B=o(F,this.unsigned),G=B.mul(S);B.isZero()&&(B=v),E=E.add(B),A=A.sub(G)}return E},$.div=$.divide,$.modulo=function(S){if(n(S)||(S=c(S)),t){var M=(this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,S.low,S.high);return a(M,t.get_high(),this.unsigned)}return this.sub(this.div(S).mul(S))},$.mod=$.modulo,$.rem=$.modulo,$.not=function(){return a(~this.low,~this.high,this.unsigned)},$.and=function(S){return n(S)||(S=c(S)),a(this.low&S.low,this.high&S.high,this.unsigned)},$.or=function(S){return n(S)||(S=c(S)),a(this.low|S.low,this.high|S.high,this.unsigned)},$.xor=function(S){return n(S)||(S=c(S)),a(this.low^S.low,this.high^S.high,this.unsigned)},$.shiftLeft=function(S){return n(S)&&(S=S.toInt()),(S&=63)===0?this:S<32?a(this.low<<S,this.high<<S|this.low>>>32-S,this.unsigned):a(0,this.low<<S-32,this.unsigned)},$.shl=$.shiftLeft,$.shiftRight=function(S){return n(S)&&(S=S.toInt()),(S&=63)===0?this:S<32?a(this.low>>>S|this.high<<32-S,this.high>>S,this.unsigned):a(this.high>>S-32,this.high>=0?0:-1,this.unsigned)},$.shr=$.shiftRight,$.shiftRightUnsigned=function(S){if(n(S)&&(S=S.toInt()),S&=63,S===0)return this;var M=this.high;if(S<32){var F=this.low;return a(F>>>S|M<<32-S,M>>>S,this.unsigned)}else return S===32?a(M,0,this.unsigned):a(M>>>S-32,0,this.unsigned)},$.shru=$.shiftRightUnsigned,$.shr_u=$.shiftRightUnsigned,$.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},$.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},$.toBytes=function(S){return S?this.toBytesLE():this.toBytesBE()},$.toBytesLE=function(){var S=this.high,M=this.low;return[M&255,M>>>8&255,M>>>16&255,M>>>24,S&255,S>>>8&255,S>>>16&255,S>>>24]},$.toBytesBE=function(){var S=this.high,M=this.low;return[S>>>24,S>>>16&255,S>>>8&255,S&255,M>>>24,M>>>16&255,M>>>8&255,M&255]},e.fromBytes=function(S,M,F){return F?e.fromBytesLE(S,M):e.fromBytesBE(S,M)},e.fromBytesLE=function(S,M){return new e(S[0]|S[1]<<8|S[2]<<16|S[3]<<24,S[4]|S[5]<<8|S[6]<<16|S[7]<<24,M)},e.fromBytesBE=function(S,M){return new e(S[4]<<24|S[5]<<16|S[6]<<8|S[7],S[0]<<24|S[1]<<16|S[2]<<8|S[3],M)},fg}var Tk=bM();const Nk=mM(Tk),xM=AD({__proto__:null,default:Nk},[Tk]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aa=Nk||xM;function E1(t){return aa.fromString(t,!0,16)}const _k=E1("c3a5c85c97cb3127"),ra=E1("b492b66fbe98f273"),Vn=E1("9ae16a3b2f90404f");function P2(t){return t.xor(t.shru(47))}function Ak(t,e,n){const r=t.slice(e,e+n);return aa.fromBytes(Array.from(r),!0,!0)}function yt(t,e){return Ak(t,e,8)}function lw(t,e){return Ak(t,e,4)}function pn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function po(t,e,n=E1("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let s=e.xor(r).mul(n);return s=s.xor(s.shru(47)),s=s.mul(n),s}function yM(t,e,n,r,s,i){s=s.add(t),i=pn(i.add(s).add(r),21);const o=s;return s=s.add(e),s=s.add(n),i=i.add(pn(s,44)),[s.add(r),i.add(o)]}function K0(t,e,n,r){return yM(yt(t,e),yt(t,e+8),yt(t,e+16),yt(t,e+24),n,r)}function vM(t,e=t.length){if(e>=8){const n=Vn.add(e*2),r=yt(t,0).add(Vn),s=yt(t,e-8),i=pn(s,37).mul(n).add(r),o=pn(r,25).add(s).mul(n);return po(i,o,n)}if(e>=4){const n=Vn.add(e*2),r=lw(t,0);return po(r.shl(3).add(e),lw(t,e-4),n)}if(e>0){const n=t[0],r=t[e>>1],s=t[e-1],i=n+(r<<8),o=e+(s<<2);return P2(Vn.mul(i).xor(_k.mul(o))).mul(Vn)}return Vn}function wM(t,e=t.length){const n=Vn.add(e*2),r=yt(t,0).mul(ra),s=yt(t,8),i=yt(t,e-8).mul(n),o=yt(t,e-16).mul(Vn);return po(pn(r.add(s),43).add(pn(i,30)).add(o),r.add(pn(s.add(Vn),18)).add(i),n)}function kM(t,e=t.length){const n=Vn.add(e*2),r=yt(t,0).mul(Vn),s=yt(t,8),i=yt(t,e-8).mul(n),o=yt(t,e-16).mul(Vn),a=pn(r.add(s),43).add(pn(i,30)).add(o),l=po(a,r.add(pn(s.add(Vn),18)).add(i),n),u=yt(t,16).mul(n),c=yt(t,24),h=a.add(yt(t,e-32)).mul(n),f=l.add(yt(t,e-24)).mul(n);return po(pn(u.add(c),43).add(pn(h,30)).add(f),u.add(pn(c.add(r),18)).add(h),n)}function SM(t,e=t.length){const n=aa.fromNumber(81,!0);if(e<=32)return e<=16?vM(t,e):wM(t,e);if(e<=64)return kM(t,e);let r=n,s=n.mul(ra).add(113),i=P2(s.mul(Vn).add(113)).mul(Vn),o=[aa.UZERO,aa.UZERO],a=[aa.UZERO,aa.UZERO];r=r.mul(Vn).add(yt(t,0));let l=0;const u=(e-1>>6)*64,c=u+(e-1&63)-63;do r=pn(r.add(s).add(o[0]).add(yt(t,l+8)),37).mul(ra),s=pn(s.add(o[1]).add(yt(t,l+48)),42).mul(ra),r=r.xor(a[1]),s=s.add(o[0]).add(yt(t,l+40)),i=pn(i.add(a[0]),33).mul(ra),o=K0(t,l,o[1].mul(ra),r.add(a[0])),a=K0(t,l+32,i.add(a[1]),s.add(yt(t,l+16))),[i,r]=[r,i],l+=64;while(l!==u);const h=ra.add(i.and(255).shl(1));return l=c,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=pn(r.add(s).add(o[0]).add(yt(t,l+8)),37).mul(h),s=pn(s.add(o[1]).add(yt(t,l+48)),42).mul(h),r=r.xor(a[1].mul(9)),s=s.add(o[0].mul(9).add(yt(t,l+40))),i=pn(i.add(a[0]),33).mul(h),o=K0(t,l,o[1].mul(h),r.add(a[0])),a=K0(t,l+32,i.add(a[1]),s.add(yt(t,l+16))),[i,r]=[r,i],po(po(o[0],a[0],h).add(P2(s).mul(_k)).add(i),po(o[1],a[1],h).add(r),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oo(t,e){return e==="string"?mo(t):tl([t],e)}function CM(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function tl(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ca(t)),ee().getBool("DEBUG")&&JD(t,e),CM(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let r=0;r<n.length;++r)Math.round(t[r])!==0&&(n[r]=1);return n}else throw new Error(`Unknown data type ${e}`)}function Kn(){return ee().platform.now()}function mo(t,e="utf-8"){return e=e||"utf-8",ee().platform.encode(t,e)}function vo(t,e="utf-8"){return e=e||"utf-8",ee().platform.decode(t,e)}function ss(t){return ee().platform.isTypedArray!=null?ee().platform.isTypedArray(t):Ik(t)}function Ca(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||T4(t)||t==null||ss(t)&&n)e.push(t);else if(Array.isArray(t)||ss(t))for(let r=0;r<t.length;++r)Ca(t[r],e,n);else{let r=-1;for(const s of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(s)&&(r=Math.max(r,Number(s)));for(let s=0;s<=r;s++)Ca(t[s],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $M{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new TM)}profileKernel(e,n,r){let s;const i=()=>{s=r()};let o;const a=Kn();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of s)u.dataSync();o=Promise.resolve({kernelMs:Kn()-a})}if(ee().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<s.length;u++){const c=s[u];c.data().then(h=>{IM(h,c.dtype,e)})}return{kernelName:e,outputs:s,inputs:n,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:r,timeMs:s,inputs:i,extraInfo:o}=e;r.forEach(a=>{Promise.all([a.data(),s,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],i,l[2])})})}}function IM(t,e,n){if(e!=="float32")return!1;for(let r=0;r<t.length;r++){const s=t[r];if(isNaN(s)||!isFinite(s))return console.warn(`Found ${s} in the result of '${n}'`),!0}return!1}class TM{logKernelProfile(e,n,r,s,i,o){const a=typeof s=="number"?Ol(`${s}ms`,9):s.error,l=Ol(e,25),u=n.rank,c=n.size,h=Ol(n.shape.toString(),14);let f="";for(const d in i){const p=i[d];if(p!=null){const g=p.shape||n.shape,m=g.length;f+=`${d}: ${m}D ${m>0?g:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${h}	%c${c}	%c${f}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NM(t,e,n){const r={},s={};for(let l=0;l<e.length;l++)r[e[l].id]=!0;for(let l=0;l<t.length;l++){const u=t[l],c=u.inputs;for(const h in c){const f=c[h];let d=!1;for(let p=0;p<e.length;p++)if(r[f.id]){u.outputs.forEach(g=>r[g.id]=!0),d=!0,s[u.id]=!0;break}if(d)break}}const i={};i[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const u=t[l],c=u.inputs;for(let h=0;h<u.outputs.length;h++)if(i[u.outputs[h].id]){for(const f in c)i[c[f].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const u=t[l];if(s[u.id]&&o[u.id]){const c={};for(const f in u.inputs){const d=u.inputs[f];r[d.id]&&(c[f]=d)}const h=Object.assign({},u);h.inputs=c,h.outputs=u.outputs,a.push(h)}}return a}function _M(t,e,n,r){for(let s=e.length-1;s>=0;s--){const i=e[s],o=[];if(i.outputs.forEach(l=>{const u=t[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=n(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const c=i.inputs[l];if(!ft(u.shape,c.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${c.shape}'`);if(t[c.id]==null)t[c.id]=u;else{const h=t[c.id];t[c.id]=r(h,u),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uw=20,Qu=3,dg=7;function AM(t,e,n,r){const s=Re(e),i=EM(t,e,n,s),o=e.length,a=Pf(t,e,n,s,i),l=["Tensor"];return r&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function EM(t,e,n,r){const s=se(e),i=r[r.length-1],o=new Array(i).fill(0),a=e.length,l=n==="complex64"?fc(t):t;if(a>1)for(let u=0;u<s/i;u++){const c=u*i;for(let h=0;h<i;h++)o[h]=Math.max(o[h],hc(l[c+h],0,n).length)}return o}function hc(t,e,n){let r;return Array.isArray(t)?r=`${parseFloat(t[0].toFixed(dg))} + ${parseFloat(t[1].toFixed(dg))}j`:gh(t)?r=`'${t}'`:n==="bool"?r=Ek(t):r=parseFloat(t.toFixed(dg)).toString(),Ol(r,e)}function Ek(t){return t===0?"false":"true"}function Pf(t,e,n,r,s,i=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const g=fc(t);return[hc(g[0],0,n)]}return n==="bool"?[Ek(t[0])]:[t[0].toString()]}if(l===1){if(a>uw){const m=Qu*o;let b=Array.from(t.slice(0,m)),x=Array.from(t.slice((a-Qu)*o,a*o));return n==="complex64"&&(b=fc(b),x=fc(x)),["["+b.map((v,y)=>hc(v,s[y],n)).join(", ")+", ..., "+x.map((v,y)=>hc(v,s[a-Qu+y],n)).join(", ")+"]"]}return["["+(n==="complex64"?fc(t):Array.from(t)).map((m,b)=>hc(m,s[b],n)).join(", ")+"]"]}const u=e.slice(1),c=r.slice(1),h=r[0]*o,f=[];if(a>uw){for(let g=0;g<Qu;g++){const m=g*h,b=m+h;f.push(...Pf(t.slice(m,b),u,n,c,s,!1))}f.push("...");for(let g=a-Qu;g<a;g++){const m=g*h,b=m+h;f.push(...Pf(t.slice(m,b),u,n,c,s,g===a-1))}}else for(let g=0;g<a;g++){const m=g*h,b=m+h;f.push(...Pf(t.slice(m,b),u,n,c,s,g===a-1))}const d=l===2?",":"";f[0]="["+(a>0?f[0]+d:"");for(let g=1;g<f.length-1;g++)f[g]=" "+f[g]+d;let p=`,
`;for(let g=2;g<l;g++)p+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(i?"":p),f}function fc(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kn{constructor(e,n,r){if(this.dtype=n,this.shape=e.slice(),this.size=se(e),r!=null){const s=r.length;L(s===this.size,()=>`Length of values '${s}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Gt(n,this.size),this.strides=Re(e)}set(e,...n){n.length===0&&(n=[0]),L(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const r=this.locToIndex(n);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const s of e){if(s<0||s>=this.shape[n]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}n++}let r=e[e.length-1];for(let s=0;s<e.length-1;++s)r+=this.strides[s]*e[s];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let r=0;r<n.length-1;++r)n[r]=Math.floor(e/this.strides[r]),e-=n[r]*this.strides[r];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return bs().makeTensor(this.values,this.shape,this.dtype)}}let bs=null,El=null;function RM(t){bs=t}function DM(t){El=t}class en{constructor(e,n,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=se(e),this.strides=Re(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return El.buffer(this.shape,this.dtype,e)}bufferSync(){return El.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return ks(this.shape,e,this.dtype==="complex64")}arraySync(){return ks(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=bs().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(r=>vo(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),bs().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=bs().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>vo(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await bs().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),bs().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return El.print(this,e)}clone(){return this.throwIfDisposed(),El.clone(this)}toString(e=!1){const n=this.dataSync();return AM(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),El.cast(this,e)}variable(e=!0,n,r){return this.throwIfDisposed(),bs().makeVariable(this,e,n,r)}}Object.defineProperty(en,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function re(){return N4("Tensor",()=>en)}re();class hd extends en{constructor(e,n,r,s){super(e.shape,e.dtype,e.dataId,s),this.trainable=n,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!ft(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);bs().disposeTensor(this),this.dataId=e.dataId,bs().incRef(this,null)}dispose(){bs().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(hd,Symbol.hasInstance,{value:t=>t instanceof en&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cw;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(cw||(cw={}));var B2;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(B2||(B2={}));var V2;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(V2||(V2={}));var W2;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(W2||(W2={}));var U2;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(U2||(U2={}));const MM={float32:W2,int32:B2,bool:V2,complex64:U2};function Cr(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return MM[t][e]}function bx(t){return Cr(t,"int32")}function Rk(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function Dk(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ht(t,e){if(t.dtype===e.dtype)return[t,e];const n=Cr(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Mk(t){const e=[];return Fk(t,e,new Set),e}function Fk(t,e,n){if(t==null)return;if(t instanceof en){e.push(t);return}if(!FM(t))return;const r=t;for(const s in r){const i=r[s];n.has(i)||(n.add(i),Fk(i,e,n))}}function FM(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pg(t){return t.kernelName!=null}class hw{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Yl{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new hw}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const r=e[n];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,r=1){return e in this.registryFactory?(Rr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:r}=this.initializeBackend(e);if(!(r?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new $M(this.backendInstance),!0}setupRegisteredKernels(){ow(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){ow(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=n.factory();if(r&&!(r instanceof C4)&&typeof r.then=="function"){const s=++this.pendingBackendInitId,i=r.then(o=>s<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,Rr(`Initialization of backend ${e} failed`),Rr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Rr(`Initialization of backend ${e} failed`),Rr(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const r=e[n],{success:s,asyncInit:i}=this.initializeBackend(r);if(i||s)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const r=this.state.tensorInfo.get(n),s=r.backend,i=this.readSync(n),o=s.refCount(n);s.disposeData(n,!0),r.backend=e,e.move(n,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let r=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let s;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(s),()=>(s=n(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(e,n,r){e();try{const s=r();return n(),s}catch(s){throw n(),s}}nextTensorId(){return Yl.nextTensorId++}nextVariableId(){return Yl.nextVariableId++}clone(e){const n=K.runKernel(Lh,{x:e}),r={x:e},s=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return K.runKernel(Ch,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,r,[n],s,i,{}),n}runKernel(e,n,r){if(this.backendName==null&&this.backend,!(sw(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,r){const s=this.backend.numDataIds();let i=0;r.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=s-n-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,r=[];const s=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=pg(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(pg(e)){const{kernelName:p,inputs:g,attrs:m}=e;this.backendName==null&&this.backend;const b=sw(p,this.backendName);L(b!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const x=this.backend.numDataIds();l=b.kernelFunc({inputs:g,attrs:m,backend:this.backend});const v=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,x,v);const y=v.map(w=>w.rank!=null?w:this.makeTensorFromTensorInfo(w));if(s){const w=this.getTensorsForGradient(p,g,y);r=this.saveTensorsForBackwardMode(w)}return y}}else{const{forwardFunc:p}=e,g=m=>{s&&(r=m.map(b=>this.keep(this.clone(b))))};a=()=>{const m=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,g));const b=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,m,b),b}}const{inputs:c,attrs:h}=e,f=pg(e)?null:e.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(d=this.profiler.profileKernel(u,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),n=d.outputs)}),s&&this.addTapeNode(u,c,n,f,r,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(p=>c[p]!=null?c[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,n,r){const s=iw(e);if(s!=null){const i=s.inputsToSave||[],o=s.outputsToSave||[];let a;s.saveAllInputs?(L(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(u=>n[u])):a=i.map(u=>n[u]);const l=r.filter((u,c)=>o[c]);return a.concat(l)}return[]}makeTensor(e,n,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;let i=e;r==="string"&&gh(e[0])&&(i=e.map(l=>mo(l)));const o=s.write(i,n,r),a=new en(n,r,o,this.nextTensorId());if(this.trackTensor(a,s),r==="string"){const l=this.state.tensorInfo.get(o),u=eM(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,n,r,s){r=r||"float32";const i={dataId:e,shape:n,dtype:r};return this.makeTensorFromTensorInfo(i,s)}makeTensorFromTensorInfo(e,n){const{dataId:r,shape:s,dtype:i}=e,o=new en(s,i,r,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,r,s){r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.cast(s));const i=new hd(e,n,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*ad(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof hd||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*ad(e.dtype);this.state.numBytes-=r}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const s of this.state.activeProfile.kernels)s.kernelTimeMs=await s.kernelTimeMs,s.extraInfo=await s.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,r,s,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:r,saved:i},l=iw(e);l!=null&&(s=l.gradFunc),s!=null&&(a.gradient=u=>(u=u.map((c,h)=>{if(c==null){const f=r[h],d=_n(f.size,f.dtype);return this.makeTensor(d,f.shape,f.dtype)}return c}),s(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=Mk(e),r=new Set(n.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!r.has(o.id)&&o.dispose()}const s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(i=>{!i.kept&&i.scopeId===s.id&&this.track(i)})}gradients(e,n,r,s=!1){if(L(n.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));L(i instanceof en,()=>"The result y returned by f() must be a tensor.");const o=NM(this.state.activeTape,n,i);if(!s&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=r??OM(i.shape),_M(a,o,u=>this.tidy(u),LM);const l=n.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const c of u.saved)c.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return L(M2(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{L(n.every(a=>a instanceof en),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const s={};n.forEach((a,l)=>{s[l]=a});const i=(a,l)=>(r=e(...n,l),L(r.value instanceof en,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),L(M2(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(a,l)=>{const u=r.gradFunc(a,l),c=Array.isArray(u)?u:[u];L(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),L(c.every(f=>f instanceof en),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return c.forEach((f,d)=>{h[d]=()=>f}),h};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=Kn(),r=await this.backend.time(e);return r.wallMs=Kn()-n,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new hw;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Yl.nextTensorId=0;Yl.nextVariableId=0;function OM(t){const e=I4(se(t),"float32");return K.makeTensor(e,t,"float32")}function Ok(){const t=rk();if(t._tfengine==null){const e=new rM(t);t._tfengine=new Yl(e)}return aM(t._tfengine.ENV),RM(()=>t._tfengine),t._tfengine}const K=Ok();function LM(t,e){const n={a:t,b:e};return K.runKernel(Au,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zM(){return typeof navigator<"u"&&navigator!=null}function Lk(t){if(t||zM()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function zk(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const or=ee();or.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});or.registerFlag("IS_BROWSER",()=>zk());or.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");or.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));or.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));or.registerFlag("PROD",()=>!1);or.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>or.getBool("DEBUG"));or.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);or.registerFlag("IS_TEST",()=>!1);or.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>or.getBool("DEBUG"));or.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);or.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);or.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1(t,e){let n=t;if(ss(t))return e==="string"?[]:[t.length];if(Rk(t)){const s=t.channels||"RGBA";return[t.height,t.width*s.length]}else if(Dk(t))return[t.buffer.size/(e==null?4:ad(e))];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||ss(n)&&e!=="string";)r.push(n.length),n=n[0];return Array.isArray(t)&&ee().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Pk(t,r,[]),r}function Pk(t,e,n){if(n=n||[],!Array.isArray(t)&&!ss(t)){L(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}L(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),L(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const r=e.slice(1);for(let s=0;s<t.length;++s)Pk(t[s],r,n.concat(s))}function fw(t,e,n,r){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function V(t,e,n,r="numeric"){if(t instanceof re())return fw(r,t.dtype,e,n),t;let s=Nu(t);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),fw(r,s,e,n),t==null||!ss(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const i=R1(t,s);!ss(t)&&!Array.isArray(t)&&(t=[t]);const a=s!=="string"?tl(t,s):Ca(t,[],!0);return K.makeTensor(a,i,s)}function Bk(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,o)=>V(i,`${e}[${o}]`,n,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PM="__op";function Y(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+PM;const s=(...i)=>{K.startScope(n);try{const o=r(...i);return T4(o)&&console.error("Cannot return a Promise inside of tidy."),K.endScope(o),o}catch(o){throw K.endScope(null),o}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BM(t,e){const n=V(t,"real","complex"),r=V(e,"imag","complex");ls(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return K.runKernel(O4,s)}const $a=Y({complex_:BM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1(t,e,n,r){if(r==null)r=Nu(t);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Dk(t)||Rk(t)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return K.backend.createTensorFromGPUData(t,e||n,r)}if(!ss(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Wi(e);const s=se(e),i=se(n);L(s===i,()=>`Based on the provided shape, [${e}], the tensor should have ${s} values but has ${i}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==se(e.slice(o)):!0;L(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!ss(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=r!=="string"?tl(t,r):Ca(t,[],!0),K.makeTensor(t,e,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(t,e,n){const r=R1(t,n);return D1(t,e,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fd={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Lo{static join(e){return new Lo(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(r=>ss(r)?r.buffer:r),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let r=0;r<e.length;r++){const s=e[r];r!==e.length-1&&s.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=n+s.byteLength;this.shards.push({buffer:s,start:n,end:i}),n=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const r=this.findShardForByte(e);if(r===-1)throw new Error(`Could not find start shard for byte ${e}`);const s=n-e,i=new ArrayBuffer(s),o=new Uint8Array(i);let a=0;for(let l=r;l<this.shards.length;l++){const u=this.shards[l],h=e+a-u.start,f=a,p=Math.min(n,u.end)-u.start,g=new Uint8Array(u.buffer,h,p-h);if(o.set(g,f),a+=g.length,n<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(s){return e<s.start?-1:e>=s.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=VM(this.shards,n);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function VM(t,e){let n=0,r=t.length;for(;n<=r;){const s=Math.floor((r-n)/2)+n,i=e(t[s]);if(i===0)return s;i<0?r=s:n=s+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fs(){return K}function dw(){return K.memory()}function Q(t,e){return K.tidy(t,e)}function Ze(t){Mk(t).forEach(n=>n.dispose())}function Ks(t){return K.keep(t)}function Vk(t,e,n=1){return K.registerBackend(t,e,n)}function WM(){return K.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zl=4;async function pw(t,e){const n=[],r=[],s=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<s.length;++o){const a=s[o],l=Array.isArray(t)?t[o].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const c=new Promise(async h=>{const f=await l.bytes(),d=f.reduce((m,b)=>m+b.length,0)+Zl*f.length,p=new Uint8Array(d);let g=0;for(let m=0;m<f.length;m++){const b=f[m],x=new Uint8Array(new Uint32Array([b.length]).buffer);p.set(x,g),g+=Zl,p.set(b,g),g+=b.length}h(p)});r.push(c)}else r.push(l.data());e!=null&&(u.group=e),n.push(u)}const i=await Promise.all(r);return{data:qM(i),specs:n}}function UM(t,e){const n=new Lo(t),r={};let s=0;for(const i of e){const o=GM(i,(a,l)=>n.slice(s+a,s+l));r[i.name]=HM(i,n.slice(s,s+o)),s+=o}return r}function GM(t,e){const n=se(t.shape);let r;if("quantization"in t){const s=t.quantization;r=fd[s.dtype]}else if(t.dtype==="string"){let s=0;for(let i=0;i<n;i++)s+=Zl+new Uint32Array(e(s,s+Zl))[0];return s}else r=fd[t.dtype];return n*r}function HM(t,e){const n=t.name,r=t.dtype,s=t.shape,i=se(s);let o,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(r!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${r}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=fd[l.dtype],c=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(r==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(c.length);for(let h=0;h<c.length;h++){const f=c[h];o[h]=f*l.scale+l.min}}else if(l.dtype==="float16")o=nF()(c);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(r==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(c.length);for(let h=0;h<c.length;h++){const f=c[h];o[h]=Math.round(f*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${r}`);a+=i*u}else if(r==="string"){const l=se(t.shape);o=[];for(let u=0;u<l;u++){const c=new Uint32Array(e.slice(a,a+Zl))[0];a+=Zl;const h=new Uint8Array(e.slice(a,a+c));o.push(h),a+=c}}else{const l=fd[r];if(r==="float32")o=new Float32Array(e);else if(r==="int32")o=new Int32Array(e);else if(r==="bool")o=new Uint8Array(e);else if(r==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),c=new Float32Array(o.length/2);for(let p=0;p<u.length;p++)u[p]=o[p*2],c[p]=o[p*2+1];const h=js(u,s,"float32"),f=js(c,s,"float32"),d=$a(h,f);return h.dispose(),f.dispose(),d}else throw new Error(`Unsupported dtype in weight '${n}': ${r}`);a+=i*l}return js(o,s,r)}function qM(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(i=>{if(e+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const r=new Uint8Array(e);let s=0;return n.forEach(i=>{r.set(new Uint8Array(i.buffer),s),s+=i.byteLength}),r.buffer}const xx=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function mw(t){return xx?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function XM(t){if(xx)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let r=0,s=e.length;r<s;r++)n+=String.fromCharCode(e[r]);return btoa(n)}function jM(t){if(xx){const r=Buffer.from(t,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;++r)n.set([e.charCodeAt(r)],r);return n.buffer}function KM(t){return Lo.join(t)}function YM(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function ZM(t,e,n){const r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(r.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=n}return t.signature!=null&&(r.signature=t.signature),t.userDefinedMetadata!=null&&(r.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(r.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(r.initializerSignature=t.initializerSignature),r}async function JM(t,e){let n,r;return t.weightsManifest!=null&&([n,r]=await e(t.weightsManifest)),ZM(t,n,r)}function yx(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:mw(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:mw(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new Lo(t.weightData).byteLength}}function gw(t){const e=[];for(const n of t)e.push(...n.weights);return e}function QM(){const t=n=>{let r=n<<13,s=0;for(;(r&8388608)===0;)s-=8388608,r<<=1;return r&=-8388609,s+=947912704,r|s},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function eF(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function tF(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function nF(){const t=QM(),e=eF(),n=tF();return r=>{const s=new ArrayBuffer(4*r.length),i=new Uint32Array(s);for(let o=0;o<r.length;o++){const a=r[o],l=t[n[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(s)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return fn.instance==null&&(fn.instance=new fn),fn.instance}static registerSaveRouter(e){fn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){fn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return fn.getHandlers(e,"save")}static getLoadHandlers(e,n){return fn.getHandlers(e,"load",n)}static getHandlers(e,n,r){const s=[];return(n==="load"?fn.getInstance().loadRouters:fn.getInstance().saveRouters).forEach(o=>{const a=o(e,r);a!==null&&s.push(a)}),s}}const rF=t=>fn.getSaveHandlers(t),sF=(t,e)=>fn.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G2="tensorflowjs",H2=1,fa="models_store",ao="model_info_store";function Wk(){if(!ee().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function q2(t){const e=t.result;e.createObjectStore(fa,{keyPath:"modelPath"}),e.createObjectStore(ao,{keyPath:"modelPath"})}class Ia{constructor(e){if(this.indexedDB=Wk(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((r,s)=>{const i=this.indexedDB.open(G2,H2);i.onupgradeneeded=()=>q2(i),i.onsuccess=()=>{const o=i.result;if(n==null){const a=o.transaction(fa,"readonly"),u=a.objectStore(fa).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(u.result.modelArtifacts)},u.onerror=c=>(o.close(),s(u.error)),a.oncomplete=()=>o.close()}else{n.weightData=Lo.join(n.weightData);const a=yx(n),l=o.transaction(ao,"readwrite");let u=l.objectStore(ao),c;try{c=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return s(f)}let h;c.onsuccess=()=>{h=o.transaction(fa,"readwrite");const f=h.objectStore(fa);let d;try{d=f.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return s(p)}d.onsuccess=()=>r({modelArtifactsInfo:a}),d.onerror=p=>{u=l.objectStore(ao);const g=u.delete(this.modelPath);g.onsuccess=()=>(o.close(),s(d.error)),g.onerror=m=>(o.close(),s(d.error))}},c.onerror=f=>(o.close(),s(c.error)),l.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},i.onerror=o=>s(i.error)})}}Ia.URL_SCHEME="indexeddb://";const Uk=t=>ee().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ia.URL_SCHEME)?iF(t.slice(Ia.URL_SCHEME.length)):null;fn.registerSaveRouter(Uk);fn.registerLoadRouter(Uk);function iF(t){return new Ia(t)}function oF(t){return t.startsWith(Ia.URL_SCHEME)?t.slice(Ia.URL_SCHEME.length):t}class aF{constructor(){this.indexedDB=Wk()}async listModels(){return new Promise((e,n)=>{const r=this.indexedDB.open(G2,H2);r.onupgradeneeded=()=>q2(r),r.onsuccess=()=>{const s=r.result,i=s.transaction(ao,"readonly"),a=i.objectStore(ao).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(s.close(),n(a.error)),i.oncomplete=()=>s.close()},r.onerror=s=>n(r.error)})}async removeModel(e){return e=oF(e),new Promise((n,r)=>{const s=this.indexedDB.open(G2,H2);s.onupgradeneeded=()=>q2(s),s.onsuccess=()=>{const i=s.result,o=i.transaction(ao,"readwrite"),a=o.objectStore(ao),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const c=a.delete(e),h=()=>{u=i.transaction(fa,"readwrite");const d=u.objectStore(fa).delete(e);d.onsuccess=()=>n(l.result.modelArtifactsInfo),d.onerror=p=>r(l.error)};c.onsuccess=h,c.onerror=f=>(h(),i.close(),r(l.error))}},l.onerror=c=>(i.close(),r(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},s.onerror=i=>r(s.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $i="/",Rl="tensorflowjs_models",Gk="info",lF="model_topology",uF="weight_specs",cF="weight_data",hF="model_metadata";function Hk(t){return{info:[Rl,t,Gk].join($i),topology:[Rl,t,lF].join($i),weightSpecs:[Rl,t,uF].join($i),weightData:[Rl,t,cF].join($i),modelMetadata:[Rl,t,hF].join($i)}}function qk(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function fF(t){const e=t.split($i);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join($i)}function dF(t){return t.startsWith(Ta.URL_SCHEME)?t.slice(Ta.URL_SCHEME.length):t}class Ta{constructor(e){if(!ee().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Hk(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=yx(e),i=Lo.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,XM(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:s}}catch{throw qk(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=r;const s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=s;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=jM(o),n}}Ta.URL_SCHEME="localstorage://";const Xk=t=>ee().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ta.URL_SCHEME)?pF(t.slice(Ta.URL_SCHEME.length)):null;fn.registerSaveRouter(Xk);fn.registerLoadRouter(Xk);function pF(t){return new Ta(t)}class mF{constructor(){L(ee().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),L(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=Rl+$i,r=$i+Gk;for(let s=0;s<this.LS.length;++s){const i=this.LS.key(s);if(i.startsWith(n)&&i.endsWith(r)){const o=fF(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=dF(e);const n=Hk(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(n.info));return qk(n),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bw="://";class Os{constructor(){this.managers={}}static getInstance(){return Os.instance==null&&(Os.instance=new Os),Os.instance}static registerManager(e,n){L(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(bw)&&(e=e.slice(0,e.indexOf(bw))),L(e.length>0,()=>"scheme must not be an empty string.");const r=Os.getInstance();L(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=n}static getManager(e){const n=Os.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(Os.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gF{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!ee().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const s=this.functionRefs[r.data.index];s(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return Ik(e)}}if(ee().get("IS_BROWSER")){ee().setPlatform("browser",new gF);try{Os.registerManager(Ta.URL_SCHEME,new mF)}catch{}try{Os.registerManager(Ia.URL_SCHEME,new aF)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bF={importFetch:()=>require("node-fetch")};let mg;class xF{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return ee().global.fetch!=null?ee().global.fetch(e,n):(mg==null&&(mg=bF.importFetch()),mg(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ee().get("IS_NODE")&&!ee().get("IS_BROWSER")&&ee().setPlatform("node",new xF);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qe(t,e="float32",n){return e=e||"float32",Wi(t),new kn(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yF(t,e){const n=V(t,"x","cast");if(!QD(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return K.runKernel(Ch,r,s)}const we=Y({cast_:yF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vF(t){const n={x:V(t,"x","clone","string_or_numeric")};return K.runKernel(Lh,n)}const ga=Y({clone_:vF});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wF(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Ok();const kF={buffer:Qe,cast:we,clone:ga,print:wF};DM(kF);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SF(t,e){let n=V(t,"a","add"),r=V(e,"b","add");[n,r]=Ht(n,r);const s={a:n,b:r};return K.runKernel(Au,s)}const he=Y({add_:SF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CF(t,e){let n=V(t,"a","floorDiv"),r=V(e,"b","floorDiv");[n,r]=Ht(n,r);const s={a:n,b:r};return K.runKernel(Fh,s)}const jk=Y({floorDiv_:CF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $F(t,e){let n=V(t,"a","div"),r=V(e,"b","div");if([n,r]=Ht(n,r),n.dtype==="int32"&&r.dtype==="int32")return jk(n,r);const s={a:n,b:r},i={};return K.runKernel(_h,s,i)}const Ee=Y({div_:$F});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IF(t,e){let n=V(t,"a","mul"),r=V(e,"b","mul");[n,r]=Ht(n,r);const s={a:n,b:r};return K.runKernel(qh,s)}const H=Y({mul_:IF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TF(t){const e=V(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return K.runKernel(zp,n)}else{const n={x:e};return K.runKernel(Ep,n)}}const dn=Y({abs_:TF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NF(t){const n={x:V(t,"x","acos")};return K.runKernel(bh,n)}const _F=Y({acos_:NF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AF(t){const n={x:V(t,"x","acosh")};return K.runKernel(xh,n)}const EF=Y({acosh_:AF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RF(t,e=null,n=!1){const s={x:V(t,"x","all","bool")},i={axis:e,keepDims:n};return K.runKernel(A4,s,i)}const Kk=Y({all_:RF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DF(t,e=null,n=!1){const s={x:V(t,"x","any","bool")},i={axis:e,keepDims:n};return K.runKernel(E4,s,i)}const X2=Y({any_:DF});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MF(t,e=0){const r={x:V(t,"x","argMax")},s={axis:e};return K.runKernel(Rp,r,s)}const Bc=Y({argMax_:MF});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FF(t,e=0){const r={x:V(t,"x","argMin")},s={axis:e};return K.runKernel(Dp,r,s)}const OF=Y({argMin_:FF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LF(t){const n={x:V(t,"x","asin")};return K.runKernel(yh,n)}const zF=Y({asin_:LF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PF(t){const n={x:V(t,"x","asinh")};return K.runKernel(vh,n)}const BF=Y({asinh_:PF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VF(t){const n={x:V(t,"x","atan")};return K.runKernel(wh,n)}const WF=Y({atan_:VF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UF(t,e){let n=V(t,"a","atan2"),r=V(e,"b","atan2");[n,r]=Ht(n,r);const s={a:n,b:r};return K.runKernel(Sh,s)}const GF=Y({atan2_:UF});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HF(t){const n={x:V(t,"x","atanh")};return K.runKernel(kh,n)}const qF=Y({atanh_:HF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f0(t,e,n,r,s="NHWC",i){const o=t[3],a=[...e,o],l=Gi(s);return Cn(t,a,n,i,r,null,null,l)}function us(t,e,n,r,s,i,o="channelsLast"){const[a,l]=Vc(e);let u;if(o==="channelsLast")u=[a,l,t[3],t[3]];else if(o==="channelsFirst")u=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Cn(t,u,n,r,s,i,!1,o)}function Ui(t,e,n,r,s,i,o="NDHWC"){const[a,l,u]=j2(e);let c,h;if(o==="NDHWC")h="channelsLast",c=[a,l,u,t[4],t[4]];else if(o==="NCDHW")h="channelsFirst",c=[a,l,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return zo(t,c,n,r,s,!1,h,i)}function Cn(t,e,n,r,s,i,o=!1,a="channelsLast"){let[l,u,c,h]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,c,h]=t;else if(a==="channelsFirst")[l,h,u,c]=t;else throw new Error(`Unknown dataFormat ${a}`);const[f,d,,p]=e,[g,m]=Vc(n),[b,x]=Vc(r),v=zl(f,b),y=zl(d,x),{padInfo:w,outHeight:C,outWidth:T}=KF(s,u,c,g,m,v,y,i,a),N=o?p*h:p;let $;return a==="channelsFirst"?$=[l,N,C,T]:a==="channelsLast"&&($=[l,C,T,N]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:h,outHeight:C,outWidth:T,outChannels:N,padInfo:w,strideHeight:g,strideWidth:m,filterHeight:f,filterWidth:d,effectiveFilterHeight:v,effectiveFilterWidth:y,dilationHeight:b,dilationWidth:x,inShape:t,outShape:$,filterShape:e}}function zo(t,e,n,r,s,i=!1,o="channelsLast",a){let[l,u,c,h,f]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,c,h,f]=t;else if(o==="channelsFirst")[l,f,u,c,h]=t;else throw new Error(`Unknown dataFormat ${o}`);const[d,p,g,,m]=e,[b,x,v]=j2(n),[y,w,C]=j2(r),T=zl(d,y),N=zl(p,w),$=zl(g,C),{padInfo:_,outDepth:S,outHeight:M,outWidth:F}=YF(s,u,c,h,b,x,v,T,N,$,a),A=i?m*f:m;let E;return o==="channelsFirst"?E=[l,A,S,M,F]:o==="channelsLast"&&(E=[l,S,M,F,A]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:c,inWidth:h,inChannels:f,outDepth:S,outHeight:M,outWidth:F,outChannels:A,padInfo:_,strideDepth:b,strideHeight:x,strideWidth:v,filterDepth:d,filterHeight:p,filterWidth:g,effectiveFilterDepth:T,effectiveFilterHeight:N,effectiveFilterWidth:$,dilationDepth:y,dilationHeight:w,dilationWidth:C,inShape:t,outShape:E,filterShape:e}}function XF(t,e,n,r,s){r==null&&(r=vx(t,e,n));const i=t[0],o=t[1],a=Wc((i-e+2*r)/n+1,s),l=Wc((o-e+2*r)/n+1,s);return[a,l]}function jF(t,e,n,r,s,i){s==null&&(s=vx(t,e[0],r[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*s>=e[a]&&(o[a]=Wc((t[a]-e[a]+2*s)/r[a]+1,i));return o}function vx(t,e,n,r=1){const s=zl(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}function Vc(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function j2(t){return typeof t=="number"?[t,t,t]:t}function zl(t,e){return e<=1?t:t+(t-1)*(e-1)}function KF(t,e,n,r,s,i,o,a,l){let u,c,h;if(typeof t=="number"){u={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const d=XF([e,n],i,r,t,a);c=d[0],h=d[1]}else if(t==="same"){c=Math.ceil(e/r),h=Math.ceil(n/s);const f=Math.max(0,(c-1)*r+i-e),d=Math.max(0,(h-1)*s+o-n),p=Math.floor(f/2),g=f-p,m=Math.floor(d/2),b=d-m;u={top:p,bottom:g,left:m,right:b,type:"SAME"}}else if(t==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/r),h=Math.ceil((n-o+1)/s);else if(typeof t=="object"){const f=l==="channelsLast"?t[1][0]:t[2][0],d=l==="channelsLast"?t[1][1]:t[2][1],p=l==="channelsLast"?t[2][0]:t[3][0],g=l==="channelsLast"?t[2][1]:t[3][1];u={top:f,bottom:d,left:p,right:g,type:f===0&&d===0&&p===0&&g===0?"VALID":"EXPLICIT"},c=Wc((e-i+f+d)/r+1,a),h=Wc((n-o+p+g)/s+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outHeight:c,outWidth:h}}function YF(t,e,n,r,s,i,o,a,l,u,c){let h,f,d,p;if(t==="valid"&&(t=0),typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const m=jF([e,n,r,1],[a,l,u],1,[s,i,o],t,c);f=m[0],d=m[1],p=m[2]}else if(t==="same"){f=Math.ceil(e/s),d=Math.ceil(n/i),p=Math.ceil(r/o);const g=(f-1)*s+a-e,m=(d-1)*i+l-n,b=(p-1)*o+u-r,x=Math.floor(g/2),v=g-x,y=Math.floor(m/2),w=m-y,C=Math.floor(b/2),T=b-C;h={top:y,bottom:w,left:C,right:T,front:x,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}function Wc(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Na(t){const[e,n,r]=Vc(t);return e===1&&n===1&&r===1}function Rn(t,e){return Na(t)||Na(e)}function _a(t){return Vc(t).every(e=>e>0)}function Gi(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function fr(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")L(Kl(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(s=>{L(Kl(s),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${s}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZF(t,e){const r={x:V(t,"x","reshape","string_or_numeric")},s={shape:e};return K.runKernel(x1,r,s)}const J=Y({reshape_:ZF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JF(t,e,n,r,s){const i=V(t,"x","avgPool","float32"),o=1;L(Rn(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=J(i,[1,i.shape[0],i.shape[1],i.shape[2]])),L(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),fr("avgPool",r,s);const u={x:a},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let h=K.runKernel(Mp,u,c);return h=we(h,i.dtype),l?J(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const wx=Y({avgPool_:JF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QF(t,e,n,r,s,i="NDHWC"){const o=V(t,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=J(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),L(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),L(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),L(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),fr("avgPool3d",r,s);const u={x:a},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:i};let h=K.runKernel(Fp,u,c);return h=we(h,a.dtype),l?J(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const eO=Y({avgPool3d_:QF});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tO(t,e=0){L(t.length>=1,()=>"Pass at least one tensor to concat");const n=Bk(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),n.length===1)return ga(n[0]);const r=n,s={axis:e};return K.runKernel(Pp,r,s)}const Un=Y({concat_:tO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nO(t,e,n=!1,r=!1){let s=V(t,"a","matMul"),i=V(e,"b","matMul");[s,i]=Ht(s,i);const o={a:s,b:i},a={transposeA:n,transposeB:r};return K.runKernel(Op,o,a)}const ht=Y({matMul_:nO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rO(t){const n={x:V(t,"x","sigmoid","float32")};return K.runKernel(r0,n)}const Eu=Y({sigmoid_:rO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sO(t,e,n){const r=V(t,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const s={x:r},i={begin:e,size:n};return K.runKernel(S1,s,i)}const vt=Y({slice_:sO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iO(t){const n={x:V(t,"x","tanh","float32")};return K.runKernel(u0,n)}const M1=Y({tanh_:iO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oO(t,e,n){const r=V(t,"x","batchToSpaceND"),s=e.reduce((a,l)=>a*l);L(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),L(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),L(r.shape[0]%s===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`);const i={x:r},o={blockShape:e,crops:n};return K.runKernel(Lp,i,o)}const kx=Y({batchToSpaceND_:oO});function aO(t){let e;return t.rank===0||t.rank===1?e=J(t,[1,1,1,t.size]):t.rank===2?e=J(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=J(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lO(t,e,n,r,s,i){i==null&&(i=.001);const o=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let u;s!=null&&(u=V(s,"scale","batchNorm"));let c;r!=null&&(c=V(r,"offset","batchNorm")),L(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),L(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),L(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:aO(o),scale:u,offset:c,mean:a,variance:l},d={varianceEpsilon:i},p=K.runKernel(jp,f,d);return J(p,o.shape)}const F1=Y({batchNorm_:lO});function uO(t,e,n,r,s,i){const o=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let u;s!=null&&(u=V(s,"scale","batchNorm"));let c;return r!=null&&(c=V(r,"offset","batchNorm")),L(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),L(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),L(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&L(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&L(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),F1(o,a,l,c,u,i)}const cO=Y({batchNorm2d_:uO});function hO(t,e,n,r,s,i){const o=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let u;s!=null&&(u=V(s,"scale","batchNorm"));let c;return r!=null&&(c=V(r,"offset","batchNorm")),L(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),L(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),L(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&L(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&L(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),F1(o,a,l,c,u,i)}const fO=Y({batchNorm3d_:hO});function dO(t,e,n,r,s,i){const o=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let u;s!=null&&(u=V(s,"scale","batchNorm"));let c;return r!=null&&(c=V(r,"offset","batchNorm")),L(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),L(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),L(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&L(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&L(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),F1(o,a,l,c,u,i)}const pO=Y({batchNorm4d_:dO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mO(t,e,n){const r=V(t,"x","bincount"),s=V(e,"weights","bincount");L(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),L(n>=0,()=>`size must be non-negative, but got ${n}.`),L(s.size===r.size||s.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`);const i={x:r,weights:s},o={size:n};return K.runKernel(M4,i,o)}const gO=Y({bincount_:mO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bO(t,e){let n=V(t,"broadcastTo","x");const r=n.shape;if(Wi(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const u=n.shape.slice();for(;u.length<e.length;)u.unshift(1);n=J(n,u)}const s=n.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(s[u]===e[u])i[u]=1;else if(n.shape[u]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(i.map((u,c)=>u>1?c:-1).filter(u=>u>=0).length===0)return ga(n);const a={x:n},l={reps:i};return K.runKernel(c0,a,l)}const Ac=Y({broadcastTo_:bO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xO(t){const n={x:V(t,"x","ceil","float32")};return K.runKernel($h,n)}const yO=Y({ceil_:xO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O1(t,e,n){Wi(t),n=n||Nu(e);const r={shape:t,value:e,dtype:n};return K.runKernel(K4,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vO(t,e,n){const r=V(t,"x","clipByValue");if(L(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return O1(r.shape,e,r.dtype);const s={x:r},i={clipValueMin:e,clipValueMax:n};return K.runKernel(Ih,s,i)}const Lr=Y({clipByValue_:vO});function wO(t){return Un(t,0)}const kO=Y({concat1d_:wO});function SO(t,e){return Un(t,e)}const CO=Y({concat2d_:SO});function $O(t,e){return Un(t,e)}const IO=Y({concat3d_:$O});function TO(t,e){return Un(t,e)}const NO=Y({concat4d_:TO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _O(t,e,n,r,s="NHWC",i=[1,1],o){const a=V(t,"x","conv2d","float32"),l=V(e,"filter","conv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=J(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),L(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),fr("conv2d",r,o);const h=s==="NHWC"?u.shape[3]:u.shape[1];L(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),L(Rn(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),L(_a(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),L(_a(n),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:u,filter:l},d={strides:n,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o},p=K.runKernel(Bp,f,d);return c?J(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Aa=Y({conv2d_:_O});function AO(t,e,n,r,s="NWC",i=1,o){const a=V(t,"x","conv1d"),l=V(e,"filter","conv1d");let u=a,c=!1;a.rank===2&&(c=!0,u=J(a,[1,a.shape[0],a.shape[1]])),L(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),L(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),fr("conv1d",r,o),L(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),L(Rn(n,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${i}'`),L(_a(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),L(_a(n),()=>"Error in conv1D: Stride should be larger than 0."),L(s==="NWC",()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`);const h=J(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=J(u,[u.shape[0],1,u.shape[1],u.shape[2]]),m=Aa(f,h,[1,n],r,"NHWC",[1,i],o);return c?J(m,[m.shape[2],m.shape[3]]):J(m,[m.shape[0],m.shape[2],m.shape[3]])}const Yk=Y({conv1d_:AO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EO(t,e,n,r,s,i="NHWC",o){L(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,u=!1;e.rank===3&&(u=!0,l=J(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),L(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),L(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),L(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const c=i==="NHWC"?a[3]:a[1],h=i==="NHWC"?l.shape[3]:l.shape[1];L(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),L(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),fr("conv2dDerInput",s,o);const f={dy:l,filter:n},d={strides:r,pad:s,dataFormat:i,dimRoundingMode:o,inputShape:a},p=K.runKernel(Vp,f,d);return u?J(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Sx=Y({conv2DBackpropInput_:EO});function RO(t,e,n,r,s,i){const o=V(t,"x","conv2dTranspose"),a=V(e,"filter","conv2dTranspose");return Sx(n,o,a,r,s,"NHWC",i)}const Zk=Y({conv2dTranspose_:RO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DO(t,e,n,r,s="NDHWC",i=[1,1,1]){const o=V(t,"x","conv3d"),a=V(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=J(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),L(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),L(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),L(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),L(Rn(n,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),L(s==="NDHWC",()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`),L(_a(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),L(_a(n),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:l,filter:a},h={strides:n,pad:r,dataFormat:s,dilations:i},f=K.runKernel(Wp,c,h);return u?J(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const MO=Y({conv3d_:DO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FO(t,e,n,r,s){L(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let i=t,o=e,a=!1;e.rank===4&&(a=!0,o=J(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);const l=i[4],u=o.shape[4];L(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),L(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),L(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),L(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),L(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);const c={dy:o,filter:n},h={pad:s,strides:r,inputShape:i},f=K.runKernel(P4,c,h);return a?J(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Jk=Y({conv3DBackpropInput_:FO});function OO(t,e,n,r,s){const i=V(t,"x","conv3dTranspose"),o=V(e,"filter","conv3dTranspose");return Jk(n,i,o,r,s)}const LO=Y({conv3dTranspose_:OO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zO(t){const n={x:V(t,"x","cos","float32")};return K.runKernel(Th,n)}const Cx=Y({cos_:zO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PO(t){const n={x:V(t,"x","cosh","float32")};return K.runKernel(Nh,n)}const Qk=Y({cosh_:PO});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BO(t,e=0,n=!1,r=!1){const i={x:V(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return K.runKernel(B4,i,o)}const K2=Y({cumprod_:BO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VO(t,e=0,n=!1,r=!1){const i={x:V(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return K.runKernel(Up,i,o)}const eS=Y({cumsum_:VO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WO(t,e,n,r=!1){const s=V(t,"x","denseBincount"),i=V(e,"weights","denseBincount");L(s.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`),L(s.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`),L(n>=0,()=>`size must be non-negative, but got ${n}.`),L(i.size===s.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${i.shape}.`);const o={x:s,weights:i},a={size:n,binaryOutput:r};return K.runKernel(W4,o,a)}const xw=Y({denseBincount_:WO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UO(t,e,n="NHWC"){const r=V(t,"x","depthToSpace","float32"),s=n==="NHWC"?r.shape[1]:r.shape[2],i=n==="NHWC"?r.shape[2]:r.shape[3],o=n==="NHWC"?r.shape[3]:r.shape[1];L(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),L(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e}  for depthToSpace with input shape
    ${r.shape}`),L(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${r.shape}`),L(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`);const a={x:r},l={blockSize:e,dataFormat:n};return K.runKernel(U4,a,l)}const GO=Y({depthToSpace_:UO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HO(t,e,n,r,s="NHWC",i=[1,1],o){const a=V(t,"x","depthwiseConv2d","float32"),l=V(e,"filter","depthwiseConv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=J(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),L(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const h=s==="NHWC"?u.shape[3]:u.shape[1];L(h===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${l.shape[2]}.`),fr("depthwiseConv2d",r,o);const f={x:u,filter:l},d={strides:n,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o},p=K.runKernel(Gp,f,d);return c?J(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const $x=Y({depthwiseConv2d_:HO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qO(t,e,n,r,s=[1,1],i="NHWC"){const o=V(t,"x","dilation2d"),a=V(e,"filter","dilation2d");L(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),L(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),L(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=J(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),L(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const c={x:l,filter:a},h={strides:n,pad:r,dilations:s},f=K.runKernel(Hp,c,h);return u?J(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const XO=Y({dilation2d_:qO});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jl(t,e){const n=t.length,r=[];for(let s=0;s<n;s++){const i=n-1-s,o=t[i]||1;(e[e.length-1-s]||1)>1&&o===1&&r.unshift(i)}return r}function ln(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],i=e.length-r-1,o=e[i];(s==null||s===1&&o>1)&&n.unshift(i)}return n}function Xe(t,e){const n=Math.max(t.length,e.length),r=new Array(n);for(let s=0;s<n;s++){let i=t[t.length-s-1];i==null&&(i=1);let o=e[e.length-s-1];if(o==null&&(o=1),i===1)r[n-s-1]=o;else if(o===1)r[n-s-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else r[n-s-1]=i}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jO(t,e){let n=V(t,"a","equal","string_or_numeric"),r=V(e,"b","equal","string_or_numeric");[n,r]=Ht(n,r),Xe(n.shape,r.shape);const s={a:n,b:r};return K.runKernel(qp,s)}const ti=Y({equal_:jO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KO(t,e,n){const r=V(e,"a","where"),s=V(n,"b","where"),i=V(t,"condition","where","bool"),o=Xe(Xe(i.shape,r.shape),s.shape),a=Ac(i,o),l=Ac(r,o),u=Ac(s,o),c={condition:a,t:l,e:u};return K.runKernel(k1,c)}const Gn=Y({where_:KO});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YO(t){const n={x:V(t,"x","zerosLike")};return K.runKernel(A1,n)}const it=Y({zerosLike_:YO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZO(t,e){let n=V(t,"a","div"),r=V(e,"b","div");[n,r]=Ht(n,r);const s=Ee(n,r),i=it(s),o=ti(r,i);return Gn(o,i,s)}const JO=Y({divNoNan_:ZO});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QO(t,e){const n=V(t,"t1","dot"),r=V(e,"t2","dot");L((n.rank===1||n.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);const s=n.rank===1?n.size:n.shape[1],i=r.rank===1?r.size:r.shape[0];if(L(s===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${i}.`),n.rank===1&&r.rank===1){const o=J(n,[1,-1]),a=J(r,[-1,1]),l=ht(o,a);return J(l,[])}else if(n.rank===1&&r.rank===2){const o=J(n,[1,-1]),a=J(r,[r.shape[0],r.shape[1]]),l=ht(o,a);return J(l,[l.size])}else if(n.rank===2&&r.rank===1){const o=J(r,[-1,1]),a=ht(n,o);return J(a,[a.size])}else{const o=J(r,[r.shape[0],r.shape[1]]);return ht(n,o)}}const eL=Y({dot_:QO});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tL(t,...e){const n=e.map((s,i)=>V(s,`tensors${i}`,"einsum")),r={equation:t};return K.runKernel(q4,n,r)}const ec=Y({einsum_:tL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nL(t){const n={x:V(t,"x","elu","float32")};return K.runKernel(Ah,n)}const L1=Y({elu_:nL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rL(t){let e=V(t,"x","erf");L(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=we(e,"float32"));const n={x:e};return K.runKernel(Eh,n)}const tS=Y({erf_:rL});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ix(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function nS(t,e,n){const r=t.length+e.length,s=[];let i=0,o=0;for(let a=0;a<r;a++)n.indexOf(a)===-1?s.push(t[i++]):s.push(e[o++]);return s}function xn(t,e){const n=[],r=t.length;for(let i=0;i<r;i++)e.indexOf(i)===-1&&n.push(t[i]);const s=e.map(i=>t[i]);return[n,s]}function qt(t,e){const n=e.map(r=>1);return nS(t,n,e)}function $n(t,e,n){L(Ix(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function Rt(t,e){if(Ix(t,e))return null;const n=[];for(let r=0;r<e;++r)t.indexOf(r)===-1&&n.push(r);return t.forEach(r=>n.push(r)),n}function Po(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function Xt(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sL(t,e=null,n=!1){const s={x:V(t,"x","max")},i={reductionIndices:e,keepDims:n};return K.runKernel(s1,s,i)}const Ss=Y({max_:sL});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iL(t,e=null,n=!1){const s={x:V(t,"x","min")},i={axis:e,keepDims:n};return K.runKernel(l1,s,i)}const dd=Y({min_:iL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oL(t,e){let n=V(t,"base","pow"),r=V(e,"exp","pow");[n,r]=Ht(n,r);const s={a:n,b:r};return K.runKernel(Xh,s)}const Ea=Y({pow_:oL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function He(t,e){if((ss(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ss(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return D1(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aL(t){const n={x:V(t,"x","sqrt","float32")};return K.runKernel(i0,n)}const An=Y({sqrt_:aL});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(t){const e=V(t,"x","square"),n={};return K.runKernel("Square",{x:e},n)}const kt=Y({square_:lL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uL(t,e=null,n=!1){let r=V(t,"x","sum");r.dtype==="bool"&&(r=we(r,"int32"));const s={x:r},i={axis:e,keepDims:n};return K.runKernel(C1,s,i)}const Ne=Y({sum_:uL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cL(t,e="euclidean",n=null,r=!1){t=V(t,"x","norm");const s=rS(t,e,n);let i=s.shape;if(r){const o=et(n,t.shape);i=qt(s.shape,o)}return J(s,i)}function rS(t,e,n=null){if(t.rank===0)return dn(t);if(t.rank!==1&&n===null)return rS(J(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return Ne(dn(t),n);if(e===1/0)return Ss(dn(t),n);if(e===-1/0)return dd(dn(t),n);if(e==="euclidean"||e===2)return An(Ne(Ea(dn(t),He(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return Ss(Ne(dn(t),n[0]),n[1]-1);if(e===1/0)return Ss(Ne(dn(t),n[1]),n[0]);if(e===-1/0)return dd(Ne(dn(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return An(Ne(kt(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const z1=Y({norm_:cL});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hL(t,e=null,n=!1){return z1(t,"euclidean",e,n)}const fL=Y({euclideanNorm_:hL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dL(t){const n={x:V(t,"x","exp")};return K.runKernel(Rh,n)}const zr=Y({exp_:dL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pL(t,e=0){const n=V(t,"x","expandDims","string_or_numeric");L(e<=n.rank,()=>"Axis must be <= rank of the tensor");const r={input:n},s={dim:e};return K.runKernel(Xp,r,s)}const Yn=Y({expandDims_:pL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mL(t){const n={x:V(t,"x","expm1")};return K.runKernel(Dh,n)}const gL=Y({expm1_:mL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bL(t,e){const n=V(t,"x","tile","string_or_numeric");L(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const r={x:n},s={reps:e};return K.runKernel(c0,r,s)}const Dr=Y({tile_:bL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xL(t,e,n,r="float32"){e==null&&(e=t);const s=Qe([t,e],r),i=t<=e?t:e;for(let a=0;a<i;++a)s.set(1,a,a);const o=J(s.toTensor(),[t,e]);if(n==null)return o;if(n.length===1)return Dr(Yn(o,0),[n[0],1,1]);if(n.length===2)return Dr(Yn(Yn(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return Dr(Yn(Yn(Yn(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const sS=Y({eye_:xL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yL(t){const n={x:V(t,"x","floor","float32")};return K.runKernel(Mh,n)}const P1=Y({floor_:yL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vL(t,e,n=0,r=0){const s=V(t,"x","gather"),i=V(e,"indices","gather","int32"),o={x:s,indices:i},a={axis:n,batchDims:r};return K.runKernel(Kp,o,a)}const B1=Y({gather_:vL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wL(t,e){let n=V(t,"a","greater","string_or_numeric"),r=V(e,"b","greater","string_or_numeric");[n,r]=Ht(n,r),Xe(n.shape,r.shape);const s={a:n,b:r};return K.runKernel(Yp,s)}const Pr=Y({greater_:wL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kL(t,e){let n=V(t,"a","greaterEqual","string_or_numeric"),r=V(e,"b","greaterEqual","string_or_numeric");[n,r]=Ht(n,r),Xe(n.shape,r.shape);const s={a:n,b:r};return K.runKernel(Oh,s)}const nl=Y({greaterEqual_:kL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SL(t){const n={input:V(t,"input","imag")};return K.runKernel(J4,n)}const Tx=Y({imag_:SL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CL(t){const n={x:V(t,"x","isFinite")};return K.runKernel(zh,n)}const $L=Y({isFinite_:CL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IL(t){const n={x:V(t,"x","isInf")};return K.runKernel(Ph,n)}const TL=Y({isInf_:IL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NL(t){const n={x:V(t,"x","isNaN")};return K.runKernel(Bh,n)}const _L=Y({isNaN_:NL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AL(t,e=.2){const r={x:V(t,"x","leakyRelu")},s={alpha:e};return K.runKernel(Zp,r,s)}const Nx=Y({leakyRelu_:AL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EL(t,e){let n=V(t,"a","less","string_or_numeric"),r=V(e,"b","less","string_or_numeric");[n,r]=Ht(n,r),Xe(n.shape,r.shape);const s={a:n,b:r};return K.runKernel(Jp,s)}const pd=Y({less_:EL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RL(t,e){let n=V(t,"a","lessEqual","string_or_numeric"),r=V(e,"b","lessEqual","string_or_numeric");[n,r]=Ht(n,r),Xe(n.shape,r.shape);const s={a:n,b:r};return K.runKernel(Qp,s)}const Ru=Y({lessEqual_:RL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DL(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return K.runKernel(Q4,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ML(t,e=5,n=1,r=1,s=.5){const i=V(t,"x","localResponseNormalization");L(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),L(Kl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=J(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:n,alpha:r,beta:s},c=K.runKernel(r1,l,u);return a?J(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const FL=Y({localResponseNormalization_:ML});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OL(t){const n={x:V(t,"x","log","float32")};return K.runKernel(Vh,n)}const is=Y({log_:OL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LL(t){const n={x:V(t,"x","log1p")};return K.runKernel(Wh,n)}const _x=Y({log1p_:LL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zL(t,e){L(M2(t),()=>"The f passed in variableGrads(f) must be a function"),L(e==null||Array.isArray(e)&&e.every(u=>u instanceof hd),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const u in K.registeredVariables)e.push(K.registeredVariables[u])}const r=n?e.filter(u=>!u.trainable):null,s=e.length;e=e.filter(u=>u.trainable),L(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`);const i=!0,{value:o,grads:a}=K.gradients(t,e,null,i);L(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),L(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,c)=>{a[c]!=null&&(l[u.name]=a[c])}),r!=null&&r.forEach(u=>l[u.name]=null),{value:o,grads:l}}function Ra(t){return K.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PL(t){const n={x:V(t,"x","neg")};return K.runKernel(c1,n)}const Nt=Y({neg_:PL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BL(t){const n={x:V(t,"x","softplus")};return K.runKernel(s0,n)}const d0=Y({softplus_:BL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VL(t){const e=V(t,"x","logSigmoid");return Ra(r=>({value:Nt(d0(Nt(r))),gradFunc:o=>H(o,Eu(Nt(r)))}))(e)}const WL=Y({logSigmoid_:VL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UL(t,e){let n=V(t,"a","sub"),r=V(e,"b","sub");[n,r]=Ht(n,r);const s={a:n,b:r};return K.runKernel(a0,s)}const Ie=Y({sub_:UL});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GL(t,e=-1){const n=V(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return Ra((s,i)=>{const a=Ss(s,e,!0),l=Ie(s,a),u=Ie(we(l,"float32"),is(Ne(zr(l),e,!0)));return i([u]),{value:u,gradFunc:(h,f)=>{const[d]=f,p=!0,g=zr(d);return Ie(h,H(Ne(h,e,p),g))}}})(n)}const iS=Y({logSoftmax_:GL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HL(t,e=null,n=!1){const r=V(t,"x","logSumExp"),s=et(e,r.shape),i=Ss(r,s,!0),o=Ie(r,i),a=zr(o),l=Ne(a,s),u=is(l),c=he(J(i,u.shape),u);if(n){const h=qt(c.shape,s);return J(c,h)}return c}const Ax=Y({logSumExp_:HL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(t,e){const n=V(t,"a","logicalAnd","bool"),r=V(e,"b","logicalAnd","bool");Xe(n.shape,r.shape);const s={a:n,b:r};return K.runKernel(e1,s)}const Fi=Y({logicalAnd_:qL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XL(t){const n={x:V(t,"x","logicalNot","bool")};return K.runKernel(t1,n)}const Ex=Y({logicalNot_:XL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jL(t,e){const n=V(t,"a","logicalOr","bool"),r=V(e,"b","logicalOr","bool");Xe(n.shape,r.shape);const s={a:n,b:r};return K.runKernel(n1,s)}const oS=Y({logicalOr_:jL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KL(t,e){const n=V(t,"a","logicalXor","bool"),r=V(e,"b","logicalXor","bool");return Xe(n.shape,r.shape),Fi(oS(t,e),Ex(Fi(t,e)))}const YL=Y({logicalXor_:KL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZL(t,e,n,r,s){const i=V(t,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=J(i,[1,i.shape[0],i.shape[1],i.shape[2]])),L(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),L(Rn(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),fr("maxPool",r,s);const u={x:a},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},h=K.runKernel(i1,u,c);return l?J(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Rx=Y({maxPool_:ZL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(t,e=[1,1,1],n,r,s,i="NDHWC"){const o=V(t,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=J(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),L(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),L(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),fr("maxPool3d",r,s);const u={x:a},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:i},h=K.runKernel(o1,u,c);return l?J(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const QL=Y({maxPool3d_:JL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ez(t,e){let n=V(t,"a","maximum"),r=V(e,"b","maximum");[n,r]=Ht(n,r),n.dtype==="bool"&&(n=we(n,"int32"),r=we(r,"int32")),Xe(n.shape,r.shape);const s={a:n,b:r};return K.runKernel(Uh,s)}const Bo=Y({maximum_:ez});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tz(t,e=null,n=!1){const s={x:V(t,"x","mean")},i={axis:e,keepDims:n};return K.runKernel(a1,s,i)}const Wt=Y({mean_:tz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tn(t,e="float32"){if(Wi(t),e==="complex64"){const r=tn(t,"float32"),s=tn(t,"float32");return $a(r,s)}const n=_n(se(t),e);return K.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hi(t,e="float32"){if(Wi(t),e==="complex64"){const r=Hi(t,"float32"),s=tn(t,"float32");return $a(r,s)}const n=I4(se(t),e);return K.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nz(t,e){let n=V(t,"a","minimum"),r=V(e,"b","minimum");[n,r]=Ht(n,r),n.dtype==="bool"&&(n=we(n,"int32"),r=we(r,"int32")),Xe(n.shape,r.shape);const s={a:n,b:r};return K.runKernel(Gh,s)}const Ql=Y({minimum_:nz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rz(t,e,n){L(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const r=V(t,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");L(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const s=n==="reflect"?1:0;for(let a=0;a<r.rank;a++)L(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),L(e[a][0]>=0&&e[a][0]<=r.shape[a]-s&&e[a][1]>=0&&e[a][1]<=r.shape[a]-s,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-s} or less than 0 for input of shape ${r.shape}`);const i={paddings:e,mode:n},o={x:r};return K.runKernel(u1,o,i)}const sz=Y({mirrorPad_:rz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iz(t,e){let n=V(t,"a","mod"),r=V(e,"b","mod");[n,r]=Ht(n,r);const s={a:n,b:r};return K.runKernel(Hh,s)}const oz=Y({mod_:iz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(t,e=null,n=!1){t=V(t,"x","moments");const r=et(e,t.shape),s=Wt(t,r,n);let i=s.shape;n||(i=qt(s.shape,r));const o=kt(Ie(we(t,"float32"),J(s,i))),a=Wt(o,r,n);return{mean:s,variance:a}}const Dx=Y({moments_:az});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lz(t,e){let n=V(t,"a","notEqual","string_or_numeric"),r=V(e,"b","notEqual","string_or_numeric");[n,r]=Ht(n,r),Xe(n.shape,r.shape);const s={a:n,b:r};return K.runKernel(h1,s)}const Uc=Y({notEqual_:lz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uz(t,e,n=1,r=0,s="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:V(t,"indices","oneHot","int32")},a={dtype:s,depth:e,onValue:n,offValue:r};return K.runKernel(d1,o,a)}const aS=Y({oneHot_:uz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cz(t){const n={x:V(t,"x","onesLike")};return K.runKernel(f1,n)}const os=Y({onesLike_:cz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hz(t,e,n=0){const r=V(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},i={x:r};return K.runKernel(m1,i,s)}const Mx=Y({pad_:hz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fz(t,e,n){const r=V(t,"x","spaceToBatchND");L(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),L(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),L(r.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const s={x:r},i={blockShape:e,paddings:n};return K.runKernel($1,s,i)}const Fx=Y({spaceToBatchND_:fz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dz(t,e,n,r,s,i,o){s==null&&(s=[1,1]),i==null&&(i=1),r===0&&(r="valid");const a=V(t,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=J(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(Rn(i,s),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${s}'`);const c=us(l.shape,e,i,s,r),h=[c.dilationHeight,c.dilationWidth];let f;r==="same"?f=mz([c.filterHeight,c.filterWidth],h):f=[[0,0],[0,0]];const d=h[0]===1&&h[1]===1,[p,g]=pz([c.inHeight,c.inWidth],h,f),m=d?r:"valid",b=d?l:Fx(l,h,p),v=(n==="avg"?()=>wx(b,e,i,m,o):()=>Rx(b,e,i,m,o))(),y=d?v:kx(v,h,g);return u?J(y,[y.shape[1],y.shape[2],y.shape[3]]):y}function pz(t,e,n){const r=n.map(c=>c[0]),s=n.map(c=>c[1]),i=t.concat(r,s),o=e.map((c,h)=>(c-i[h]%c)%c),a=s.map((c,h)=>c+o[h]),l=e.map((c,h)=>[r[h],a[h]]),u=e.map((c,h)=>[0,o[h]]);return[l,u]}function mz(t,e){const r=t.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),s=r.map(o=>Math.floor(o/2)),i=r.map((o,a)=>o-s[a]);return r.map((o,a)=>[s[a],i[a]])}const gz=Y({pool_:dz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bz(t,e){const n=V(t,"x","prelu"),r=V(e,"alpha","prelu"),s={x:n,alpha:r};return K.runKernel(g1,s)}const Ox=Y({prelu_:bz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xz(t,e=null,n=!1){let r=V(t,"x","prod");r.dtype==="bool"&&(r=we(r,"int32"));const s={x:r},i={axis:e,keepDims:n};return K.runKernel(b1,s,i)}const yz=Y({prod_:xz});var Bf={exports:{}},vz=Bf.exports,yw;function wz(){return yw||(yw=1,function(t){(function(e,n,r){function s(l){var u=this,c=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var c=new s(l),h=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&i(h,c),f.state=function(){return i(c,{})}),f}function a(){var l=4022871197,u=function(c){c=String(c);for(var h=0;h<c.length;h++){l+=c.charCodeAt(h);var f=.02519603282416938*l;l=f>>>0,f-=l,f*=l,l=f>>>0,f-=l,l+=f*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=o:this.alea=o})(vz,t)}(Bf)),Bf.exports}var Vf={exports:{}},kz=Vf.exports,vw;function Sz(){return vw||(vw=1,function(t){(function(e,n,r){function s(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,d=(u.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor128=o})(kz,t)}(Vf)),Vf.exports}var Wf={exports:{}},Cz=Wf.exports,ww;function $z(){return ww||(ww=1,function(t){(function(e,n,r){function s(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,d=(u.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorwow=o})(Cz,t)}(Wf)),Wf.exports}var Uf={exports:{}},Iz=Uf.exports,kw;function Tz(){return kw||(kw=1,function(t){(function(e,n,r){function s(a){var l=this;l.next=function(){var c=l.x,h=l.i,f,d;return f=c[h],f^=f>>>7,d=f^f<<24,f=c[h+1&7],d^=f^f>>>10,f=c[h+3&7],d^=f^f>>>3,f=c[h+4&7],d^=f^f<<7,f=c[h+7&7],f=f^f<<13,d^=f^f<<9,c[h]=d,l.i=h+1&7,d};function u(c,h){var f,d=[];if(h===(h|0))d[0]=h;else for(h=""+h,f=0;f<h.length;++f)d[f&7]=d[f&7]<<15^h.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?d[7]=-1:d[f],c.x=d,c.i=0,f=256;f>0;--f)c.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,d=(u.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.x&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xorshift7=o})(Iz,t)}(Uf)),Uf.exports}var Gf={exports:{}},Nz=Gf.exports,Sw;function _z(){return Sw||(Sw=1,function(t){(function(e,n,r){function s(a){var l=this;l.next=function(){var c=l.w,h=l.X,f=l.i,d,p;return l.w=c=c+1640531527|0,p=h[f+34&127],d=h[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=h[f]=p^d,l.i=f,p+(c^c>>>16)|0};function u(c,h){var f,d,p,g,m,b=[],x=128;for(h===(h|0)?(d=h,h=null):(h=h+"\0",d=0,x=Math.max(x,h.length)),p=0,g=-32;g<x;++g)h&&(d^=h.charCodeAt((g+32)%h.length)),g===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,g>=0&&(m=m+1640531527|0,f=b[g&127]^=d+m,p=f==0?p+1:0);for(p>=128&&(b[(h&&h.length||0)&127]=-1),p=127,g=4*128;g>0;--g)d=b[p+34&127],f=b[p=p+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,b[p]=d^f;c.w=m,c.X=b,c.i=p}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,d=(u.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(c.X&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.xor4096=o})(Nz,t)}(Gf)),Gf.exports}var Hf={exports:{}},Az=Hf.exports,Cw;function Ez(){return Cw||(Cw=1,function(t){(function(e,n,r){function s(a){var l=this,u="";l.next=function(){var h=l.b,f=l.c,d=l.d,p=l.a;return h=h<<25^h>>>7^f,f=f-d|0,d=d<<24^d>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^f,l.c=f=f-d|0,l.d=d<<16^f>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new s(a),c=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,d=(u.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=u.next,h.quick=h,c&&(typeof c=="object"&&i(c,u),h.state=function(){return i(u,{})}),h}n&&n.exports?n.exports=o:this.tychei=o})(Az,t)}(Hf)),Hf.exports}var qf={exports:{}};const Rz={},Dz=Object.freeze(Object.defineProperty({__proto__:null,default:Rz},Symbol.toStringTag,{value:"Module"})),Mz=gM(Dz);var Fz=qf.exports,$w;function Oz(){return $w||($w=1,function(t){(function(e,n,r){var s=256,i=6,o=52,a="random",l=r.pow(s,i),u=r.pow(2,o),c=u*2,h=s-1,f;function d(y,w,C){var T=[];w=w==!0?{entropy:!0}:w||{};var N=b(m(w.entropy?[y,v(n)]:y??x(),3),T),$=new p(T),_=function(){for(var S=$.g(i),M=l,F=0;S<u;)S=(S+F)*s,M*=s,F=$.g(1);for(;S>=c;)S/=2,M/=2,F>>>=1;return(S+F)/M};return _.int32=function(){return $.g(4)|0},_.quick=function(){return $.g(4)/4294967296},_.double=_,b(v($.S),n),(w.pass||C||function(S,M,F,A){return A&&(A.S&&g(A,$),S.state=function(){return g($,{})}),F?(r[a]=S,M):S})(_,N,"global"in w?w.global:this==r,w.state)}function p(y){var w,C=y.length,T=this,N=0,$=T.i=T.j=0,_=T.S=[];for(C||(y=[C++]);N<s;)_[N]=N++;for(N=0;N<s;N++)_[N]=_[$=h&$+y[N%C]+(w=_[N])],_[$]=w;(T.g=function(S){for(var M,F=0,A=T.i,E=T.j,D=T.S;S--;)M=D[A=h&A+1],F=F*s+D[h&(D[A]=D[E=h&E+M])+(D[E]=M)];return T.i=A,T.j=E,F})(s)}function g(y,w){return w.i=y.i,w.j=y.j,w.S=y.S.slice(),w}function m(y,w){var C=[],T=typeof y,N;if(w&&T=="object")for(N in y)try{C.push(m(y[N],w-1))}catch{}return C.length?C:T=="string"?y:y+"\0"}function b(y,w){for(var C=y+"",T,N=0;N<C.length;)w[h&N]=h&(T^=w[h&N]*19)+C.charCodeAt(N++);return v(w)}function x(){try{var y;return f&&(y=f.randomBytes)?y=y(s):(y=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(y)),v(y)}catch{var w=e.navigator,C=w&&w.plugins;return[+new Date,e,C,e.screen,v(n)]}}function v(y){return String.fromCharCode.apply(0,y)}if(b(r.random(),n),t.exports){t.exports=d;try{f=Mz}catch{}}else r["seed"+a]=d})(typeof self<"u"?self:Fz,[],Math)}(qf)),qf.exports}var gg,Iw;function Lz(){if(Iw)return gg;Iw=1;var t=wz(),e=Sz(),n=$z(),r=Tz(),s=_z(),i=Ez(),o=Oz();return o.alea=t,o.xor128=e,o.xorwow=n,o.xorshift7=r,o.xor4096=s,o.tychei=i,gg=o,gg}var Lx=Lz();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lS{constructor(e,n,r,s,i){this.mean=e,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=Lx.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const s=this.nextVal;return this.nextVal=NaN,s}let e,n,r=!1;for(;!r;){let s,i,o;do s=2*this.random()-1,i=2*this.random()-1,o=s*s+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*s*a,n=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class zz{constructor(e=0,n=1,r,s){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=Lx.alea(s)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pz(t,e=0,n=1,r,s){if(Wi(t),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const i=new lS(e,n,r,!1,s),o=Qe(t,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Y2=Y({randomNormal_:Pz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bz(t,e=0,n=1,r="float32",s){Wi(t);const i=Qe(t,r),o=new zz(e,n,null,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Da=Y({randomUniform_:Bz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gc(t,e,n=1,r="float32"){if(n===0)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return K.runKernel(ox,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vz(t){const n={input:V(t,"input","real")};return K.runKernel(ax,n)}const md=Y({real_:Vz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wz(t){const n={x:V(t,"x","reciprocal")};return K.runKernel(jh,n)}const Uz=Y({reciprocal_:Wz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gz(t){const n={x:V(t,"x","relu")};return K.runKernel(Kh,n)}const qi=Y({relu_:Gz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hz(t){const n={x:V(t,"x","relu6")};return K.runKernel(Yh,n)}const uS=Y({relu6_:Hz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qz(t,e){const r={x:V(t,"x","reverse")},s={dims:e};return K.runKernel(w1,r,s)}const Ma=Y({reverse_:qz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xz(t){const n={x:V(t,"x","round")};return K.runKernel(Zh,n)}const cS=Y({round_:Xz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jz(t){const n={x:V(t,"x","rsqrt","float32")};return K.runKernel(Jh,n)}const hS=Y({rsqrt_:jz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kz(t){const n={x:V(t,"x","selu")};return K.runKernel(Qh,n)}const fS=Y({selu_:Kz});function Yz(t,e,n,r,s,i=[1,1],o="NHWC"){const a=V(t,"x","separableConv2d"),l=V(e,"depthwiseFilter","separableConv2d"),u=V(n,"pointwiseFilter","separableConv2d");let c=a,h=!1;if(a.rank===3&&(h=!0,c=J(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");L(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),L(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),L(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),L(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),L(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const f=l.shape[2],d=l.shape[3];L(u.shape[2]===f*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*d}, but got ${u.shape[2]}.`);const p=$x(c,l,r,s,o,i),m=Aa(p,u,1,"valid",o);return h?J(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const dS=Y({separableConv2d_:Yz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zz(t){const n={x:V(t,"x","sign")};return K.runKernel(n0,n)}const Jz=Y({sign_:Zz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qz(t){const n={x:V(t,"x","sin","float32")};return K.runKernel(e0,n)}const pS=Y({sin_:Qz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eP(t){const n={x:V(t,"x","sinh")};return K.runKernel(t0,n)}const mS=Y({sinh_:eP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tP(t,e,n){const r=V(t,"x","slice1d");return L(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),vt(r,[e],[n])}const zx=Y({slice1d_:tP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nP(t,e,n){const r=V(t,"x","slice2d");return L(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),vt(r,e,n)}const gS=Y({slice2d_:nP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rP(t,e,n){const r=V(t,"x","slice3d");return L(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),vt(r,e,n)}const Px=Y({slice3d_:rP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sP(t,e,n){const r=V(t,"x","slice4d");return L(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),vt(r,e,n)}const gd=Y({slice4d_:sP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iP(t,e=-1){const n=V(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return K.runKernel(T1,r,s)}const Bx=Y({softmax_:iP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oP(t){L(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return K.runKernel(j4,e)}const bS=Y({fft_:oP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aP(t){L(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return K.runKernel(Z4,e)}const Z2=Y({ifft_:aP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lP(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=J(t,[n,e]);r=Z2(s)}else{const s=[n,2*(e-1)],i=J(md(t),[n,e]),o=J(Tx(t),[n,e]),a=Ma(vt(i,[0,1],[n,e-2]),1),l=H(Ma(vt(o,[0,1],[n,e-2]),1),He(-1)),u=Un([i,a],1),c=Un([o,l],1),h=J($a(u,c),[s[0],s[1]]);r=Z2(h)}if(r=md(r),t.rank===3&&t.shape[0]!==0){const s=r,i=t.shape[0];r=J(r,[i,r.shape[0]/i,r.shape[1]]),s.dispose()}return r}const uP=Y({irfft_:lP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cP(t,e,n=0){const s={x:V(t,"x","split")},i={numOrSizeSplits:e,axis:n};return K.runKernel(I1,s,i)}const Or=Y({split_:cP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hP(t,e){L(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(e!=null&&e<n){const p=t.shape.map(m=>0),g=t.shape.map(m=>m);g[t.shape.length-1]=e,s=vt(t,p,g),n=e}else if(e!=null&&e>n){const p=t.shape.map(g=>g);p[t.shape.length-1]=e-n,s=Un([t,tn(p)],t.shape.length-1),n=e}else s=t;const i=it(s),o=J($a(s,i),[r,n]),a=bS(o),l=Math.floor(n/2)+1,u=md(a),c=Tx(a),h=Or(u,[l,n-l],u.shape.length-1),f=Or(c,[l,n-l],c.shape.length-1),d=s.shape.slice();return d[s.shape.length-1]=l,J($a(h[0],f[0]),d)}const fP=Y({rfft_:hP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dP(t,e){let n=V(t,"a","squaredDifference"),r=V(e,"b","squaredDifference");[n,r]=Ht(n,r),Xe(n.shape,r.shape);const s={a:n,b:r},i={};return K.runKernel(o0,s,i)}const xS=Y({squaredDifference_:dP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pP(t,e){const n=V(t,"x","squeeze","string_or_numeric");return J(n,Fo(n.shape,e).newShape)}const p0=Y({squeeze_:pP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mP(t,e=0){const n=Bk(t,"tensors","stack","string_or_numeric");L(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&L(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const r=n,s={axis:e};return K.runKernel(p1,r,s)}const ni=Y({stack_:mP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gP(t,e=0){const r={x:V(t,"x","step")},s={alpha:e};return K.runKernel(h0,r,s)}const m0=Y({step_:gP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bP(t,e,n,r,s=0,i=0,o=0,a=0,l=0){const c={x:V(t,"x","stridedSlice","string_or_numeric")},h={begin:e,end:n,strides:r,beginMask:s,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return K.runKernel(fx,c,h)}const xP=Y({stridedSlice_:bP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yP(t){const n={x:V(t,"x","tan","float32")};return K.runKernel(l0,n)}const vP=Y({tan_:yP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sr(t,e){Z8(t);const n=R1(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return D1(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bg(t,e,n){if(Z8(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=R1(t,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return D1(t,e,r,n)}function yS(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(i+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(i+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(i+` update.rank != ${s+t.length-r}`);for(let o=0;o<s;++o)if(n.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-s;++o)if(n.shape[o+s]!==t[o+r])throw new Error(i+` updates.shape[${o+s}] (${n.shape[o+s]}) != shape[${o+s}] (${t[o+s]})`)}function wP(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}yS(n,e,t)}function rl(t,e,n){const r=e.shape.length,s=r>1?e.shape[r-1]:1,i=n.length;let o=1;for(let h=s;h<i;++h)o*=n[h];const a=s<1?1:s,l=se(e.shape)/a,u=[...Re(n.slice(0,s)),1],c=se(n);return{sliceRank:s,numUpdates:l,sliceSize:o,strides:u,outputSize:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kP(t,e=1,n=!0){const r=V(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const i={x:r},o={k:e,sorted:n},[a,l]=K.runKernel(dx,i,o);return{values:a,indices:l}}const SP=Y({topk_:kP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CP(t,e=0,n=1,r,s){if(Wi(t),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new lS(e,n,r,!0,s),o=Qe(t,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const vS=Y({truncatedNormal_:CP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $P(t,e=0){const n=V(t,"x","unique","string_or_numeric");L(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},s={axis:e},[i,o]=K.runKernel(mx,r,s);return{values:i,indices:o}}const IP=Y({unique_:$P});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TP(t,e,n){const r=V(t,"x","unsortedSegmentSum"),s=V(e,"segmentIds","unsortedSegmentSum","int32");L(Kl(n),()=>"numSegments must be of dtype int");const i={x:r,segmentIds:s},o={numSegments:n};return K.runKernel(_1,i,o)}const wS=Y({unsortedSegmentSum_:TP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NP(t,e=0){const n=V(t,"x","unstack","string_or_numeric");L(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const r={value:n},s={axis:e};return K.runKernel(N1,r,s)}const Fa=Y({unstack_:NP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _P(t,e=!0,n,r){return K.makeVariable(t,e,n,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kS(t,e){const n=[];for(let i=0;i<e.length;i++)e[i]&&n.push(i);const r=Qe(t,"int32"),s=Qe([n.length,t.length],"int32");for(let i=0;i<n.length;i++){const o=r.indexToLoc(n[i]),a=i*t.length;s.values.set(o,a)}return s.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AP(t,e,n){const r=V(t,"x","transpose");if(e==null&&(e=r.shape.map((o,a)=>a).reverse()),L(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(o=>{L(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();const s={x:r},i={perm:e};return r.dtype==="complex64"?Q(()=>{let o=md(r),a=Tx(r);return o=K.runKernel(Ll,{x:o},i),a=K.runKernel(Ll,{x:a},i),n&&(a=Nt(a)),$a(o,a)}):K.runKernel(Ll,s,i)}const st=Y({transpose_:AP});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EP(t,e){if(e==null)return t.shape.slice();if(ft(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)e[r]==null&&t.shape[r]!=null?n.push(t.shape[r]):n.push(e[r]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RP(t,e,n,r){const s=V(t,"x","dropout");if(L(s.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`),L(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof en?s.clone():s;const i=EP(s,n),o=1-e,a=Ee(P1(he(Da(i,0,1,"float32",r),o)),o);return H(s,a)}const DP=Y({dropout_:RP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MP(t,e,n,r,s,i="NHWC",o){let a=t;t.rank===3&&(a=J(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=J(e,[1,e.shape[0],e.shape[1],e.shape[2]])),L(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),L(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),L(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],c=i==="NHWC"?l.shape[3]:l.shape[1];L(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),L(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),fr("conv2dDerFilter",s,o);const h={x:a,dy:l},f={strides:r,pad:s,dataFormat:i,dimRoundingMode:o,filterShape:n};return K.runKernel(L4,h,f)}const Vx=Y({conv2DBackpropFilter_:MP});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wx(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return H(t,m0(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Ux(t,e){let n=e;const r=ln(t.shape,e.shape);return r.length>0&&(n=Ne(n,r)),J(n,t.shape)}function Gx(t,e,n,r){if(e==="linear")return t;if(e==="relu")return qi(t);if(e==="elu")return L1(t);if(e==="relu6")return uS(t);if(e==="prelu")return Ox(t,n);if(e==="leakyrelu")return Nx(t,r);if(e==="sigmoid")return Eu(t);throw new Error(`Unknown fused activation ${e}.`)}const Hx=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FP({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",Hx(K.state.gradientDepth,l)===!1){L(s==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=Aa(t,e,n,r,s,i,o);return a!=null&&(C=he(C,a)),Gx(C,l,u,c)}const h=V(t,"x","conv2d","float32"),f=V(e,"filter","conv2d","float32");let d=h,p=!1;h.rank===3&&(p=!0,d=J(h,[1,h.shape[0],h.shape[1],h.shape[2]])),L(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),L(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),fr("fused conv2d",r,o);const g=s==="NHWC"?d.shape[3]:d.shape[1];L(f.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${f.shape[2]}.`),L(Rn(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);const m=Cn(d.shape,f.shape,n,i,r,o);let b;a!=null&&(b=V(a,"bias","fused conv2d"),[b]=Ht(b,h),s==="NHWC"?Xe(m.outShape,b.shape):(L(b.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`),L(b.shape.length===0||b.shape[0]===m.outChannels||b.shape[0]===1,()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${m.outChannels})`)));let x;if(u!=null){const C=u.shape;if(L(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)L(C[0]===1||C[0]===m.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${m.outChannels}).`);else if(C.length===3)try{Xe(C,m.outShape)}catch{const N=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${m.outShape}).`;throw Error(N)}x=V(u,"prelu weights","fused conv2d")}const v=(C,T)=>{L(s==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`);const[N,$,_,S]=T,M=Wx(C,_,l);L(Na(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const F=Sx($.shape,M,N,n,r),A=Vx($,M,N.shape,n,r),E=[F,A];if(S!=null){const D=Ux(S,M);E.push(D)}return E},y={x:d,filter:f,bias:b,preluActivationWeights:x},w={strides:n,pad:r,dataFormat:s,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:c};return a==null?Ra((T,N,$)=>{let _=K.runKernel(ud,y,w);return $([N,T,_]),p&&(_=J(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:v}})(d,f):Ra((T,N,$,_)=>{let S=K.runKernel(ud,y,w);return _([N,T,S,$]),p&&(S=J(S,[S.shape[1],S.shape[2],S.shape[3]])),{value:S,gradFunc:v}})(d,f,b)}const OP=Y({fusedConv2d_:FP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LP(t,e,n,r,s,i=[1,1],o){let a=t;t.rank===3&&(a=J(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=J(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},c={strides:r,pad:s,dimRoundingMode:o,dilations:i,filterShape:n};return K.runKernel(G4,u,c)}const zP=Y({depthwiseConv2dNativeBackpropFilter_:LP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PP(t,e,n,r,s,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=J(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:n},c={strides:r,pad:s,dimRoundingMode:o,dilations:i,inputShape:t},h=K.runKernel(H4,u,c);return l?J(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const BP=Y({depthwiseConv2dNativeBackpropInput_:PP});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VP({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(Hx(K.state.gradientDepth,i)===!1){let S=ht(t,e,n,r);return s!=null&&(S=he(S,s)),Gx(S,i,o,a)}let l=V(t,"a","fused matMul"),u=V(e,"b","fused matMul");[l,u]=Ht(l,u);const c=n?l.shape[l.rank-2]:l.shape[l.rank-1],h=r?u.shape[u.rank-1]:u.shape[u.rank-2],f=n?l.shape[l.rank-1]:l.shape[l.rank-2],d=r?u.shape[u.rank-2]:u.shape[u.rank-1],p=l.shape.slice(0,-2),g=u.shape.slice(0,-2),m=se(p),b=se(g);L(c===h,()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${r} must match.`);const v=Xe(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([f,d]),y=n?J(l,[m,c,f]):J(l,[m,f,c]),w=r?J(u,[b,d,h]):J(u,[b,h,d]);let C;s!=null&&(C=V(s,"bias","fused matMul"),[C]=Ht(C,l),Xe(v,C.shape));let T;o!=null&&(T=V(o,"prelu weights","fused matMul"));const N=(S,M)=>{const[F,A,E,D]=M,P=Wx(J(S,E.shape),E,i);let z,B;if(!n&&!r?(z=ht(P,A,!1,!0),B=ht(F,P,!0,!1)):!n&&r?(z=ht(P,A,!1,!1),B=ht(P,F,!0,!1)):n&&!r?(z=ht(A,P,!1,!0),B=ht(F,P,!1,!1)):(z=ht(A,P,!0,!0),B=ht(P,F,!0,!0)),s!=null){const G=Ux(D,P);return[z,B,G]}else return[z,B]},$={a:y,b:w,bias:C,preluActivationWeights:T},_={transposeA:n,transposeB:r,activation:i,leakyreluAlpha:a};return s==null?Ra((M,F,A)=>{const E=K.runKernel(ld,$,_);return A([M,F,E]),{value:J(E,v),gradFunc:N}})(y,w):Ra((M,F,A,E)=>{const D=K.runKernel(ld,$,_);return E([M,F,D,A]),{value:J(D,v),gradFunc:N}})(y,w,C)}const Tw=Y({fusedMatMul_:VP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WP(t,e,n,r,s="bilinear",i=0){const o=V(t,"image","cropAndResize"),a=V(e,"boxes","cropAndResize","float32"),l=V(n,"boxInd","cropAndResize","int32"),u=a.shape[0];L(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),L(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),L(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),L(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),L(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),L(s==="bilinear"||s==="nearest",()=>`method must be bilinear or nearest, but was ${s}`);const c={image:o,boxes:a,boxInd:l},h={method:s,extrapolationValue:i,cropSize:r};return K.runKernel(V4,c,h)}const UP=Y({cropAndResize_:WP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GP(t){const e=V(t,"image","flipLeftRight","float32");L(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return K.runKernel(Y4,n,{})}const HP=Y({flipLeftRight_:GP});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qP(t){const e=V(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];L(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),L(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,Dr(e,s)}const XP=Y({grayscaleToRGB_:qP});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jP(t){const e=V(t,"image","RGBToGrayscale"),n=e.rank-1,r=e.shape[n];L(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),L(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const s=e.dtype,i=we(e,"float32"),o=Sr([.2989,.587,.114]);let a;switch(e.rank){case 2:a=ec("ij,j->i",i,o);break;case 3:a=ec("ijk,k->ij",i,o);break;case 4:a=ec("ijkl,l->ijk",i,o);break;case 5:a=ec("ijklm,m->ijkl",i,o);break;case 6:a=ec("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Yn(a,-1),we(a,s)}const KP=Y({rgbToGrayscale_:jP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YP(t,e,n=0,r=.5){const s=V(t,"image","rotateWithOffset","float32");L(s.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`);const i={image:s},o={radians:e,fillValue:n,center:r};return K.runKernel(gx,i,o)}const ZP=Y({rotateWithOffset_:YP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Du(t,e,n,r,s,i){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=t.shape[0];return n=Math.min(n,o),L(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),L(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),L(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),L(e.rank===1,()=>"scores must be a 1D tensor"),L(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),L(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JP(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const i=V(t,"boxes","nonMaxSuppression","float32"),o=V(e,"scores","nonMaxSuppression","float32"),a=Du(i,o,n,r,s);n=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:r,scoreThreshold:s};return K.runKernel(rx,{boxes:i,scores:o},l)}const QP=Y({nonMaxSuppression_:JP});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(t,e,n){const r=tB(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function tB(t,e,n){return rB(t,e,n||nB)}function nB(t,e){return t>e?1:t<e?-1:0}function rB(t,e,n){let r=0,s=t.length,i=0,o=!1;for(;r<s;){i=r+(s-r>>>1);const a=n(e,t[i]);a>0?r=i+1:(s=i,o=!a)}return o?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qx(t,e,n,r,s){return Kx(t,e,n,r,s,0)}function Xx(t,e,n,r,s,i){return Kx(t,e,n,r,s,0,!1,i,!0)}function jx(t,e,n,r,s,i){return Kx(t,e,n,r,s,i,!0)}function Kx(t,e,n,r,s,i,o=!1,a=!1,l=!1){const u=[];for(let m=0;m<e.length;m++)e[m]>s&&u.push({score:e[m],boxIndex:m,suppressBeginIndex:0});u.sort(Nw);const c=i>0?-.5/i:0,h=[],f=[];for(;h.length<n&&u.length>0;){const m=u.pop(),{score:b,boxIndex:x,suppressBeginIndex:v}=m;if(b<s)break;let y=!1;for(let w=h.length-1;w>=v;--w){const C=sB(t,x,h[w]);if(C>=r){y=!0;break}if(m.score=m.score*iB(r,c,C),m.score<=s)break}m.suppressBeginIndex=h.length,y||(m.score===b?(h.push(x),f.push(m.score)):m.score>s&&eB(u,m,Nw))}const d=h.length,p=n-d;a&&p>0&&(h.push(...new Array(p).fill(0)),f.push(...new Array(p).fill(0)));const g={selectedIndices:h};return o&&(g.selectedScores=f),l&&(g.validOutputs=d),g}function sB(t,e,n){const r=t.subarray(e*4,e*4+4),s=t.subarray(n*4,n*4+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(s[0],s[2]),c=Math.min(s[1],s[3]),h=Math.max(s[0],s[2]),f=Math.max(s[1],s[3]),d=(a-i)*(l-o),p=(h-u)*(f-c);if(d<=0||p<=0)return 0;const g=Math.max(i,u),m=Math.max(o,c),b=Math.min(a,h),x=Math.min(l,f),v=Math.max(b-g,0)*Math.max(x-m,0);return v/(d+p-v)}function iB(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function Nw(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function oB(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const i=V(t,"boxes","nonMaxSuppressionAsync"),o=V(e,"scores","nonMaxSuppressionAsync"),a=Du(i,o,n,r,s);n=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],c=l[1],{selectedIndices:h}=qx(u,c,n,r,s);return i!==t&&i.dispose(),o!==e&&o.dispose(),Sr(h,"int32")}const aB=oB;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,i=0){const o=V(t,"boxes","nonMaxSuppression"),a=V(e,"scores","nonMaxSuppression"),l=Du(o,a,n,r,s,i);n=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},c={maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:i},h=K.runKernel(ix,u,c);return{selectedIndices:h[0],selectedScores:h[1]}}const uB=Y({nonMaxSuppressionWithScore_:lB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function cB(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,i=0){const o=V(t,"boxes","nonMaxSuppressionAsync"),a=V(e,"scores","nonMaxSuppressionAsync"),l=Du(o,a,n,r,s,i);n=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),c=u[0],h=u[1],{selectedIndices:f,selectedScores:d}=jx(c,h,n,r,s,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Sr(f,"int32"),selectedScores:Sr(d)}}const hB=cB;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fB(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,i=!1){const o=V(t,"boxes","nonMaxSuppression"),a=V(e,"scores","nonMaxSuppression"),l=Du(o,a,n,r,s,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,f={boxes:o,scores:a},d={maxOutputSize:u,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:i},p=K.runKernel(sx,f,d);return{selectedIndices:p[0],validOutputs:p[1]}}const dB=Y({nonMaxSuppressionPadded_:fB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function pB(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,i=!1){const o=V(t,"boxes","nonMaxSuppressionAsync"),a=V(e,"scores","nonMaxSuppressionAsync"),l=Du(o,a,n,r,s,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,[f,d]=await Promise.all([o.data(),a.data()]),{selectedIndices:p,validOutputs:g}=Xx(f,d,u,c,h,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Sr(p,"int32"),validOutputs:He(g,"int32")}}const mB=pB;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(t,e,n=!1,r=!1){const s=V(t,"images","resizeBilinear");L(s.rank===3||s.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`),L(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),L(r===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=s,o=!1;s.rank===3&&(o=!0,i=J(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:r,size:e},u=K.runKernel(v1,a,l);return o?J(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const SS=Y({resizeBilinear_:gB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(t,e,n=!1,r=!1){const s=V(t,"images","resizeNearestNeighbor");L(s.rank===3||s.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`),L(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),L(s.dtype==="float32"||s.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),L(r===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=s,o=!1;s.rank===3&&(o=!0,i=J(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:r,size:e},u=K.runKernel(y1,a,l);return o?J(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const CS=Y({resizeNearestNeighbor_:bB});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(t,e="binary",n=!1,r=.5){const s=V(t,"image","threshold"),i=.2989,o=.587,a=.114,l=s.shape[0]*s.shape[1];let u=H(Sr([r]),255),c,h,f,d;if(L(s.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`),L(s.shape[2]===3||s.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`),L(s.dtype==="int32"||s.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`),L(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),s.shape[2]===3){[c,h,f]=Or(s,[1,1,1],-1);const m=H(c,i),b=H(h,o),x=H(f,a);d=he(he(m,b),x)}else d=t;if(e==="otsu"){const m=gO(we(cS(d),"int32"),js([]),256);u=yB(m,l)}const p=n?Ru(d,u):Pr(d,u);return we(H(p,255),"int32")}function yB(t,e){let n=Sr([-1]),r=Sr([0]),s=Sr([0]),i,o,a,l,u,c;for(let h=0;h<t.size-1;h++){i=vt(t,0,h+1),o=vt(t,h+1),u=Ee(Ne(i),e),c=Ee(Ne(o),e);const f=Ne(H(i,Gc(0,i.size)));a=Ee(f,Ne(i));const d=O1(o.shape,i.size),p=he(Gc(0,o.size),d),g=H(o,p);l=Ee(Ne(g),Ne(o));const m=Ie(a,l),b=Ie(a,l),x=H(u,c);s=H(H(x,m),b);const v=Pr(s,r);r=Gn(v,s,r),n=Gn(v,Sr([h]),n)}return n}const vB=Y({threshold_:xB});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wB(t,e,n="nearest",r="constant",s=0,i){const o=V(t,"image","transform","float32"),a=V(e,"transforms","transform","float32");L(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),L(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),L(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:n,fillMode:r,fillValue:s,outputShape:i};return K.runKernel(px,l,u)}const kB=Y({transform_:wB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(t,e,n){const r=V(t,"a","bandPart");L(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const s=r.shape,[i,o]=r.shape.slice(-2);let a,l;typeof e=="number"?(L(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),L(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=V(e<0?i:e,"numLower","bandPart")):(L(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Gn(pd(e,0),i,Ql(e,i))),typeof n=="number"?(L(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),L(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),l=V(n<0?o:n,"numUpper","bandPart")):(L(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Gn(pd(n,0),o,Ql(n,o)));const u=J(Gc(0,i,1,"int32"),[-1,1]),c=Gc(0,o,1,"int32"),h=Ie(u,c),f=Fi(Ru(h,a),nl(h,Nt(l))),d=tn([i,o],r.dtype);return J(ni(Fa(J(r,[-1,i,o])).map(p=>Gn(f,p,d))),s)}const CB=Y({bandPart_:SB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(t){let e;if(Array.isArray(t)){e=!1,L(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const s=t[0].shape[0];for(let i=1;i<t.length;++i)L(t[i].shape[0]===s,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${s})`)}else e=!0,t=Or(t,t.shape[0],0).map(s=>p0(s,[0]));L(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],r=t;for(let s=0;s<t.length;++s)n.push(K.tidy(()=>{let i=r[s];if(s>0)for(let o=0;o<s;++o){const a=H(Ne(H(n[o],i)),n[o]);i=Ie(i,a)}return Ee(i,z1(i,"euclidean"))}));return e?ni(n,0):n}const IB=Y({gramSchmidt_:$B});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(t,e=!1){if(L(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return _w(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,u)=>l*u),r=Fa(J(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],i=[];r.forEach(l=>{const[u,c]=_w(l,e);s.push(u),i.push(c)});const o=J(ni(s,0),t.shape),a=J(ni(i,0),t.shape);return[o,a]}}function _w(t,e=!1){return K.tidy(()=>{L(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],r=t.shape[1];let s=sS(n),i=ga(t);const o=bg([[1]],[1,1]);let a=ga(o);const l=n>=r?r:n;for(let u=0;u<l;++u){const c=i,h=a,f=s;[a,i,s]=K.tidy(()=>{const d=vt(i,[u,u],[n-u,1]),p=z1(d),g=vt(i,[u,u],[1,1]),m=Gn(Pr(g,0),bg([[-1]]),bg([[1]])),b=Ie(g,H(m,p)),x=Ee(d,b);x.shape[0]===1?a=ga(o):a=Un([o,vt(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);const v=Nt(Ee(ht(m,b),p)),y=vt(i,[u,0],[n-u,r]),w=H(v,a),C=st(a);if(u===0)i=Ie(y,ht(w,ht(C,y)));else{const $=Ie(y,ht(w,ht(C,y)));i=Un([vt(i,[0,0],[u,r]),$],0)}const T=st(w),N=vt(s,[0,u],[n,s.shape[1]-u]);if(u===0)s=Ie(N,ht(ht(N,a),T));else{const $=Ie(N,ht(ht(N,a),T));s=Un([vt(s,[0,0],[n,u]),$],1)}return[a,i,s]}),Ze([c,h,f])}return!e&&n>r&&(s=vt(s,[0,0],[n,r]),i=vt(i,[0,0],[r,r])),[s,i]})}const NB=Y({qr_:TB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var tr;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(tr||(tr={}));function _B(t,e,n=tr.SUM_BY_NONZERO_WEIGHTS){const r=V(t,"losses","computeWeightedLoss");let s=null;e!=null&&(s=V(e,"weights","computeWeightedLoss"));const i=s==null?r:H(r,s);if(n===tr.NONE)return i;if(n===tr.SUM)return Ne(i);if(n===tr.MEAN){if(s==null)return Wt(i);{const o=r.size/s.size,a=Ee(Ne(i),Ne(s));return o>1?Ee(a,He(o)):a}}if(n===tr.SUM_BY_NONZERO_WEIGHTS){if(s==null)return Ee(Ne(i),He(r.size));{const o=H(s,Hi(r.shape)),a=we(Ne(Uc(o,He(0))),"float32");return Ee(Ne(i),a)}}throw Error(`Unknown reduction: ${n}`)}const Xi=Y({computeWeightedLoss_:_B});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AB(t,e,n,r=tr.SUM_BY_NONZERO_WEIGHTS){const s=V(t,"labels","absoluteDifference"),i=V(e,"predictions","absoluteDifference");let o=null;n!=null&&(o=V(n,"weights","absoluteDifference")),ls(s.shape,i.shape,"Error in absoluteDifference: ");const a=dn(Ie(s,i));return Xi(a,o,r)}const EB=Y({absoluteDifference_:AB});function RB(t,e,n,r,s=tr.SUM_BY_NONZERO_WEIGHTS){const i=V(t,"labels","cosineDistance"),o=V(e,"predictions","cosineDistance");let a=null;r!=null&&(a=V(r,"weights","cosineDistance")),ls(i.shape,o.shape,"Error in cosineDistance: ");const l=He(1),u=Ie(l,Ne(H(i,o),n,!0));return Xi(u,a,s)}const DB=Y({cosineDistance_:RB});function MB(t,e,n,r=tr.SUM_BY_NONZERO_WEIGHTS){let s=V(t,"labels","hingeLoss");const i=V(e,"predictions","hingeLoss");let o=null;n!=null&&(o=V(n,"weights","hingeLoss")),ls(s.shape,i.shape,"Error in hingeLoss: ");const a=He(1);s=Ie(H(He(2),s),a);const l=qi(Ie(a,H(s,i)));return Xi(l,o,r)}const FB=Y({hingeLoss_:MB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(t,e,n,r=1,s=tr.SUM_BY_NONZERO_WEIGHTS){const i=V(t,"labels","huberLoss"),o=V(e,"predictions","huberLoss");let a=null;n!=null&&(a=V(n,"weights","huberLoss")),ls(i.shape,o.shape,"Error in huberLoss: ");const l=He(r),u=dn(Ie(o,i)),c=Ql(u,l),h=Ie(u,c),f=he(H(He(.5),kt(c)),H(l,h));return Xi(f,a,s)}const LB=Y({huberLoss_:OB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(t,e,n,r=1e-7,s=tr.SUM_BY_NONZERO_WEIGHTS){const i=V(t,"labels","logLoss"),o=V(e,"predictions","logLoss");let a=null;n!=null&&(a=V(n,"weights","logLoss")),ls(i.shape,o.shape,"Error in logLoss: ");const l=He(1),u=He(r),c=Nt(H(i,is(he(o,u)))),h=H(Ie(l,i),is(he(Ie(l,o),u))),f=Ie(c,h);return Xi(f,a,s)}const PB=Y({logLoss_:zB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(t,e,n,r=tr.SUM_BY_NONZERO_WEIGHTS){const s=V(t,"labels","meanSquaredError"),i=V(e,"predictions","meanSquaredError");let o=null;n!=null&&(o=V(n,"weights","meanSquaredError")),ls(s.shape,i.shape,"Error in meanSquaredError: ");const a=xS(s,i);return Xi(a,o,r)}const VB=Y({meanSquaredError_:BB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WB(t,e){const n=V(t,"labels","sigmoidCrossEntropyWithLogits"),r=V(e,"logits","sigmoidCrossEntropyWithLogits");ls(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=qi(r),i=H(r,n),o=_x(zr(Nt(dn(r))));return he(Ie(s,i),o)}function UB(t,e,n,r=0,s=tr.SUM_BY_NONZERO_WEIGHTS){let i=V(t,"multiClassLabels","sigmoidCrossEntropy");const o=V(e,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=V(n,"weights","sigmoidCrossEntropy")),ls(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const u=He(r),c=He(1),h=He(.5);i=he(H(i,Ie(c,u)),H(h,u))}const l=WB(i,o);return Xi(l,a,s)}const GB=Y({sigmoidCrossEntropy_:UB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(t,e,n=-1){if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return Ra((s,i,o)=>{const l=Ax(i,[n],!0),u=Ie(we(i,"float32"),l);o([s,u]);const c=Nt(H(u,s));return{value:Ne(c,[n]),gradFunc:(d,p)=>{const[g,m]=p,b=qt(d.shape,[n]);return[H(J(d,b),Ie(we(g,"float32"),zr(m))),H(J(d,b),Ie(zr(m),we(g,"float32")))]}}})(t,e)}function qB(t,e,n,r=0,s=tr.SUM_BY_NONZERO_WEIGHTS){let i=V(t,"onehotLabels","softmaxCrossEntropy");const o=V(e,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=V(n,"weights","softmaxCrossEntropy")),ls(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const u=He(r),c=He(1),h=He(i.shape[1]);i=he(H(i,Ie(c,u)),Ee(u,h))}const l=HB(i,o);return Xi(l,a,s)}const XB=Y({softmaxCrossEntropy_:qB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ti={flipLeftRight:HP,grayscaleToRGB:XP,resizeNearestNeighbor:CS,resizeBilinear:SS,rgbToGrayscale:KP,rotateWithOffset:ZP,cropAndResize:UP,nonMaxSuppression:QP,nonMaxSuppressionAsync:aB,nonMaxSuppressionWithScore:uB,nonMaxSuppressionWithScoreAsync:hB,nonMaxSuppressionPadded:dB,nonMaxSuppressionPaddedAsync:mB,threshold:vB,transform:kB},jB={bandPart:CB,gramSchmidt:IB,qr:NB},KB={absoluteDifference:EB,computeWeightedLoss:Xi,cosineDistance:DB,hingeLoss:FB,huberLoss:LB,logLoss:PB,meanSquaredError:VB,sigmoidCrossEntropy:GB,softmaxCrossEntropy:XB};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YB=new Map,ZB=new Map;class Mu{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class Yr{constructor(){this.classNameMap={}}static getMap(){return Yr.instance==null&&(Yr.instance=new Yr),Yr.instance}static register(e){Yr.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function ue(t,e,n){L(t.className!=null,()=>"Class being registered does not have the static className property defined."),L(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),L(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const r=n,s=e+">"+r;return Yr.register(t),YB.set(s,t),ZB.set(t,s),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vo extends Mu{minimize(e,n=!1,r){const{value:s,grads:i}=this.computeGradients(e,r);if(r!=null){const o=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return Ze(i),n?s:(s.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return zL(e,n)}dispose(){this.iterations_!=null&&Ze(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:He(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Vo,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $S extends Vo{static get className(){return"Adadelta"}constructor(e,n,r=null){super(),this.learningRate=e,this.rho=n,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=K.registeredVariables[r],o=!1;this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accum_grad`,variable:Q(()=>it(i).variable(o))}),this.accumulatedUpdates[s]==null&&(this.accumulatedUpdates[s]={originalName:`${r}/accum_var`,variable:Q(()=>it(i).variable(o))});const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const l=this.accumulatedGrads[s].variable,u=this.accumulatedUpdates[s].variable;Q(()=>{const c=he(H(l,this.rho),H(kt(a),1-this.rho)),h=H(Ee(An(he(u,this.epsilon)),An(he(l,this.epsilon))),a),f=he(H(u,this.rho),H(kt(h),1-this.rho));l.assign(c),u.assign(f);const d=he(H(h,-this.learningRate),i);i.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ze(this.accumulatedGrads.map(e=>e.variable)),Ze(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,n).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedUpdates=e.slice(n,n*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IS extends Vo{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=K.registeredVariables[r];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accumulator`,variable:Q(()=>O1(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[s].tensor:e[r];if(o==null)return;const a=this.accumulatedGrads[s].variable;Q(()=>{const l=he(a,kt(o));a.assign(l);const u=he(H(Ee(o,An(he(l,K.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ze(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TS extends Vo{static get className(){return"Adam"}constructor(e,n,r,s=null){super(),this.learningRate=e,this.beta1=n,this.beta2=r,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Q(()=>{this.accBeta1=He(n).variable(),this.accBeta2=He(r).variable()}),s==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);Q(()=>{const r=Ie(1,this.accBeta1),s=Ie(1,this.accBeta2);n.forEach((i,o)=>{const a=K.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Q(()=>it(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:Q(()=>it(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,f=he(H(c,this.beta1),H(u,1-this.beta1)),d=he(H(h,this.beta2),H(kt(u),1-this.beta2)),p=Ee(f,r),g=Ee(d,s);c.assign(f),h.assign(d);const m=he(H(Ee(p,he(An(g),this.epsilon)),-this.learningRate),a);a.assign(m)}),this.accBeta1.assign(H(this.accBeta1,this.beta1)),this.accBeta2.assign(H(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ze(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ze(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),Q(()=>{this.accBeta1.assign(Ea(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ea(this.beta2,this.iterations_+1))});const n=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,n).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NS extends Vo{static get className(){return"Adamax"}constructor(e,n,r,s=null,i=0){super(),this.learningRate=e,this.beta1=n,this.beta2=r,this.epsilon=s,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Q(()=>{this.iteration=He(0).variable(),this.accBeta1=He(n).variable()}),s==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);Q(()=>{const r=Ie(1,this.accBeta1),s=Ee(-this.learningRate,he(H(this.iteration,this.decay),1));n.forEach((i,o)=>{const a=K.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:it(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:it(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const c=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,f=he(H(c,this.beta1),H(u,1-this.beta1)),d=H(h,this.beta2),p=dn(u),g=Bo(d,p);c.assign(f),h.assign(g);const m=he(H(Ee(s,r),Ee(f,he(g,this.epsilon))),a);a.assign(m)}),this.iteration.assign(he(this.iteration,1)),this.accBeta1.assign(H(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ze(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ze(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yx extends Vo{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=Array.isArray(e)?e[s].tensor:e[r];if(i==null)return;const o=K.registeredVariables[r];Q(()=>{const a=he(H(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Ks(He(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _S extends Yx{static get className(){return"Momentum"}constructor(e,n,r=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=r,this.accumulations=[],this.m=He(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=K.registeredVariables[r];this.accumulations[s]==null&&(this.accumulations[s]={originalName:`${r}/momentum`,variable:Q(()=>it(i).variable(!1))});const o=this.accumulations[s].variable,a=Array.isArray(e)?e[s].tensor:e[r];a!=null&&Q(()=>{let l;const u=he(H(this.m,o),a);this.useNesterov?l=he(H(this.c,he(a,H(u,this.m))),i):l=he(H(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ze(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AS extends Vo{static get className(){return"RMSProp"}constructor(e,n=.9,r=0,s=null,i=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=r,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,s==null&&(this.epsilon=K.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const i=K.registeredVariables[r],o=!1;this.accumulatedMeanSquares[s]==null&&(this.accumulatedMeanSquares[s]={originalName:`${r}/rms`,variable:Q(()=>it(i).variable(o))}),this.accumulatedMoments[s]==null&&(this.accumulatedMoments[s]={originalName:`${r}/momentum`,variable:Q(()=>it(i).variable(o))}),this.accumulatedMeanGrads[s]==null&&this.centered&&(this.accumulatedMeanGrads[s]={originalName:`${r}/mg`,variable:Q(()=>it(i).variable(o))});const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const l=this.accumulatedMeanSquares[s].variable,u=this.accumulatedMoments[s].variable;Q(()=>{const c=he(H(l,this.decay),H(kt(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[s].variable,f=he(H(h,this.decay),H(a,1-this.decay)),d=Ee(H(a,this.learningRate),An(Ie(c,he(kt(f),this.epsilon)))),p=he(H(u,this.momentum),d);l.assign(c),h.assign(f),u.assign(p);const g=Ie(i,p);i.assign(g)}else{const h=he(H(l,this.decay),H(kt(a),1-this.decay)),f=he(H(u,this.momentum),Ee(H(a,this.learningRate),An(he(h,this.epsilon))));l.assign(h),u.assign(f);const d=Ie(i,f);i.assign(d)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ze(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ze(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ze(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,n).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedMoments=e.slice(n,n*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JB=[$S,IS,TS,NS,_S,AS,Yx];function QB(){for(const t of JB)ue(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aw(t,e,n,r){o(t),n=n??0,r=r??1,a(n,r);let s=0;const i=l=>(l.then(u=>{const c=n+ ++s/t.length*(r-n);return e(c),u}),l);function o(l){L(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){L(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),L(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),L(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(t.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function eV(t,e){e==null&&(e={});const n=e.fetchFunc==null?ee().platform.fetch:e.fetchFunc,r=t.map(h=>n(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(r):await Aw(r,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await Aw(a,e.onProgress,.5,1)}function tV(t,e){var n;const r=e.fetchFunc==null?ee().platform.fetch:e.fetchFunc;let s=0,i;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async o=>{for(var a;s<t.length;){i||(i=(await r(t[s],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){s++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,s/t.length);continue}o.enqueue(u);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nV="application/octet-stream",rV="application/json";class Zx{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(L(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=ee().platform.fetch,L(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&L(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],s=YM(e,r);if(n.body.append("model.json",new Blob([JSON.stringify(s)],{type:rV}),"model.json"),e.weightData!=null){const o=Lo.join(e.weightData);n.body.append("model.weights.bin",new Blob([o],{type:nV}),"model.weights.bin")}const i=await this.fetch(this.path,n);if(i.ok)return{modelArtifactsInfo:yx(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const r=n.modelTopology,s=n.weightsManifest;if(r==null&&s==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return JM(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),r=gw(e.weightsManifest),s=()=>tV(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:r,getWeightStream:s})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[r,s]=sV(n),i=this.weightPathPrefix||r,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+s);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const n=await this.getWeightUrls(e),r=gw(e),s=await eV(n,this.loadOptions);return[r,s]}}Zx.URL_SCHEME_REGEX=/^https?:\/\//;function sV(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}function Ew(t){return t.match(Zx.URL_SCHEME_REGEX)!=null}const ES=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(r=>Ew(r)):n=Ew(t),n)return RS(t,e)}return null};fn.registerSaveRouter(ES);fn.registerLoadRouter(ES);function RS(t,e){return new Zx(t,e)}function iV(t,e){return RS(t,e)}function Jx(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(se(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const s=e.shape,i=s[s.length-1];let o=1;for(let h=0;h<s.length-1;++h)o*=s[h];const a=t.shape,l=s.slice();l.pop();let u=1;for(let h=i;h<n;++h)u*=a[h],l.push(a[h]);const c=[...Re(t.shape).map(h=>h/u),1].slice(0,i);return[l,o,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J2=-2,oV=-1;function Qx(t,e,n){const r=t.shape.length;L(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),L(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let s=0;s<r;++s)L(e[s]+n[s]<=t.shape[s],()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+n[s]}) would overflow input.shape[${s}] (${t.shape[s]})`)}function aV(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function ey(t,e,n){const r=[];for(let s=0;s<t.length;s++)r[s]=Math.ceil((e[s]-t[s])/n[s]);return r}function DS(t,e,n,r){const s=[...t];for(let i=s.length;i<r.length;i++)s.push(1);for(let i=0;i<n;i++)i===0?s[e]=1:(s.splice(e,0,1),s.pop());return s}function MS(t,e,n){return n<=t?n:n-(e-1)}function FS(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function lV(t,e,n,r,s,i,o,a,l){const u=t.length;let c=new Array(u),h=new Array(u),f=new Array(u);if(e.length&&n>0){const d=e[0],p=n+1;c=OS(o,d,p,r,t),h=LS(a,d,p,s,t),f=DS(i,d,p,t)}else for(let d=0;d<u;d++)c[d]=PS(o,r,i,t,d,l),h[d]=BS(a,s,i,t,d,l),f[d]=zS(i,d,l);return{begin:c,end:h,strides:f}}function OS(t,e,n,r,s){const i=[...s],o=FS(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=MS(e,n,a);let u=r[l];t&1<<l&&(u=0),i[a]=u}return i}function LS(t,e,n,r,s){const i=[...s],o=FS(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=MS(e,n,a);let u=r[l];t&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=s[a];i[a]<0&&(i[a]+=l),i[a]=Sa(0,i[a],s[a])}return i}function zS(t,e,n){let r=t[e];return(n&1<<e||r==null)&&(r=1),r}function PS(t,e,n,r,s,i){let o=e[s];const a=n[s]||1;(t&1<<s||i&1<<s||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=r[s];return o<0&&(o+=l),o=Sa(0,o,l-1),o}function BS(t,e,n,r,s,i){let o=e[s];const a=n[s]||1;(t&1<<s||i&1<<s||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=r[s];return o<0&&(o+=l),a>0?o=Sa(0,o,l):o=Sa(-1,o,l-1),o}function ty(t,e,n){let r=n.length;for(let s=0;s<n.length;s++)if(n[s]>1){r=s;break}for(let s=r+1;s<n.length;s++)if(e[s]>0||n[s]!==t[s])return!1;return!0}function ny(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function V1(t,e,n){let r;const s=t.shape.length;typeof e=="number"?r=[e,...new Array(s-1).fill(0)]:e.length<s?r=e.concat(new Array(s-e.length).fill(0)):r=e.slice(),r.forEach(o=>{L(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return n==null?i=new Array(s).fill(-1):typeof n=="number"?i=[n,...new Array(s-1).fill(-1)]:n.length<s?i=n.concat(new Array(s-n.length).fill(-1)):i=n,i=i.map((o,a)=>o>=0?o:(L(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-r[a])),[r,i]}function ry(t,e,n,r,s,i,o,a,l){let u;if(r==null?(u=new Array(e.length),u.fill(1)):u=r,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:u.slice(),beginMask:s,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let v=0;v<h.dims;v++)c&&(1<<v&a)!==0&&h.numAddAxisAfterEllipsis++,1<<v&o&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const f={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};uV(h,f);let d=!0,p=!0,g=!0;const m=[],b=[];for(let v=0;v<t.length;++v){if(f.strides[v]===0)throw Error(`strides[${v}] must be non-zero`);const y=!!(f.shrinkAxisMask&1<<v),w=t[v];if(w===-1){m.push(y?1:-1);continue}const C=[f.beginMask&1<<v,f.endMask&1<<v],T=[f.strides[v]>0?0:-1,f.strides[v]>0?w:w-1];if(y&&f.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&f.strides[v]===1;const N=!!(f.beginMask&1<<v&&f.endMask&1<<v);if(f.beginValid&&f.endValid){if(y){const M=f.begin[v]<0?w+f.begin[v]:f.begin[v];if(f.begin[v]=M,f.end[v]=f.begin[v]+1,M<0||M>=w)throw Error(`slice index ${f.begin[v]} of dimension ${v} out of bounds.`)}else f.begin[v]=Rw(f.begin[v],0,f.strides[v],w,C,T),f.end[v]=Rw(f.end[v],1,f.strides[v],w,C,T);const S=f.strides[v]===1&&f.begin[v]===0&&f.end[v]===w;d=d&&S,p=p&&(v===0&&f.strides[v]===1||S)}else d=d&&f.strides[v]===1&&N,p=p&&(v===0&&f.strides[v]===1||N);let $,_=!1;if(f.beginValid&&f.endValid?($=f.end[v]-f.begin[v],_=!0):y?($=1,_=!0):N&&w>=0&&(f.strides[v]<0?$=-w:$=w,_=!0),_){let S;$===0||$<0!=f.strides[v]<0?S=0:S=Math.trunc($/f.strides[v])+($%f.strides[v]!==0?1:0),m.push(S)}else m.push(-1)}for(let v=0;v<f.finalShapeGatherIndices.length;++v){const y=f.finalShapeGatherIndices[v];y>=0?b.push(m[y]):y===J2&&b.push(1)}return{finalShapeSparse:b.filter((v,y)=>f.finalShapeGatherIndices[y]!==J2),finalShape:b,isIdentity:d,sliceDim0:p,isSimpleSlice:g,begin:f.begin,end:f.end,strides:f.strides}}function uV(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const s=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<s;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(J2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[r]),t.end!=null&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(oV),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}function Rw(t,e,n,r,s,i){if(s[e])return n>0?i[e]:i[e+1&1];{const o=t<0?r+t:t;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const cV=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Qx,computeFlatOffset:ny,computeOutShape:ey,getNormalizedAxes:lV,isSliceContinous:ty,maskToAxes:aV,parseSliceParams:V1,sliceInfo:ry,startForAxis:PS,startIndicesWithElidedDims:OS,stopForAxis:BS,stopIndicesWithElidedDims:LS,stridesForAxis:zS,stridesWithElidedDims:DS},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hV{static sgd(e){return new Yx(e)}static momentum(e,n,r=!1){return new _S(e,n,r)}static rmsprop(e,n=.9,r=0,s=null,i=!1){return new AS(e,n,r,s,i)}static adam(e=.001,n=.9,r=.999,s=null){return new TS(e,n,r,s)}static adadelta(e=.001,n=.95,r=null){return new $S(e,n,r)}static adamax(e=.002,n=.9,r=.999,s=null,i=0){return new NS(e,n,r,s,i)}static adagrad(e,n=.1){return new IS(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sa=hV;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fV=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function VS(){return new Promise(t=>fV(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sy(t,e){const n=t[0].length;t.forEach((s,i)=>{L(s.length===n,()=>`Error in concat${n}D: rank of tensors[${i}] must be the same as the rank of the rest (${n})`)}),L(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const r=t[0];t.forEach((s,i)=>{for(let o=0;o<n;o++)L(o===e||s[o]===r[o],()=>`Error in concat${n}D: Shape of tensors[${i}] (${s}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function Ys(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xs;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(xs||(xs={}));function WS(t,e,n){let r=new Array;if(n==null&&e==null)return r;if(e==null)for(;r.length<t+n.length;)r.push(-1);else r=e.slice();if(n==null)return r;if(t+n.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${r.length}`);for(let s=1;s<n.length;++s){const i=n[s],o=r[r.length-n.length+s],a=r[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${s+t}] = ${i} but shape[${s+t}] = ${a}`)}else r[o]=i}return r}function US(t){const e={FIRST_DIM_SIZE:xs.FIRST_DIM_SIZE,VALUE_ROWIDS:xs.VALUE_ROWIDS,ROW_LENGTHS:xs.ROW_LENGTHS,ROW_SPLITS:xs.ROW_SPLITS,ROW_LIMITS:xs.ROW_LIMITS,ROW_STARTS:xs.ROW_STARTS},n=[];for(const r of t)if(r in e)n.push(e[r]);else break;return n}function GS(t){return t.length===0?0:t[0]===xs.FIRST_DIM_SIZE?t.length-1:t.length}function HS(t,e){if(t==null||e==null)return;const n=t.length,r=e.length;if(n>=r)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let s=0;s<Math.min(n,r-1);++s){const i=t[s],o=e[s+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${s-t.length}] = ${i} but ragged tensor input.flatValues.shape[${s-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iy=30;function W1(t){return t<=iy?t:F2(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oy(t,e,n){const r=n*(typeof t=="number"?t:t[0]),s=e*(typeof t=="number"?t:t[1]);return[r,s]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g0(t,e,n,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(t[0]/n),s=s.concat(t.slice(1));else{s=s.concat(t[0]);const i=e.length;for(let o=0;o<i;++o)s=s.concat([t[o+1]/e[o],e[o]]);s=s.concat(t.slice(i+1))}return s}function b0(t,e,n=!0){const r=[];if(n){r.push(e);for(let s=e+1;s<t;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{const s=[],i=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?i.push(o):s.push(o);r.push(...s),r.push(0),r.push(...i)}return r}function x0(t,e,n,r=!0){const s=[];r?s.push(t[0]/n):s.push(t[0]*n);for(let i=1;i<t.length;++i)i<=e.length?r?s.push(e[i-1]*t[i]):s.push(t[i]/e[i-1]):s.push(t[i]);return s}function ay(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function ly(t,e,n){const r=t.slice(0,1);for(let s=0;s<n;++s)r.push(t[s+1]-e[s][0]-e[s][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U1=1.7580993408473768,G1=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uy=.3275911,cy=.254829592,hy=-.284496736,fy=1.421413741,dy=-1.453152027,py=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oi(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function qS(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}function XS(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let s=0;s<t.length;s+=4)n[Math.floor(s/4)]=t[s],r[Math.floor(s/4)]=t[s+1];return{real:n,imag:r}}function jS(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let s=2;s<t.length;s+=4)n[Math.floor(s/4)]=t[s],r[Math.floor(s/4)]=t[s+1];return{real:n,imag:r}}function my(t,e){const n=t[e*2],r=t[e*2+1];return{real:n,imag:r}}function KS(t,e,n,r){t[r*2]=e,t[r*2+1]=n}function YS(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let s=0;s<Math.ceil(t/2);s++){const i=(e?2:-2)*Math.PI*(s/t);n[s]=Math.cos(i),r[s]=Math.sin(i)}return{real:n,imag:r}}function ZS(t,e,n){const r=(n?2:-2)*Math.PI*(t/e),s=Math.cos(r),i=Math.sin(r);return{real:s,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xg="->",dV=/->/g,Dw=",",Mw="...";function gy(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(dV,"").length)/xg.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${xg}").`);const[r,s]=t.split(xg);L(r.indexOf(Mw)===-1,()=>`The ellipsis notation ("${Mw}") is not supported yet.`);const i=r.split(Dw),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<s.length;++f){const d=s[f];if(!i.some(p=>p.indexOf(d)!==-1))throw new Error(`Output subscripts contain the label ${d} not present in the input subscripts.`);a.indexOf(d)===-1&&a.push(d)}for(let f=0;f<r.length;++f){const d=r[f];a.indexOf(d)===-1&&d!==Dw&&a.push(d)}const l=new Array(i.length);for(let f=0;f<o;++f){if(new Set(i[f].split("")).size!==i[f].length)throw new Error(`Found duplicate axes in input component ${i[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let d=0;d<i[f].length;++d)l[f].push(a.indexOf(i[f][d]))}const u=a.length,c=s.length,h=[];for(let f=c;f<u;++f)h.push(f);return{allDims:a,summedDims:h,idDims:l}}function by(t,e){let n=new Array(t);n.fill(-1);for(let s=0;s<e.length;++s)n[e[s]]=s;const r=[];for(let s=0;s<t;++s)n[s]===-1&&r.push(s);return n=n.filter(s=>s!==-1),{permutationIndices:n,expandDims:r}}function xy(t,e,n){const r=new Array(t);for(let s=0;s<n.length;++s){const i=n[s].shape;for(let o=0;o<e[s].length;++o)r[e[s][o]]===void 0?r[e[s][o]]=i[o]:L(r[e[s][o]]===i[o],()=>`Expected dimension ${r[e[s][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function yy(t,e){const n=t,r=[];let s=0;t.length===0&&n.push(-1),s=t.length+1;for(let o=0;o<s;++o)r.push([]);const i=[];for(let o=0;o<n.length;++o){const a=n[o],l=pV(e,a);for(const u of l)i.indexOf(u)===-1&&(r[o].push(u),i.push(u))}return{path:n,steps:r}}function vy(t){return t.every((e,n)=>e===n)}function pV(t,e){const n=[];for(let r=0;r<t.length;++r)(t[r].length===0||t[r].indexOf(e)!==-1||e===-1)&&n.push(r);return n}function wy(t,e,n=0){let r=[];if(typeof e=="number")L(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(t.shape[n]/e);else{const s=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);L(s<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=t.shape[n]-o}L(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JS(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function QS(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function eC(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tC(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function nC(t,e){return`size ${t} must be non-negative, not ${e}`}function rC(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function sC(t,e){const n=se(t),r=se(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${t} outputShape= ${e}`}function iC(t,e){const n=se(t),r=se(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${r}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q2(){return"segment ids must be >= 0"}function oC(){return"segment ids are not increasing"}function aC(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function lC(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uC(t,e){let n=!1,r;for(t<=iy?(r=t,n=!0):r=F2(t,Math.floor(Math.sqrt(t)));!n;)r>e||r===t?n=!0:r=F2(t,r+1);return r}function cC(t,e,n){const r=[],s=t.length;for(let i=0;i<s;i++)i!==e?r.push(t[i]):r.push(n);return r}function ky(t,e,n,r){const s=e.shape.length,i=t.shape.length;if(r!==0&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let h=0;h<r;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[n],a=[];let l=1,u=1,c=1;for(let h=0;h<r;++h)a.push(t.shape[h]),l*=t.shape[h];for(let h=r;h<n;h++)a.push(t.shape[h]),u*=t.shape[h];for(let h=r;h<s;h++)a.push(e.shape[h]);for(let h=n+1;h<i;h++)a.push(t.shape[h]),c*=t.shape[h];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:o,outputShape:a}}const mV=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:ky,computeOutShape:cC,segOpComputeOptimalWindowSize:uC},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Li(t){try{return t.map(e=>vo(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function hC(t){return t.map(e=>mo(e))}const gV=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:cy,ERF_A2:hy,ERF_A3:fy,ERF_A4:dy,ERF_A5:py,ERF_P:uy,PARALLELIZE_THRESHOLD:iy,get RowPartitionType(){return xs},SELU_SCALE:G1,SELU_SCALEALPHA:U1,applyActivation:Gx,assertAndGetBroadcastShape:Xe,assertAxesAreInnerMostDims:$n,assertParamsConsistent:sy,assignToTypedArray:KS,axesAreInnerMostDims:Ix,calculateShapes:rl,checkEinsumDimSizes:xy,checkPadOnDimRoundingMode:fr,combineLocations:nS,combineRaggedTensorToTensorShapes:WS,complexWithEvenIndex:XS,complexWithOddIndex:jS,computeConv2DInfo:Cn,computeConv3DInfo:zo,computeDefaultPad:vx,computeDilation2DInfo:f0,computeOptimalWindowSize:W1,computeOutAndReduceShapes:xn,computeOutShape:Ys,computePool2DInfo:us,computePool3DInfo:Ui,convertConv2DDataFormat:Gi,decodeEinsumEquation:gy,eitherStridesOrDilationsAreOne:Rn,expandShapeToKeepDim:qt,exponent:ZS,exponents:YS,fromStringArrayToUint8:hC,fromUint8ToStringArray:Li,getAxesPermutation:Rt,getBroadcastDims:Jl,getComplexWithIndex:my,getEinsumComputePath:yy,getEinsumPermutation:by,getFusedBiasGradient:Ux,getFusedDyActivation:Wx,getImageCenter:oy,getInnerMostAxes:Xt,getPermuted:b0,getRaggedRank:GS,getReductionAxes:ln,getReshaped:g0,getReshapedPermuted:x0,getRowPartitionTypesHelper:US,getSliceBeginCoords:ay,getSliceSize:ly,getSparseFillEmptyRowsIndicesDenseShapeMismatch:JS,getSparseFillEmptyRowsNegativeIndexErrorMessage:QS,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:eC,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:rC,getSparseReshapeInputOutputMismatchErrorMessage:iC,getSparseReshapeInputOutputMultipleErrorMessage:sC,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:tC,getSparseReshapeNegativeOutputDimErrorMessage:nC,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:lC,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Q2,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:oC,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:aC,getUndoAxesPermutation:Po,isIdentityPermutation:vy,log:dM,mergeRealAndImagArrays:Oi,prepareAndValidate:Jx,prepareSplitSize:wy,segment_util:mV,shouldFuse:Hx,slice_util:cV,splitRealAndImagArrays:qS,stridesOrDilationsArePositive:_a,tupleValuesAreOne:Na,upcastType:Cr,validateDefaultValueShape:HS,validateInput:wP,validateUpdateShape:yS,warn:Rr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */QB();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fC={kernelName:Ep,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(t,m0(we(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV={kernelName:bh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const r=kt(we(n,"float32")),s=An(Ie(He(1),r));return Nt(Ee(t,s))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xV={kernelName:xh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const r=An(Ie(kt(we(n,"float32")),1));return Ee(t,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yV={kernelName:Au,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,s=Xe(n.shape,r.shape);return{a:()=>{let a=t;const l=ln(n.shape,s);return l.length>0&&(a=Ne(a,l)),J(a,n.shape)},b:()=>{let a=t;const l=ln(r.shape,s);return l.length>0&&(a=Ne(a,l)),J(a,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vV={kernelName:_4,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((r,s)=>{n[s]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wV={kernelName:Rp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>it(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kV={kernelName:Dp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>it(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SV={kernelName:yh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ee(t,An(Ie(He(1),kt(we(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CV={kernelName:vh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const r=An(he(He(1),kt(we(n,"float32"))));return Ee(t,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $V={kernelName:Sh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,s=Xe(n.shape,r.shape);return{a:()=>{const a=he(kt(n),kt(r));let l=H(t,Ee(r,a));const u=ln(n.shape,s);return u.length>0&&(l=Ne(l,u)),J(l,n.shape)},b:()=>{const a=he(kt(n),kt(r));let l=Nt(H(t,Ee(n,a)));const u=ln(r.shape,s);return u.length>0&&(l=Ne(l,u)),J(l,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IV={kernelName:wh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ee(t,he(kt(we(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TV={kernelName:kh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ee(t,Ie(He(1),kt(we(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NV(t,e,n,r,s,i){const o=V(t,"dy","avgPool3dGrad"),a=V(e,"input","avgPool3dGrad");let l=o,u=a,c=!1;a.rank===4&&(c=!0,l=J(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=J(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),L(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),L(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),fr("avgPool3dGrad",s,i);const h={dy:l,input:u},f={filterSize:n,strides:r,pad:s,dimRoundingMode:i},d=K.runKernel(D4,h,f);return c?J(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const _V=Y({avgPool3dGrad_:NV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AV={kernelName:Fp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:s,strides:i,pad:o,dimRoundingMode:a}=n;return{x:()=>_V(t,r,s,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(t,e,n,r,s){const i=V(t,"dy","avgPoolGrad"),o=V(e,"input","avgPoolGrad");L(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=J(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=J(i,[1,i.shape[0],i.shape[1],i.shape[2]])),L(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),L(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:l,input:a},h={filterSize:n,strides:r,pad:s},f=K.runKernel(R4,c,h);return u?J(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const RV=Y({avgPoolGrad_:EV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DV={kernelName:Mp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:s,strides:i,pad:o}=n;return{x:()=>RV(t,r,s,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MV={kernelName:Op,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[r,s]=e,{transposeA:i,transposeB:o}=n;return!i&&!o?{a:()=>ht(t,s,!1,!0),b:()=>ht(r,t,!0,!1)}:!i&&o?{a:()=>ht(t,s,!1,!1),b:()=>ht(t,r,!0,!1)}:i&&!o?{a:()=>ht(s,t,!1,!0),b:()=>ht(r,t,!1,!1)}:{a:()=>ht(s,t,!0,!0),b:()=>ht(t,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FV={kernelName:Lp,gradFunc:(t,e,n)=>{const{blockShape:r,crops:s}=n;return{x:()=>Fx(t,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OV={kernelName:uM,gradFunc:(t,e,n)=>{const r=n,s=r.inputShape,i=r.shape,o=Array.from(i);for(let l=s.length-1;l>=0;l--)if(s[l]===i[l])o[l]=1;else if(s[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Ne(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LV={kernelName:Ch,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zV={kernelName:$h,gradFunc:t=>({x:()=>it(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PV={kernelName:Ih,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{clipValueMin:s,clipValueMax:i}=n;return{x:()=>Gn(Fi(nl(r,s),Ru(r,i)),t,it(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BV={kernelName:zp,inputsToSave:["x"],gradFunc:fC.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VV={kernelName:Pp,saveAllInputs:!0,gradFunc:(t,e,n)=>{const r=e.map(l=>l.shape),{axis:s}=n,i=et(s,e[0].shape)[0],o=r.map(l=>l[i]);return Or(t,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WV={kernelName:Bp,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,s]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=n;return L(Na(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>Sx(r.shape,t,s,o,a,l),filter:()=>Vx(r,t,s.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UV={kernelName:Vp,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[r,s]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>Aa(t,s,i,o,a,1,l),filter:()=>Vx(t,r,s.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV(t,e,n,r,s){let i=t;t.rank===4&&(i=J(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;o.rank===4&&(o=J(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),L(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),L(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),L(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),L(i.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${n[3]}.`),L(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:i,dy:o},l={strides:r,pad:s,filterShape:n};return K.runKernel(z4,a,l)}const HV=Y({conv3DBackpropFilter_:GV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qV={kernelName:Wp,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:s,pad:i}=n;L(Na(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,a]=e;return{x:()=>Jk(o.shape,t,a,s,i),filter:()=>HV(o,t,a.shape,s,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XV={kernelName:Th,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(Nt(pS(we(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jV={kernelName:Nh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(mS(we(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KV={kernelName:Up,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:s,exclusive:i,reverse:o}=n;return{x:()=>{const a=Rt([s],r.rank);let l=eS(t,s,i,!o);return a!=null&&(l=st(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YV={kernelName:Gp,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:s,pad:i,dimRoundingMode:o}=n,a=r??[1,1];L(Na(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return L(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),L(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),L(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),L(Rn(s,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${s} and dilations '${a}'.`),fr("depthwiseConv2d",i,o),{x:()=>BP(l.shape,t,u,s,i,a,o),filter:()=>zP(l,t,u.shape,s,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZV={kernelName:Hp,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,s]=e,i={x:r,filter:s,dy:t},o={x:r,filter:s,dy:t};return{x:()=>K.runKernel(O2,i,n),filter:()=>K.runKernel(L2,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JV={kernelName:Ah,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,r={dy:t,y:n};return{x:()=>K.runKernel(X4,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QV={kernelName:Eh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=H(zr(Nt(kt(n))),2/Math.sqrt(Math.PI));return{x:()=>H(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eW={kernelName:Rh,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tW={kernelName:Xp,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>J(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nW={kernelName:Dh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(t,zr(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rW={kernelName:Mh,gradFunc:t=>({x:()=>it(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sW={kernelName:Fh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,s=Xe(n.shape,r.shape);return{a:()=>{const a=Ee(t,we(r,"float32")),l=ln(n.shape,s);return l.length>0?J(Ne(a,l),n.shape):a},b:()=>{let a=H(t,we(n,"float32"));const l=ln(r.shape,s);l.length>0&&(a=J(Ne(a,l),r.shape));const u=kt(r);return Nt(Ee(a,we(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iW={kernelName:jp,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:r}=n,[s,i,o,a]=e,l=a??He(1),u=ln(i.shape,s.shape),c=[];if(i.rank===1){for(let y=0;y<s.shape.length-1;++y)c.push(s.shape[y]);c.push(1)}const h=Ie(s,i),f=H(t,l),d=hS(he(o,He(r))),p=H(H(H(d,d),d),He(-.5));return{x:()=>i.rank===1?J(H(H(t,Dr(J(d,[1,1,1,i.shape[0]]),c)),l),s.shape):J(H(H(t,d),l),s.shape),mean:()=>{let y=H(H(d,He(-1)),f);return i.rank===1&&(y=Ne(y,u)),J(y,i.shape)},variance:()=>{let y=H(H(p,h),f);return i.rank===1&&(y=Ne(y,u)),J(y,i.shape)},scale:()=>{const y=H(h,d);let w=H(t,y);return i.rank===1&&(w=Ne(w,u)),J(w,i.shape)},offset:()=>{let y=t;return i.rank===1&&(y=Ne(y,u)),J(y,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oW={kernelName:Kp,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[r,s]=e,{axis:i,batchDims:o}=n,a=et(i,r.shape)[0],l=(u,c,h)=>()=>{const f=u.shape,d=c.size,p=f.slice(0,a),g=p.length,m=f.slice(i,f.length).slice(1),b=m.length,x=Fw(0,g),v=Fw(g+1,g+1+b),y=Ow([p,[d],m]),w=J(h,y),C=J(c,[d]),T=Ow([[g],x,v]),N=st(w,T);let $=wS(N,C,u.shape[a]);const _=Po(T);return $=st($,_),$};if(o===1){const u=r.shape[0],c=r.split(u,0);return{x:()=>ni(c.map((d,p)=>l(d,s.slice(p,1),t.slice(p,1))())).reshape(r.shape),indices:()=>s}}else return{x:l(r,s,t),indices:()=>s}}};function Fw(t,e){const n=[];for(let r=t;r<e;++r)n.push(r);return n}function Ow(t){const e=[];for(let n=0;n<t.length;++n)for(let r=0;r<t[n].length;++r)e.push(t[n][r]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aW={kernelName:Oh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>it(n),b:()=>it(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lW={kernelName:Lh,gradFunc:t=>({x:()=>we(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uW={kernelName:zh,gradFunc:t=>({x:()=>it(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cW={kernelName:Ph,gradFunc:t=>({x:()=>it(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hW={kernelName:Bh,gradFunc:t=>({x:()=>it(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fW={kernelName:Zp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{alpha:s}=n,i=Pr(r,0);return{x:()=>Gn(i,t,H(t,s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dW={kernelName:Wh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ee(t,he(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pW={kernelName:Vh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ee(t,we(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mW={kernelName:hM,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{axis:s}=n;return{logits:()=>{const o=zr(r);return Ie(t,H(Ne(t,s,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(t,e,n,r=5,s=1,i=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:r,bias:s,alpha:i,beta:o};return K.runKernel(ex,a,l)}const bW=Y({localResponseNormalizationBackprop_:gW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xW={kernelName:r1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,s]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=n;return{x:()=>bW(r,s,t,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dC(t,e,n,r){return e.rank<n.rank&&(e=J(e,qt(e.shape,r))),t.rank<n.rank&&(t=J(t,qt(t.shape,r))),{x:()=>H(t,we(ti(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lw={kernelName:s1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{reductionIndices:s}=r,i=e[0],o=e[1],a=et(s,i.shape),l=dC(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yW={kernelName:Uh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>H(t,we(nl(n,r),"float32")),b:()=>H(t,we(pd(n,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(t,e,n,r,s,i,o){const a=V(t,"dy","maxPool3dGrad"),l=V(e,"input","maxPool3dGrad"),u=V(n,"output","maxPool3dGrad");let c=a,h=l,f=u,d=!1;l.rank===4&&(d=!0,c=J(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=J(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=J(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),L(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),L(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),L(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),fr("maxPool3dGrad",i,o);const p={dy:c,input:h,output:f},g={filterSize:r,strides:s,pad:i,dimRoundingMode:o},m=K.runKernel(nx,p,g);return d?J(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const wW=Y({maxPool3dGrad_:vW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kW={kernelName:o1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,s]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>wW(t,r,s,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SW(t,e,n,r,s,i,o){const a=V(t,"dy","maxPoolGrad"),l=V(e,"input","maxPoolGrad"),u=V(n,"output","maxPoolGrad");L(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),L(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),L(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),fr("maxPoolGrad",i,o);const c={dy:a,input:l,output:u},h={filterSize:r,strides:s,pad:i,dimRoundingMode:o};return K.runKernel(tx,c,h)}const CW=Y({maxPoolGrad_:SW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $W={kernelName:i1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,s]=e,{filterSize:i,strides:o,pad:a}=n;return{x:()=>CW(t,r,s,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IW={kernelName:a1,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:s}=n,i=et(s,r.shape),a=xn(r.shape,i)[1],l=se(a);return{x:()=>{const c=r.shape.slice();i.forEach(d=>{c[d]=1});const h=J(t,c);return Ee(H(h,Hi(r.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TW={kernelName:l1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{axis:s}=r,[i,o]=e,a=et(s,i.shape),l=dC(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NW={kernelName:Gh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>H(t,we(Ru(n,r),"float32")),b:()=>H(t,we(Pr(n,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _W={kernelName:u1,inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:s}=n,i=s.map(o=>o[0]);return{x:()=>vt(t,i,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AW={kernelName:Hh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,s=Xe(n.shape,r.shape);return{a:()=>{const a=ln(n.shape,s);return a.length>0?J(Ne(t,a),n.shape):t},b:()=>{const a=H(t,Nt(P1(Ee(n,r)))),l=ln(r.shape,s);return l.length>0?J(Ne(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EW={kernelName:qh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,s=Xe(n.shape,r.shape);return{a:()=>{const a=H(t,we(r,"float32")),l=ln(n.shape,s);return l.length>0?J(Ne(a,l),n.shape):a},b:()=>{const a=H(t,we(n,"float32")),l=ln(r.shape,s);return l.length>0?J(Ne(a,l),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RW={kernelName:c1,gradFunc:t=>({x:()=>Nt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DW={kernelName:d1,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>tn(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MW={kernelName:f1,gradFunc:t=>({x:()=>it(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FW={kernelName:p1,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:r}=n;return Fa(t,r).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zw={kernelName:m1,inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:s}=n,i=s.map(o=>o[0]);return{x:()=>vt(t,i,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OW={kernelName:Xh,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,r,s]=e,i=n,o=r,a=Xe(i.shape,o.shape);return{a:()=>{const c=we(o,"float32");let h=H(t,H(c,Ea(i,Ie(c,He(1)))));const f=ln(i.shape,a);return f.length>0&&(h=Ne(h,f)),J(h,i.shape)},b:()=>{const c=Pr(i,0),h=Gn(c,is(i),it(i));let f=H(t,H(s,h));const d=ln(o.shape,a);return d.length>0&&(f=Ne(f,d)),J(f,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LW={kernelName:g1,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,r]=e,s=Pr(n,0);return{x:()=>Gn(s,t,H(t,r)),alpha:()=>{let i=Gn(s,it(t),H(t,n));const o=ln(r.shape,t.shape);return o.length>0&&(i=Ne(i,o)),J(i,r.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zW(t,e,n){const r=t.shape.slice();r[n]=1;const s=J(e,r),i=K2(t,n,!0,!1),o=K2(t,n,!0,!0),a=H(i,o);return H(s,a)}function PW(t,e,n){const r=t.shape.length,s=r-n.length,i=Rt(n,r);let o=t;i!=null&&(o=st(t,i));const a=o.shape.slice(),u=a.splice(r-n.length,n.length).reduce((f,d)=>f*d,1);a.push(u);const c=o.reshape(a);let h=zW(c,e,s);if(h=h.reshape(o.shape),i!=null){const f=Po(i);h=st(h,f)}return h}const BW={kernelName:b1,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:s}=n;let i=[];return s==null?i=r.shape.map((o,a)=>a):typeof s=="number"?i=[s]:i=s,{x:()=>PW(r,t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VW={kernelName:_h,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,s=Xe(n.shape,r.shape);return{a:()=>{const a=Ee(t,we(r,"float32")),l=ln(n.shape,s);return l.length>0?J(Ne(a,l),n.shape):a},b:()=>{let a=H(t,we(n,"float32"));const l=ln(r.shape,s);l.length>0&&(a=J(Ne(a,l),r.shape));const u=kt(r);return Nt(Ee(a,we(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WW={kernelName:jh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ee(t,Nt(kt(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UW={kernelName:Yh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=H(Ru(n,6),m0(n));return{x:()=>H(t,we(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GW={kernelName:Kh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(t,we(m0(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HW={kernelName:x1,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>J(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qW={kernelName:v1,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,s={dy:t,images:r};return{images:()=>K.runKernel(ux,s,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XW={kernelName:y1,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,s={dy:t,images:r};return{images:()=>K.runKernel(lx,s,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jW={kernelName:w1,gradFunc:(t,e,n)=>{const{dims:r}=n,s=et(r,t.shape);return{x:()=>Ma(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KW={kernelName:Zh,gradFunc:t=>({x:()=>it(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YW={kernelName:Jh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Nt(Ee(t,H(Ea(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZW={kernelName:k1,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>we(it(n),"float32"),t:()=>H(t,we(n,t.dtype)),e:()=>H(t,we(Ex(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JW={kernelName:Qh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const r=Pr(n,He(0)),s=He(U1),i=He(G1),o=H(t,i),a=H(H(t,s),zr(we(n,"float32")));return Gn(r,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QW={kernelName:r0,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(t,H(n,Ie(He(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eU={kernelName:n0,gradFunc:t=>({x:()=>it(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tU={kernelName:e0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(Cx(we(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nU={kernelName:t0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(Qk(we(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rU={kernelName:S1,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{begin:s,size:i}=n,o=r.shape,[a,l]=V1(r,s,i),u=[];for(let c=0;c<t.rank;c++)u.push([a[c],o[c]-a[c]-l[c]]);return{x:()=>Mx(t,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sU={kernelName:T1,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{dim:s}=n,i=!0,o=H(t,r);return{logits:()=>Ie(o,H(Ne(o,[s],i),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iU={kernelName:s0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(t,Eu(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pw={kernelName:$1,gradFunc:(t,e,n)=>{const{blockShape:r,paddings:s}=n;return{x:()=>kx(t,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bw={kernelName:I1,gradFunc:(t,e,n)=>{const{axis:r}=n;return{x:()=>Un(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oU={kernelName:i0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ee(t,H(An(we(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aU={kernelName:cx,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(t,H(we(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lU={kernelName:o0,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,s=He(2);return{a:()=>H(t,H(s,Ie(n,r))),b:()=>H(t,H(s,Ie(r,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uU={kernelName:h0,gradFunc:t=>({x:()=>it(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cU={kernelName:a0,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,s=Xe(n.shape,r.shape);return{a:()=>{let a=t;const l=ln(n.shape,s);return l.length>0&&(a=Ne(a,l)),J(a,n.shape)},b:()=>{let a=t;const l=ln(r.shape,s);return l.length>0&&(a=Ne(a,l)),J(Nt(a),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hU={kernelName:C1,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,s=r.shape.slice(),{axis:i}=n;et(i,r.shape).forEach(u=>{s[u]=1});const a=J(t,s),l=H(a,Hi(r.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fU={kernelName:l0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ee(t,kt(Cx(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dU={kernelName:u0,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>H(Ie(He(1),kt(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pU={kernelName:c0,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{reps:s}=n;return{x:()=>{let o=it(r);if(r.rank===1)for(let a=0;a<s[0];++a)o=he(o,vt(t,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)o=he(o,vt(t,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let u=0;u<s[2];++u)o=he(o,vt(t,[a*r.shape[0],l*r.shape[1],u*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let u=0;u<s[2];++u)for(let c=0;c<s[3];++c)o=he(o,vt(t,[a*r.shape[0],l*r.shape[1],u*r.shape[2],c*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mU={kernelName:Ll,gradFunc:(t,e,n)=>{const r=n,{perm:s}=r,i=Po(s);return{x:()=>st(t,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gU={kernelName:N1,gradFunc:(t,e,n)=>{const r=n,{axis:s}=r;return{value:()=>ni(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU={kernelName:_1,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>xU(t,n)}}};function xU(t,e){const n=Bo(e,it(e)),r=B1(t,n);let s=nl(e,He(0,"int32"));const i=r.rank-s.rank;for(let a=0;a<i;++a)s=Yn(s,a+1);s=Fi(s,Hi(r.shape,"bool"));const o=it(r);return Gn(s,r,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yU={kernelName:A1,gradFunc:t=>({x:()=>it(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vU=[fC,bV,xV,yV,vV,wV,kV,SV,CV,$V,IV,TV,AV,DV,MV,FV,OV,LV,zV,PV,BV,VV,UV,WV,qV,XV,jV,KV,YV,ZV,VW,JV,QV,eW,tW,nW,sW,rW,iW,oW,aW,lW,uW,cW,hW,fW,dW,pW,mW,xW,Lw,Lw,yW,kW,$W,IW,TW,NW,_W,AW,EW,RW,DW,MW,FW,zw,zw,OW,LW,BW,WW,UW,GW,HW,qW,XW,jW,KW,YW,ZW,JW,QW,eU,tU,nU,rU,sU,iU,Pw,Pw,Bw,Bw,oU,lU,aU,uU,cU,hU,fU,dU,pU,mU,gU,bU,yU];for(const t of vU)pM(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.abs=function(){return this.throwIfDisposed(),dn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.acos=function(){return this.throwIfDisposed(),_F(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.acosh=function(){return this.throwIfDisposed(),EF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.add=function(t){return this.throwIfDisposed(),he(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.all=function(t,e){return this.throwIfDisposed(),Kk(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.any=function(t,e){return this.throwIfDisposed(),X2(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.argMax=function(t){return this.throwIfDisposed(),Bc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.argMin=function(t){return this.throwIfDisposed(),OF(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.asScalar=function(){return this.throwIfDisposed(),L(this.size===1,()=>"The array must have only 1 element."),J(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.asType=function(t){return this.throwIfDisposed(),we(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.as1D=function(){return this.throwIfDisposed(),J(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.as2D=function(t,e){return this.throwIfDisposed(),J(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),J(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),J(this,[t,e,n,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.as5D=function(t,e,n,r,s){return this.throwIfDisposed(),J(this,[t,e,n,r,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.asin=function(){return this.throwIfDisposed(),zF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.asinh=function(){return this.throwIfDisposed(),BF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.atan=function(){return this.throwIfDisposed(),WF(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.atan2=function(t){return this.throwIfDisposed(),GF(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.atanh=function(){return this.throwIfDisposed(),qF(this)};re().prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),wx(this,t,e,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),kx(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.batchNorm=function(t,e,n,r,s){return this.throwIfDisposed(),F1(this,t,e,n,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Ac(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.cast=function(t){return this.throwIfDisposed(),we(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.ceil=function(){return this.throwIfDisposed(),yO(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Lr(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof en&&(t=[t]),Un([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.conv1d=function(t,e,n,r,s,i){return this.throwIfDisposed(),Yk(this,t,e,n,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.conv2dTranspose=function(t,e,n,r,s){return this.throwIfDisposed(),Zk(this,t,e,n,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.conv2d=function(t,e,n,r,s,i){return this.throwIfDisposed(),Aa(this,t,e,n,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.cos=function(){return this.throwIfDisposed(),Cx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.cosh=function(){return this.throwIfDisposed(),Qk(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),K2(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),eS(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),GO(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.depthwiseConv2d=function(t,e,n,r,s,i){return this.throwIfDisposed(),$x(this,t,e,n,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.dilation2d=function(t,e,n,r,s){return this.throwIfDisposed(),XO(this,t,e,n,r,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.divNoNan=function(t){return this.throwIfDisposed(),JO(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.div=function(t){return this.throwIfDisposed(),Ee(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.dot=function(t){return this.throwIfDisposed(),eL(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.elu=function(){return this.throwIfDisposed(),L1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.equal=function(t){return this.throwIfDisposed(),ti(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.erf=function(){return this.throwIfDisposed(),tS(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),fL(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.exp=function(){return this.throwIfDisposed(),zr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.expandDims=function(t){return this.throwIfDisposed(),Yn(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.expm1=function(){return this.throwIfDisposed(),gL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.fft=function(){return this.throwIfDisposed(),bS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.flatten=function(){return this.throwIfDisposed(),J(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.floor=function(){return this.throwIfDisposed(),P1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.floorDiv=function(t){return this.throwIfDisposed(),jk(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.gather=function(t,e,n){return this.throwIfDisposed(),B1(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.greaterEqual=function(t){return this.throwIfDisposed(),nl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.greater=function(t){return this.throwIfDisposed(),Pr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.ifft=function(){return this.throwIfDisposed(),Z2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.irfft=function(){return this.throwIfDisposed(),uP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.isFinite=function(){return this.throwIfDisposed(),$L(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.isInf=function(){return this.throwIfDisposed(),TL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.isNaN=function(){return this.throwIfDisposed(),_L(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.leakyRelu=function(t){return this.throwIfDisposed(),Nx(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.lessEqual=function(t){return this.throwIfDisposed(),Ru(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.less=function(t){return this.throwIfDisposed(),pd(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.localResponseNormalization=function(t,e,n,r){return this.throwIfDisposed(),FL(this,t,e,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.logSigmoid=function(){return this.throwIfDisposed(),WL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.logSoftmax=function(t){return this.throwIfDisposed(),iS(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),Ax(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.log=function(){return this.throwIfDisposed(),is(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.log1p=function(){return this.throwIfDisposed(),_x(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.logicalAnd=function(t){return this.throwIfDisposed(),Fi(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.logicalNot=function(){return this.throwIfDisposed(),Ex(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.logicalOr=function(t){return this.throwIfDisposed(),oS(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.logicalXor=function(t){return this.throwIfDisposed(),YL(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),ht(this,t,e,n)};re().prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),Rx(this,t,e,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.max=function(t,e){return this.throwIfDisposed(),Ss(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.maximum=function(t){return this.throwIfDisposed(),Bo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.mean=function(t,e){return this.throwIfDisposed(),Wt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.min=function(t,e){return this.throwIfDisposed(),dd(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.minimum=function(t){return this.throwIfDisposed(),Ql(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),sz(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.mod=function(t){return this.throwIfDisposed(),oz(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.mul=function(t){return this.throwIfDisposed(),H(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.neg=function(){return this.throwIfDisposed(),Nt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.norm=function(t,e,n){return this.throwIfDisposed(),z1(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.notEqual=function(t){return this.throwIfDisposed(),Uc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),aS(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.onesLike=function(){return this.throwIfDisposed(),os(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.pad=function(t,e){return this.throwIfDisposed(),Mx(this,t,e)};re().prototype.pool=function(t,e,n,r,s,i){return this.throwIfDisposed(),gz(this,t,e,n,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.pow=function(t){return this.throwIfDisposed(),Ea(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.prelu=function(t){return this.throwIfDisposed(),Ox(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.prod=function(t,e){return this.throwIfDisposed(),yz(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.reciprocal=function(){return this.throwIfDisposed(),Uz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.relu=function(){return this.throwIfDisposed(),qi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.relu6=function(){return this.throwIfDisposed(),uS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.reshapeAs=function(t){return this.throwIfDisposed(),J(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.reshape=function(t){return this.throwIfDisposed(),J(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),SS(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),CS(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.reverse=function(t){return this.throwIfDisposed(),Ma(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.rfft=function(){return this.throwIfDisposed(),fP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.round=function(){return this.throwIfDisposed(),cS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.rsqrt=function(){return this.throwIfDisposed(),hS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.selu=function(){return this.throwIfDisposed(),fS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.separableConv2d=function(t,e,n,r,s,i){return this.throwIfDisposed(),dS(this,t,e,n,r,s,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.sigmoid=function(){return this.throwIfDisposed(),Eu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.sign=function(){return this.throwIfDisposed(),Jz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.sin=function(){return this.throwIfDisposed(),pS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.sinh=function(){return this.throwIfDisposed(),mS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.slice=function(t,e){return this.throwIfDisposed(),vt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.softmax=function(t){return this.throwIfDisposed(),Bx(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.softplus=function(){return this.throwIfDisposed(),d0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Fx(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.split=function(t,e){return this.throwIfDisposed(),Or(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.sqrt=function(){return this.throwIfDisposed(),An(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.square=function(){return this.throwIfDisposed(),kt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.squaredDifference=function(t){return this.throwIfDisposed(),xS(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.squeeze=function(t){return this.throwIfDisposed(),p0(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof en?[this,t]:[this,...t];return ni(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.step=function(t){return this.throwIfDisposed(),m0(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.stridedSlice=function(t,e,n,r,s,i,o,a){return this.throwIfDisposed(),xP(this,t,e,n,r,s,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.sub=function(t){return this.throwIfDisposed(),Ie(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.sum=function(t,e){return this.throwIfDisposed(),Ne(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.tan=function(){return this.throwIfDisposed(),vP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.tanh=function(){return this.throwIfDisposed(),M1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.tile=function(t){return this.throwIfDisposed(),Dr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.toBool=function(){return this.throwIfDisposed(),we(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.toFloat=function(){return this.throwIfDisposed(),we(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.toInt=function(){return this.throwIfDisposed(),we(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.topk=function(t,e){return this.throwIfDisposed(),SP(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.transpose=function(t){return this.throwIfDisposed(),st(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.unique=function(t){return this.throwIfDisposed(),IP(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),wS(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.unstack=function(t){return this.throwIfDisposed(),Fa(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.where=function(t,e){return this.throwIfDisposed(),Gn(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */re().prototype.zerosLike=function(){return this.throwIfDisposed(),it(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ls extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ls.prototype)}}class Qr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Qr.prototype)}}class q extends Error{constructor(e){super(e),Object.setPrototypeOf(this,q.prototype)}}class Ke extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ke.prototype)}}class Sy extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Sy.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pC{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Oa(t,e){if(Array.isArray(t)){let n=[];for(let r=0;r<e;r++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function zs(t,e){if(!t)throw new Sy(e)}function Vw(t,e){let n=0;for(const r of t)r===e&&n++;return n}function Zn(t){return t.length===1?t[0]:t}function pt(t){return Array.isArray(t)?t:[t]}function Si(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function la(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let Ur={};function Cy(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function eb(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>eb(e));else{const e=Object.keys(t);for(const n of e){const r=t[n];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?t[n]=r.value:eb(r))}}}function y0(t,e={},n={},r="object",s=!1){if(typeof t=="string"){const i=t;let o;if(i in n)o=n[i];else if(i in Ur)o=Ur[i];else if(o=e[i],o==null)throw new q(`Unknown ${r}: ${t}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=t;if(i.className==null||i.config==null)throw new q(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in n?[a,l]=n[o]:o in Ur?[a,l]=Ur.className:o in e&&([a,l]=e[o]),a==null)throw new q(`Unknown ${r}: ${o}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const d of Object.keys(Ur))u[d]=Ur[d];for(const d of Object.keys(n))u[d]=n[d];const c=i.config;c.customObjects=u;const h=Object.assign({},Ur);for(const d of Object.keys(n))Ur[d]=n[d];eb(i.config);const f=l(a,i.config,n,s);return Ur=Object.assign({},h),f}else{const u=Object.assign({},Ur);for(const h of Object.keys(n))Ur[h]=n[h];const c=new a(i.config);return Ur=Object.assign({},u),c}}}function wU(t,e){return t<e?-1:t>e?1:0}function Y0(t,e){return-1*wU(t,e)}function go(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function kU(t){if(t==null)throw new q(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function sl(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new q(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function $y(t,e,n=0,r=1/0){return zs(n>=0),zs(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every(s=>typeof s===e)}function mn(t,e){Array.isArray(t)?(L(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,r)=>mn(n,`element ${r+1} of ${e}`))):L(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${mC(t)}.`)}function mC(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>mC(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function SU(t,e,n){let r=n!=null?n():Kn(),s;return(...o)=>{const a=n!=null?n():Kn();return a-r<e||(r=a,s=t(...o)),s}}function gC(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let CU=0;function bC(){return CU++}const Z0={};function H1(t=""){return t in Z0||(Z0[t]=0),Z0[t]+=1,t+Z0[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const $U=["channelsFirst","channelsLast"],IU=["nearest","bilinear"],TU=["valid","same","causal"],NU=["max","avg"],_U=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const bl=new Map;function jt(t){sl($U,"DataFormat",t)}function AU(t){sl(IU,"InterpolationFormat",t)}function Br(t){sl(TU,"PaddingMode",t)}function xC(t){sl(NU,"PoolMode",t)}const Ec=[],Ww="/";function ba(t,e){Ec.push(t);try{const n=e();return Ec.pop(),n}catch(n){throw Ec.pop(),n}}function EU(){return Ec.length===0?"":Ec.join(Ww)+Ww}function yC(t){if(!wC(t))throw new Error("Not a valid tensor name: '"+t+"'");return EU()+t}function vC(t){if(!wC(t))throw new Error("Not a valid tensor name: '"+t+"'");bl.has(t)||bl.set(t,0);const e=bl.get(t);if(bl.set(t,bl.get(t)+1),e>0){const n=`${t}_${e}`;return bl.set(n,1),n}else return t}const RU=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function wC(t){return!!t.match(RU)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DU(t){return t===parseInt(t.toString(),10)}function bo(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let r=1;for(let s=e;s<n;++s)r*=t[s];return r}function eu(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r<e&&(e=r)}return e}function wo(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r>e&&(e=r)}return e}function Is(t,e){if(e<t)throw new q(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let r=t;r<e;++r)n.push(r);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let yg;function rn(){return yg==null&&(yg=WM().epsilon()),yg}function Ts(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zs(t,e){return we(t,e)}function v0(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),J(t,n)}function MU(t,e){return Q(()=>{if(t.shape.length!==2)throw new q(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=v0(t,1);return tb(n,[1,e,1])})}function FU(t){const e=[bo(t.shape)];return J(t,e)}function OU(t){if(t.rank<=1)throw new q(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],bo(t.shape,1)];return J(t,e)}function xa(t,e,n){return Q(()=>{switch(t.rank){case 1:return zx(t,e,n);case 2:return gS(t,[e,0],[n,t.shape[1]]);case 3:return Px(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return gd(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return vt(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return vt(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new q(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function vg(t,e,n){return Q(()=>{switch(t.rank){case 1:return zx(t,e,n);case 2:return gS(t,[0,e],[t.shape[0],n]);case 3:return Px(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return gd(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new q(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function J0(t,e,n,r){return Q(()=>{switch(t.rank){case 1:return zx(t,e,n);case 2:switch(r){case 1:return xa(t,e,n);case 2:return vg(t,e,n);default:throw new q(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return xa(t,e,n);case 2:return Px(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return vg(t,e,n);default:throw new q(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return xa(t,e,n);case 2:return gd(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return gd(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return vg(t,e,n);default:throw new q(`The axis is not within the rank of the tensor ${r}`)}default:throw new q(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Iy(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),Un(t,e)}function Uw(t,e){switch(t.rank){case 1:return kO([t,e]);case 2:return CO([t,e],0);case 3:return IO([t,e],0);case 4:return NO([t,e],0);default:throw new q(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function tb(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new q(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return Dr(t,e)}function q1(t,e=0,n=1,r,s){return Y2(t,e,n,r,s)}function Js(t,e,n,r){if(t.rank<2||e.rank<2)throw new Ke(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const s=t.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(s!==i)throw new Ke(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return Tw({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?nb(t.rank,r,Ts()):null,activation:n});{const s=t.shape.slice(),i=s.pop();t=J(t,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],c=Array.from({length:e.rank},(p,g)=>g===0?e.rank-2:g<=e.rank-2?g-1:g);e=J(st(e,c),[l,-1]);const h=[...s,...u];return J(Tw({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?nb(t.rank,r,Ts()):null,activation:n}),h)}}function kC(t,e,n){return Q(()=>(Array.isArray(e)?e=Sr(e,"int32"):e=we(e,"int32"),B1(t,e,n)))}function w0(t){return H(t,t)}function nb(t,e,n){const r=e.shape;if(e.rank!==1&&e.rank!==t)throw new q(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return r.length===1?J(e,[1,r[0],1,1,1]):J(e,[1,r[3],r[0],r[1],r[2]]);if(n==="channelsLast")return r.length===1?J(e,[1,1,1,1,r[0]]):J(e,[1].concat(r))}else if(t===4){if(n==="channelsFirst")return r.length===1?J(e,[1,r[0],1,1]):J(e,[1,r[2],r[0],r[1]]);if(n==="channelsLast")return r.length===1?J(e,[1,1,1,r[0]]):J(e,[1].concat(r))}else if(t===3){if(n==="channelsFirst")return r.length===1?J(e,[1,r[0],1]):J(e,[1,r[1],r[0]]);if(n==="channelsLast")return r.length===1?J(e,[1,1,r[0]]):J(e,[1].concat(r))}else if(t<3)return e;throw new q(`Unsupported input rank by biasAdd: ${e.rank}`)}function Ds(t,e,n){return Q(()=>(n==null&&(n=Ts()),jt(n),he(t,nb(t.rank,e,n))))}function LU(t,e=1){if(e!==1)throw new Ke(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return L1(t)}function zU(t){return Q(()=>Ee(t,he(dn(t),1)))}function SC(t,e,n,r){return Q(()=>DP(t,e,n,r))}function PU(t){return Q(()=>{const e=he(.5,H(.2,t));return Lr(e,0,1)})}function k0(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const BU=["fanIn","fanOut","fanAvg"],VU=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WU(t){sl(BU,"FanMode",t)}function UU(t){sl(VU,"Distribution",t)}class cs extends Mu{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class CC extends cs{apply(e,n){return tn(e,n)}}CC.className="Zeros";ue(CC);class Ty extends cs{apply(e,n){return Hi(e,n)}}Ty.className="Ones";ue(Ty);class $C extends cs{constructor(e){if(super(),typeof e!="object")throw new q(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new q(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return Q(()=>H(He(this.value),Hi(e,n)))}getConfig(){return{value:this.value}}}$C.className="Constant";ue($C);class IC extends cs{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return Da(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}IC.className="RandomUniform";ue(IC);class TC extends cs{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ke(`randomNormal does not support dType ${n}.`);return q1(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}TC.className="RandomNormal";ue(TC);class NC extends cs{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ke(`truncatedNormal does not support dType ${n}.`);return vS(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}NC.className="TruncatedNormal";ue(NC);class _C extends cs{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return Q(()=>{if(e.length!==2||e[0]!==e[1])throw new q("Identity matrix initializer can only be used for 2D square matrices.");return H(this.gain,sS(e[0]))})}getConfig(){return{gain:this.gain}}}_C.className="Identity";ue(_C);function GU(t,e="channelsLast"){let n,r;if(jt(e),t.length===2)n=t[0],r=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const s=bo(t,2);n=t[1]*s,r=t[0]*s}else if(e==="channelsLast"){const s=bo(t,0,t.length-2);n=t[t.length-2]*s,r=t[t.length-1]*s}}else{const s=bo(t);n=Math.sqrt(s),r=Math.sqrt(s)}return[n,r]}class $r extends cs{constructor(e){if(super(),e.scale<0)throw new q(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,WU(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,UU(this.distribution),this.seed=e.seed}apply(e,n){const r=GU(e),s=r[0],i=r[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,s):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(s+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Ke(`${this.getClassName()} does not support dType ${n}.`);return vS(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return Da(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}$r.className="VarianceScaling";ue($r);class Ny extends $r{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return $r.className}}Ny.className="GlorotUniform";ue(Ny);class _y extends $r{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return $r.className}}_y.className="GlorotNormal";ue(_y);class Ay extends $r{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return $r.className}}Ay.className="HeNormal";ue(Ay);class Ey extends $r{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return $r.className}}Ey.className="HeUniform";ue(Ey);class Ry extends $r{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return $r.className}}Ry.className="LeCunNormal";ue(Ry);class Dy extends $r{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return $r.className}}Dy.className="LeCunUniform";ue(Dy);class AC extends cs{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return Q(()=>{if(e.length<2)throw new Ke("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const r=se(e.slice(0,-1)),s=e[e.length-1],i=r*s;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(s,r),Math.min(s,r)],a=q1(o,0,1,n,this.seed),l=jB.qr(a,!1);let u=l[0];const h=l[1].flatten().stridedSlice([0],[Math.min(s,r)*Math.min(s,r)],[Math.min(s,r)+1]);return u=H(u,h.sign()),r<s&&(u=u.transpose()),H(He(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}AC.className="Orthogonal";ue(AC);const Gw={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Hw(t,e={}){return y0(t,Yr.getMap().classNameMap,e,"initializer")}function Et(t){return Cy(t)}function It(t){if(typeof t=="string"){const e=t in Gw?Gw[t]:t;if(e==="GlorotNormal")return new _y;if(e==="GlorotUniform")return new Ny;if(e==="HeNormal")return new Ay;if(e==="HeUniform")return new Ey;if(e==="LeCunNormal")return new Ry;if(e==="LeCunUniform")return new Dy;{const n={};return n.className=e,n.config={},Hw(n)}}else return t instanceof cs?t:Hw(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rb(t){return Array.isArray(t)&&Array.isArray(t[0])}function bd(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function We(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new q(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function lt(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new q(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xd(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((r,s)=>r*s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qw="Variable";class HU{constructor(e,n="float32",r=qw,s=!0,i=null){this.dtype=n??"float32",this.shape=e.shape,this.id=bC(),r=r??qw,this.originalName=yC(r),this.name=vC(this.originalName),this.trainable_=s,this.constraint=i,this.val=_P(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),qU(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function qU(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function sb(t){return t.map(e=>e.read())}function My(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class sn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class ri{constructor(e,n,r,s,i,o,a){this.dtype=e,this.shape=n,this.sourceLayer=r,this.inputs=s,this.callArgs=i,this.outputTensorIndex=a,this.id=bC(),o!=null&&(this.originalName=yC(o),this.name=vC(this.originalName)),this.rank=n.length}}let XU=0,X1=class{constructor(e,n){this.callArgs=n,this.id=XU++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const r of e.inboundLayers)r!=null&&r.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},jU=0;class tt extends Mu{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=jU++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const r=this.getClassName();n=Si(r)+"_"+H1(r)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let r;if(e.batchInputShape!=null)r=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),r=[i].concat(e.inputShape)}this.batchInputShape=r;let s=e.dtype;s==null&&(s=e.inputDType),s==null&&(s="float32"),this.dtype=s}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new Qr(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new q(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Zn(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Zn(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Ls(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Ls(`Layer ${this.name} is not connected, no input to return.`);return Zn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Ls(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Ls(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Zn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=pt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const r=pt(this.inputSpec);if(n.length!==r.length)throw new q(`Layer ${this.name} expects ${r.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let s=0;s<n.length;s++){const i=n[s],o=r[s];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new q(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new q(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new q(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new q(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const c=Number(u),h=o.axes[u],f=c>=0?l[c]:l[l.length+c];if(h!=null&&[h,null].indexOf(f)===-1)throw new q(`Input ${s} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${h} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],c=i.shape[l];if(u!=null&&c!=null&&u!==c)throw new q(`Input ${s} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const r=pt(e),s=ZU(e),i=JU(e);if(s===i)throw new q("Arguments to apply() must be all SymbolicTensors or all Tensors");return ba(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of pt(e))o.push(a.shape);this.build(Zn(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,o);const a=pt(o),l=[];for(let u of a)r.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=Zn(l),this.activityRegularizer!=null)throw new Ke("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=KU(e),a=this.computeOutputShape(o);let l;const u=YU(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((c,h)=>new ri(u,c,this,pt(e),n,this.name,h)):l=new ri(u,a,this,pt(e),n,this.name),this.addInboundNode(e,l,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new Ke("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((r,s)=>{r!=null&&e[s]!=null&&e[s]!==r&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ls(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const r=JSON.stringify(n.outputShapes);e.indexOf(r)===-1&&e.push(r)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new Ls(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Qr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return xd(this.weights)}build(e){this.built=!0}getWeights(e=!1){return sb(e?this.trainableWeights:this.weights)}setWeights(e){Q(()=>{const n=this.weights;if(n.length!==e.length)throw new q(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const r=[],s=sb(n);for(let i=0;i<s.length;++i){const o=s[i],a=n[i],l=e[i];if(!ft(o.shape,l.shape))throw new q(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}My(r)})}addWeight(e,n,r,s,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new q(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(s=l!=null?l():It("zeros"));const u=s.apply(n,r),c=new HU(u,r,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),o==null&&(o=!0),o?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=pt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,r){if(!this.supportsMasking)return;const s=this.computeMask(e,r),i=pt(n),o=pt(s);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,n,r,s,i,o,a=null){const l=pt(e);n=pt(n),r=pt(r),s=pt(s),i=bd(i),o=bd(o);const u=[],c=[],h=[];for(const f of l)u.push(f.sourceLayer),c.push(f.nodeIndex),h.push(f.tensorIndex);new X1({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:h,inputTensors:l,outputTensors:n,inputMasks:r,outputMasks:s,inputShapes:i,outputShapes:o},a);for(let f=0;f<n.length;f++)n[f].sourceLayer=this,n[f].nodeIndex=this.inboundNodes.length-1,n[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function KU(t){t=pt(t);const e=[];for(const n of t)e.push(n.shape);return Zn(e)}function YU(t){return"float32"}function EC(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const r=e.inboundNodes[n];if(r.inboundLayers.length===0)return r.inputTensors;{const s=[];for(let i=0;i<r.inboundLayers.length;i++){const o=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],u=EC(o,a,l);for(const c of u)s.indexOf(c)===-1&&s.push(c)}return s}}}function ZU(t){let e=!0;for(const n of pt(t))if(!(n instanceof ri)){e=!1;break}return e}function JU(t){let e=!0;for(const n of pt(t))if(n instanceof ri){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class S0 extends tt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:H1("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new q("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new q("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new q("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=e.dtype||"float32";this.batchInputShape=n,this.dtype=r,this.inputSpec=[{shape:n}];const s=new ri(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new X1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new q(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}S0.className="InputLayer";ue(S0);function QU(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new q("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new S0({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eG(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return we(e,t.dtype)}catch{throw new q(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class lo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof lo)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=eG(e,n),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new q(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof ri){if(this.id2Value[e.id]==null)throw new q(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new q(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof ri){if(this.id2Value[e.id]==null)throw new q(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new q(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&Ze(this.id2Mask)}}const yd=new pC,vd=new pC;function tG(t){yd!=null&&yd.setMaxEntries(t),vd!=null&&vd.setMaxEntries(t)}function dc(t,e,n,r){const s=n==null?!1:n.training,i=Array.isArray(t),o=i?t:[t],a=o.map(p=>p.name),l=[],u=e.names();for(const p of a)u.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);const c=a.join(",")+"|"+e.names().sort().join(",");let h=yd.get(c),f;if(h==null){const p=nG(o,e);h=p.sorted,f=p.recipientCounts,yd.put(c,h),vd.put(c,f)}f={},s||Object.assign(f,vd.get(c));const d=new lo(e);for(let p=0;p<h.length;++p){const g=h[p],m=g.sourceLayer;if(m instanceof S0)continue;const b=[],x=[],v=[];let y=!1;for(const $ of g.inputs){const _=d.getValue($),S=d.getMask($);b.push(_),x.push(S),S!=null&&(y=!0),s||(f[$.name]--,f[$.name]===0&&!e.hasKey($)&&a.indexOf($.name)===-1&&!_.isDisposed&&$.sourceLayer.stateful!==!0&&v.push(_))}y&&(n=n||{},n.mask=x[0]);const w=pt(m.apply(b,n));let C=null;m.supportsMasking&&(C=m.computeMask(b,x));const T=sG(g),N=Array.isArray(T)?T:[T];for(let $=0;$<N.length;++$){d.hasKey(N[$])||d.add(N[$],w[$],Array.isArray(C)?C[0]:C);const _=a.indexOf(N[$].name);_!==-1&&(l[_]=w[$])}s||Ze(v)}return d.disposeMasks(),i?l:l[0]}function nG(t,e){L(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(t.length===1){const s=Xw(t[0],e);n=s.sorted,r=s.recipientMap}else{const s=new Set;for(const i of t){const{sorted:o,recipientMap:a}=Xw(i,e);for(const l of o)s.has(l.name)||(n.push(l),s.add(l.name));for(const l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(u=>r[l].add(u))}}return{sorted:n,recipientCounts:rG(r)}}function rG(t){const e={};for(const n in t)e[n]=t[n].size;return e}function Xw(t,e){const n=new Set,r=[],s={};for(const a of e.names())n.add(a);const i=[],o=[];for(i.push(t);i.length>0;){const a=i[i.length-1];if(n.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),n.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)s[u.name]==null&&(s[u.name]=new Set),s[u.name].add(a.name),!n.has(u.name)&&i.push(u)}}return{sorted:r,recipientMap:s}}function sG(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let r=0;r<t.sourceLayer.inboundNodes.length;++r)for(const s of t.sourceLayer.inboundNodes[r].outputTensors)if(s.id===t.id){n=r;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG=ee();iG.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,tG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fy(t,e){return Q(()=>An(Ne(H(t,t),e,!0)))}class C0 extends Mu{getConfig(){return{}}}class RC extends C0{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Q(()=>{const n=Fy(e,this.axis),r=Lr(n,0,this.maxValue);return H(e,Ee(r,he(rn(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}RC.className="MaxNorm";ue(RC);class DC extends C0{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Q(()=>Ee(e,he(rn(),Fy(e,this.axis))))}getConfig(){return{axis:this.axis}}}DC.className="UnitNorm";ue(DC);class MC extends C0{apply(e){return qi(e)}}MC.className="NonNeg";ue(MC);class FC extends C0{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Q(()=>{const n=Fy(e,this.axis),r=he(H(this.rate,Lr(n,this.minValue,this.maxValue)),H(1-this.rate,n));return H(e,Ee(r,he(rn(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}FC.className="MinMaxNorm";ue(FC);const jw={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function on(t){return Cy(t)}function Kw(t,e={}){return y0(t,Yr.getMap().classNameMap,e,"constraint")}function an(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in jw?jw[t]:t,config:{}};return Kw(n)}else return t instanceof C0?t:Kw(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Zo(t){if(t==null)return;const e=[],n=[],r=[];for(const s in t){const i=t[s];if(typeof i!="number"){const o=i;e.push(o.data()),n.push(s),r.push(o)}}if(e.length>0){const s=await Promise.all(e);for(let i=0;i<s.length;++i)t[n[i]]=s[i][0];Ze(r)}}function OC(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Yw;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(Yw||(Yw={}));const oG=125;class Hc{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class aG{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const r of this.callbacks)await r.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const r of this.callbacks)await r.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const r of this.callbacks)await r.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const r of this.callbacks)await r.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class lG extends Hc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const r=n.size==null?0:n.size;this.seen+=r;for(const s in n){const i=n[s];if(typeof i=="number")this.totals.hasOwnProperty(s)||(this.totals[s]=0),this.totals[s]=this.totals[s]+i*r;else{let o;s in this.totals?o=this.totals[s]:this.totals[s]=0;const a=Q(()=>he(this.totals[s],H(i,r)));this.totals[s]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?n[r]=this.totals[r]/this.seen:Q(()=>{const s=H(Ee(1,this.seen),this.totals[r]);n[r]=s,this.totals[r].dispose(),Ks(n[r])}))}}class uG extends Hc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const r in n)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(n[r])}async syncData(){const e=[],n=[],r=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),n.push(i),r.push(a)}}const s=await Promise.all(e);for(let i=0;i<s.length;++i)this.history[n[i]][r[i]].dispose(),this.history[n[i]][r[i]]=s[i][0]}}class cG extends Hc{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||VS,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=oG),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");D2(this.yieldEvery)&&(this.maybeWait=SU(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,r){const s=[];this.yield!=null&&(await Zo(r),s.push(this.yield(e,n,r))),s.push(this.nextFrameFunc()),await Promise.all(s)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await Zo(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const r=[];this.epochEnd!=null&&(await Zo(n),r.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(e,n){this.batchBegin!=null&&(await Zo(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const r=[];this.batchEnd!=null&&(await Zo(n),r.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):D2(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(r)}async onTrainBegin(e){this.trainBegin!=null&&(await Zo(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Zo(e),await this.trainEnd(e))}}function LC(t,e){return t==null&&(t={}),t instanceof Hc?[t]:Array.isArray(t)&&t[0]instanceof Hc?t:pt(t).map(r=>new cG(r,e))}class Xr{constructor(){}static registerCallbackConstructor(e,n){L(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Xr.checkForDuplicate(n),Xr.constructors[e]==null&&(Xr.constructors[e]=[]),Xr.constructors[e].push(n)}static checkForDuplicate(e){for(const n in Xr.constructors)Xr.constructors[+n].forEach(s=>{if(s===e)throw new q("Duplicate callback constructor.")})}static clear(){Xr.constructors={}}static createCallbacks(e){const n=[];for(const r in Xr.constructors){const s=+r;e>=s&&n.push(...Xr.constructors[s])}return n.map(r=>new r)}}Xr.constructors={};function zC(t,e,n,r,s,i,o,a,l){const u=new uG,c=[new lG,...Xr.createCallbacks(e)];t!=null&&c.push(...t),c.push(u);const h=new aG(c);return h.setParams({epochs:n,initialEpoch:r,samples:s,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qs(t,e={},n=!1){return y0(t,Yr.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wd(t,e){return Q(()=>{t.dtype!=="float32"&&(t=we(t,"float32"));const n=Ne(w0(t),e,!0),r=O1(n.shape,rn()),s=An(Bo(n,r));return Ee(t,s)})}function j1(t,e){return Q(()=>Wt(w0(Ie(e,t)),-1))}function Oy(t,e){return Q(()=>Wt(dn(Ie(e,t)),-1))}function Ly(t,e){return Q(()=>{const n=Ie(t,e),r=Lr(dn(t),rn(),Number.MAX_VALUE),s=dn(Ee(n,r));return H(100,Wt(s,-1))})}function hG(t,e){return Q(()=>{const n=Lr(e,rn(),Number.MAX_VALUE),r=is(he(1,n)),s=Lr(t,rn(),Number.MAX_VALUE),i=is(he(1,s));return Wt(w0(Ie(r,i)),-1)})}function fG(t,e){return Q(()=>{const n=Bo(0,Ie(1,H(t,e)));return Wt(w0(n),-1)})}function dG(t,e){return Q(()=>{const n=Bo(0,Ie(1,H(t,e)));return Wt(n,-1)})}function pG(t,e){return Q(()=>{const n=Ne(H(t,e),-1),r=Ss(H(Ie(1,t),e),-1);return Bo(0,he(1,Ie(r,n)))})}function mG(t,e){return Q(()=>{const n=Math.log(2),r=Ie(e,t),s=Ie(he(r,d0(H(-2,r))),n);return Wt(s,-1)})}function qc(t,e,n=!1){return Q(()=>{if(n)e=Bx(e);else{const r=Ne(e,e.shape.length-1,!0);e=Ee(e,r)}return e=Lr(e,rn(),1-rn()),Nt(Ne(H(we(t,"float32"),is(e)),e.shape.length-1))})}function kd(t,e,n=!1){return Q(()=>{const r=we(P1(FU(t)),"int32");e=Lr(e,rn(),1-rn());const s=e.shape,i=J(aS(r,s[s.length-1]),s);return qc(i,e,n)})}function gG(t,e){if(!ft(t.shape,e.shape))throw new q(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return Q(()=>{const n=qi(e),r=Nt(dn(e));return he(Ie(n,H(e,t)),_x(zr(r)))})}function K1(t,e){return Q(()=>{let n;return n=Lr(e,rn(),1-rn()),n=is(Ee(n,Ie(1,n))),Wt(gG(t,n),-1)})}function bG(t,e){return Q(()=>{const n=Lr(t,rn(),1),r=Lr(e,rn(),1);return Ne(H(t,is(Ee(n,r))),-1)})}function xG(t,e){return Q(()=>{const n=is(he(rn(),e));return Wt(Ie(e,H(t,n)),-1)})}function PC(t,e){return Q(()=>{const n=wd(t,-1),r=wd(e,-1),s=H(n,r);return Nt(Ne(s,-1))})}const Sd={meanSquaredError:j1,meanAbsoluteError:Oy,meanAbsolutePercentageError:Ly,meanSquaredLogarithmicError:hG,squaredHinge:fG,hinge:dG,categoricalHinge:pG,logcosh:mG,categoricalCrossentropy:qc,sparseCategoricalCrossentropy:kd,binaryCrossentropy:K1,kullbackLeiblerDivergence:bG,poisson:xG,cosineProximity:PC};function wg(t){if(typeof t=="string"){if(t in Sd)return Sd[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new q(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function BC(t,e){return Q(()=>{const n=H(.5,os(e)),r=Zs(Pr(e,n),t.dtype);return Wt(ti(t,r),-1)})}function VC(t,e){return Q(()=>Zs(ti(Bc(t,-1),Bc(e,-1)),"float32"))}function yG(t,e){return Q(()=>we(Ne(Fi(ti(t,1),ti(e,1))),"float32"))}function vG(t,e){return Q(()=>we(Ne(Fi(ti(t,0),ti(e,1))),"float32"))}function wG(t,e){return Q(()=>{const n=yG(t,e),r=vG(t,e),s=he(n,r);return we(Gn(Pr(s,0),Ee(n,s),0),"float32")})}function kG(t,e){return K1(t,e)}function SG(t,e){return t.rank===e.rank&&(t=p0(t,[t.rank-1])),e=Bc(e,-1),e.dtype!==t.dtype&&(e=we(e,t.dtype)),we(ti(t,e),"float32")}const CG=j1,$G=j1,IG=Oy,TG=Oy,NG=Ly,_G=Ly,WC=qc,AG=PC,UC=kd,Cd={binaryAccuracy:BC,categoricalAccuracy:VC,precision:wG,categoricalCrossentropy:WC,sparseCategoricalCrossentropy:UC,mse:CG,MSE:$G,mae:IG,MAE:TG,mape:NG,MAPE:_G,cosine:AG};function EG(t){if(typeof t=="string"&&t in Cd)return Cd[t];if(typeof t!="string"&&t!=null)return t;throw new q(`Unknown metric ${t}`)}function Q0(t){if(zs(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(Sd))if(Sd[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(Cd))if(Cd[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function RG(t){const e={Adagrad:()=>sa.adagrad(.01),Adadelta:()=>sa.adadelta(1,.95,rn()),Adam:()=>sa.adam(.001,.9,.999,rn()),Adamax:()=>sa.adamax(.002,.9,.999,rn(),0),RMSProp:()=>sa.rmsprop(.001,.9,0,rn()),SGD:()=>sa.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new q(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Zw=1*1024*1024;function Jw(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!ib(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const r=JSON.stringify(t);r.length>Zw&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${Zw}.`)}}function ib(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!ib(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!ib(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DG(t,e,n,r=console.log){const s=FG(t),i=["Layer (type)","Input Shape","Output shape","Param #"];s?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(e*c)));let o;if(!s){i.push("Receives inputs"),o=[];for(const c in t.nodesByDepth)o.push(...t.nodesByDepth[c])}r("_".repeat(e)),$d(i,n,r),r("=".repeat(e));const a=t.layers;for(let c=0;c<a.length;++c)s?OG(a[c],n,r):LG(a[c],n,o,r),r((c===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=MG(t),u=xd(t.nonTrainableWeights);r(`Total params: ${l+u}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${u}`),r("_".repeat(e))}function MG(t){let e;return t.collectedTrainableWeights!=null?e=xd(t.collectedTrainableWeights):e=xd(t.trainableWeights),e}function FG(t){let e=!0;const n=[],r=[];for(const s in t.nodesByDepth)n.push(t.nodesByDepth[s]);for(const s of n){if(s.length>1||s.length===1&&s[0].inboundLayers.length>1){e=!1;break}r.push(...s)}if(e)for(const s of t.layers){let i=!1;for(const o of s.inboundNodes)if(r.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function $d(t,e,n=console.log){let r="";for(let s=0;s<t.length;++s)s>0&&(r=r.slice(0,r.length-1)+" "),r+=t[s],r=r.slice(0,e[s]),r+=" ".repeat(e[s]-r.length);n(r)}function OG(t,e,n){let r,s;try{s=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{s="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const i=t.name,o=t.getClassName(),a=[`${i} (${o})`,s,r,t.countParams().toString()];$d(a,e,n)}function LG(t,e,n,r){let s,i;try{i=t.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const o=[];for(const h of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(h)===-1))for(let f=0;f<h.inboundLayers.length;++f){const d=h.inboundLayers[f].name,p=h.nodeIndices[f],g=h.tensorIndices[f];o.push(`${d}[${p}][${g}]`)}const a=t.name,l=t.getClassName(),u=o.length===0?"":o[0],c=[`${a} (${l})`,i,s,t.countParams().toString(),u];$d(c,e,r);for(let h=1;h<o.length;++h)$d(["","","","",o[h]],e,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GC(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function Id(t,e){if(t===null)return null;if(typeof t=="string")return la(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],r=t.length;for(let s=0;s<r;++s){const i=t[s];GC(e,s,i)?n.push(i):n.push(Id(i,e))}return n}else{const n={};for(const r of Object.keys(t)){const s=t[r];if(r==="name"&&typeof s=="string")n[r]=s;else{const i=la(r);n[i]=Id(s,i)}}return n}}function ob(t,e){if(t==null)return null;if(typeof t=="string")return Si(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],r=t.length;for(let s=0;s<r;++s){const i=t[s];GC(e,s,i)?n.push(i):n.push(ob(i,e))}return n}else{const n={};for(const r of Object.keys(t)){const s=t[r],i=Si(r);(r==="name"||r==="className")&&typeof s=="string"?n[i]=s:n[i]=ob(s,r)}return n}}/** @license See the LICENSE file. */const HC="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zG=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class ms extends tt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const x=this.getClassName().toLowerCase();this.name=H1(x)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],go(this.inputs).length!==this.inputs.length)throw new q(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(x=>x.name)}`);go(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(x=>x.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const x of this.outputs){const v=x.sourceLayer,y=x.nodeIndex,w=x.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(y),this.outputLayersTensorIndices.push(w)}for(const x of this.inputs){const v=x.sourceLayer,y=x.nodeIndex,w=x.tensorIndex;zs(y===0,"input layer has >1 nodes"),zs(w===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(y),this.inputLayersTensorIndices.push(w)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let x=0;x<this.inputLayers.length;x++){const v=this.inputLayers[x];if(!(v instanceof S0))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${x} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(const x of this.outputLayers)this.outputNames.push(x.name);this.internalInputShapes=this.inputs.map(x=>x.shape),this.internalOutputShapes=this.outputs.map(x=>x.shape);const n={},r={},s={},i={},o={},a=[],l=(x,v,y,w,C,T)=>{(w==null||C==null||T==null)&&(w=x.sourceLayer,C=x.nodeIndex,T=x.tensorIndex);const N=w.inboundNodes[C];if(y.indexOf(N)!==-1)throw new Qr(`The tensor ${x.name} at layer "${w.name}" is part of a cycle.`);if(v.indexOf(N)!==-1)return;this.containerNodes.add(ms.nodeKey(w,C)),w.id in o||(o[w.id]=Object.keys(o).length),y.indexOf(N)===-1&&y.push(N);const $=N.inboundLayers.length;for(let _=0;_<$;_++){const S=N.inputTensors[_],M=N.inboundLayers[_],F=N.nodeIndices[_],A=N.tensorIndices[_];l(S,v,y,M,F,A)}for(v.push(N);y.indexOf(N)>=0;)y.splice(y.indexOf(N),1);a.push(N)},u=[],c=[];for(const x of this.outputs)l(x,u,c);const h=a.slice().reverse();for(const x of h){r[x.id]=x,x.id in n||(n[x.id]=0);let v=n[x.id];const y=s[x.outboundLayer.id]==null?0:s[x.outboundLayer.id];v=Math.max(v,y),s[x.outboundLayer.id]=v,i[x.outboundLayer.id]=x.outboundLayer,n[x.id]=v;for(let w=0;w<x.inboundLayers.length;w++){const C=x.inboundLayers[w],T=x.nodeIndices[w],N=C.inboundNodes[T],$=n[N.id]==null?0:n[N.id];n[N.id]=Math.max(v+1,$),r[N.id]=N}}const f={};for(const x in n){const v=n[x];v in f||(f[v]=[]),f[v].push(r[x])}const d={};for(const x in s){const v=s[x];v in d||(d[v]=[]),d[v].push(i[x])}let p=Object.keys(d).map(x=>parseInt(x,10)).sort(Y0);this.layers=[];for(const x of p){const v=d[x];v.sort((y,w)=>{const C=o[y.id],T=o[w.id];return C<T?-1:C>T?1:0});for(const y of v)y instanceof ms&&this.internalContainerRefs.push(y),this.layers.push(y)}this.layersByDepth=d,p=Object.keys(f).map(x=>parseInt(x,10)).sort(Y0);const g=this.inputs.slice(),m=[];for(const x of p)for(const v of f[x]){const y=v.outboundLayer;if(y!=null){for(const w of v.inputTensors)if(g.indexOf(w)===-1)throw new Qr(`Graph disconnected: cannot obtain value for tensor ${w} at layer "${y.name}". The following previous layers were accessed without issue: ${m}`);for(const w of v.outputTensors)g.push(w);m.push(y.name)}}this.nodesByDepth=f;const b=this.layers.map(x=>x.name);for(const x of b){const v=b.filter(y=>y===x).length;if(v!==1)throw new Qr(`The name "${x}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(b))}this.outboundNodes=[],this.inboundNodes=[],new X1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(x=>null),outputMasks:this.outputs.map(x=>null),inputShapes:this.inputs.map(x=>x.shape),outputShapes:this.outputs.map(x=>x.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(r=>r.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new q("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const r of this.layers)n.push(...r.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const r={};let s=0;const i=zG(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const c=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(r[c]!=null)throw new q(`Duplicate weight name: ${c}`);r[c]=u,s++}const o=[];for(const a in e){let l=a;if(r[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(r[l]!=null)o.push([r[l],e[a]]);else if(n)throw new q(`Provided weight data has no target variable: ${a}`);delete r[l]}if(n){const a=[];for(const l in r)a.push(l);if(a.length>0)throw new q(`${a.length} of ${s} weights are not set: ${a}`)}My(o)}parseWeights(e){for(const n in Object.keys(e)){const r=n.split("/"),s=["vars","layer_checkpoint_dependencies"],i=r.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!s.includes(o)).join("/");i!==n&&(e[i]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${HC}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const r=ob(this.updatedConfig());return n?JSON.stringify(r):r}call(e,n){return Q(()=>{e=pt(e);const r=new lo;for(let s=0;s<this.inputs.length;++s)r.add(this.inputs[s],e[s]);return dc(this.outputs,r,n)})}computeMask(e,n){return Q(()=>{e=pt(e);let r;return n==null?r=Oa(null,e.length):r=pt(n),this.runInternalGraph(e,r)[1]})}computeOutputShape(e){const n=bd(e);if(n.length!==this.inputLayers.length)throw new q(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],u=n[a],c=l.name+"_0_0";r[c]=u}const s=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Y0);if(s.length>1)for(const a of s){const l=this.nodesByDepth[a];for(const u of l){const c=u.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(c.id)!==-1)continue;const h=[];for(let g=0;g<u.inboundLayers.length;g++){const m=u.inboundLayers[g],b=u.nodeIndices[g],x=u.tensorIndices[g],v=`${m.name}_${b}_${x}`,y=r[v];h.push(y)}const f=c.computeOutputShape(Zn(h)),d=bd(f),p=c.inboundNodes.indexOf(u);for(let g=0;g<d.length;g++){const m=`${c.name}_${p}_${g}`;r[m]=d[g]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],h=`${l.name}_${u}_${c}`;o.push(h)}for(let a=0;a<o.length;a++){const l=o[a];zs(l in r),i.push(r[l])}return Zn(i)}runInternalGraph(e,n){n==null&&(n=Oa(null,e.length));const r={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],c=e[l],h=n[l];r[u.id]=[c,h]}const s=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Y0);for(const l of s){const u=this.nodesByDepth[l];for(const c of u){const h=c.outboundLayer,f=c.inputTensors,d=c.outputTensors,p=new Array;for(const g of f)g.id in r&&p.push(r[g.id]);if(p.length===f.length){let g={},m,b,x,v;if(c.callArgs!=null&&(g=c.callArgs),p.length===1){const[y,w]=p[0];g.mask==null&&(g.mask=w),x=pt(h.call(y,g)),v=pt(h.computeMask(y,w)),m=[y],b=[w]}else m=p.map(y=>y[0]),b=p.map(y=>y[1]),g.mask==null&&(g.mask=b),x=pt(h.call(m,g)),v=pt(h.computeMask(m,b));if(h.activityRegularizer)throw new Ke("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let y=0;y<d.length;++y){const w=d[y],C=x[y],T=v[y];r[w.id]=[C,T]}}}}const i=[],o=[],a=[];for(const l of this.outputs){zs(l.id in r,`Could not compute output ${l.name} : ${l.id}`);const[u,c]=r[l.id];a.push(u.shape),i.push(u),o.push(c)}return[i,o,a]}buildNodeConversionMap(e){const n={};let r;for(const s of this.layers){r=s instanceof ms?1:0;for(let i=0;i<s.inboundNodes.length;i++){const o=ms.nodeKey(s,i);this.containerNodes.has(o)&&(n[o]=r,r+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new q("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const r of this.layers)if(r.name===e)return r;throw new q(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new q(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return Q(()=>{const e=[];for(const n of this.layers)for(let r=0;r<n.inboundNodes.length;++r){const s=ms.nodeKey(n,r);this.containerNodes.has(s)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let h=0;h<o.inboundNodes.length;h++){const f=o.inboundNodes[h],d=ms.nodeKey(o,h);let p={};if(this.containerNodes.has(d)){if(f.callArgs)try{JSON.stringify(f.callArgs),p=f.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(f.inboundLayers.length>0){const g=[];for(let m=0;m<f.inboundLayers.length;m++){const b=f.inboundLayers[m],x=f.nodeIndices[m],v=f.tensorIndices[m],y=ms.nodeKey(b,x);let w=n[y];w==null&&(w=0),g.push([b.name,w,v,p])}u.push(g)}}}const c={};c.name=o.name,c.className=a,c.config=l,c.inboundNodes=u,r.push(c)}e.layers=r;const s=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=ms.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const h=this.inputLayersTensorIndices[o];s.push([a.name,c,h])}e.inputLayers=s;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=ms.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const h=this.outputLayersTensorIndices[o];i.push([a.name,c,h])}return e.outputLayers=i,e}static fromConfig(e,n,r={},s=!1){const i={},o={};function a(m,b){m.name in o?o[m.name].push(b):o[m.name]=[b]}function l(m,b){const x=[];let v;for(const y of b){const w=y[0],C=y[1],T=y[2];if(v=y[3]==null?{}:y[3],!(w in i)){a(m,b);return}const N=i[w];if(N.inboundNodes.length<=C){a(m,b);return}const $=N.inboundNodes[C];x.push($.outputTensors[T])}x.length>0&&m.apply(Zn(x),v)}function u(m){const b=m.name,x=Qs(m,n.customObjects!=null?n.customObjects:{});x.setFastWeightInitDuringBuild(s),i[b]=x,m.inboundNodes.forEach(y=>{if(!(y instanceof Array))throw new q(`Corrupted configuration, expected array for nodeData: ${y}`);a(x,y)})}const c=n.name,h=n.layers;for(const m of h)u(m);for(;!kU(o);)for(const m of h){const b=i[m.name];if(b.name in o){const x=o[b.name];delete o[b.name];for(const v of x)l(b,v)}}const f=[],d=[],p=n.inputLayers;for(const m of p){const b=m[0],x=m[1],v=m[2];zs(b in i);const w=i[b].inboundNodes[x].outputTensors;f.push(w[v])}const g=n.outputLayers;for(const m of g){const b=m[0],x=m[1],v=m[2];zs(b in i);const w=i[b].inboundNodes[x].outputTensors;d.push(w[v])}return new e({inputs:f,outputs:d,name:c})}get stateful(){if(this._stateful)throw new q("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Q(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function PG(t,e,n){const r=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>null);if(r===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const s=[];return e.forEach(i=>{i in t?s.push(t[i]):s.push(null)}),s}else throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function qC(t,e){return PG(t,e,"classWeight")}async function XC(t,e,n,r){if(n!=null){const s=Q(()=>{if(t.shape.length===1)return ga(t);if(t.shape.length===2){if(t.shape[1]>1)return Bc(t,1);if(t.shape[1]===1)return J(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await s.data());Ze(s);const o=[];return i.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),Sr(o,"float32")}else return null}function BG(t,e){return H(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const VG=32;function jC(t,e){let n,r;const s=e;n=s.xs,r=s.ys,L(n!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=Qw("input",t.inputNames,n),o=Qw("output",t.outputNames,r),a=i[0].shape[0];L(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),L(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)L(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<o.length;l++)L(o[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:o}}function Qw(t,e,n){if(n instanceof en)return[n];if(Array.isArray(n))return L(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const r=[];for(const s of e){if(n[s]==null)throw new q(`The feature data generated by the dataset lacks the required ${t} key '${s}'.`);r.push(n[s])}return r}}function WG(t){if(t.length===3)throw new Ke("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function UG(t,e,n){const r=n.batchesPerEpoch!=null;if(L(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),L(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),L(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),L(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),L(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const s=n.validationData!=null;let i,o;if(s)if(e5(n.validationData))L(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const m=WG(n.validationData);i=m.xs,o=m.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let u;s?u=l.slice().concat(l.map(m=>"val_"+m)):u=l.slice();const c=LC(n.callbacks,n.yieldEvery),h=n.verbose==null?1:n.verbose,{callbackList:f,history:d}=zC(c,h,n.epochs,null,null,GG(e,n),null,s,u);f.setModel(t),t.history=d,await f.onTrainBegin(),t.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,g=await e.iterator();for(;p<n.epochs;){const m={};await f.onEpochBegin(p);let b=0,x=0;for(r||(g=await e.iterator());!r||b<n.batchesPerEpoch;){const v=await g.next();if(r&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${b} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){const{xs:y,ys:w}=jC(t,v.value),C={};C.batch=x,C.size=y[0].shape[0],await f.onBatchBegin(x,C);const T=[];if(n.classWeight!=null){const _=qC(n.classWeight,t.outputNames);for(let S=0;S<_.length;++S)T.push(await XC(w[S],null,_[S]))}const N=y.concat(w).concat(T),$=a(N);Ze(N);for(let _=0;_<l.length;++_){const S=l[_],M=$[_];C[S]=M,Ks(M)}await f.onBatchEnd(x,C),OC(C),x++,b++}if(r?b>=n.batchesPerEpoch:v.done){if(s){let y;e5(n.validationData)?y=pt(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):y=pt(t.evaluate(i,o,{batchSize:n.validationBatchSize==null?VG:n.validationBatchSize,verbose:0}));for(let w=0;w<t.metricsNames.length;++w)m[`val_${t.metricsNames[w]}`]=y[w]}break}if(t.stopTraining_)break}if(await f.onEpochEnd(p,m),p++,t.stopTraining_)break}return await f.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function GG(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function e5(t){return typeof t.iterator=="function"}function HG(t){return typeof t.next=="function"}async function qG(t,e,n){n=n||{};const r=n.batches!=null,s=t.testFunction;let i=[];if(n.verbose>0)throw new Ke("Verbose mode is not implemented yet.");L(!r||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=HG(e)?e:await e.iterator();let a=0,l=0;for(;!r||l<n.batches;){const u=await o.next();if(i=Q(()=>{if(u.value){const{xs:c,ys:h}=jC(t,u.value),f=c.concat(h),d=Q(()=>s(f));if(Ze(f),l===0)for(let g=0;g<d.length;++g)i.push(He(0));const p=f[0].shape[0];for(let g=0;g<d.length;++g){const m=d[g],b=i[g];i[g]=Q(()=>he(i[g],H(p,m))),l>0&&Ze(b)}Ze(d),a+=p,++l}return i}),u.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const c=i[u];i[u]=Ee(i[u],a),Ze(c)}return Zn(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kg(t){L(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function tc(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(r=>xa(r,e,n-e)):xa(t,e,n-e)}function ab(t,e){return Q(()=>t==null?null:Array.isArray(t)?t.map(n=>ab(n,e)):kC(t,e.dtype==="int32"?e:we(e,"int32")))}function Sg(t,e){const n=[];let r=0,s=null;for(;r<t;)s=r+e,s>=t&&(s=t),n.push([r,s]),r=s;return n}function KC(t){const e=[];t instanceof en&&(t=[t]);for(let n=0;n<t.length;++n){const r=t[n];if(r.rank===1)e.push(v0(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function ps(t,e){if(t==null)return;const n=[];if(e instanceof en)n.push(e.id);else if(Array.isArray(e))e.forEach(s=>n.push(s.id));else if(e!=null)for(const s in e){const i=e[s];n.push(i.id)}const r=[];if(t instanceof en)n.indexOf(t.id)===-1&&r.push(t);else if(Array.isArray(t))t.forEach(s=>{n.indexOf(s.id)===-1&&r.push(s)});else if(t!=null)for(const s in t){const i=t[s];n.indexOf(i.id)===-1&&r.push(i)}r.forEach(s=>{s.isDisposed||s.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XG(t){return t instanceof en}function lb(t){return Array.isArray(t)}function t5(t){return!XG(t)&&!lb(t)}function n5(t,e,n,r=!0,s=""){if(e==null||e.length===0){if(t!=null){let o=!1;if(lb(t)&&t.length>0)o=!0;else if(t5(t)){for(const a in t)if(t.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new q(`Error when checking model ${s} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(o=>null);let i;if(t5(t)){t=t,i=[];for(const o of e){if(t[o]==null)throw new q(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(t[o])}}else if(lb(t)){if(t=t,t.length!==e.length)throw new q(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,e.length>1)throw new q(`The model ${s} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=KC(i),n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new q(`Error when checking ${s}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[o].length;++l){if(l===0&&!r)continue;const u=a.shape[l],c=n[o][l];if(c!=null&&c>=0&&u!==c)throw new q(`${s} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${s} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function jG(t,e,n){const r=go(t.map(i=>i.shape[0]));r.sort();const s=go(e.map(i=>i.shape[0]));if(s.sort(),r.length>1)throw new q(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(s.length>1)throw new q(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(r.length>0&&s.length>0&&!ft(r,s))throw new q(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${s[0]} target sample(s).`)}function KG(t,e,n){const r=[j1,K1,qc];for(let s=0;s<t.length;++s){const i=t[s],o=e[s],a=n[s];if(o!=null){if(o===qc&&i.shape[i.shape.length-1]===1)throw new q(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let c=0;c<l.length;++c){const h=l[c],f=u[c];if(f!=null&&h!==f)throw new q(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function r5(t,e,n,r=!0,s=""){let i;if(Array.isArray(t)){if(t.length!==e.length)throw new q(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(e.length>1)throw new q(`The model expects ${e.length} ${s} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new q(`Error when checking ${s}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[o].length;++l){if(l===0&&!r)continue;const u=a.shape[l],c=n[o][l];if(c!=null&&c!==u)throw new q(`Error when checking ${s}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function YG(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(r=>n);{const r=[];for(const s of e){let i=n.hasOwnProperty(s)?n[s]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}const ZG="layers-model";class Pl extends ms{constructor(e){super(e),this.isTraining=!1}summary(e,n,r=console.log){if(!this.built)throw new q("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");DG(this,e,n,r)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=RG(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Vo))throw new q("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new q(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(wg(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new q(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>wg(a))}else{const o=wg(e.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const r=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ba("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const s=YG(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};ba("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=s[o];(u=>{const c="";let h,f,d;for(const p of u){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const m=this.internalOutputShapes[o];m[m.length-1]===1||this.lossFunctions[o]===K1?["accuracy","acc"].indexOf(p)!==-1?f=BC:["crossentropy","ce"].indexOf(p)!==-1&&(f=kG):this.lossFunctions[o]===kd?["accuracy","acc"].indexOf(p)!==-1?f=SG:["crossentropy","ce"].indexOf(p)!==-1&&(f=UC):["accuracy","acc"].indexOf(p)!==-1?f=VC:["crossentropy","ce"].indexOf(p)!==-1&&(f=WC);let b;["accuracy","acc"].indexOf(p)!==-1?b="acc":["crossentropy","ce"].indexOf(p)!==-1&&(b="ce"),d=f,h=c+b}else d=EG(p),h=c+Q0(p);let g;ba(h,()=>{g=d}),i(o,h,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,r={}){const s=r.batchSize==null?32:r.batchSize;kg(s);const o=this.standardizeUserDataXY(e,n,!0,s);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,s,r.verbose,r.steps);return Zn(u)}finally{ps(o[0],e),ps(o[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),qG(this,e,n)}checkNumSamples(e,n,r,s="steps"){let i;if(r!=null){if(i=null,n!=null)throw new q(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new q(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return i}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new q("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(n),s=r?n:[n],i=this.retrieveSymbolicTensors(s),o=new lo;if(e instanceof en&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new q(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new q(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=dc(i,o);return r?a:a[0]}retrieveSymbolicTensors(e){const n=Oa(null,e.length);let r=e.length;for(const s of this.layers){const i=Array.isArray(s.output)?s.output:[s.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(n[a]=i[l],r--),r===0)break}if(r===0)break}if(r>0){const s=[];throw n.forEach((i,o)=>{i==null&&s.push(e[o])}),new q(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return n}predictLoop(e,n=32,r=!1){return Q(()=>{const s=this.checkNumSamples(e);if(r)throw new Ke("Verbose predictLoop() is not implemented yet.");const i=Sg(s,n),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)Q(()=>{const u=i[a][0],c=i[a][1],h=tc(e,u,c),f=[];if(Array.isArray(h))for(let p=0;p<h.length;++p)f.push({key:this.inputs[p],value:h[p]});else f.push({key:this.inputs[0],value:h});const d=new lo(f);return dc(this.outputs,d)}).forEach((u,c)=>o[c].push(u));return Zn(o.map(a=>Un(a,0)))})}predict(e,n={}){const r=KC(e);r5(r,this.inputNames,this.feedInputShapes,!1);try{const s=n.batchSize==null?32:n.batchSize;return kg(s),this.predictLoop(r,s)}finally{ps(r,e)}}predictOnBatch(e){r5(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,r=!0,s){if(this.optimizer_==null)throw new Qr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===kd?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=n5(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=n5(n,this.feedOutputNames,i,!1,"target"),jG(e,n),KG(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&e[0].shape[0]%s!==0)throw new q(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,r,s,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,n,i,o);if(r!=null)throw new Error("sample weight is not supported yet.");let u=null;if(s!=null){const c=qC(s,this.outputNames);u=[];for(let h=0;h<c.length;++h)u.push(await XC(l[h],null,c[h]))}return[a,l,u]}testLoop(e,n,r,s=0,i){return Q(()=>{const o=this.checkNumSamples(n,r,i,"steps"),a=[];if(s>0)throw new Ke("Verbose mode is not implemented yet.");if(i!=null)throw new Ke("steps mode in testLoop() is not implemented yet");{const l=Sg(o,r),u=Sr(Is(0,o));for(let c=0;c<l.length;++c){const h=l[c][0],f=l[c][1],d=xa(u,h,f-h),p=ab(n,d),g=e(p);if(c===0)for(let m=0;m<g.length;++m)a.push(He(0));for(let m=0;m<g.length;++m){const b=g[m];a[m]=he(a[m],H(f-h,b))}}for(let c=0;c<a.length;++c)a[c]=Ee(a[c],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let r=0;r<e.length;++r){const s=e[r];let i=s;if(Vw(e,s)>1){const o=Vw(e.slice(0,r),s);i+=`_${o}`}n.push(i)}return n}makeTrainFunction(){return e=>{const n=[],r=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const h=[];for(let g=0;g<this.inputs.length;++g)h.push({key:this.inputs[g],value:r[g]});const f=new lo(h),d=dc(this.outputs,f,{training:!0});let p;for(let g=0;g<this.lossFunctions.length;++g){const m=this.lossFunctions[g];let b=m(s[g],d[g]);i[g]!=null&&(b=BG(b,i[g]));const x=Wt(b);n.push(x),g===0?p=b:p=he(p,b)}for(let g=0;g<this.metricsTensors.length;++g){let m;if(this.outputs.length>1&&g<this.outputs.length)m=n[g];else{const b=this.metricsTensors[g][0],x=this.metricsTensors[g][1];m=Wt(b(s[x],d[x]))}Ks(m),o.push(m)}return p=Wt(p),this.calculateLosses().forEach(g=>{p=he(p,g)}),p},l=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>Q(()=>{const n=[];let r;const s=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:s[u]});const a=new lo(o),l=dc(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const c=this.lossFunctions[u],h=Wt(c(i[u],l[u]));u===0?r=h:r=he(r,h),n.push(r)}for(let u=0;u<this.metricsTensors.length;++u){const c=this.metricsTensors[u][0],h=this.metricsTensors[u][1],f=Wt(c(i[h],l[h]));n.push(f)}return n})}async fit(e,n,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let s,i,o,a,l,u,c,h,f;try{const d=r.batchSize==null?32:r.batchSize;kg(d);const g=await this.standardizeUserData(e,n,r.sampleWeight,r.classWeight,!1,d);s=g[0],i=g[1],f=g[2];let m=!1,b;if(r.validationData!=null&&r.validationData.length>0){if(m=!0,r.validationData.length===2)l=r.validationData[0],u=r.validationData[1];else throw r.validationData.length===3?new Ke("validationData including sample weights is not supported yet."):new q(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const _=await this.standardizeUserData(l,u,null,null,!0,d);c=_[0],h=_[1],b=c.concat(h)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){m=!0;const $=Math.floor(s[0].shape[0]*(1-r.validationSplit)),_=s[0].shape[0];c=tc(s,$,_),o=s,s=tc(s,0,$),h=tc(i,$,_),a=i,i=tc(i,0,$),b=c.concat(h)}else r.validationSteps!=null&&(m=!0);const x=s.concat(i).concat(f);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),y=this.getDedupedMetricsNames();let w,C;m?(this.makeTestFunction(),w=this.testFunction,C=y.slice().concat(y.map($=>"val_"+$))):(w=null,b=[],C=y.slice());const T=LC(r.callbacks,r.yieldEvery);return await this.fitLoop(v,x,y,d,r.epochs,r.verbose,T,w,b,r.shuffle,C,r.initialEpoch,null,null)}finally{this.isTraining=!1,ps(s,e),ps(i,n),ps(o,e),ps(a,n),ps(c,l),ps(h,u),f!=null&&Ze(f)}}async fitLoop(e,n,r,s,i,o,a,l,u,c,h,f,d,p){s==null&&(s=32),i==null&&(i=1),c==null&&(c=!0),f==null&&(f=0);let g=!1;if(l!=null&&u!=null&&(g=!0),p!=null&&(g=!0,d==null))throw new q("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const m=this.checkNumSamples(n,s,d,"steps_per_epoch");let b;m!=null&&(b=Is(0,m)),o==null&&(o=1);const{callbackList:x,history:v}=zC(a,o,i,f,m,d,s,g,h);x.setModel(this),this.history=v,await x.onTrainBegin(),this.stopTraining_=!1;for(let y=f;y<i;++y){await x.onEpochBegin(y);const w={};if(d!=null)throw new Ke("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new Ke("batch shuffling is not implemneted yet");c&&YD(b);const C=Sr(b),T=Sg(m,s);for(let N=0;N<T.length;++N){const $={};if(await x.onBatchBegin(N,$),Q(()=>{const _=T[N][0],S=T[N][1],M=xa(C,_,S-_);$.batch=N,$.size=S-_;const F=ab(n,M),A=e(F);for(let E=0;E<r.length;++E){const D=r[E],P=A[E];$[D]=P,Ks(P)}if(N===T.length-1&&g){const E=this.testLoop(l,u,s);for(let D=0;D<r.length;++D){const P=r[D],z=E[D];Ks(z),w["val_"+P]=z}}}),await x.onBatchEnd(N,$),OC($),this.stopTraining_)break}C.dispose()}if(await x.onEpochEnd(y,w),this.stopTraining_)break}return await x.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return UG(this,e,n)}async trainOnBatch(e,n){const r=await this.standardizeUserData(e,n),s=r[0],i=r[1],a=this.makeTrainFunction()(s.concat(i)),l=[];for(const u of a){const c=await u.data();l.push(c[0])}return Ze(a),ps(r[0],e),ps(r[1],n),Zn(l)}getNamedWeights(e){const n=[],r=e!=null&&e.trainableOnly,s=r?this.trainableWeights:this.weights,i=this.getWeights(r);for(let o=0;o<s.length;++o)r&&!s[o].trainable||n.push({name:s[o].originalName,tensor:i[o]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=dw().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-dw().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Si(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Si(n))}else{const n=Object.keys(this.loss);e={};const r=this.loss;for(const s of n)if(typeof r[s]=="string")e[s]=Si(r[s]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Si(Q0(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Si(Q0(e)));{const e={};for(const n in this.metrics)e[n]=Si(Q0(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=Id(e.optimizer_config),r=Qs(n);let s;if(typeof e.loss=="string")s=la(e.loss);else if(Array.isArray(e.loss))s=e.loss.map(o=>la(o));else if(e.loss!=null){s={};for(const o in e.loss)s[o]=la(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>la(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=la(e.metrics[o])}this.compile({loss:s,metrics:i,optimizer:r})}async save(e,n){if(typeof e=="string"){const u=rF(e);if(u.length===0)throw new q(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new q(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new q("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await pw(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:ZG,generatedBy:`TensorFlow.js tfjs-layers v${HC}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:c,specs:h}=await pw(await this.optimizer.getWeights(),u);r.specs.push(...h),r.data=KM([r.data,c])}return this.userDefinedMetadata!=null&&(Jw(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=r.data,a.weightSpecs=r.specs,e.save(a)}setUserDefinedMetadata(e){Jw(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Pl.className="Model";ue(Pl);class YC extends Pl{}YC.className="Functional";ue(YC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function s5(t,e){if(e==null&&(e={}),typeof t=="string"){const n=sF(t,e);if(n.length===0)n.push(iV(t,e));else if(n.length>1)throw new q(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return JG(t,void 0,e)}async function JG(t,e,n){if(n==null&&(n={}),t.load==null)throw new q("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await t.load();let s=r.modelTopology;s.model_config!=null&&(s=s.model_config);const i=n.strict==null?!0:n.strict,o=r.weightData!=null&&r.weightSpecs!=null&&i,a=Qs(Id(s),e,o),l=r.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new q("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:c}=QG(r.weightData,r.weightSpecs);a.loadWeights(u,i),a.optimizer!=null&&c.length>0&&await a.optimizer.setWeights(c),Ze(u),Ze(c.map(h=>h.tensor))}return a}function QG(t,e){const n=UM(t,e),r={},s=[];return e.forEach(i=>{i.group==="optimizer"?s.push({name:i.name,tensor:n[i.name]}):r[i.name]=n[i.name]}),{modelWeights:r,optimizerWeights:s}}class tu extends Pl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:H1("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new q(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof tu||e instanceof Pl;let r;if(n){if(r=e,r.outputs.length!==1)throw new q("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new q("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new q("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const s=QU({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(s)}if(n)this.outputs=r.outputs,this.inputs=r.inputs;else{if(e.inboundNodes.length!==1)throw new q(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new q("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=EC(this.outputs[0])}this.inboundNodes=[],new X1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Oa(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{const s=e.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(lt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Pl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,r=console.log){this.built||this.build(),super.summary(e,n,r)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,r={}){if(!this.built)throw new Qr("The model needs to be compiled before being used.");return this.model.evaluate(e,n,r)}async evaluateDataset(e,n){if(!this.built)throw new Qr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,r={}){if(!this.built)throw new Qr("The model needs to be compiled before being used.");return this.model.fit(e,n,r)}async fitDataset(e,n){if(!this.built)throw new Qr("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,r={},s=!1){let i,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new q("Legacy serialization format not supported yet.");i=n}else L(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=n.layers,delete n.layers,o=n;const a=new e(o);if(!(a instanceof tu))throw new Ke(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const c=Qs(l,void 0,s);s&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(e){if(this.model==null)throw new q("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new q("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const r={};r.className=n.getClassName(),r.config=n.getConfig(),e.push(r)}return{name:this.name,layers:e}}}tu.className="Sequential";ue(tu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eH(t){return new tu(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Dn=class extends Mu{getConfig(){return{}}};class ZC extends Dn{apply(e,n=1){return LU(e,n)}}ZC.className="elu";ue(ZC);class JC extends Dn{apply(e){return fS(e)}}JC.className="selu";ue(JC);class QC extends Dn{apply(e){return qi(e)}}QC.className="relu";ue(QC);class e$ extends Dn{apply(e){return Q(()=>Ql(6,qi(e)))}}e$.className="relu6";ue(e$);let t$=class extends Dn{apply(e){return e}};t$.className="linear";ue(t$);class n$ extends Dn{apply(e){return Eu(e)}}n$.className="sigmoid";ue(n$);class r$ extends Dn{apply(e){return PU(e)}}r$.className="hardSigmoid";ue(r$);class s$ extends Dn{apply(e){return d0(e)}}s$.className="softplus";ue(s$);class i$ extends Dn{apply(e){return zU(e)}}i$.className="softsign";ue(i$);class o$ extends Dn{apply(e){return M1(e)}}o$.className="tanh";ue(o$);let zy=class extends Dn{apply(e,n=-1){return Bx(e,n)}};zy.className="softmax";ue(zy);class a$ extends Dn{apply(e,n=-1){return iS(e,n)}}a$.className="logSoftmax";ue(a$);class l$ extends Dn{apply(e){return Q(()=>Q(()=>{const n=Math.sqrt(2),r=H(.5,he(1,tS(Ee(e,n))));return H(e,r)}))}}l$.className="gelu";ue(l$);class u$ extends Dn{apply(e){return Q(()=>H(.5,H(e,he(1,M1(H(An(Ee(2,Math.PI)),he(e,H(.044715,Ea(e,3)))))))))}}u$.className="gelu_new";ue(u$);class c$ extends Dn{apply(e){return Q(()=>H(e,M1(d0(e))))}}c$.className="mish";ue(c$);class h$ extends Dn{apply(e,n=1){return Q(()=>H(Eu(H(e,n)),e))}}h$.className="swish";ue(h$);function ko(t){return t.getClassName()}function Cg(t,e={}){return y0(t,Yr.getMap().classNameMap,e,"activation")}function So(t){if(t==null){const e={};return e.className="linear",e.config={},Cg(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},Cg(e)}else return t instanceof Dn?t:Cg(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tH(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class f$ extends Mu{}class d$ extends f${constructor(e){super(),tH(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return Q(()=>{let n=tn([1]);return this.hasL1&&(n=he(n,Ne(H(this.l1,dn(e))))),this.hasL2&&(n=he(n,Ne(H(this.l2,w0(e))))),J(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}d$.className="L1L2";ue(d$);const i5={l1l2:"L1L2"};function bt(t){return Cy(t)}function o5(t,e={}){return y0(t,Yr.getMap().classNameMap,e,"regularizer")}function _t(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in i5?i5[t]:t,config:{}};return o5(n)}else return t instanceof f$?t:o5(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class p$ extends tt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=We(e);let r=qi(e);return this.maxValue!=null&&(r=Lr(r,0,this.maxValue)),r}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}p$.className="ReLU";ue(p$);class m$ extends tt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const r=We(e);return Nx(r,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}m$.className="LeakyReLU";ue(m$);class g$ extends tt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=It(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=_t(e.alphaRegularizer),this.alphaConstraint=an(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new q(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=lt(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const s of this.sharedAxes)n[s-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let s=1;s<e.length;++s)r[s]=e[s];this.inputSpec=[new sn({ndim:e.length,axes:r})],this.built=!0}call(e,n){return e=We(e),Ox(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Et(this.alphaInitializer),alphaRegularizer:bt(this.alphaRegularizer),alphaConstraint:on(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}g$.className="PReLU";ue(g$);let b$=class extends tt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ke(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const r=We(e);return L1(r)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};b$.className="ELU";ue(b$);class x$ extends tt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const r=We(e);return H(r,we(Pr(r,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}x$.className="ThresholdedReLU";ue(x$);class y$ extends tt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new zy().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return Q(()=>{let r=We(e);const s=n.mask;if(s!=null){const i=H(Ie(Hi(r.shape),we(s,r.dtype)),He(-1e9));r=he(r,i)}return this.axis instanceof Array?this.axis.length>1?zr(Ie(r,Ax(r,this.axis,!0))):this.softmax(r,this.axis[0]):this.softmax(r,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}y$.className="Softmax";ue(y$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bl(t,e,n){if(typeof t=="number")return Oa(t,e);if(t.length!==e)throw new q(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let r=0;r<e;++r){const s=t[r];if(!DU(s))throw new q(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${s}`)}return t}function Cs(t,e,n,r,s=1){if(t==null)return t;const i=e+(e-1)*(s-1);let o;return n==="same"?o=t:o=t-i+1,Math.floor((o+r-1)/r)}function Ps(t,e,n,r){if(t==null)return null;if(r==="valid")t=t*e+wo([n-e,0]);else if(r==="same")t=t*e;else throw new q(`Unsupport padding mode: ${r}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Py(t,e){return Q(()=>(jt(e),e==="channelsFirst"?st(t,[0,2,3,1]):t))}function v$(t,e){return Q(()=>(jt(e),e==="channelsFirst"?st(t,[0,2,3,4,1]):t))}function nH(t,e,n,r=1,s="valid",i,o=1){return Q(()=>{if(i==null&&(i=Ts()),jt(i),t.shape.length!==3)throw new q(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new q(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new q(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(i==="channelsFirst"&&(t=st(t,[0,2,1])),s==="causal")throw new Ke("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Yk(t,e,r,s==="same"?"same":"valid","NWC",o);return n!=null&&(a=Ds(a,n)),a})}function a5(t,e,n,r=[1,1],s="valid",i,o,a=null){return Q(()=>{if(i==null&&(i=Ts()),jt(i),t.rank!==3&&t.rank!==4)throw new q(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new q(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=Py(t,i);if(s==="causal")throw new Ke("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=OP({x:l,filter:e,strides:r,pad:s==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),i==="channelsFirst"&&(l=st(l,[0,3,1,2])),l})}function rH(t,e,n,r=[1,1,1],s="valid",i,o){return Q(()=>{if(i==null&&(i=Ts()),jt(i),t.rank!==4&&t.rank!==5)throw new q(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new q(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=v$(t,i);if(s==="causal")throw new Ke("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=MO(a,e,r,s==="same"?"same":"valid","NDHWC",o),n!=null&&(a=Ds(a,n)),i==="channelsFirst"&&(a=st(a,[0,4,1,2,3])),a})}class Y1 extends tt{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Y1.verifyArgs(n),this.rank=e,mn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ke(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Bl(n.kernelSize,e,"kernelSize"),this.strides=Bl(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Br(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,jt(this.dataFormat),this.activation=So(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=It(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=an(n.biasConstraint),this.biasRegularizer=_t(n.biasRegularizer),this.activityRegularizer=_t(n.activityRegularizer),this.dilationRate=Bl(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new q(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new q(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new q(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(zs("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!$y(e.kernelSize,"number",1,3))throw new q(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ko(this.activation),useBias:this.useBias,biasInitializer:Et(this.biasInitializer),biasRegularizer:bt(this.biasRegularizer),activityRegularizer:bt(this.activityRegularizer),biasConstraint:on(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Fu extends Y1{constructor(e,n){super(e,n),this.kernel=null,Fu.verifyArgs(n),this.filters=n.filters,mn(this.filters,"filters"),this.kernelInitializer=It(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=an(n.kernelConstraint),this.kernelRegularizer=_t(n.kernelRegularizer)}build(e){e=lt(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new q(`The channel dimension of the input should be defined. Found ${e[n]}`);const r=e[n],s=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:r}}],this.built=!0}call(e,n){return Q(()=>{e=We(e);let r;const s=this.bias==null?null:this.bias.read(),i=gC(this.activation.getClassName());if(i!=null&&this.rank===2)r=a5(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=nH(e,this.kernel.read(),s,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=a5(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=rH(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ke("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(e){e=lt(e);const n=[],r=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<r.length;++i){const o=Cs(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}let s=[e[0]];return this.dataFormat==="channelsLast"?(s=s.concat(n),s.push(this.filters)):(s.push(this.filters),s=s.concat(n)),s}getConfig(){const e={filters:this.filters,kernelInitializer:Et(this.kernelInitializer),kernelRegularizer:bt(this.kernelRegularizer),kernelConstraint:on(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new q(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class $0 extends Fu{constructor(e){super(2,e),$0.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!$y(e.kernelSize,"number",1,2))throw new q(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}$0.className="Conv2D";ue($0);class I0 extends Fu{constructor(e){super(3,e),I0.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new q(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}I0.className="Conv3D";ue(I0);class w$ extends $0{constructor(e){if(super(e),this.inputSpec=[new sn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new q(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=lt(e),e.length!==4)throw new q("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new q("The channel dimension of the inputs should be defined. Found `None`.");const r=e[n],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new sn({ndim:4,axes:{[n]:r}})],this.built=!0}call(e,n){return Q(()=>{let r=We(e);if(r.shape.length!==4)throw new q(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,i=s[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=s[o],u=s[a],c=this.kernelSize[0],h=this.kernelSize[1],f=this.strides[0],d=this.strides[1],p=Ps(l,f,c,this.padding),g=Ps(u,d,h,this.padding),m=[i,p,g,this.filters];this.dataFormat!=="channelsLast"&&(r=st(r,[0,2,3,1]));let b=Zk(r,this.kernel.read(),m,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(b=st(b,[0,3,1,2])),this.bias!=null&&(b=Ds(b,this.bias.read(),this.dataFormat)),this.activation!=null&&(b=this.activation.apply(b)),b})}computeOutputShape(e){e=lt(e);const n=e.slice();let r,s,i;this.dataFormat==="channelsFirst"?(r=1,s=2,i=3):(r=3,s=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return n[r]=this.filters,n[s]=Ps(n[s],l,o,this.padding),n[i]=Ps(n[i],u,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}w$.className="Conv2DTranspose";ue(w$);class k$ extends I0{constructor(e){if(super(e),this.inputSpec=[new sn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new q(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=lt(e),e.length!==5)throw new q("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new q("The channel dimension of the inputs should be defined. Found `None`.");const r=e[n],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new sn({ndim:5,axes:{[n]:r}})],this.built=!0}call(e,n){return Q(()=>{let r=We(e);if(r.shape.length!==5)throw new q(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,i=s[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=s[l],c=s[o],h=s[a],f=this.kernelSize[0],d=this.kernelSize[1],p=this.kernelSize[2],g=this.strides[0],m=this.strides[1],b=this.strides[2],x=Ps(u,g,f,this.padding),v=Ps(c,m,d,this.padding),y=Ps(h,b,p,this.padding),w=[i,x,v,y,this.filters];this.dataFormat!=="channelsLast"&&(r=st(r,[0,2,3,4,1]));let C=LO(r,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=st(C,[0,4,1,2,3])),this.bias!==null&&(C=Ds(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(e){e=lt(e);const n=e.slice();let r,s,i,o;this.dataFormat==="channelsFirst"?(r=1,s=2,i=3,o=4):(r=4,s=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],h=this.strides[1],f=this.strides[2];return n[r]=this.filters,n[s]=Ps(n[s],c,a,this.padding),n[i]=Ps(n[i],h,l,this.padding),n[o]=Ps(n[o],f,u,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}k$.className="Conv3DTranspose";ue(k$);class S$ extends Fu{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new q("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new q("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new q(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=It(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=_t(n.depthwiseRegularizer),this.depthwiseConstraint=an(n.depthwiseConstraint),this.pointwiseInitializer=It(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=_t(n.pointwiseRegularizer),this.pointwiseConstraint=an(n.pointwiseConstraint)}build(e){if(e=lt(e),e.length<this.rank+2)throw new q(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new q(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const r=e[n],s=this.kernelSize.concat([r,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(r*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new sn({ndim:this.rank+2,axes:{[n]:r}})],this.built=!0}call(e,n){return Q(()=>{e=We(e);let r;if(this.rank===1)throw new Ke("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=st(e,[0,2,3,1])),r=dS(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=Ds(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=st(r,[0,3,1,2])),r})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Et(this.depthwiseInitializer),e.pointwiseInitializer=Et(this.pointwiseInitializer),e.depthwiseRegularizer=bt(this.depthwiseRegularizer),e.pointwiseRegularizer=bt(this.pointwiseRegularizer),e.depthwiseConstraint=on(this.depthwiseConstraint),e.pointwiseConstraint=on(this.pointwiseConstraint),e}}S$.className="SeparableConv";class C$ extends S${constructor(e){super(2,e)}}C$.className="SeparableConv2D";ue(C$);class Z1 extends Fu{constructor(e){super(1,e),Z1.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!$y(e.kernelSize,"number",1,1))throw new q(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Z1.className="Conv1D";ue(Z1);class $$ extends tt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return Q(()=>{if(e=We(e),this.dataFormat==="channelsLast"){const r=J0(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return J0(r,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=J0(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return J0(r,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}$$.className="Cropping2D";ue($$);class I$ extends tt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,AU(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],r=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,r]}else{const n=e[1]==null?null:this.size[0]*e[1],r=e[2]==null?null:this.size[1]*e[2];return[e[0],n,r,e[3]]}}call(e,n){return Q(()=>{let r=We(e);const s=r.shape;if(this.dataFormat==="channelsFirst"){r=st(r,[0,2,3,1]);const i=this.size[0]*s[2],o=this.size[1]*s[3],a=this.interpolation==="nearest"?Ti.resizeNearestNeighbor(r,[i,o]):Ti.resizeBilinear(r,[i,o]);return st(a,[0,3,1,2])}else{const i=this.size[0]*s[1],o=this.size[1]*s[2];return this.interpolation==="nearest"?Ti.resizeNearestNeighbor(r,[i,o]):Ti.resizeBilinear(r,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}I$.className="UpSampling2D";ue(I$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sH(t,e,n=[1,1],r="valid",s,i){return Q(()=>{s==null&&(s=Ts()),jt(s);let o=Py(t,s);if(t.rank!==4)throw new q(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new q(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=$x(o,e,n,r==="same"?"same":"valid","NHWC",i),s==="channelsFirst"&&(o=st(o,[0,3,1,2])),o})}class T$ extends Y1{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=It(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=an(e.depthwiseConstraint),this.depthwiseRegularizer=_t(e.depthwiseRegularizer)}build(e){if(e=lt(e),e.length<4)throw new q(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new q(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const r=e[n],s=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Q(()=>{e=We(e);let r=sH(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=Ds(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(e){e=lt(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Cs(n,this.kernelSize[0],this.padding,this.strides[0]),o=Cs(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],s,i,o]:[e[0],i,o,s]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Et(this.depthwiseInitializer),e.depthwiseRegularizer=bt(this.depthwiseRegularizer),e.depthwiseConstraint=on(this.depthwiseRegularizer),e}}T$.className="DepthwiseConv2D";ue(T$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function N$(t,e,n,r){if(Array.isArray(t)){if(e!=null||n!=null)throw new q("When inputs is an array, neither initialState or constants should be provided");r!=null&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function s(i){return i==null||Array.isArray(i)?i:[i]}return e=s(e),n=s(n),{inputs:t,initialState:e,constants:n}}function _$(t,e,n,r=!1,s,i,o=!1,a=!1){return Q(()=>{const l=e.shape.length;if(l<3)throw new q(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(Is(2,l));e=st(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),s!=null&&(s=we(we(s,"bool"),"float32"),s.rank===l-1&&(s=Yn(s,-1)),s=st(s,u)),r&&(e=Ma(e,0),s!=null&&(s=Ma(s,0)));const c=[];let h,f=n;const d=e.shape[0],p=Fa(e);let g;s!=null&&(g=Fa(s));for(let b=0;b<d;++b){const x=p[b],v=Q(()=>t(x,f));if(s==null)h=v[0],f=v[1];else{const y=Q(()=>{const w=g[b],C=Ie(os(w),w),T=he(H(v[0],w),H(f[0],C)),N=f.map(($,_)=>he(H(v[1][_],w),H($,C)));return{output:T,newStates:N}});h=y.output,f=y.newStates}a&&c.push(h)}let m;return a&&(m=ni(c,1)),[h,m,f]})}class Wo extends tt{constructor(e){super(e);let n;if(e.cell==null)throw new q("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new Wy({cells:e.cell}):n=e.cell,n.stateSize==null)throw new q("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new sn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Is(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){rb(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const r=n[0];let s;if(this.returnSequences?s=[e[0],e[1],r]:s=[e[0],r],this.returnState){const i=[];for(const o of n)i.push([e[0],o]);return[s].concat(i)}else return s}computeMask(e,n){return Q(()=>{Array.isArray(n)&&(n=n[0]);const r=this.returnSequences?n:null;if(this.returnState){const s=this.states.map(i=>null);return[r].concat(s)}else return r})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let r=0;r<e;++r)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ke("Constants support is not implemented in RNN yet.");rb(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,r=e.slice(2);this.inputSpec[0]=new sn({shape:[n,null,...r]});const s=[e[0]].concat(e.slice(2));this.cell.build(s);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!ft(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new q(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new sn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){Q(()=>{if(!this.stateful)throw new Ls("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new q("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>tn([r,s])):this.states_=[tn([r,this.cell.stateSize])];else if(e==null)Ze(this.states_),this.keptStates!=null&&(Ze(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>tn([r,s])):this.states_[0]=tn([r,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new q(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):Ze(this.states_);for(let s=0;s<this.states_.length;++s){const i=e[s],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,a=[r,o];if(!ft(i.shape,a))throw new q(`State ${s} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[s]=i}}this.states_=this.states_.map(s=>Ks(s.clone()))})}apply(e,n){let r=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});const i=N$(e,r,s,this.numConstants);e=i.inputs,r=i.initialState,s=i.constants;let o=[],a=[];if(r!=null){n.initialState=r,o=o.concat(r),this.stateSpec=[];for(const u of r)this.stateSpec.push(new sn({shape:u.shape}));a=a.concat(this.stateSpec)}if(s!=null&&(n.constants=s,o=o.concat(s),this.numConstants=s.length),o[0]instanceof ri){const u=[e].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const f=super.apply(u,n);return this.inputSpec=h,f}else return super.apply(e,n)}call(e,n){return Q(()=>{const r=n==null?null:n.mask,s=n==null?null:n.training;let i=n==null?null:n.initialState;e=We(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new q(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:s},u=_$((p,g)=>{const m=this.cell.call([p].concat(g),a);return[m[0],m.slice(1)]},e,i,this.goBackwards,r,null,this.unroll,this.returnSequences),c=u[0],h=u[1],f=u[2];this.stateful&&this.resetStates(f,s);const d=this.returnSequences?h:c;return this.returnState?[d].concat(f):d})}getInitialState(e){return Q(()=>{let n=tn(e.shape);return n=Ne(n,[1,2]),n=v0(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?tb(n,[1,r]):n):this.cell.stateSize>1?[tb(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===Wo.className&&(n.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),n)}static fromConfig(e,n,r={}){const s=n.cell,i=Qs(s,r);return new e(Object.assign(n,{cell:i}))}}Wo.className="RNN";ue(Wo);class J1 extends tt{}class By extends J1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,mn(this.units,"units"),this.activation=So(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=It(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=_t(e.kernelRegularizer),this.recurrentRegularizer=_t(e.recurrentRegularizer),this.biasRegularizer=_t(e.biasRegularizer),this.kernelConstraint=an(e.kernelConstraint),this.recurrentConstraint=an(e.recurrentConstraint),this.biasConstraint=an(e.biasConstraint),this.dropout=eu([1,wo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=eu([1,wo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=lt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Q(()=>{if(e=e,e.length!==2)throw new q(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];const s=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Co({ones:()=>os(e),rate:this.dropout,training:s,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Co({ones:()=>os(r),rate:this.recurrentDropout,training:s,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Js(H(e,o),this.kernel.read()):i=Js(e,this.kernel.read()),this.bias!=null&&(i=Ds(i,this.bias.read())),a!=null&&(r=H(r,a));let l=he(i,Js(r,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:ko(this.activation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:bt(this.kernelRegularizer),recurrentRegularizer:bt(this.recurrentRegularizer),biasRegularizer:bt(this.biasRegularizer),activityRegularizer:bt(this.activityRegularizer),kernelConstraint:on(this.kernelConstraint),recurrentConstraint:on(this.recurrentConstraint),biasConstraint:on(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}By.className="SimpleRNNCell";ue(By);class A$ extends Wo{constructor(e){e.cell=new By(e),super(e)}call(e,n){return Q(()=>{this.cell.dropoutMask!=null&&(Ze(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ze(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,s=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,n){return new e(n)}}A$.className="SimpleRNN";ue(A$);class Vy extends J1{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new q("GRUCell does not support reset_after parameter set to true.");this.units=e.units,mn(this.units,"units"),this.activation=So(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=So(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=It(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=_t(e.kernelRegularizer),this.recurrentRegularizer=_t(e.recurrentRegularizer),this.biasRegularizer=_t(e.biasRegularizer),this.kernelConstraint=an(e.kernelConstraint),this.recurrentConstraint=an(e.recurrentConstraint),this.biasConstraint=an(e.biasConstraint),this.dropout=eu([1,wo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=eu([1,wo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=lt(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Q(()=>{if(e=e,e.length!==2)throw new q(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const r=n.training==null?!1:n.training;let s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Co({ones:()=>os(e),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Co({ones:()=>os(s),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=H(e,i[0]));let c=Js(e,this.kernel.read());this.useBias&&(c=Ds(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=H(s,o[0]));const h=this.recurrentKernel.read(),[f,d]=Or(h,[2*this.units,this.units],h.rank-1),p=Js(s,f),[g,m,b]=Or(c,3,c.rank-1),[x,v]=Or(p,2,p.rank-1);a=this.recurrentActivation.apply(he(g,x)),l=this.recurrentActivation.apply(he(m,v));const y=Js(H(l,s),d);u=this.activation.apply(he(b,y));const w=he(H(a,s),H(he(1,Nt(a)),u));return[w,w]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:ko(this.activation),recurrentActivation:ko(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:bt(this.kernelRegularizer),recurrentRegularizer:bt(this.recurrentRegularizer),biasRegularizer:bt(this.biasRegularizer),activityRegularizer:bt(this.activityRegularizer),kernelConstraint:on(this.kernelConstraint),recurrentConstraint:on(this.recurrentConstraint),biasConstraint:on(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}Vy.className="GRUCell";ue(Vy);class E$ extends Wo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Vy(e),super(e)}call(e,n){return Q(()=>{this.cell.dropoutMask!=null&&(Ze(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ze(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,s=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}E$.className="GRU";ue(E$);class Q1 extends J1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,mn(this.units,"units"),this.activation=So(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=So(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=It(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=_t(e.kernelRegularizer),this.recurrentRegularizer=_t(e.recurrentRegularizer),this.biasRegularizer=_t(e.biasRegularizer),this.kernelConstraint=an(e.kernelConstraint),this.recurrentConstraint=an(e.recurrentConstraint),this.biasConstraint=an(e.biasConstraint),this.dropout=eu([1,wo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=eu([1,wo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=lt(e);const r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;s=new(n=class extends cs{apply(l,u){const c=i.apply([o]),h=new Ty().apply([o]),f=i.apply([o*2]);return Uw(Uw(c,h),f)}},n.className="CustomInit",n)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return Q(()=>{const r=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new q(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Co({ones:()=>os(e),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Co({ones:()=>os(s),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,c,h;0<this.dropout&&this.dropout<1&&(e=H(e,o[0]));let f=Js(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=H(s,a[0])),f=he(f,Js(s,this.recurrentKernel.read())),this.useBias&&(f=Ds(f,this.bias.read()));const[d,p,g,m]=Or(f,4,f.rank-1);l=this.recurrentActivation.apply(d),u=this.recurrentActivation.apply(p),c=he(H(u,i),H(l,this.activation.apply(g))),h=this.recurrentActivation.apply(m);const b=H(h,this.activation.apply(c));return[b,b,c]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:ko(this.activation),recurrentActivation:ko(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:bt(this.kernelRegularizer),recurrentRegularizer:bt(this.recurrentRegularizer),biasRegularizer:bt(this.biasRegularizer),activityRegularizer:bt(this.activityRegularizer),kernelConstraint:on(this.kernelConstraint),recurrentConstraint:on(this.recurrentConstraint),biasConstraint:on(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}Q1.className="LSTMCell";ue(Q1);class R$ extends Wo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Q1(e),super(e)}call(e,n){return Q(()=>{this.cell.dropoutMask!=null&&(Ze(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ze(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,s=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}R$.className="LSTM";ue(R$);class Wy extends J1{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return Q(()=>{e=e;let r=e.slice(1);const s=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?s.push(r.splice(0,a.stateSize.length)):s.push(r.splice(0,1));s.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];r=s[a],a===0?o=[e[0]].concat(r):o=[o[0]].concat(r),o=l.call(o,n),i.push(o.slice(1))}r=[];for(const a of i.slice().reverse())r.push(...a);return[o[0]].concat(r)})}build(e){rb(e)&&(e=e[0]),e=e;let n;this.cells.forEach((r,s)=>{ba(`RNNCell_${s}`,()=>{r.build(e),Array.isArray(r.stateSize)?n=r.stateSize[0]:n=r.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=i=>({className:i.getClassName(),config:i.getConfig()}),s={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),s)}static fromConfig(e,n,r={}){const s=[];for(const i of n.cells)s.push(Qs(i,r));return new e({cells:s})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const r of this.cells)n.push(...r.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return sb(e)}setWeights(e){const n=[];for(const r of this.cells){const s=r.weights.length,i=e.splice(s);for(let o=0;o<r.weights.length;++o)n.push([r.weights[o],i[o]])}My(n)}}Wy.className="StackedRNNCells";ue(Wy);function Co(t){const{ones:e,rate:n,training:r=!1,count:s=1,dropoutFunc:i}=t,o=()=>i!=null?i(e(),n):SC(e(),n),a=()=>k0(o,e,r);return!s||s<=1?Ks(a().clone()):Array(s).fill(void 0).map(a).map(u=>Ks(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var iH=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n};class D$ extends Wo{constructor(e){if(e.unroll)throw new Ke("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ke("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new sn({ndim:5})]}call(e,n){return Q(()=>{if(this.cell.dropoutMask!=null&&(Ze(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ze(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new q("ConvRNN2D cell does not support constants");const r=n==null?null:n.mask,s=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return Q(()=>{const{stateSize:n}=this.cell,r=e.shape,s=this.computeSingleOutputShape(r),i=[s[0],...s.slice(2)],o=tn(i);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(e,n=!1){Q(()=>{if(!this.stateful)throw new Ls("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,s=this.computeSingleOutputShape(r),i=[s[0],...s.slice(2)];if(r[0]==null)throw new q("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>tn(i)):this.states_=[tn(i)];else if(e==null)Ze(this.states_),this.keptStates!=null&&(Ze(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>tn(i)):this.states_[0]=tn(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new q(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):Ze(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!ft(l.shape,u))throw new q(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Ks(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:r,kernelSize:s,padding:i,strides:o,dilationRate:a}=this.cell,l=n==="channelsFirst",u=e[l?3:2],c=e[l?4:3],h=Cs(u,s[0],i,o[0],a[0]),f=Cs(c,s[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[r,h,f]:[h,f,r]]}}D$.className="ConvRNN2D";class Uy extends Q1{constructor(e){const{filters:n,kernelSize:r,strides:s,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,mn(this.filters,"filters"),this.kernelSize=Bl(r,2,"kernelSize"),this.kernelSize.forEach(l=>mn(l,"kernelSize")),this.strides=Bl(s||1,2,"strides"),this.strides.forEach(l=>mn(l,"strides")),this.padding=i||"valid",Br(this.padding),this.dataFormat=o||"channelsLast",jt(this.dataFormat),this.dilationRate=Bl(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>mn(l,"dilationRate"))}build(e){var n;e=lt(e);const r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new q(`The channel dimension of the input should be defined. Found ${e[r]}`);const s=e[r],i=4,o=this.kernelSize.concat([s,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,c=this.filters;l=new(n=class extends cs{apply(f,d){const p=u.apply([c]),g=Hi([c]),m=u.apply([c*2]);return Iy([p,g,m])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return Q(()=>{if(e.length!==3)throw new q(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const r=n.training||!1,s=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Co({ones:()=>os(s),rate:this.dropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(G,j,Z)=>!j||!j[Z]?G:H(j[Z],G);let c=u(s,l,0),h=u(s,l,1),f=u(s,l,2),d=u(s,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Co({ones:()=>os(i),rate:this.recurrentDropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let g=u(i,p,0),m=u(i,p,1),b=u(i,p,2),x=u(i,p,3);const v=3,[y,w,C,T]=Or(this.kernel.read(),a,v),[N,$,_,S]=this.useBias?Or(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,y,N,this.padding),h=this.inputConv(h,w,$,this.padding),f=this.inputConv(f,C,_,this.padding),d=this.inputConv(d,T,S,this.padding);const[M,F,A,E]=Or(this.recurrentKernel.read(),a,v);g=this.recurrentConv(g,M),m=this.recurrentConv(m,F),b=this.recurrentConv(b,A),x=this.recurrentConv(x,E);const D=this.recurrentActivation.apply(he(c,g)),P=this.recurrentActivation.apply(he(h,m)),z=he(H(P,o),H(D,this.activation.apply(he(f,b)))),B=H(this.recurrentActivation.apply(he(d,x)),this.activation.apply(z));return[B,B,z]})}getConfig(){const e=super.getConfig(),{units:n}=e,r=iH(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},r),s)}inputConv(e,n,r,s){const i=Aa(e,n,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?Ds(i,r,this.dataFormat):i}recurrentConv(e,n){return Aa(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Uy.className="ConvLSTM2DCell";ue(Uy);class M$ extends D${constructor(e){const n=new Uy(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}M$.className="ConvLSTM2D";ue(M$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Gy extends tt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,r=[];for(let s=0;s<this.noiseShape.length;++s)r.push(this.noiseShape[s]==null?n[s]:this.noiseShape[s]);return r}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const r=We(e);if(0<this.rate&&this.rate<1){const s=n.training==null?!1:n.training,i=this.getNoiseShape(r);return k0(()=>SC(r,this.rate,i,this.seed),()=>r,s)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}Gy.className="Dropout";ue(Gy);class F$ extends Gy{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}F$.className="SpatialDropout1D";ue(F$);class Hy extends tt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,mn(this.units,"units"),this.activation=So(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=an(e.kernelConstraint),this.biasConstraint=an(e.biasConstraint),this.kernelRegularizer=_t(e.kernelRegularizer),this.biasRegularizer=_t(e.biasRegularizer),this.activityRegularizer=_t(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=lt(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=lt(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const r=We(e),s=gC(this.activation.getClassName());let i;return s!=null?i=Js(r,this.kernel.read(),s,this.bias?this.bias.read():null):(i=Js(r,this.kernel.read()),this.bias!=null&&(i=Ds(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:ko(this.activation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:bt(this.kernelRegularizer),biasRegularizer:bt(this.biasRegularizer),activityRegularizer:bt(this.activityRegularizer),kernelConstraint:on(this.kernelConstraint),biasConstraint:on(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}Hy.className="Dense";ue(Hy);class O$ extends tt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=lt(e);for(const n of e.slice(1))if(n==null)throw new q(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],bo(e,1)]}call(e,n){return Q(()=>{this.invokeCallHook(e,n);let r=We(e);if(this.dataFormat==="channelsFirst"&&r.rank>1){const s=[0];for(let i=2;i<r.rank;++i)s.push(i);s.push(1),r=st(r,s)}return OU(r)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}O$.className="Flatten";ue(O$);class L$ extends tt{constructor(e){super(e),this.supportsMasking=!0,this.activation=So(e.activation)}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const r=We(e);return this.activation.apply(r)})}getConfig(){const e={activation:ko(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}L$.className="Activation";ue(L$);class z$ extends tt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return Q(()=>(e=We(e),MU(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}z$.className="RepeatVector";ue(z$);class P$ extends tt{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const r="Total size of new array must be unchanged.",s=n.slice();let i=1,o=null;for(let l=0;l<s.length;++l){const u=s[l];if(this.isUnknown(u))if(o===null)o=l;else throw new q("Can only specifiy one unknown dimension.");else i*=u}const a=bo(e);if(o!==null){if(i===0||a%i!==0)throw new q(r);s[o]=a/i}else if(a!==i)throw new q(r);return s}computeOutputShape(e){let n=!1;for(let r=0;r<e.length;++r)if(this.isUnknown(e[r])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const r=We(e),s=r.shape,i=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return J(r,i)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}P$.className="Reshape";ue(P$);class B$ extends tt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Is(1,e.dims.length+1);if(!ft(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new sn({ndim:this.dims.length+1})]}computeOutputShape(e){e=lt(e);const n=e.slice();return this.dims.forEach((r,s)=>{n[s+1]=e[r]}),n}call(e,n){return st(We(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}B$.className="Permute";ue(B$);class V$ extends tt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const r=We(e);return X2(Uc(r,this.maskValue),-1)}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const r=We(e),o=X2(Uc(r,this.maskValue),-1,!0);return H(r,we(o,r.dtype))})}}V$.className="Masking";ue(V$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class W$ extends tt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(pt(e.inputLength))}this.inputDim=e.inputDim,mn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,mn(this.outputDim,"outputDim"),this.embeddingsInitializer=It(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=_t(e.embeddingsRegularizer),this.activityRegularizer=_t(e.activityRegularizer),this.embeddingsConstraint=an(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return Q(()=>this.maskZero?(e=We(e),Uc(e,it(e))):null)}computeOutputShape(e){if(e=lt(e),this.inputLength==null)return[...e,this.outputDim];const n=pt(this.inputLength);if(n.length!==e.length-1)throw new q(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let r=0;for(let s=0;s<n.length;++s){const i=n[s],o=e[s+1];if(i!=null&&o!=null&&i!==o)throw new q(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(n[r]=o),r++}}return[e[0],...n,this.outputDim]}call(e,n){return Q(()=>{this.invokeCallHook(e,n);let r=We(e);r.dtype!=="int32"&&(r=Zs(r,"int32"));const s=kC(this.embeddings.read(),J(r,[r.size]));return J(s,lt(this.computeOutputShape(r.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Et(this.embeddingsInitializer),embeddingsRegularizer:bt(this.embeddingsRegularizer),activityRegularizer:bt(this.activityRegularizer),embeddingsConstraint:on(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}W$.className="Embedding";ue(W$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class il extends tt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ke}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const r=e.slice(0,e.length-n.length);for(let s=0;s<n.length;++s){const i=e[e.length-n.length+s],o=n[s];if(i==null||o==null||i<0||o<0)r.push(null);else if(i===1)r.push(o);else if(o===1)r.push(i);else{if(i!==o)throw new q("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));r.push(i)}}return r}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[lt(e)]),e=e,e.length<2)throw new q(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const i of e)i!=null&&i[0]!==null&&n.push(i[0]);if(n=go(n),n.length>1)throw new q(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let r=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}const s=e.map(i=>i.length);e.indexOf(null)===-1&&go(s).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return Q(()=>{if(e=e,this.reshapeRequired){const r=[],s=e.map(i=>i.rank);if(s.indexOf(null)===-1){const i=wo(s);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=v0(o,1);r.push(o)}return this.mergeFunction(r)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const c=l.shape,h=c[0],f=c.slice(1).concat([h]);let d=J(l,[h].concat(bo(c.slice(1))));d=st(d,[1,0]),d=J(d,f),r.push(d),i=!0}else if(u>1){const c=Is(1,u).concat([0]);r.push(st(l,c)),i=!0}else r.push(l)}let o=this.mergeFunction(r);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,c=l[u-1],h=[c].concat(l.slice(0,l.length-1));o=J(st(J(o,[-1,c]),[1,0]),h)}else if(a>1){const l=[a-1].concat(Is(0,a-1));o=st(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let s=1;s<e.length;++s){const i=e[s]==null?null:e[s].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}let r=[];for(const s of e)s!=null&&s[0]!==null&&r.push(s[0]);return r=go(r),r.length===1?n=r.concat(n):n=[null].concat(n),n}computeMask(e,n){return Q(()=>{if(n==null)return null;if(!Array.isArray(n))throw new q("`mask` should be an Array");if(!Array.isArray(e))throw new q("`inputs` should be an Array");if(n.length!==e.length)throw new q(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(s=>s==null))return null;n=n.map(s=>s==null?s:Yn(s,0));let r=n[0];for(let s=1;s<n.length-1;++s)r=Fi(r,n[s]);return r})}}class U$ extends il{constructor(e){super(e)}mergeFunction(e){return Q(()=>{let n=e[0].clone();for(let r=1;r<e.length;++r)n=he(n,e[r]);return n})}}U$.className="Add";ue(U$);class G$ extends il{constructor(e){super(e)}mergeFunction(e){return Q(()=>{let n=e[0].clone();for(let r=1;r<e.length;++r)n=H(n,e[r]);return n})}}G$.className="Multiply";ue(G$);class H$ extends il{constructor(e){super(e)}mergeFunction(e){return Q(()=>{let n=e[0].clone();for(let r=1;r<e.length;++r)n=he(n,e[r]);return H(1/e.length,n)})}}H$.className="Average";ue(H$);class q$ extends il{constructor(e){super(e)}mergeFunction(e){return Q(()=>{let n=e[0];for(let r=1;r<e.length;++r)n=Bo(n,e[r]);return n})}}q$.className="Maximum";ue(q$);class X$ extends il{constructor(e){super(e)}mergeFunction(e){return Q(()=>{let n=e[0];for(let r=1;r<e.length;++r)n=Ql(n,e[r]);return n})}}X$.className="Minimum";ue(X$);class j$ extends il{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new q("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const s of e)if(s!=null){n=!1;break}if(n)return;const r=[];for(let s=0;s<e.length;++s){const i=e[s].slice();i.splice(this.axis,1);let o=!1;for(const a of r)if(ft(a,i)){o=!0;break}o||r.push(i)}if(r.length>1)throw new q("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Q(()=>Iy(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new q("A `Concatenate` layer should be called on a list of inputs.");const n=e,r=n[0].slice(),s=this.axis<0?r.length+this.axis:this.axis;for(const i of n.slice(1)){if(r[s]==null||i[s]==null){r[s]=null;break}r[s]+=i[s]}return r}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new q("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new q("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new q(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return Q(()=>{let r=!0;if(n.forEach(o=>{if(o!=null){r=!1;return}}),r)return null;const s=[];for(let o=0;o<e.length;++o)n[o]==null?s.push(we(os(e[o]),"bool")):n[o].rank<e[o].rank?s.push(Yn(n[o],-1)):s.push(n[o]);const i=Un(s,this.axis);return Kk(i,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}j$.className="Concatenate";ue(j$);function nc(t,e){for(;t<0;)t+=e;return t}function oH(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Ke("batchDot is not implemented for tensors of 4D or higher rank yet");if(L(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),L(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new Ke("batchDot is not implemented for complex64-type Tensors yet.");const r=t.shape.length,s=e.shape.length;n==null&&(n=[r-1,s-2]);const i=n;return Q(()=>{let o;if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);e=J(e,e.shape.concat(l))}else if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);t=J(t,t.shape.concat(l))}else o=0;let a;if(t.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Ne(H(t,e),i[0]):a=Ne(H(st(t,[1,0]),e),i[1]);else{const l=i[0]!==t.shape.length-1,u=i[1]===e.shape.length-1;a=ht(t,e,l,u)}if(o>0){let l;r>s?l=r+s-3:l=r-1;const u=[];for(let c=l;c<l+o;++c)u.push(c);a=p0(a,u)}return a.shape.length===1&&(a=Yn(a,1)),a})}class K$ extends il{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){L(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],r=e[1];if(n.length>3||r.length>3)throw new Ke("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(n,r);if(n[s[0]]!==r[s[1]])throw new q(`Dimension incompatibility: ${n[s[0]]} !== ${r[s[1]]}`)}mergeFunction(e){if(e.length!==2)throw new q(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],r=e[1],s;return Array.isArray(this.axes)?s=this.axes.map((i,o)=>nc(i,e[o].shape.length)):s=[nc(this.axes,n.shape.length),nc(this.axes,r.shape.length)],this.normalize&&(n=wd(n,s[0]),r=wd(r,s[1])),oH(n,r,s)}interpretAxes(e,n){let r;return Array.isArray(this.axes)?r=this.axes:r=[nc(this.axes,e.length),nc(this.axes,n.length)],r}computeOutputShape(e){L(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),r=e[1].slice();if(n.length>3||r.length>3)throw new Ke("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(n,r);n.splice(s[0],1),r.splice(s[1],1),r.splice(0,1);const i=n.concat(r);return i.length===1&&i.push(1),i}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}K$.className="Dot";ue(K$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Y$ extends tt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const r=We(e);return k0(()=>he(q1(r.shape,0,this.stddev),r),()=>r,n.training||!1)})}}Y$.className="GaussianNoise";ue(Y$);class Z$ extends tt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return Q(()=>{this.invokeCallHook(e,n);const r=We(e);return this.rate>0&&this.rate<1?k0(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return H(r,q1(r.shape,1,i))},()=>r,n.training||!1):r})}}Z$.className="GaussianDropout";ue(Z$);class J$ extends tt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||We(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return Q(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(e);return k0(()=>{const i=We(e),a=-1.6732632423543772*1.0507009873554805;let l=nl(Da(r),this.rate);l=Zs(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,c=-u*a*this.rate,h=he(H(i,l),H(he(l,-1),a));return he(H(h,u),c)},()=>We(e),n.training||!1)}return e})}}J$.className="AlphaDropout";ue(J$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xc(t,e,n,r,s,i=.001){let o;if(t.rank===2)o=cO(t,e,n,r,s,i);else if(t.rank===3)o=fO(t,e,n,r,s,i);else if(t.rank===4)o=pO(t,e,n,r,s,i);else throw new Ke(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return o}function aH(t,e,n,r,s=.001){return Q(()=>{const i=Dx(t,r),o=i.mean,a=i.variance;return[Xc(t,o,a,n,e,s),o,a]})}function lH(t,e,n,r,s=.001){return Q(()=>{const i=Dx(t,r),o=i.mean,a=i.variance,l=[];for(const p of Is(0,t.rank))r.indexOf(p)!==-1?l.push(1):l.push(t.shape[p]);const u=J(o,l),c=J(a,l),h=e==null?null:J(e,l),f=n==null?null:J(n,l);return[Xc(t,u,c,f,h,s),o,a]})}function uH(t,e,n,r,s=.001){return ft(r.slice().sort(),Is(0,t.rank-1))?aH(t,e,n,r,s):lH(t,e,n,r,s)}class Q$ extends tt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=It(e.betaInitializer||"zeros"),this.gammaInitializer=It(e.gammaInitializer||"ones"),this.movingMeanInitializer=It(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=It(e.movingVarianceInitializer||"ones"),this.betaConstraint=an(e.betaConstraint),this.gammaConstraint=an(e.gammaConstraint),this.betaRegularizer=_t(e.betaRegularizer),this.gammaRegularizer=_t(e.gammaRegularizer)}build(e){e=lt(e);const n=this.axis>=0?this.axis:this.axis+e.length,r=e[n];if(r==null)throw new q(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new sn({ndim:e.length,axes:{[n]:r}})];const s=[r];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return Q(()=>{const r=n.training==null?!1:n.training,s=We(e),i=s.shape,o=i.length,a=Is(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=Oa(1,o);u[l]=i[l];const c=a.slice();c.sort();const h=!ft(c,Is(0,o).slice(0,o-1)),f=()=>{if(h){const x=J(this.movingMean.read(),u),v=J(this.movingVariance.read(),u),y=this.center?J(this.beta.read(),u):null,w=this.scale?J(this.gamma.read(),u):null;return Xc(s,x,v,y,w,this.epsilon)}else return Xc(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return f();const[d,p,g]=uH(s,this.gamma.read(),this.beta.read(),a,this.epsilon),m=(x,v,y)=>{Q(()=>{const w=1-y,C=x.read(),T=H(Ie(C,v),w);x.write(Ie(C,T))})};return(()=>{m(this.movingMean,p,this.momentum),m(this.movingVariance,g,this.momentum)})(),d})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Et(this.betaInitializer),gammaInitializer:Et(this.gammaInitializer),movingMeanInitializer:Et(this.movingMeanInitializer),movingVarianceInitializer:Et(this.movingVarianceInitializer),betaRegularizer:bt(this.betaRegularizer),gammaRegularizer:bt(this.gammaRegularizer),betaConstraint:on(this.betaConstraint),gammaConstraint:on(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}Q$.className="BatchNormalization";ue(Q$);class eI extends tt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=It(e.betaInitializer||"zeros"),this.gammaInitializer=It(e.gammaInitializer||"ones"),this.betaRegularizer=_t(e.betaRegularizer),this.gammaRegularizer=_t(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=lt(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=n);for(const i of this.axis)if(i<0||i>=n)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==go(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(i=>e[i]),s=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(e,n){const r=We(e),s=r.shape,i=s.length;return Q(()=>{let{mean:a,variance:l}=Dx(r,this.axis,!0);const u=Oa(1,i);for(const g of this.axis)u[g]=s[g];const c=g=>g!=null&&g.shape.length!==i?J(g,u):g;let h=this.scale?c(this.gamma.read()):null,f=this.center?c(this.beta.read()):null;const d=[],p=[];for(let g=0;g<i;++g)this.axis.indexOf(g)!==-1?(d.push(s[g]),p.push(1)):(d.push(1),p.push(s[g]));return a=Dr(a,d),l=Dr(l,d),h!=null&&(h=Dr(h,p)),f!=null&&(f=Dr(f,p)),Xc(r,a,l,f,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Et(this.betaInitializer),gammaInitializer:Et(this.gammaInitializer),betaRegularizer:bt(this.betaRegularizer),gammaRegularizer:bt(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}eI.className="LayerNormalization";ue(eI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cH(t,e,n){return Q(()=>{if(t.rank!==4)throw new q(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new q("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Ts()),n!=="channelsLast"&&n!=="channelsFirst")throw new q(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return n==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],Mx(t,r)})}class tI extends tt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Ts():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new q(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,r;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new q(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new q(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);r=e.padding[1]}this.padding=[n,r]}this.inputSpec=[new sn({ndim:4})]}computeOutputShape(e){e=lt(e);let n,r;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?r=e[3]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],e[1],n,r]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?r=e[2]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],n,r,e[3]])}call(e,n){return Q(()=>cH(We(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}tI.className="ZeroPadding2D";ue(tI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function em(t,e,n,r,s,i){return Q(()=>{jt(s),xC(i),Br(r),n==null&&(n=[1,1]),r==null&&(r="valid"),s==null&&(s=Ts()),i==null&&(i="max"),t=Py(t,s);let o;const a=r==="same"?"same":"valid";return i==="max"?o=Rx(t,e,n,a):o=wx(t,e,n,a),s==="channelsFirst"&&(o=st(o,[0,3,1,2])),o})}function nI(t,e,n,r,s,i){return Q(()=>{jt(s),xC(i),Br(r),n==null&&(n=[1,1,1]),r==null&&(r="valid"),s==null&&(s=Ts()),i==null&&(i="max"),t=v$(t,s);let o;const a=r==="same"?"same":"valid";return i==="max"?o=QL(t,e,n,a):o=eO(t,e,n,a),s==="channelsFirst"&&(o=st(o,[0,4,1,2,3])),o})}class rI extends tt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new q(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(mn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new q(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);mn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Br(this.padding),this.inputSpec=[new sn({ndim:3})]}computeOutputShape(e){e=lt(e);const n=Cs(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return Q(()=>{this.invokeCallHook(e,n),e=v0(We(e),2);const r=this.poolingFunction(We(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return p0(r,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class sI extends rI{constructor(e){super(e)}poolingFunction(e,n,r,s,i){return jt(i),Br(s),em(e,n,r,s,i,"max")}}sI.className="MaxPooling1D";ue(sI);class iI extends rI{constructor(e){super(e)}poolingFunction(e,n,r,s,i){return jt(i),Br(s),em(e,n,r,s,i,"avg")}}iI.className="AveragePooling1D";ue(iI);class oI extends tt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new q(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];mn(this.poolSize,"poolSize"),mn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jt(this.dataFormat),Br(this.padding),this.inputSpec=[new sn({ndim:4})]}computeOutputShape(e){e=lt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=Cs(n,this.poolSize[0],this.padding,this.strides[0]),r=Cs(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,r]:[e[0],n,r,e[3]]}call(e,n){return Q(()=>(this.invokeCallHook(e,n),this.poolingFunction(We(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class aI extends oI{constructor(e){super(e)}poolingFunction(e,n,r,s,i){return jt(i),Br(s),em(e,n,r,s,i,"max")}}aI.className="MaxPooling2D";ue(aI);class lI extends oI{constructor(e){super(e)}poolingFunction(e,n,r,s,i){return jt(i),Br(s),em(e,n,r,s,i,"avg")}}lI.className="AveragePooling2D";ue(lI);class uI extends tt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new q(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];mn(this.poolSize,"poolSize"),mn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jt(this.dataFormat),Br(this.padding),this.inputSpec=[new sn({ndim:5})]}computeOutputShape(e){e=lt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=Cs(n,this.poolSize[0],this.padding,this.strides[0]),r=Cs(r,this.poolSize[1],this.padding,this.strides[1]),s=Cs(s,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,r,s]:[e[0],n,r,s,e[4]]}call(e,n){return Q(()=>(this.invokeCallHook(e,n),this.poolingFunction(We(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class cI extends uI{constructor(e){super(e)}poolingFunction(e,n,r,s,i){return jt(i),Br(s),nI(e,n,r,s,i,"max")}}cI.className="MaxPooling3D";ue(cI);class hI extends uI{constructor(e){super(e)}poolingFunction(e,n,r,s,i){return jt(i),Br(s),nI(e,n,r,s,i,"avg")}}hI.className="AveragePooling3D";ue(hI);class fI extends tt{constructor(e){super(e),this.inputSpec=[new sn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new Ke}}class dI extends fI{constructor(e){super(e||{})}call(e,n){return Q(()=>{const r=We(e);return Wt(r,1)})}}dI.className="GlobalAveragePooling1D";ue(dI);class pI extends fI{constructor(e){super(e||{})}call(e,n){return Q(()=>{const r=We(e);return Ss(r,1)})}}pI.className="GlobalMaxPooling1D";ue(pI);class mI extends tt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,jt(this.dataFormat),this.inputSpec=[new sn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new Ke}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class gI extends mI{call(e,n){return Q(()=>{const r=We(e);return this.dataFormat==="channelsLast"?Wt(r,[1,2]):Wt(r,[2,3])})}}gI.className="GlobalAveragePooling2D";ue(gI);class bI extends mI{call(e,n){return Q(()=>{const r=We(e);return this.dataFormat==="channelsLast"?Ss(r,[1,2]):Ss(r,[2,3])})}}bI.className="GlobalMaxPooling2D";ue(bI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class xI extends tt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,r={}){const s=n.layer,i=Qs(s,r);delete n.layer;const o={layer:i};return Object.assign(o,n),new e(o)}}class yI extends xI{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=lt(e),e.length<3)throw new q(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=lt(e);const n=[e[0]].concat(e.slice(2)),r=this.layer.computeOutputShape(n),s=e[1];return[r[0],s].concat(r.slice(1))}call(e,n){return Q(()=>(e=We(e),_$((o,a)=>[We(this.layer.call(o,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}yI.className="TimeDistributed";ue(yI);function hH(t){sl(_U,"BidirectionalMergeMode",t)}const fH="concat";class vI extends xI{constructor(e){super(e);const n=e.layer.getConfig(),r={};r.className=e.layer.getClassName(),r.config=n,this.forwardLayer=Qs(r),n.goBackwards=n.goBackwards!==!0;const s={};if(s.className=e.layer.getClassName(),s.config=n,this.backwardLayer=Qs(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?fH:e.mergeMode,hH(this.mergeMode),e.weights)throw new Ke("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,r=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,r)),this.backwardLayer.setWeights(e.slice(r))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let r,s,i;return this.returnState&&(i=n.slice(1)),r=n[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,s=[r]):this.mergeMode==null?s=[r,r.slice()]:s=[r],this.returnState?this.mergeMode==null?s.concat(i).concat(i.slice()):[r].concat(i).concat(i.slice()):Zn(s)}apply(e,n){let r=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});const i=N$(e,r,s,this.numConstants);if(e=i.inputs,r=i.initialState,s=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(r==null||r.length===0)&&s==null)return super.apply(e,n);const o=[],a=[];if(r!=null){const u=r.length;if(u%2>0)throw new q("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,o.push(...r);const c=r.map(h=>new sn({shape:h.shape}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),a.push(...c)}if(s!=null)throw new Ke("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof ri;for(const u of o)if(u instanceof ri!==l)throw new q("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),c=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=c;const f=super.apply(u,n);return this.inputSpec=h,f}else return super.apply(e,n)}call(e,n){return Q(()=>{const r=n.initialState;let s,i;if(r==null)s=this.forwardLayer.call(e,n),i=this.backwardLayer.call(e,n);else{const l=r.slice(0,r.length/2),u=r.slice(r.length/2);s=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(n,{initialState:u}))}let o;this.returnState&&(Array.isArray(s)&&(o=s.slice(1).concat(i.slice(1))),s=s[0],i=i[0]),this.returnSequences&&(i=Ma(i,1));let a;return this.mergeMode==="concat"?a=Iy([s,i]):this.mergeMode==="sum"?a=he(s,i):this.mergeMode==="ave"?a=H(.5,he(s,i)):this.mergeMode==="mul"?a=H(s,i):this.mergeMode==null&&(a=[s,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ba(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ba(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[n,n]:r=n:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(r)?r.concat(i).concat(i):[r].concat(i).concat(i)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const r=Qs(n.layer);if(delete n.layer,n.numConstants!=null)throw new Ke("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const s=n;return s.layer=r,new e(s)}}vI.className="Bidirectional";ue(vI);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wI extends tt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return Q(()=>(e=We(e),e.dtype!=="float32"&&(e=Zs(e,"float32")),he(H(e,this.scale),this.offset)))}}wI.className="Rescaling";ue(wI);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:dH,cropAndResize:pH}=Ti;class kI extends tt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,r,s,i,o,a,l){return Q(()=>{let u,c=!1;const h=n/o,f=r/a,d=(s+n)/o,p=(i+r)/a,g=[h,f,d,p],m=[];e.rank===3?(c=!0,u=ni([e])):u=e;for(let w=0;w<u.shape[0];w++)m.push(g);const b=js(m,[m.length,4]),x=Gc(0,m.length,1,"int32"),y=pH(u,b,x,[s,i],"nearest");return Zs(c?We(Fa(y)):y,l)})}upsize(e,n,r,s){return Q(()=>{const i=dH(e,[n,r]);return Zs(i,s)})}call(e,n){return Q(()=>{const r=We(e),s=r.dtype,i=r.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(r,l,u,this.height,this.width,o,a,s):this.upsize(e,this.height,this.width,s)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=lt(e);const n=e.length-3,r=e.length-2;return e[n]=this.height,e[r]=this.width,e}}kI.className="CenterCrop";ue(kI);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mH(t,e,n,r){let s=We(t);if(s.dtype!=="int32"&&(s=Zs(s,"int32")),e==="int")return s;const i=s.shape;if(s.rank===0&&(s=Yn(s,-1)),e==="oneHot"&&s.shape[s.shape.length-1]!==1&&(s=Yn(s,-1)),s.rank>2)throw new q(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${s.rank}.`);const o=["multiHot","oneHot"].includes(e),a=s;let l;if(typeof r<"u"&&e==="count"?l=xw(a,r,n,o):l=xw(a,[],n,o),e!=="tfIdf")return l;if(r)return H(l,r);throw new q("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class SI extends tt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=lt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return Q(()=>{e=We(e),e.dtype!=="int32"&&(e=Zs(e,"int32"));let r;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new q(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);r=We(n.countWeights)}const s=Ss(e),i=dd(e),o=Pr(this.numTokens,s).bufferSync().get(0),a=nl(i,0).bufferSync().get(0);if(!(o&&a))throw new q(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return mH(e,this.outputMode,this.numTokens,r)})}}SI.className="CategoryEncoding";ue(SI);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const gH=["bilinear","nearest"],l5=new Set(gH);class CI extends tt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(l5.has(e.interpolation))this.interpolation=e.interpolation;else throw new q(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=lt(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return Q(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return Ti.resizeBilinear(e,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Ti.resizeNearestNeighbor(e,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...l5]} are supported`)})}}CI.className="Resizing";ue(CI);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $I{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}$I.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class II extends tt{constructor(e){super(e),this.randomGenerator=new $I(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}II.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const bH=["bilinear","nearest"],u5=new Set(bH);class TI extends II{constructor(e){super(e);const{factor:n,interpolation:r="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new q(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new q(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new q(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(u5.has(r))this.interpolation=r;else throw new q(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=lt(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return Q(()=>{const r=We(e);this.imgHeight=r.shape[r.shape.length-3];const s=r.shape[r.shape.length-2];this.widthFactor=Da([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*s;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Ti.resizeBilinear(e,o);case"nearest":return Ti.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...u5]} are supported`)}})}}TI.className="RandomWidth";ue(TI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ef(t){return new Hy(t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xH=ee();xH.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var c5;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(c5||(c5={}));var h5;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(h5||(h5={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var f5;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(f5||(f5={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Te(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&L(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yH=kS;class tm extends C4{nextDataId(){return tm.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Y8(this,Fs())}write(e,n,r){this.firstUse&&(this.firstUse=!1,ee().get("IS_NODE")&&Rr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const s={id:this.nextDataId()};return this.data.set(s,{values:e,dtype:r,refCount:1}),s}makeTensorInfo(e,n,r){let s;if(n==="string"&&r!=null&&r.length>0&&gh(r[0])){const i=r.map(o=>mo(o));s=this.write(i,e,n)}else s=this.write(r,e,n);return{dataId:s,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,r,s,i){this.data.set(e,{values:n,dtype:s,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:r}=this.data.get(e);if(n==="complex64"){const s=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return Oi(s,i)}return nM(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const r=n.map(s=>vo(s));return Qe(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Qe(e.shape,e.dtype,n)}makeOutput(e,n,r){return Fs().makeTensorFromTensorInfo(this.makeTensorInfo(n,r,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(e);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=Kn();return e(),{kernelMs:Kn()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Te([e],"where");const n=this.readSync(e.dataId);return yH(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}tm.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NI(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const vH=t=>{const{x:e}=t.inputs,n=t.backend;Te(e,"abs");let r=new Float32Array(se(e.shape));const s=n.data.get(e.dataId).values;return r=NI(s),n.makeOutput(r,e.shape,e.dtype)},wH={kernelName:Ep,backendName:"cpu",kernelFunc:vH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kt(t){return(e,n,r,s,i)=>{const o=Xe(e,n),a=o.length,l=Re(o),u=se(o),c=Nn(i,u),h=e.length,f=n.length,d=Re(e),p=Re(n),g=Jl(e,o),m=Jl(n,o);if(g.length+m.length===0)for(let b=0;b<c.length;++b)c[b]=t(r[b%r.length],s[b%s.length]);else for(let b=0;b<c.length;++b){const x=_u(b,a,l),v=x.slice(-h);g.forEach(T=>v[T]=0);const y=Xs(v,h,d),w=x.slice(-f);m.forEach(T=>w[T]=0);const C=Xs(w,f,p);c[b]=t(r[y],s[C])}return[c,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kr(t){const{inputs:e,backend:n}=t,{real:r,imag:s}=e,i=n.data.get(r.dataId).values,o=n.data.get(s.dataId).values,a=n.makeTensorInfo(r.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(s.shape,"float32",o)},a}const kH={kernelName:O4,backendName:"cpu",kernelFunc:kr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Td(t,e,n="float32"){if(n==="complex64"){const s=Td(t,e,"float32"),i=Td(t,e,"float32");return kr({inputs:{real:s,imag:i},backend:t})}const r=_n(se(e),n);return t.makeTensorInfo(e,n,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function si(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const SH={kernelName:Lh,backendName:"cpu",kernelFunc:si};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function La(t){const{inputs:e,backend:n}=t,{input:r}=e,s=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(s.dataId).values;return n.makeTensorInfo(s.shape,s.dtype,i)}const CH={kernelName:ax,backendName:"cpu",kernelFunc:La};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _I(t,e,n,r){if(r==="int32"){const s=Int32Array.from(t);return[e,"int32",s]}if(r==="bool"){const s=tl([0],n),[i,o]=Kt((a,l)=>a!==l?1:0)(e,[],t,s,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function $o(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{dtype:i}=r;if(i==="complex64"){if(s.dtype==="complex64")return si({inputs:{x:s},backend:n});const c=Td(n,s.shape,s.dtype),h=$o({inputs:{x:s},backend:n,attrs:{dtype:"float32"}}),f=kr({inputs:{real:h,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),f}if(s.dtype==="complex64"){const c=La({inputs:{input:s},backend:n}),h=$o({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),h}if(!Q8(s.dtype,i)){const c=si({inputs:{x:s},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:i}}const o=n.data.get(s.dataId).values,[a,l,u]=_I(o,s.shape,s.dtype,i);return n.makeTensorInfo(a,l,u)}const $H={kernelName:Ch,backendName:"cpu",kernelFunc:$o};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function un(t,e,n,r){return n==null?({inputs:s,backend:i})=>{const{a:o,b:a}=s,l=i;Te([o,a],t);const u=l.data.get(o.dataId).values,c=l.data.get(a.dataId).values,h=o.dtype==="string"?Li(u):u,f=o.dtype==="string"?Li(c):c,d=r||o.dtype,[p,g]=e(o.shape,a.shape,h,f,d);return l.makeTensorInfo(g,d,p)}:({inputs:s,backend:i})=>{const{a:o,b:a}=s,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=$o({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(u.dataId),h=c.complexTensorInfos.real,f=c.complexTensorInfos.imag,d=l.data.get(h.dataId).values,p=l.data.get(f.dataId).values,g=$o({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),m=l.data.get(g.dataId),b=m.complexTensorInfos.real,x=m.complexTensorInfos.imag,v=l.data.get(b.dataId).values,y=l.data.get(x.dataId).values,[w,C,T]=n(o.shape,a.shape,d,p,v,y),N=l.makeTensorInfo(T,"float32",w),$=l.makeTensorInfo(T,"float32",C),_=kr({inputs:{real:N,imag:$},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(g),l.disposeIntermediateTensorInfo(N),l.disposeIntermediateTensorInfo($),_}else{const u=l.data.get(o.dataId).values,c=l.data.get(a.dataId).values,h=r||o.dtype,[f,d]=e(o.shape,a.shape,u,c,h);return l.makeTensorInfo(d,h,f)}}}function qy(t){return(e,n,r,s,i,o)=>{const a=Xe(e,n),l=se(a),u=a.length,c=Re(a),h=Nn("float32",l),f=Nn("float32",l),d=Jl(e,a),p=Jl(n,a),g=Oi(r,s),m=Oi(i,o),b=e.length,x=Re(e),v=n.length,y=Re(n);if(d.length+p.length===0)for(let w=0;w<h.length;w++){const C=w%g.length,T=w%m.length,N=t(g[C*2],g[C*2+1],m[T*2],m[T*2+1]);h[w]=N.real,f[w]=N.imag}else for(let w=0;w<h.length;w++){const C=_u(w,u,c),T=C.slice(-b);d.forEach(M=>T[M]=0);const N=Xs(T,b,x),$=C.slice(-v);p.forEach(M=>$[M]=0);const _=Xs($,v,y),S=t(g[N*2],g[N*2+1],m[_*2],m[_*2+1]);h[w]=S.real,f[w]=S.imag}return[h,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AI=Kt((t,e)=>t+e),IH=qy((t,e,n,r)=>({real:t+n,imag:e+r})),nu=un(Au,AI,IH),TH={kernelName:Au,backendName:"cpu",kernelFunc:nu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xy(t,e,n,r,s){const i=se(r),o=_n(s,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=s||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function EI(t,e,n,r=!1){const s=t.shape[0],i=t.shape[1],o=Qe([s,n],e.dtype);for(let a=0;a<s;a++)for(let l=0;l<i;l++){const u=t.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=n||(r?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RI=Kt((t,e)=>t&e),NH=un(F4,RI),_H={kernelName:F4,backendName:"cpu",kernelFunc:NH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hi(t){return(e,n,r)=>{const s=Gt(n,e.length);for(let i=0;i<e.length;++i)s[i]=t(e[i],r);return s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mt(t,e,n){const r=hi(e);return Uo(t,r,n)}function Uo(t,e,n){return({inputs:r,attrs:s,backend:i})=>{const{x:o}=r;Te(o,t);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Li(l)}else u=l;const c=n||o.dtype,h=e(u,c,s);return a.makeTensorInfo(o.shape,c,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DI=hi(t=>Math.ceil(t)),AH=Uo($h,DI),EH={kernelName:$h,backendName:"cpu",kernelFunc:AH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MI(t,e,n,r){const s=Gt(n,se(e));if(r&&n!=="string"){let i=0;t.forEach(o=>{const a=se(o.shape);s.set(o.vals,i),i+=a})}else{let i=0;t.forEach(o=>{const a=n==="string"?Li(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const c=u*e[1]+i;for(let h=0;h<o.shape[1];++h)s[c+h]=a[l++]}i+=o.shape[1]})}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FI=Kt((t,e)=>t===e?1:0),OI=un(qp,FI,null,"bool"),RH={kernelName:qp,backendName:"cpu",kernelFunc:OI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LI=hi(t=>Math.exp(t)),zI=Uo(Rh,LI,"float32"),DH={kernelName:Rh,backendName:"cpu",kernelFunc:zI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PI=hi(t=>Math.expm1(t)),MH=Uo(Dh,PI),FH={kernelName:Dh,backendName:"cpu",kernelFunc:MH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BI=hi(t=>Math.floor(t)),OH=Uo(Mh,BI),LH={kernelName:Mh,backendName:"cpu",kernelFunc:OH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VI=Kt((t,e)=>Math.floor(t/e)),zH=un(Fh,VI,null,"int32"),PH={kernelName:Fh,backendName:"cpu",kernelFunc:zH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WI(t,e,n,r,s,i,o,a,l){const u=Qe([r,i],n);for(let c=0;c<r;c++){const h=[];let f=0;for(let d=0;d<s;d++){const p=t[c*s+d];f+=p*o[d],h.push(p)}if(f<0||f>=l/i)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let d=0;d<i;d++)u.values[c*i+d]=e.get(...e.indexToLoc(f*i+d))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UI(t,e,n){const r=Qe(n,t.dtype);for(let s=0;s<r.size;++s){const o=r.indexToLoc(s).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const c=t.locToIndex(o);0<=c&&c<t.values.length&&(r.values[s]=t.values[c])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GI=Kt((t,e)=>t>e?1:0),BH=un(Yp,GI,null,"bool"),VH={kernelName:Yp,backendName:"cpu",kernelFunc:BH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HI=Kt((t,e)=>t>=e?1:0),WH=un(Oh,HI,null,"bool"),UH={kernelName:Oh,backendName:"cpu",kernelFunc:WH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qI=Kt((t,e)=>t<e?1:0),GH=un(Jp,qI,null,"bool"),HH={kernelName:Jp,backendName:"cpu",kernelFunc:GH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XI=Kt((t,e)=>t<=e?1:0),qH=un(Qp,XI,null,"bool"),XH={kernelName:Qp,backendName:"cpu",kernelFunc:qH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jI(t,e,n){const r=(e-t)/(n-1),s=_n(n,"float32");s[0]=t;for(let i=1;i<s.length;i++)s[i]=s[i-1]+r;return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KI=hi(t=>Math.log(t)),jH=Uo(Vh,KI),KH={kernelName:Vh,backendName:"cpu",kernelFunc:jH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YI(t,e,n,r){const s=Nn(r,se(n));for(let i=0;i<s.length;++i){const o=i*e;let a=t[o];for(let l=0;l<e;++l){const u=t[o+l];(Number.isNaN(u)||u>a)&&(a=u)}s[i]=a}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZI=Kt((t,e)=>Math.max(t,e)),YH=un(Uh,ZI),ZH={kernelName:Uh,backendName:"cpu",kernelFunc:YH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JI=Kt((t,e)=>Math.min(t,e)),JH=un(Gh,JI),QH={kernelName:Gh,backendName:"cpu",kernelFunc:JH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jy=Kt((t,e)=>t*e),eq=qy((t,e,n,r)=>({real:t*n-e*r,imag:t*r+e*n})),nm=un(qh,jy,eq),tq={kernelName:qh,backendName:"cpu",kernelFunc:nm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QI(t,e,n){const r=Oo(-1,n);return jy([],e,r,t,n)}function nq(t){const{inputs:e,backend:n}=t,{x:r}=e;Te(r,"neg");const s=n.data.get(r.dataId).values,[i,o]=QI(s,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,i)}const rq={kernelName:c1,backendName:"cpu",kernelFunc:nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e9=Kt((t,e)=>t!==e?1:0),sq=un(h1,e9,null,"bool"),iq={kernelName:h1,backendName:"cpu",kernelFunc:sq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ky(t,e,n,r,s){const i=e.length,o=se(e),a=Re(e),l=Re(s),u=Nn(n,se(s));for(let c=0;c<o;++c){const h=_u(c,i,a),f=new Array(h.length);for(let p=0;p<f.length;p++)f[p]=h[r[p]];const d=Xs(f,i,l);u[d]=t[c]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ar(t){const{inputs:e,attrs:n,backend:r}=t,{x:s}=e,{perm:i}=n;Te(s,"transpose");const o=s.shape.length,a=new Array(o);for(let h=0;h<a.length;h++)a[h]=s.shape[i[h]];const l=r.data.get(s.dataId).values,u=Ky(l,s.shape,s.dtype,i,a);return{dataId:r.write(u,a,s.dtype),shape:a,dtype:s.dtype}}const oq={kernelName:Ll,backendName:"cpu",kernelFunc:ar};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t9(t,e,n,r){const[s,i]=xn(t,r),o=Cr(e,"int32"),a=_n(se(s),o),l=se(i);for(let u=0;u<a.length;++u){const c=u*l;let h=1;for(let f=0;f<l;++f)h*=n[c+f];a[u]=h}return{outVals:a,outShape:s,outDtype:o}}function aq(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r;Te(s,"prod");const a=s.shape.length,l=et(i,s.shape),u=Rt(l,a);let c=l,h=s;const f=[];u!=null&&(h=ar({inputs:{x:s},backend:n,attrs:{perm:u}}),f.push(h),c=Xt(c.length,a));const d=n.data.get(h.dataId).values,{outVals:p,outShape:g,outDtype:m}=t9(h.shape,h.dtype,d,c);let b=g;return o&&(b=qt(g,l)),f.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(b,m,p)}const lq={kernelName:b1,backendName:"cpu",kernelFunc:aq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uq(t,e,n){t.forEach((r,s)=>{if(r<0||r>=n){const i=_u(s,e.length,Re(e)).join(",");throw new Error(`indices[${i}] = ${r} is not in [0, ${n})`)}})}function cq(t,e){for(let n=0;n<t.length;++n){const r=t[n],s=n===t.length-1?e:t[n+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>s)throw new Error("Ragged splits must not point past values");for(let i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function hq(t,e,n,r){const s=[];let i=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);cq(n,r);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const c=e[u+1];for(let h=1;h<l+1;++h)a[u].push(h*c)}for(let u=0;u<t.length;++u){let c=t[u],h=t[u]+1;for(let f=0;f<n.length;++f){const d=n[f],p=f+e.length-1;if(p>=0){const g=a[p],m=g[g.length-1]-d[c];for(let b=c;b<h;++b)a[p].push(d[b+1]+m)}c=d[c],h=d[h]}h!==c&&(s.push([c,h]),i+=h-c)}return{outSplits:a,valueSlices:s,numValues:i}}function fq(t){const e=[];for(let n=0;n<t.length;++n){const r=t[n].length,s=Gt("int32",r);e.push(s),t[n].forEach((i,o)=>s[o]=i)}return e}function d5(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let r=e;r<t.length;r++)n[e-1]*=t[r];return n}function dq(t,e,n,r,s,i){const o=d5(e,2)[1],a=d5(i,2)[1];let l=0;for(const u of n)for(let c=u[0];c<u[1];++c){for(let h=0;h<r;++h)s[l*a+h]=t[c*o+h];++l}}function pq(t,e,n,r,s){const i=e.slice();i[0]=s;const o=Gt(n,se(i)),a=t.length,l=a===0?0:a/e[0];return dq(t,e,r,l,o,i),[o,i]}function n9(t,e,n,r,s,i,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(uq(i,o,l),r.length===0)throw new Error("params.rank must be nonzero");const u=r[0],{outSplits:c,valueSlices:h,numValues:f}=hq(i,o,t,u),d=fq(c),p=pq(n,r,s,h,f);return[d,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p5=2147483647;function r9(t,e,n,r,s,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(s.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=s.length===0,u=o.length===0,c=[];a||c.push(e[0]),l||c.push(s[0]),u||c.push(o[0]);for(let m=1;m<c.length;++m)if(c[m]!==c[m-1])throw new Error("starts, limits, and deltas must have the same shape");const h=c.length===0?1:c[0],f=Gt("int32",h+1);f[0]=0;for(let m=0;m<h;++m){const b=a?t[0]:t[m],x=l?r[0]:r[m],v=u?i[0]:i[m];if(v===0)throw new Error("Requires delta != 0");let y;if(v>0&&x<b||v<0&&x>b)y=0;else if(y=Math.ceil(Math.abs((x-b)/v)),y>p5)throw new Error(`Requires ((limit - start) / delta) <= ${p5}`);f[m+1]=f[m]+y}const d=f[h],p=Gt(n,d);let g=0;for(let m=0;m<h;++m){const b=f[m+1]-f[m];let x=a?t[0]:t[m];const v=u?i[0]:i[m];for(let y=0;y<b;++y)p[g++]=x,x+=v}return[f,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Gr=xs;class Nd{constructor(e,n,r,s,i,o,a,l,u,c){this.shape=e,this.shapeShape=n,this.values=r,this.valuesShape=s,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=US(c),this.raggedRank=GS(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Gr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Gr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Gr.VALUE_ROWIDS:return Nd.getMaxWidthValueRowID(n);case Gr.ROW_SPLITS:return Nd.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${Gr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let r=0;for(let s=0;s<n-1;++s){const i=e[s+1]-e[s];i>r&&(r=i)}return r}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let r=0,s=e[0],i=0;for(let o=1;o<n;++o){const a=e[o];a!==s&&(s=a,i=Math.max(o-r,i),r=o)}return Math.max(n-r,i)}tensorShapeFromTensor(e,n,r=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return g5(e,r)}calculateOutputSize(e){const n=this.valuesShape,r=this.defaultValueShape;HS(r,n);const s=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=WS(this.raggedRank,s,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,r){const s=Math.min(e,r),i=[];let o=0;for(let a=0;a<s;++a,o+=n)i.push(o);for(let a=s;a<e;++a)i.push(-1);return L(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,n,r,s){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(s,l),c=n[a];c===-1&&(u=0);for(let h=0;h<u;++h)o.push(c),c+=r;for(let h=0;h<l-u;++h)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,r,s){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let u=n[l];o.push(u);for(let c=1;c<i;++c){const h=e[c];if(h===l)u>=0&&(++a,a<s?u+=r:u=-1);else{if(a=0,l=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);u=n[h]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,r,s){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Gr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,n,r,s);case Gr.ROW_SPLITS:if(i.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(i,n,r,s);default:throw new Error(`Unsupported partition type: ${Gr[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case Gr.FIRST_DIM_SIZE:return e[0];case Gr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Gr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Gr[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),r=this.calculateOutputSize(n),s=new Array(this.raggedRank+1);s[s.length-1]=1;for(let l=s.length-2;l>=0;--l)s[l]=s[l+1]*r[l+1];const i=g5(r,!1),o=Gt(this.valuesDType,se(i));if(s[0]*r[0]>0){let l=this.calculateFirstParentOutputIndex(n,s[0],r[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,s[u],r[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,n,r,s){if(r.length===0)return;const i=this.values,o=r;let a=s.slice();a=a.slice(e+1);const l=se(a),u=n.length;let c=this.defaultValue;if(c.length!==l&&c.length!==1){const p=this.defaultValueShape;Q(()=>{const g=J(c,p);c=Ac(g,a).dataSync()})}let h=0,f=0,d=0;for(let p=0;p<=u;++p){let g=p<u?n[p]:-1;if(g===d){++d;continue}if(f<d){const m=i.subarray(h*l),b=o.subarray(f*l),x=(d-f)*l;m5(b,m,x)}if(p>=u){const m=r.length;g=Math.floor(m/l)}if(g>d)if(this.defaultValue.length===1)o.subarray(d*l,g*l).fill(this.defaultValue[0]),d=g;else for(;g>d;){const m=o.slice(d*l);m5(m,c,l),++d}g<0?(h=p+1,f=d):(h=p,f=d,d=f+1)}}}function m5(t,e,n){for(let r=0;r<n;r++)t[r]=e[r]}function g5(t,e){const n=[];for(let r of t){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function s9(t,e,n,r,s,i,o,a,l,u){return new Nd(t,e,n,r,s,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i9(t,e,n,r){const s=t===e,i=t<e&&n<0,o=e<t&&n>1;if(s||i||o)return _n(0,r);const a=Math.abs(Math.ceil((e-t)/n)),l=_n(a,r);e<t&&n===1&&(n=-1),l[0]=t;for(let u=1;u<l.length;u++)l[u]=l[u-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o9=hi(t=>1/Math.sqrt(t)),mq=Uo(Jh,o9),gq={kernelName:Jh,backendName:"cpu",kernelFunc:mq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function da(t,e,n,r,s,i,o,a,l,u){const c=[r/s,s],h=t.values,f=e.values;if(r===0)return Qe(n,e.dtype);const d=l instanceof kn?l:Qe(c,e.dtype);typeof l=="string"||typeof l=="number"?d.values.fill(l):typeof l=="boolean"&&d.values.fill(+l);for(let p=0;p<i;p++){const g=[];let m=0;for(let b=0;b<o;b++){const x=h[p*o+b];g.push(x),m+=x*a[b]}if(m<0||m>=r/s)throw new Error(`Invalid indices: ${g} does not index into ${n}`);for(let b=0;b<s;b++)u?d.values[m*s+b]+=f[p*s+b]:d.values[m*s+b]=e.rank===0?f[0]:f[p*s+b]}return d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bq=hi(t=>1/(1+Math.exp(-t))),a9=mt(r0,t=>1/(1+Math.exp(-t))),xq={kernelName:r0,backendName:"cpu",kernelFunc:a9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l9(t,e,n,r,s){const i=ty(r,e,n),o=se(n),a=Re(r);if(i){const h=ny(e,a);return s==="string"?t.slice(h,h+o):t.subarray(h,h+o)}const l=s==="string"?Li(t):t,u=Qe(r,s,l),c=Qe(n,s);for(let h=0;h<c.size;++h){const f=c.indexToLoc(h),d=f.map((p,g)=>p+e[g]);c.set(u.get(...d),...f)}return s==="string"?hC(c.values):c.values}function za(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{begin:i,size:o}=r;Te(s,"slice");const[a,l]=V1(s,i,o);Qx(s,a,l);const u=n.data.get(s.dataId).values,c=l9(u,a,l,s.shape,s.dtype);return n.makeTensorInfo(l,s.dtype,c)}const yq={kernelName:S1,backendName:"cpu",kernelFunc:za};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u9(t,e,n,r,s,i,o){const a=e[0],l=i[0],u=new Array(l),c=new Array(a),h=e[1];if(l===0){if(a!==0)throw new Error(JS(a));const m=Gt(n,0),b=Gt(s,0);return[m,[0,h],b,u,c]}let f=!0,d=0;const p=new Array(l).fill(0);for(let m=0;m<a;++m){const b=t[m*h];if(b<0)throw new Error(QS(m,b));if(b>=l)throw new Error(eC(m,b,l));++p[b],f=f&&b>=d,d=b}let g=!0;for(let m=0;m<l;++m){const b=p[m]===0;u[m]=b,g=g&&!b,p[m]=Math.max(p[m],1),m>0&&(p[m]+=p[m-1])}if(g&&f){const m=t,b=r;for(let x=0;x<a;++x)c[x]=x;return[m,[a,h],b,u,c]}else{const m=p[l-1],b=Gt(n,m*h),x=Gt(s,m),v=new Array(l).fill(0);for(let y=0;y<a;++y){const w=t[y*h],C=v[w],T=(w===0?0:p[w-1])+C;v[w]++;for(let N=0;N<h;++N)b[T*h+N]=t[y*h+N];x[T]=r[y],c[y]=T}for(let y=0;y<l;++y)if(v[y]===0){const C=y===0?0:p[y-1];b[C*h+0]=y;for(let T=1;T<h;++T)b[C*h+T]=0;x[C]=o}return[b,[m,h],x,u,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c9(t,e,n,r,s){const i=se(r),o=e[0],a=s.length,l=[];let u=1,c=-1;for(let m=0;m<a;++m){const b=s[m];if(b===-1){if(c!==-1)throw new Error(tC(c,m));c=m,l.push(1)}else{if(b<0)throw new Error(nC(m,b));u*=b,l.push(b)}}if(c!==-1){if(u<=0)throw new Error(rC());const m=Math.trunc(i/u);if(u*m!==i)throw new Error(sC(r,l));l[c]=m}if(se(l)!==i)throw new Error(iC(r,l));const f=r.length,d=[];if(f>0){d[f-1]=1;for(let m=f-2;m>=0;--m)d[m]=d[m+1]*r[m+1]}const p=[];if(a>0){p[a-1]=1;for(let m=a-2;m>=0;--m)p[m]=p[m+1]*l[m+1]}const g=Gt(n,o*a);for(let m=0;m<o;++m){let b=0;for(let x=0;x<f;++x)b+=t[m*f+x]*d[x];for(let x=0;x<a;++x)g[m*a+x]=Math.trunc(b/p[x]),b%=p[x]}return[g,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yy(t,e,n,r,s,i=!1,o=0){const a=r.length,l=[e[0],t.length/e[0]],u=l[1],h=a>0?s[a-1]+1:0;if(h<0)throw new Error(Q2());const f=e.slice();f[0]=h;const d=f.reduce((v,y)=>v*y,1),p=Gt(n,d);if(a===0)return h>0&&p.fill(o),[p,f];if(h<=0)throw new Error(Q2());let g=0,m=1,b=0,x=s[g];for(;;){let v=0;if(m<a){if(v=s[m],x===v){++m;continue}if(x>=v)throw new Error(oC())}if(x<0||x>=h)throw new Error(aC(x,h));x>b&&p.fill(o,b*u,x*u);for(let y=g;y<m;++y){const w=r[y];if(w<0||w>=l[0])throw new Error(lC(y,r[y],l[0]));for(let C=0;C<u;C++)p[x*u+C]+=t[w*u+C]}if(i)for(let y=0;y<u;y++)p[x*u+y]/=m-g;if(g=m,++m,b=x+1,x=v,m>a)break}return b<h&&p.fill(o,b*u,h*u),[p,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vq=hi(t=>Math.sqrt(t)),wq=mt(i0,t=>Math.sqrt(t)),kq={kernelName:i0,backendName:"cpu",kernelFunc:wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h9=Kt((t,e)=>{const n=t-e;return n*n}),Sq=un(o0,h9),Cq={kernelName:o0,backendName:"cpu",kernelFunc:Sq};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f9=hi((t,e)=>{const{pattern:n,replaceGlobal:r,rewrite:s}=e;return t.replace(new RegExp(n,r?"g":""),s)}),$q=Uo(hx,f9),Iq={kernelName:hx,backendName:"cpu",kernelFunc:$q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9(t,e,n,r){const s=Qe(t,e.dtype);for(let i=0;i<s.size;i++){const o=s.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+r[l];s.set(e.get(...a),...o)}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tq{constructor(e,n,r,s,i,o){this.separator=mo(e),this.nGramWidths=n,this.leftPad=mo(r),this.rightPad=mo(s),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const r=this.getPadWidth(n);return Math.max(0,e+2*r-n+1)}createNGrams(e,n,r,s,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),c=Math.max(0,l-(i-(a+1))),h=o-(u+c),f=n+(u>0?0:a-l);let d=0;d+=u*this.leftPad.length;for(let x=0;x<h;++x)d+=e[f+x].length;d+=c*this.rightPad.length;const p=u+c+h-1;d+=p*this.separator.length,r[s+a]=new Uint8Array(d);const g=r[s+a];let m=0;const b=x=>x.forEach(v=>g[m++]=v);for(let x=0;x<u;++x)b(this.leftPad),b(this.separator);for(let x=0;x<h-1;++x)b(e[f+x]),b(this.separator);if(h>0){b(e[f+h-1]);for(let x=0;x<c;++x)b(this.separator),b(this.rightPad)}else{for(let x=0;x<c-1;++x)b(this.rightPad),b(this.separator);b(this.rightPad)}}}compute(e,n){const r=e.length,s=n.length;if(s>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<s;++u){let c=n[u]>=l;if(c=c&&n[u]<=r,!c)throw new Error(`Invalid split value ${n[u]}, must be in [${l}, ${r}]`);l=n[u]}if(l!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${l}`)}const i=s-1,o=Gt("int32",s);if(r===0||s===0){const l=new Array(r);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=n[l]-n[l-1];let c=0;this.nGramWidths.forEach(h=>{c+=this.getNumNGrams(u,h)}),this.preserveShort&&u>0&&c===0&&(c=1),o[l]=o[l-1]+c}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=n[l];let c=o[l];if(this.nGramWidths.forEach(h=>{const f=n[l+1]-n[l],d=this.getNumNGrams(f,h);this.createNGrams(e,u,a,c,d,h),c+=d}),this.preserveShort&&c===o[l]){const h=n[l+1]-n[l];if(h===0)continue;const f=h+2*this.padWidth;this.createNGrams(e,u,a,c,1,f)}}return[a,o]}}function p9(t,e,n,r,s,i,o,a){return new Tq(n,r,s,i,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nq(t,e,n,r){if(!t.length)return;if(e.length===0){for(let i=0;i<t.length;++i)r.push(t.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=t.indexOf(i);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&r.push(a),t=t.subarray(o+1),o=t.indexOf(i)}(!n||t.length!==0)&&r.push(t);return}let s=0;for(let i=0;i<t.length+1;i++)if(i===t.length||e.indexOf(t[i])!==-1){const o=t.subarray(s,i);(!n||o.length!==0)&&r.push(o),s=i+1}}function m9(t,e,n){const r=t.length,s=[];let i=0,o=0;const a=new Array(r);for(let f=0;f<r;++f){const d=s.length;Nq(t[f],e,n,s);const p=s.length-d;a[f]=p,i+=p,o=Math.max(o,p)}const l=Gt("int32",i*2),u=new Array(i),c=[r,o];let h=0;for(let f=0;f<r;++f)for(let d=0;d<a[f];++d)l[h*2]=f,l[h*2+1]=d,u[h]=s[h],++h;return[l,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g9(t,e){const n=Gt("int32",t.length);for(let r=0;r<t.length;++r)n[r]=SM(t[r]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b9=Kt((t,e)=>t-e),_q=qy((t,e,n,r)=>({real:t-n,imag:e-r})),Zy=un(a0,b9,_q),Aq={kernelName:a0,backendName:"cpu",kernelFunc:Zy};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x9(t,e){const n=new Array(t.rank);for(let s=0;s<n.length;s++)n[s]=t.shape[s]*e[s];const r=Qe(n,t.dtype);for(let s=0;s<r.values.length;++s){const i=r.indexToLoc(s),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%t.shape[l];const a=t.locToIndex(o);r.values[s]=t.values[a]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pc=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function y9(t,e,n=0,r=t.length-1){for(;r>n;){if(r-n>600){const a=r-n+1,l=e-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(a-c)/a)*Math.sign(l-a/2),f=Math.max(n,Math.floor(e-l*c/a+h)),d=Math.min(r,Math.floor(e+(a-l)*c/a+h));y9(t,e,f,d)}const s=t[e];let i=n,o=r;for(Al(t,n,e),pc(t[r],s)>0&&Al(t,n,r);i<o;){for(Al(t,i,o),i++,o--;pc(t[i],s)<0;)i=i+1;for(;pc(t[o],s)>0;)o=o-1}pc(t[n],s)===0?Al(t,n,o):(o=o+1,Al(t,o,r)),o<=e&&(n=o+1),e<=o&&(r=o-1)}}function v9(t,e,n,r,s){const i=e[e.length-1],[o,a]=[t.length/i,i],l=Nn(n,o*r),u=Nn("int32",o*r);for(let h=0;h<o;h++){const f=h*a,d=t.subarray(f,f+a);let p=new Array(d.length);d.forEach((x,v)=>p[v]={value:x,index:v}),r<p.length&&(y9(p,r),p=p.slice(0,r)),s&&p.sort(pc);const g=h*r,m=l.subarray(g,g+r),b=u.subarray(g,g+r);for(let x=0;x<r;x++)m[x]=p[x].value,b[x]=p[x].index}const c=e.slice();return c[c.length-1]=r,[Qe(c,n,l),Qe(c,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w9(t,e,n,r){const s=et(e,n)[0],i=[1,n[0],1];for(let p=0;p<s;p++)i[0]*=n[p];i[1]=n[s];for(let p=s+1;p<n.length;p++)i[2]*=n[p];const o=new Map,a=new Int32Array(n[s]),l=new kn(i,r,t),u=[],c=i[0]===1&&i[2]===1;for(let p=0;p<n[s];p++){let g;if(c)g=t[p].toString();else{const b=[];for(let x=0;x<i[0];x++)for(let v=0;v<i[2];v++)b.push(l.get(x,p,v));g=b.join(",")}const m=o.get(g);if(m!=null)a[p]=m;else{const b=o.size;o.set(g,b),a[p]=b,u.push(p)}}const h=i.slice();h[1]=o.size;const f=new kn(h,r);u.forEach((p,g)=>{for(let m=0;m<i[0];m++)for(let b=0;b<i[2];b++)f.set(l.get(m,p,b),m,g,b)});const d=n.slice();return d[s]=h[1],{outputValues:f.values,outputShape:d,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eq=Object.freeze(Object.defineProperty({__proto__:null,addImpl:AI,bincountImpl:Xy,bincountReduceImpl:EI,bitwiseAndImpl:RI,castImpl:_I,ceilImpl:DI,concatImpl:MI,equalImpl:FI,expImpl:LI,expm1Impl:PI,floorDivImpl:VI,floorImpl:BI,gatherNdImpl:WI,gatherV2Impl:UI,greaterEqualImpl:HI,greaterImpl:GI,lessEqualImpl:XI,lessImpl:qI,linSpaceImpl:jI,logImpl:KI,maxImpl:YI,maximumImpl:ZI,minimumImpl:JI,multiplyImpl:jy,negImpl:QI,notEqualImpl:e9,prodImpl:t9,raggedGatherImpl:n9,raggedRangeImpl:r9,raggedTensorToTensorImpl:s9,rangeImpl:i9,rsqrtImpl:o9,scatterImpl:da,sigmoidImpl:bq,simpleAbsImpl:NI,sliceImpl:l9,sparseFillEmptyRowsImpl:u9,sparseReshapeImpl:c9,sparseSegmentReductionImpl:Yy,sqrtImpl:vq,squaredDifferenceImpl:h9,staticRegexReplaceImpl:f9,stridedSliceImpl:d9,stringNGramsImpl:p9,stringSplitImpl:m9,stringToHashBucketFastImpl:g9,subImpl:b9,tileImpl:x9,topKImpl:v9,transposeImpl:Ky,uniqueImpl:w9},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Vk("cpu",()=>new tm,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k9=mt(Ah,t=>t>=0?t:Math.exp(t)-1),Rq={kernelName:Ah,backendName:"cpu",kernelFunc:k9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S9(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{alpha:i}=r;Te([s],"leakyRelu");const o=se(s.shape),a=n.data.get(s.dataId).values,l=Nn("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return n.makeTensorInfo(s.shape,"float32",l)}const Dq={kernelName:Zp,backendName:"cpu",kernelFunc:S9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mq=Kt((t,e)=>t<0?e*t:t);function C9(t){const{inputs:e,backend:n}=t,{x:r,alpha:s}=e;Te([r,s],"prelu");const i=n.data.get(r.dataId).values,o=n.data.get(s.dataId).values,[a,l]=Mq(r.shape,s.shape,i,o,"float32");return n.makeTensorInfo(l,"float32",a)}const Fq={kernelName:g1,backendName:"cpu",kernelFunc:C9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $9=mt(Kh,t=>Math.max(0,t)),Oq={kernelName:Kh,backendName:"cpu",kernelFunc:$9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I9=mt(Yh,t=>Math.min(Math.max(0,t),6)),Lq={kernelName:Yh,backendName:"cpu",kernelFunc:I9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _d(t,e,n,r,s){if(n==="linear")return si({inputs:{x:e},backend:t});if(n==="relu")return $9({inputs:{x:e},backend:t});if(n==="elu")return k9({inputs:{x:e},backend:t});if(n==="relu6")return I9({inputs:{x:e},backend:t});if(n==="prelu")return C9({inputs:{x:e,alpha:r},backend:t});if(n==="leakyrelu")return S9({inputs:{x:e},backend:t,attrs:{alpha:s}});if(n==="sigmoid")return a9({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ct(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{shape:i}=r,o=se(s.shape),a=J8(i,o),l=se(a);L(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${s.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(s.dataId);const u=n.data.get(s.dataId);if(u.complexTensorInfos!=null){const c=u.complexTensorInfos.real,h=u.complexTensorInfos.imag;c.shape=a,h.shape=a}return{dataId:s.dataId,shape:a,dtype:s.dtype}}const zq={kernelName:x1,backendName:"cpu",kernelFunc:Ct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T9(t){const{inputs:e,backend:n,attrs:r}=t,{a:s,b:i}=e,{transposeA:o,transposeB:a}=r;Te([s,i],"matMul");const l=s.shape.length,u=i.shape.length,c=o?s.shape[l-2]:s.shape[l-1],h=a?i.shape[u-1]:i.shape[u-2],f=o?s.shape[l-1]:s.shape[l-2],d=a?i.shape[u-2]:i.shape[u-1],p=s.shape.slice(0,-2),g=i.shape.slice(0,-2),m=se(p),b=se(g),v=Xe(s.shape.slice(0,-2),i.shape.slice(0,-2)).concat([f,d]);L(c===h,()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${s.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const y=o?[m,c,f]:[m,f,c],w=a?[b,d,h]:[b,h,d],C=Ct({inputs:{x:s},backend:n,attrs:{shape:y}}),T=Ct({inputs:{x:i},backend:n,attrs:{shape:w}}),N=o?C.shape[1]:C.shape[2],$=o?C.shape[2]:C.shape[1],_=a?T.shape[1]:T.shape[2],S=Math.max(m,b),M=n.data.get(C.dataId).values,F=n.data.get(T.dataId).values,A=Re(C.shape),E=Re(T.shape),[D,P,z]=o?[A[0],1,A[1]]:[A[0],A[1],1],[B,G,j]=a?[1,E[1],E[0]]:[E[1],1,E[0]],Z=$*_,ne=Qe([S,$,_],C.dtype),le=ne.values,oe=n.blockSize;for(let de=0;de<S;de++){const fe=de%m,xe=de%b;for(let ie=0;ie<$;ie+=oe){const pe=Math.min(ie+oe,$);for(let ge=0;ge<_;ge+=oe){const ae=Math.min(ge+oe,_);for(let Le=0;Le<N;Le+=oe){const De=Math.min(Le+oe,N);for(let qe=ie;qe<pe;qe++)for(let Ue=ge;Ue<ae;Ue++){let ve=0;for(let Fe=Le;Fe<De;Fe++){const Jt=M[fe*D+qe*P+Fe*z],xt=F[Fe*B+Ue*G+xe*j];ve+=Jt*xt}le[de*Z+(qe*_+Ue)]+=ve}}}}}return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(T),n.makeTensorInfo(v,ne.dtype,ne.values)}const Pq={kernelName:Op,backendName:"cpu",kernelFunc:T9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bq(t){const{inputs:e,backend:n,attrs:r}=t,{a:s,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=r;let f,d,p;const g=[];f=T9({inputs:{a:s,b:i},attrs:{transposeA:l,transposeB:u},backend:n}),o&&(d=nu({inputs:{a:f,b:o},backend:n}),g.push(f),f=d),c&&(p=_d(n,f,c,a,h),g.push(f),f=p);for(const b of g)n.disposeIntermediateTensorInfo(b);return f}const Vq={kernelName:ld,backendName:"cpu",kernelFunc:Bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wq=mt(bh,t=>Math.acos(t)),Uq={kernelName:bh,backendName:"cpu",kernelFunc:Wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gq=mt(xh,t=>Math.acosh(t)),Hq={kernelName:xh,backendName:"cpu",kernelFunc:Gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qq(t){const{inputs:e,backend:n}=t,r=e;Te(e,"addN");const s=r.map(a=>n.data.get(a.dataId).values),i=Qe(r[0].shape,r[0].dtype),o=i.values;for(let a=0;a<r.length;a++){const l=s[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}const Xq={kernelName:_4,backendName:"cpu",kernelFunc:qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jq(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r;Te(s,"all");const a=et(i,s.shape);let l=a;const u=Rt(l,s.shape.length);let c=s;u!=null&&(c=ar({inputs:{x:s},backend:n,attrs:{perm:u}}),l=Xt(l.length,s.shape.length)),$n("all",l,c.shape.length);const[h,f]=xn(c.shape,l),d=se(f),p=_n(se(h),c.dtype),g=n.data.get(c.dataId).values;for(let b=0;b<p.length;++b){const x=b*d;let v=g[x];for(let y=0;y<d;++y){const w=g[x+y];v=v&&w}p[b]=v}u!=null&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(h,c.dtype,p);if(o){const b=qt(h,a),x=Ct({inputs:{x:m},backend:n,attrs:{shape:b}});return n.disposeIntermediateTensorInfo(m),x}return m}const Kq={kernelName:A4,backendName:"cpu",kernelFunc:jq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yq(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r;Te(s,"any");const a=et(i,s.shape);let l=a;const u=Rt(l,s.shape.length);let c=s;u!=null&&(c=ar({inputs:{x:s},backend:n,attrs:{perm:u}}),l=Xt(l.length,s.shape.length)),$n("any",l,c.shape.length);const[h,f]=xn(c.shape,l),d=se(f),p=_n(se(h),c.dtype),g=n.data.get(c.dataId).values;for(let b=0;b<p.length;++b){const x=b*d;let v=g[x];for(let y=0;y<d;++y){const w=g[x+y];v=v||w}p[b]=v}u!=null&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(h,c.dtype,p);if(o){const b=qt(h,a),x=Ct({inputs:{x:m},backend:n,attrs:{shape:b}});return n.disposeIntermediateTensorInfo(m),x}return m}const Zq={kernelName:E4,backendName:"cpu",kernelFunc:Yq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jq(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i}=r;Te(s,"argMax");let o=et(i,s.shape);const a=Rt(o,s.shape.length);let l=s;const u=[];a!=null&&(l=ar({inputs:{x:s},backend:n,attrs:{perm:a}}),u.push(l),o=Xt(o.length,l.shape.length)),o=[o[0]],$n("argMax",o,l.shape.length);const[c,h]=xn(l.shape,o),f=se(c),d=_n(f,"int32"),p=se(h),g=n.data.get(l.dataId).values;for(let m=0;m<d.length;++m){const b=m*p;let x=g[b],v=0;for(let y=0;y<p;++y){const w=g[b+y];w>x&&(x=w,v=y)}d[m]=v}return u.forEach(m=>n.disposeIntermediateTensorInfo(m)),n.makeTensorInfo(c,"int32",d)}const Qq={kernelName:Rp,backendName:"cpu",kernelFunc:Jq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eX(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i}=r;Te(s,"argMin");let o=et(i,s.shape);const a=Rt(o,s.shape.length);let l=s;const u=[];a!=null&&(l=ar({inputs:{x:s},backend:n,attrs:{perm:a}}),u.push(l),o=Xt(o.length,l.shape.length)),o=[o[0]],$n("argMin",o,l.shape.length);const[c,h]=xn(l.shape,o),f=se(c),d=_n(f,"int32"),p=se(h),g=n.data.get(l.dataId).values;for(let m=0;m<d.length;++m){const b=m*p;let x=g[b],v=0;for(let y=0;y<p;++y){const w=g[b+y];w<x&&(x=w,v=y)}d[m]=v}return u.forEach(m=>n.disposeIntermediateTensorInfo(m)),n.makeTensorInfo(c,"int32",d)}const tX={kernelName:Dp,backendName:"cpu",kernelFunc:eX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nX=mt(yh,t=>Math.asin(t)),rX={kernelName:yh,backendName:"cpu",kernelFunc:nX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sX=mt(vh,t=>Math.asinh(t)),iX={kernelName:vh,backendName:"cpu",kernelFunc:sX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oX=mt(wh,t=>Math.atan(t)),aX={kernelName:wh,backendName:"cpu",kernelFunc:oX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lX=Kt((t,e)=>Math.atan2(t,e)),uX=un(Sh,lX),cX={kernelName:Sh,backendName:"cpu",kernelFunc:uX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hX=mt(kh,t=>Math.atanh(t)),fX={kernelName:kh,backendName:"cpu",kernelFunc:hX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jy(t,e,n,r,s,i){const o=s.strideHeight,a=s.strideWidth,l=s.dilationHeight,u=s.dilationWidth,c=s.effectiveFilterHeight,h=s.effectiveFilterWidth,f=s.padInfo.top,d=s.padInfo.left,p=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=Qe(s.outShape,n),m=g.values,b=s.outShape[1]*s.outShape[2]*s.outShape[3],x=s.outShape[2]*s.outShape[3],v=s.outShape[3];for(let y=0;y<s.batchSize;++y){const w=y*b,C=y*r[0];for(let T=0;T<s.inChannels;++T)for(let N=0;N<s.outHeight;++N){const $=N*o-f,_=Math.max(0,$),S=Math.min(s.inHeight,c+$),M=w+N*x;for(let F=0;F<s.outWidth;++F){const A=F*a-d,E=Math.max(0,A),D=Math.min(s.inWidth,h+A);let P=p,z=0,B=0;for(let j=_;j<S;j+=l){const Z=C+j*r[1];for(let ne=E;ne<D;ne+=u){const le=Z+ne*r[2],oe=t[le+T];i==="max"&&oe>P?P=oe:i==="avg"&&(z+=oe,B++)}if(isNaN(P))break}const G=M+F*v+T;m[G]=i==="avg"?z/B:P}}}return g}function N9(t,e,n,r,s=!1,i=!1){const o=Qe(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,g=Qe(e,n,t);for(let m=0;m<r.batchSize;++m)for(let b=0;b<r.inChannels;++b)for(let x=0;x<r.outHeight;++x){const v=x*a-d;let y=v;for(;y<0;)y+=u;const w=Math.min(r.inHeight,h+v);for(let C=0;C<r.outWidth;++C){const T=C*l-p;let N=T;for(;N<0;)N+=c;const $=Math.min(r.inWidth,f+T);let _=Number.NEGATIVE_INFINITY,S=-1;for(let M=y;M<w;M+=u){const F=M-v;for(let A=N;A<$;A+=c){const E=A-T,D=g.get(m,M,A,b);D>_&&(_=D,s?S=i?((m*r.inHeight+M)*r.inWidth+A)*r.inChannels+b:(M*r.inWidth+A)*r.inChannels+b:S=F*f+E)}}o.set(S,m,x,C,b)}}return o}function _9(t,e,n,r,s,i){const o=s.strideDepth,a=s.strideHeight,l=s.strideWidth,u=s.dilationDepth,c=s.dilationHeight,h=s.dilationWidth,f=s.effectiveFilterDepth,d=s.effectiveFilterHeight,p=s.effectiveFilterWidth,g=s.padInfo.front,m=s.padInfo.top,b=s.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Qe(s.outShape,n),y=v.values,w=s.outShape[1]*s.outShape[2]*s.outShape[3]*s.outShape[4],C=s.outShape[2]*s.outShape[3]*s.outShape[4],T=s.outShape[3]*s.outShape[4],N=s.outShape[4];for(let $=0;$<s.batchSize;++$){const _=$*w,S=$*r[0];for(let M=0;M<s.inChannels;++M)for(let F=0;F<s.outDepth;++F){const A=F*o-g;let E=A;for(;E<0;)E+=u;const D=Math.min(s.inDepth,f+A),P=_+F*C;for(let z=0;z<s.outHeight;++z){const B=z*a-m;let G=B;for(;G<0;)G+=c;const j=Math.min(s.inHeight,d+B),Z=P+z*T;for(let ne=0;ne<s.outWidth;++ne){const le=ne*l-b;let oe=le;for(;oe<0;)oe+=h;const de=Math.min(s.inWidth,p+le),fe=Z+ne*N;let xe=x,ie=0,pe=0;for(let ae=E;ae<D;ae+=u){const Le=S+ae*r[1];for(let De=G;De<j;De+=c){const qe=Le+De*r[2];for(let Ue=oe;Ue<de;Ue+=h){const ve=qe+Ue*r[3],Fe=t[ve+M];if(i==="max"&&Fe>xe?xe=Fe:i==="avg"&&(ie+=Fe,pe++),isNaN(xe))break}if(isNaN(xe))break}if(isNaN(xe))break}const ge=fe+M;y[ge]=i==="avg"?ie/Math.max(pe,1):xe}}}}return v}function dX(t,e){const n=Qe(e.outShape,"int32"),r=e.strideDepth,s=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.front,d=e.padInfo.top,p=e.padInfo.left;for(let g=0;g<e.batchSize;++g)for(let m=0;m<e.inChannels;++m)for(let b=0;b<e.outDepth;++b){const x=b*r-f;let v=x;for(;v<0;)v+=o;const y=Math.min(e.inDepth,u+x);for(let w=0;w<e.outHeight;++w){const C=w*s-d;let T=C;for(;T<0;)T+=a;const N=Math.min(e.inHeight,c+C);for(let $=0;$<e.outWidth;++$){const _=$*i-p;let S=_;for(;S<0;)S+=l;const M=Math.min(e.inWidth,h+_);let F=Number.NEGATIVE_INFINITY,A=-1;for(let E=v;E<y;E+=o){const D=E-x;for(let P=T;P<N;P+=a){const z=P-C;for(let B=S;B<M;B+=l){const G=B-_,j=t.get(g,E,P,B,m);j>=F&&(F=j,A=D*c*h+z*c+G)}}}n.set(A,g,b,w,$,m)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pX(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e;Te(s,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;L(Rn(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=us(s.shape,i,o,u,a,l);let h;if(c.filterWidth===1&&c.filterHeight===1&&ft(c.inShape,c.outShape))h=si({inputs:{x:s},backend:n});else{const f=n.data.get(s.dataId).values,d=Re(s.shape),p=Jy(f,s.shape,s.dtype,d,c,"avg");h=n.makeTensorInfo(c.outShape,s.dtype,p.values)}return h}const mX={kernelName:Mp,backendName:"cpu",kernelFunc:pX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gX(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=r;Te(s,"avgPool3d");const c=Ui(s.shape,i,o,1,a,l,u),h=n.data.get(s.dataId).values,f=_9(h,s.shape,s.dtype,Re(s.shape),c,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}const bX={kernelName:Fp,backendName:"cpu",kernelFunc:gX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xX(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=r;Te([s,i],"avgPool3DGrad");const c=Ui(i.shape,o,a,1,l,u),h=c.strideDepth,f=c.strideHeight,d=c.strideWidth,p=c.filterDepth,g=c.filterHeight,m=c.filterWidth,b=c.dilationDepth,x=c.dilationHeight,v=c.dilationWidth,y=c.effectiveFilterDepth,w=c.effectiveFilterHeight,C=c.effectiveFilterWidth,T=y-1-c.padInfo.front,N=C-1-c.padInfo.left,$=w-1-c.padInfo.top,_=Qe(i.shape,"float32"),S=1/(p*g*m),M=n.bufferSync(s);for(let F=0;F<c.batchSize;++F)for(let A=0;A<c.inChannels;++A)for(let E=0;E<c.inDepth;++E)for(let D=0;D<c.inHeight;++D)for(let P=0;P<c.inWidth;++P){const z=E-T,B=D-$,G=P-N;let j=0;for(let Z=0;Z<y;Z+=b){const ne=(z+Z)/h;if(!(ne<0||ne>=c.outDepth||Math.floor(ne)!==ne))for(let le=0;le<w;le+=x){const oe=(B+le)/f;if(!(oe<0||oe>=c.outHeight||Math.floor(oe)!==oe))for(let de=0;de<C;de+=v){const fe=(G+de)/d;if(fe<0||fe>=c.outWidth||Math.floor(fe)!==fe)continue;const xe=M.get(F,ne,oe,fe,A);j+=xe}}}_.set(j*S,F,E,D,P,A)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const yX={kernelName:D4,backendName:"cpu",kernelFunc:xX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vX(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:i}=e,o=i;Te([s,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=r,c=us(o.shape,a,l,1,u),h=c.strideHeight,f=c.strideWidth,d=c.filterHeight,p=c.filterWidth,g=c.dilationHeight,m=c.dilationWidth,b=c.effectiveFilterHeight,x=c.effectiveFilterWidth,v=x-1-c.padInfo.left,y=b-1-c.padInfo.top,w=Qe(o.shape,"float32"),C=1/(d*p),T=n.data.get(s.dataId).values,N=Qe(s.shape,"float32",T);for(let $=0;$<c.batchSize;++$)for(let _=0;_<c.inChannels;++_)for(let S=0;S<c.inHeight;++S)for(let M=0;M<c.inWidth;++M){const F=S-y,A=M-v;let E=0;for(let D=0;D<b;D+=g){const P=(F+D)/h;if(!(P<0||P>=c.outHeight||Math.floor(P)!==P))for(let z=0;z<x;z+=m){const B=(A+z)/f;if(B<0||B>=c.outWidth||Math.floor(B)!==B)continue;const G=N.get($,P,B,_);E+=G}}w.set(E*C,$,S,M,_)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const wX={kernelName:R4,backendName:"cpu",kernelFunc:vX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kX(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,scale:i,offset:o,mean:a,variance:l}=e;L(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),L(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),L(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Te([s,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=r;u==null&&(u=.001);const c=n.data.get(s.dataId).values,h=n.data.get(a.dataId).values,f=n.data.get(l.dataId).values,d=i?n.data.get(i.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),g=new Float32Array(c.length),m=p.length,b=d.length,x=f.length,v=h.length;let y=0,w=0,C=0,T=0;for(let N=0;N<c.length;++N)g[N]=p[y++]+(c[N]-h[w++])*d[C++]/Math.sqrt(f[T++]+u),y>=m&&(y=0),w>=v&&(w=0),C>=b&&(C=0),T>=x&&(T=0);return n.makeTensorInfo(s.shape,s.dtype,g)}const SX={kernelName:jp,backendName:"cpu",kernelFunc:kX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CX(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockShape:i,crops:o}=r;Te([s],"batchToSpaceND");const a=i.reduce((b,x)=>b*x),l=g0(s.shape,i,a),u=b0(l.length,i.length),c=x0(s.shape,i,a),h=ay(o,i.length),f=ly(c,o,i.length),d=Ct({inputs:{x:s},backend:n,attrs:{shape:l}}),p=ar({inputs:{x:d},backend:n,attrs:{perm:u}}),g=Ct({inputs:{x:p},backend:n,attrs:{shape:c}}),m=za({inputs:{x:g},backend:n,attrs:{begin:h,size:f}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}const $X={kernelName:Lp,backendName:"cpu",kernelFunc:CX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IX(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,weights:i}=e,{size:o}=r,a=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,u=Xy(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}const TX={kernelName:M4,backendName:"cpu",kernelFunc:IX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NX(t){const{inputs:e,backend:n}=t,{s0:r,s1:s}=e,i=n.data.get(r.dataId).values,o=n.data.get(s.dataId).values,a=Xe(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const _X={kernelName:sk,backendName:"cpu",kernelFunc:NX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AX=mt(Ih,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),EX={kernelName:Ih,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RX=t=>{const{x:e}=t.inputs,n=t.backend,r=new Float32Array(se(e.shape)),s=n.data.get(e.dataId),i=s.complexTensorInfos.real,o=s.complexTensorInfos.imag,a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const c=a[u],h=l[u];r[u]=Math.hypot(c,h)}return n.makeOutput(r,e.shape,"float32")},DX={kernelName:zp,backendName:"cpu",kernelFunc:RX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ru(t){const{inputs:e,backend:n}=t,{input:r}=e,s=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(s.dataId).values;return n.makeTensorInfo(s.shape,s.dtype,i)}const MX={kernelName:J4,backendName:"cpu",kernelFunc:ru};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function su(t){const{inputs:e,backend:n,attrs:r}=t,{axis:s}=r,i=et(s,e[0].shape)[0],o=e.map(g=>g.shape);sy(o,i);let a=Ys(e.map(g=>g.shape),i);if(se(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(g=>se(g.shape)>0);if(l.length===1)return si({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const g=l.map(y=>La({inputs:{input:y},backend:n})),m=l.map(y=>ru({inputs:{input:y},backend:n})),b=su({inputs:g,backend:n,attrs:{axis:i}}),x=su({inputs:m,backend:n,attrs:{axis:i}}),v=kr({inputs:{real:b,imag:x},backend:n});return g.forEach(y=>n.disposeIntermediateTensorInfo(y)),m.forEach(y=>n.disposeIntermediateTensorInfo(y)),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(x),v}const u=l.map(g=>{const b=[-1,se(g.shape.slice(i))];return Ct({inputs:{x:g},backend:n,attrs:{shape:b}})}),c=u.map(g=>({vals:n.data.get(g.dataId).values,shape:g.shape}));a=Ys(u.map(g=>g.shape),1);const h=u[0].shape[0]===1,f=MI(c,a,e[0].dtype,h),d=Ys(l.map(g=>g.shape),i),p=n.makeTensorInfo(d,e[0].dtype,f);return u.forEach(g=>n.disposeIntermediateTensorInfo(g)),p}const FX={kernelName:Pp,backendName:"cpu",kernelFunc:su};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A9(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=r;Te([s,i],"conv2d");const h=Gi(l),f=Cn(s.shape,i.shape,o,u,a,c,!1,h),d=f.filterHeight,p=f.filterWidth,g=f.dilationHeight,m=f.dilationWidth,b=f.padInfo.left,x=f.padInfo.top,v=f.dataFormat==="channelsLast",y=new kn(f.outShape,s.dtype),w=Re(s.shape),C=Re(i.shape),T=w[0],N=v?w[1]:w[2],$=v?w[2]:1,_=v?1:w[1],S=y.strides[0],M=v?y.strides[1]:y.strides[2],F=v?y.strides[2]:1,A=v?1:y.strides[1],E=n.data.get(s.dataId).values,D=n.data.get(i.dataId).values,P=y.values;for(let z=0;z<f.batchSize;++z){const B=z*T,G=z*S;for(let j=0;j<f.outHeight;++j){const Z=G+j*M,ne=j*f.strideHeight-x;for(let le=0;le<d;++le){const oe=ne+le*g;if(oe<0||oe>=f.inHeight)continue;const de=le*C[0],fe=B+oe*N;for(let xe=0;xe<f.outWidth;++xe){const ie=Z+xe*F,pe=xe*f.strideWidth-b;for(let ge=0;ge<p;++ge){const ae=pe+ge*m;if(ae<0||ae>=f.inWidth)continue;const Le=de+ge*C[1],De=fe+ae*$;let qe=Le;for(let Ue=0;Ue<f.inChannels;++Ue){const ve=E[De+Ue*_];for(let Fe=0;Fe<f.outChannels;++Fe)P[ie+Fe*A]+=ve*D[qe+Fe];qe+=f.outChannels}}}}}}return n.makeTensorInfo(y.shape,y.dtype,P)}const OX={kernelName:Bp,backendName:"cpu",kernelFunc:A9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LX(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=r;Te([s,i],"conv2dBackpropFilter");const h=Gi(l),f=Cn(s.shape,c,o,1,a,u,!1,h),{strideHeight:d,strideWidth:p,filterHeight:g,filterWidth:m}=f,b=f.dataFormat==="channelsLast",x=new kn(f.filterShape,"float32"),v=f.padInfo.left,y=f.padInfo.top,w=n.data.get(s.dataId).values,C=n.data.get(i.dataId).values,T=new kn(s.shape,s.dtype,w),N=new kn(i.shape,i.dtype,C);for(let $=0;$<g;++$){const _=Math.max(0,Math.ceil((y-$)/d)),S=Math.min(f.outHeight,(f.inHeight+y-$)/d);for(let M=0;M<m;++M){const F=Math.max(0,Math.ceil((v-M)/p)),A=Math.min(f.outWidth,(f.inWidth+v-M)/p);for(let E=0;E<f.inChannels;++E)for(let D=0;D<f.outChannels;++D){let P=0;for(let z=0;z<f.batchSize;++z)for(let B=_;B<S;++B){const G=$+B*d-y;for(let j=F;j<A;++j){const Z=M+j*p-v;b?P+=T.get(z,G,Z,E)*N.get(z,B,j,D):P+=T.get(z,E,G,Z)*N.get(z,D,B,j)}}x.set(P,$,M,E,D)}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const zX={kernelName:L4,backendName:"cpu",kernelFunc:LX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PX(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=r;Te([s,i],"conv2dBackpropInput");const h=Re(i.shape),f=Re(s.shape);let d=Gi(u);const p=Cn(o,i.shape,a,1,l,c,!1,d),g=new kn(p.inShape,"float32"),m=g.values,b=n.data.get(s.dataId).values,x=n.data.get(i.dataId).values,[v,y,w]=h,{batchSize:C,filterHeight:T,filterWidth:N,inChannels:$,inHeight:_,inWidth:S,outChannels:M,outHeight:F,outWidth:A,strideHeight:E,strideWidth:D}=p;d=p.dataFormat;const P=T-1-p.padInfo.top,z=N-1-p.padInfo.left,B=d==="channelsLast",G=g.strides[0],j=B?g.strides[1]:g.strides[2],Z=B?g.strides[2]:1,ne=B?1:g.strides[1],le=f[0],oe=B?f[1]:f[2],de=B?f[2]:1,fe=B?1:f[1];for(let xe=0;xe<C;++xe)for(let ie=0;ie<$;++ie)for(let pe=0;pe<_;++pe){const ge=pe-P,ae=Math.max(0,Math.ceil(ge/E)),Le=Math.min(F,(T+ge)/E);for(let De=0;De<S;++De){const qe=De-z,Ue=Math.max(0,Math.ceil(qe/D)),ve=Math.min(A,(N+qe)/D);let Fe=0;for(let xt=ae;xt<Le;++xt){const Zi=xt*E-ge;for(let Tr=Ue;Tr<ve;++Tr){const Yo=Tr*D-qe,ds=le*xe+oe*xt+de*Tr,bi=v*(T-1-Zi)+y*(N-1-Yo)+w*ie;for(let Ji=0;Ji<M;++Ji){const Qi=b[ds+fe*Ji],eo=x[bi+Ji];Fe+=Qi*eo}}}const Jt=G*xe+j*pe+Z*De+ne*ie;m[Jt]=Fe}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const BX={kernelName:Vp,backendName:"cpu",kernelFunc:PX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VX(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r;Te([s,i],"conv3d");const u=zo(s.shape,i.shape,o,l,a),{filterDepth:c,filterHeight:h,filterWidth:f,dilationDepth:d,dilationHeight:p,dilationWidth:g,padInfo:m}=u,b=m.front,x=m.left,v=m.top,y=new kn(u.outShape,s.dtype),w=n.data.get(s.dataId).values,C=n.data.get(i.dataId).values,T=y.values,N=Re(s.shape),$=Re(i.shape);for(let _=0;_<u.batchSize;++_){const S=_*N[0],M=_*y.strides[0];for(let F=0;F<u.outDepth;++F){const A=M+F*y.strides[1],E=F*u.strideDepth-b;for(let D=0;D<c;++D){const P=E+D*d;if(P<0||P>=u.inDepth)continue;const z=D*$[0],B=S+P*N[1];for(let G=0;G<u.outHeight;++G){const j=A+G*y.strides[2],Z=G*u.strideHeight-v;for(let ne=0;ne<h;++ne){const le=Z+ne*p;if(le<0||le>=u.inHeight)continue;const oe=z+ne*$[1],de=B+le*N[2];for(let fe=0;fe<u.outWidth;++fe){const xe=j+fe*u.outChannels,ie=fe*u.strideWidth-x;for(let pe=0;pe<f;++pe){const ge=ie+pe*g;if(ge<0||ge>=u.inWidth)continue;const ae=oe+pe*$[2],Le=de+ge*u.inChannels;let De=ae;for(let qe=0;qe<u.inChannels;++qe){const Ue=w[Le+qe];for(let ve=0;ve<u.outChannels;++ve)T[xe+ve]+=Ue*C[De+ve];De+=u.outChannels}}}}}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const WX={kernelName:Wp,backendName:"cpu",kernelFunc:VX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UX(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:i}=e,{strides:o,pad:a,filterShape:l}=r;Te([s,i],"conv3dBackpropFilterV2");const u=Re(s.shape),c=Re(i.shape),h=zo(s.shape,l,o,1,a),f=h.strideDepth,d=h.strideHeight,p=h.strideWidth,g=h.filterDepth,m=h.filterHeight,b=h.filterWidth,x=new kn(h.filterShape,"float32"),v=x.values,[y,w,C,T]=x.strides,N=n.data.get(i.dataId).values,[$,_,S,M]=c,F=n.data.get(s.dataId).values,[A,E,D,P]=u,z=h.padInfo.front,B=h.padInfo.left,G=h.padInfo.top;for(let j=0;j<g;++j){const Z=Math.max(0,Math.ceil((z-j)/f)),ne=Math.min(h.outDepth,(h.inDepth+z-j)/f),le=j*y;for(let oe=0;oe<m;++oe){const de=Math.max(0,Math.ceil((G-oe)/d)),fe=Math.min(h.outHeight,(h.inHeight+G-oe)/d),xe=oe*w+le;for(let ie=0;ie<b;++ie){const pe=Math.max(0,Math.ceil((B-ie)/p)),ge=Math.min(h.outWidth,(h.inWidth+B-ie)/p),ae=ie*C+xe;for(let Le=0;Le<h.inChannels;++Le){const De=Le*T+ae;for(let qe=0;qe<h.outChannels;++qe){let Ue=0;for(let ve=0;ve<h.batchSize;++ve){const Fe=ve*A,Jt=ve*$;for(let xt=Z;xt<ne;++xt){const Tr=(j+xt*f-z)*E+Fe,Yo=xt*_+Jt;for(let ds=de;ds<fe;++ds){const Ji=(oe+ds*d-G)*D+Tr,Qi=ds*S+Yo;for(let eo=pe;eo<ge;++eo){const rg=(ie+eo*p-B)*P+Ji,sg=eo*M+Qi;Ue+=F[rg+Le]*N[sg+qe]}}}}v[De+qe]=Ue}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const GX={kernelName:z4,backendName:"cpu",kernelFunc:UX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HX(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:i}=e,{pad:o,strides:a,inputShape:l}=r;Te([s],"conv3dBackpropInputV2");const u=Re(s.shape),c=Re(i.shape),h=zo(l,i.shape,a,1,o),f=new kn(h.inShape,"float32"),d=f.values,[p,g,m,b]=f.strides,x=n.data.get(s.dataId).values,[v,y,w,C]=u,T=n.data.get(i.dataId).values,[N,$,_,S]=c,{batchSize:M,filterDepth:F,filterHeight:A,filterWidth:E,inChannels:D,inDepth:P,inHeight:z,inWidth:B,outChannels:G,outDepth:j,outHeight:Z,outWidth:ne,strideDepth:le,strideHeight:oe,strideWidth:de}=h,fe=F-1-h.padInfo.front,xe=A-1-h.padInfo.top,ie=E-1-h.padInfo.left;for(let pe=0;pe<M;++pe)for(let ge=0;ge<D;++ge)for(let ae=0;ae<P;++ae){const Le=ae-fe,De=Math.max(0,Math.ceil(Le/le)),qe=Math.min(j,(F+Le)/le);for(let Ue=0;Ue<z;++Ue){const ve=Ue-xe,Fe=Math.max(0,Math.ceil(ve/oe)),Jt=Math.min(Z,(A+ve)/oe);for(let xt=0;xt<B;++xt){const Zi=xt-ie,Tr=Math.max(0,Math.ceil(Zi/de)),Yo=Math.min(ne,(E+Zi)/de);let ds=0;for(let bi=De;bi<qe;++bi){const Ji=bi*le-Le;for(let Qi=Fe;Qi<Jt;++Qi){const eo=Qi*oe-ve;for(let Yu=Tr;Yu<Yo;++Yu){const rg=Yu*de-Zi,sg=v*pe+y*bi+w*Qi+C*Yu,jR=N*(F-1-Ji)+$*(A-1-eo)+_*(E-1-rg)+S*ge;for(let j0=0;j0<G;++j0){const KR=x[sg+j0],YR=T[jR+j0];ds+=KR*YR}}}}d[p*pe+g*ae+m*Ue+b*xt+ge]=ds}}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const qX={kernelName:P4,backendName:"cpu",kernelFunc:HX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XX=mt(Th,t=>Math.cos(t)),jX={kernelName:Th,backendName:"cpu",kernelFunc:XX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KX=mt(Nh,t=>Math.cosh(t)),YX={kernelName:Nh,backendName:"cpu",kernelFunc:KX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZX(t){const{inputs:e,backend:n,attrs:r}=t,{image:s,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=r,[c,h,f,d]=s.shape,p=i.shape[0],[g,m]=a,b=Qe([p,g,m,d],"float32"),x=n.data.get(i.dataId).values,v=n.data.get(o.dataId).values,y=n.data.get(s.dataId).values,w=Re(s.shape),C=Re(b.shape);for(let T=0;T<p;T++){const N=T*4,$=x[N],_=x[N+1],S=x[N+2],M=x[N+3],F=v[T];if(F>=c)continue;const A=g>1?(S-$)*(h-1)/(g-1):0,E=m>1?(M-_)*(f-1)/(m-1):0;for(let D=0;D<g;D++){const P=g>1?$*(h-1)+D*A:.5*($+S)*(h-1);if(P<0||P>h-1){for(let z=0;z<m;z++)for(let B=0;B<d;B++){const G=B+z*C[2]+D*C[1]+T*C[0];b.values[G]=u}continue}if(l==="bilinear"){const z=Math.floor(P),B=Math.ceil(P),G=P-z;for(let j=0;j<m;j++){const Z=m>1?_*(f-1)+j*E:.5*(_+M)*(f-1);if(Z<0||Z>f-1){for(let de=0;de<d;de++){const fe=de+j*C[2]+D*C[1]+T*C[0];b.values[fe]=u}continue}const ne=Math.floor(Z),le=Math.ceil(Z),oe=Z-ne;for(let de=0;de<d;de++){let fe=de+ne*w[2]+z*w[1]+F*w[0];const xe=y[fe];fe=de+le*w[2]+z*w[1]+F*w[0];const ie=y[fe];fe=de+ne*w[2]+B*w[1]+F*w[0];const pe=y[fe];fe=de+le*w[2]+B*w[1]+F*w[0];const ge=y[fe],ae=xe+(ie-xe)*oe,Le=pe+(ge-pe)*oe;fe=de+j*C[2]+D*C[1]+T*C[0],b.values[fe]=ae+(Le-ae)*G}}}else for(let z=0;z<m;++z){const B=m>1?_*(f-1)+z*E:.5*(_+M)*(f-1);if(B<0||B>f-1){for(let Z=0;Z<d;Z++){const ne=Z+z*C[2]+D*C[1]+T*C[0];b.values[ne]=u}continue}const G=Math.round(B),j=Math.round(P);for(let Z=0;Z<d;Z++){const ne=Z+G*w[2]+j*w[1]+F*w[0],le=Z+z*C[2]+D*C[1]+T*C[0];b.values[le]=y[ne]}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const JX={kernelName:V4,backendName:"cpu",kernelFunc:ZX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;Te(s,"cumprod");const l=Rt([i],s.shape.length);let u=s;l!=null&&(u=ar({inputs:{x:s},backend:n,attrs:{perm:l}}));const c=Xt(1,s.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=Cr(u.dtype,"int32"),f=I4(se(u.shape),h),d=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],g=a?(b,x)=>b+p-x-1:(b,x)=>b+x;for(let b=0;b<d.length;b+=p)for(let x=0;x<p;x++){const v=g(b,x);if(x===0)f[v]=o?1:d[v];else{const y=g(b,x-1);f[v]=o?d[y]*f[y]:d[v]*f[y]}}const m=n.makeTensorInfo(u.shape,h,f);if(l!=null){const b=Po(l),x=ar({inputs:{x:m},backend:n,attrs:{perm:b}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(u),x}return m}const ej={kernelName:B4,backendName:"cpu",kernelFunc:QX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tj(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;Te(s,"cumsum");const l=Rt([i],s.shape.length);let u=s;l!=null&&(u=ar({inputs:{x:s},backend:n,attrs:{perm:l}}));const c=Xt(1,s.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=Cr(u.dtype,"int32"),f=_n(se(u.shape),h),d=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],g=a?(b,x)=>b+p-x-1:(b,x)=>b+x;for(let b=0;b<d.length;b+=p)for(let x=0;x<p;x++){const v=g(b,x);if(x===0)f[v]=o?0:d[v];else{const y=g(b,x-1);f[v]=o?d[y]+f[y]:d[v]+f[y]}}const m=n.makeTensorInfo(u.shape,h,f);if(l!=null){const b=Po(l),x=ar({inputs:{x:m},backend:n,attrs:{perm:b}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(u),x}return m}const nj={kernelName:Up,backendName:"cpu",kernelFunc:tj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rj(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,weights:i}=e,{size:o,binaryOutput:a}=r;if(s.shape.length===1){const l=n.data.get(s.dataId).values,u=n.data.get(i.dataId).values,c=Xy(l,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}else if(s.shape.length===2){const l=n.bufferSync(s),u=n.bufferSync(i),c=EI(l,u,o,a);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const sj={kernelName:W4,backendName:"cpu",kernelFunc:rj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ij(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockSize:i,dataFormat:o}=r;L(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=s.shape[0],l=s.shape[1],u=s.shape[2],c=s.shape[3],h=l*i,f=u*i,d=c/(i*i),p=n.data.get(s.dataId).values,g=new Float32Array(a*h*f*d);let m=0;for(let b=0;b<a;++b)for(let x=0;x<h;++x){const v=Math.floor(x/i),y=x%i;for(let w=0;w<f;++w){const C=Math.floor(w/i),T=w%i,N=(y*i+T)*d;for(let $=0;$<d;++$){const S=$+N+c*(C+u*(v+l*b));g[m++]=p[S]}}}return n.makeTensorInfo([a,h,f,d],s.dtype,g)}const oj={kernelName:U4,backendName:"cpu",kernelFunc:ij};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E9(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=r;Te([s,i],"depthwiseConv2DNative");const c=Re(s.shape),h=Re(i.shape);let f=l;f==null&&(f=[1,1]),L(Rn(o,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${f}'`);const d=Cn(s.shape,i.shape,o,f,a,u,!0),{filterHeight:p,filterWidth:g,dilationHeight:m,dilationWidth:b,padInfo:x}=d,v=x.left,y=x.top,w=d.outChannels/d.inChannels,C=new kn(d.outShape,s.dtype),T=n.data.get(s.dataId).values,N=n.data.get(i.dataId).values,$=C.values;for(let _=0;_<d.batchSize;++_){const S=_*c[0],M=_*C.strides[0];for(let F=0;F<d.outHeight;++F){const A=M+F*C.strides[1],E=F*d.strideHeight-y;for(let D=0;D<p;++D){const P=E+D*m;if(P<0||P>=d.inHeight)continue;const z=D*h[0],B=S+P*c[1];for(let G=0;G<d.outWidth;++G){const j=A+G*C.strides[2],Z=G*d.strideWidth-v;for(let ne=0;ne<g;++ne){const le=Z+ne*b;if(le<0||le>=d.inWidth)continue;const oe=z+ne*h[1],de=B+le*d.inChannels;let fe=j,xe=oe;for(let ie=0;ie<d.inChannels;++ie){const pe=T[de+ie];for(let ge=0;ge<w;++ge)$[fe+ge]+=pe*N[xe+ge];fe+=w,xe+=w}}}}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const aj={kernelName:Gp,backendName:"cpu",kernelFunc:E9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lj(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=r;Te([s,i],"depthwiseConv2dNativeBackpropFilter");const h=Cn(s.shape,c,o,a,l,u,!0),{strideHeight:f,strideWidth:d,filterHeight:p,filterWidth:g}=h,m=new kn(h.filterShape,"float32"),b=h.padInfo.left,x=h.padInfo.top,v=h.outChannels/h.inChannels,y=n.data.get(s.dataId).values,w=new kn(s.shape,s.dtype,y),C=n.data.get(i.dataId).values,T=new kn(i.shape,i.dtype,C);for(let N=0;N<p;++N){const $=Math.max(0,Math.ceil((x-N)/f)),_=Math.min(h.outHeight,(h.inHeight+x-N)/f);for(let S=0;S<g;++S){const M=Math.max(0,Math.ceil((b-S)/d)),F=Math.min(h.outWidth,(h.inWidth+b-S)/d);for(let A=0;A<h.outChannels;++A){const E=Math.trunc(A/v),D=A%v;let P=0;for(let z=0;z<h.batchSize;++z)for(let B=$;B<_;++B){const G=N+B*f-x;for(let j=M;j<F;++j){const Z=S+j*d-b;P+=w.get(z,G,Z,E)*T.get(z,B,j,A)}}m.set(P,N,S,E,D)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const uj={kernelName:G4,backendName:"cpu",kernelFunc:lj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cj(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=r;Te([s,i],"depthwiseConv2DNativeBackpropInput");const h=Re(s.shape),f=Re(i.shape),d=Cn(c,i.shape,o,a,l,u,!0),p=new kn(d.inShape,"float32"),g=p.values,[m,b,x]=p.strides,v=n.data.get(s.dataId).values,[y,w,C]=h,T=n.data.get(i.dataId).values,[N,$,_]=f,{batchSize:S,filterHeight:M,filterWidth:F,inChannels:A,inHeight:E,inWidth:D,outChannels:P,outHeight:z,outWidth:B,strideHeight:G,strideWidth:j}=d,Z=M-1-d.padInfo.top,ne=F-1-d.padInfo.left,le=P/A;for(let oe=0;oe<S;++oe)for(let de=0;de<A;++de)for(let fe=0;fe<E;++fe){const xe=fe-Z,ie=Math.max(0,Math.ceil(xe/G)),pe=Math.min(z,(M+xe)/G);for(let ge=0;ge<D;++ge){const ae=ge-ne,Le=Math.max(0,Math.ceil(ae/j)),De=Math.min(B,(F+ae)/j);let qe=0;for(let Ue=ie;Ue<pe;++Ue){const ve=Ue*G-xe;for(let Fe=Le;Fe<De;++Fe){const Jt=Fe*j-ae,xt=y*oe+w*Ue+C*Fe,Zi=N*(M-1-ve)+$*(F-1-Jt)+_*de;for(let Tr=0;Tr<le;++Tr){const Yo=de*le+Tr,ds=v[xt+Yo],bi=T[Zi+Tr];qe+=ds*bi}}}g[m*oe+b*fe+x*ge+de]=qe}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const hj={kernelName:H4,backendName:"cpu",kernelFunc:cj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fj(t){const{inputs:e,backend:n}=t,{x:r}=e,s=se(r.shape),i=n.data.get(r.dataId).values,o=Qe([s,s],r.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*s+u]=i[u];const l=[...r.shape,...r.shape];return n.makeTensorInfo(l,o.dtype,o.values)}const dj={kernelName:ik,backendName:"cpu",kernelFunc:fj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pj={kernelName:Hp,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:s}=t,{strides:i,pad:o,dilations:a}=n,l=e,u=l.data.get(r.dataId).values,c=r.shape.length,h=l.data.get(s.dataId).values,f=s.shape.length,{batchSize:d,inHeight:p,inWidth:g,inChannels:m,outHeight:b,outWidth:x,padInfo:v,strideHeight:y,strideWidth:w,filterHeight:C,filterWidth:T,dilationHeight:N,dilationWidth:$,outShape:_}=f0(r.shape,s.shape,i,o,"NHWC",a),S=se(_),M=_.length,F=Gt(r.dtype,S);for(let E=0;E<d;++E)for(let D=0;D<b;++D){const P=D*y-v.top;for(let z=0;z<x;++z){const B=z*w-v.left;for(let G=0;G<m;++G){let j=Number.MIN_SAFE_INTEGER;for(let ne=0;ne<C;++ne){const le=P+ne*N;if(le>=0&&le<p)for(let oe=0;oe<T;++oe){const de=B+oe*$;if(de>=0&&de<g){const fe=Xs([E,le,de,G],c,Re(r.shape)),xe=Xs([ne,oe,G],f,Re(s.shape)),ie=u[fe]+h[xe];ie>j&&(j=ie)}}}const Z=Xs([E,D,z,G],M,Re(_));F[Z]=j}}}return{dataId:l.write(tl(F,r.dtype),_,r.dtype),shape:_,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mj={kernelName:L2,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:s,dy:i}=t,{strides:o,pad:a,dilations:l}=n,u=e,c=ks(r.shape,u.data.get(r.dataId).values),h=ks(s.shape,u.data.get(s.dataId).values),{batchSize:f,inHeight:d,inWidth:p,inChannels:g,outHeight:m,outWidth:b,padInfo:x,strideHeight:v,strideWidth:y,filterHeight:w,filterWidth:C,dilationHeight:T,dilationWidth:N,outShape:$}=f0(r.shape,s.shape,o,a,"NHWC",l);L(i.rank===$.length,()=>`Error in ${L2}, dy must have the same rank as output ${$.length}, but got ${i.rank}`);const _=ks($,u.data.get(i.dataId).values),S=tk(s.shape,s.dtype);for(let F=0;F<f;++F)for(let A=0;A<m;++A){const E=A*v-x.top;for(let D=0;D<b;++D){const P=D*y-x.left;for(let z=0;z<g;++z){let B=Number.MIN_SAFE_INTEGER,G=0,j=0;for(let Z=0;Z<w;++Z){const ne=E+Z*T;if(ne>=0&&ne<d)for(let le=0;le<C;++le){const oe=P+le*N;if(oe>=0&&oe<p){const de=c[F][ne][oe][z]+h[Z][le][z];de>B&&(B=de,G=Z,j=le)}}}S[G][j][z]+=_[F][A][D][z]}}}return{dataId:u.write(tl(S,r.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gj={kernelName:O2,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:s,dy:i}=t,{strides:o,pad:a,dilations:l}=n,u=e,c=ks(r.shape,u.data.get(r.dataId).values),h=ks(s.shape,u.data.get(s.dataId).values),{batchSize:f,inHeight:d,inWidth:p,inChannels:g,outHeight:m,outWidth:b,padInfo:x,strideHeight:v,strideWidth:y,filterHeight:w,filterWidth:C,dilationHeight:T,dilationWidth:N,outShape:$}=f0(r.shape,s.shape,o,a,"NHWC",l);L(i.rank===$.length,()=>`Error in ${O2}, dy must have the same rank as output ${$.length}, but got ${i.rank}`);const _=ks($,u.data.get(i.dataId).values),S=tk(r.shape,r.dtype);for(let F=0;F<f;++F)for(let A=0;A<m;++A){const E=A*v-x.top;for(let D=0;D<b;++D){const P=D*y-x.left;for(let z=0;z<g;++z){let B=Number.MIN_SAFE_INTEGER,G=E<0?0:E,j=P<0?0:P;for(let Z=0;Z<w;++Z){const ne=E+Z*T;if(ne>=0&&ne<d)for(let le=0;le<C;++le){const oe=P+le*N;if(oe>=0&&oe<p){const de=c[F][ne][oe][z]+h[Z][le][z];de>B&&(B=de,G=ne,j=oe)}}}S[F][G][j][z]+=_[F][A][D][z]}}}return{dataId:u.write(tl(S,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bj(t){const{inputs:e,backend:n,attrs:r}=t,{image:s}=e,{canvas:i,options:o}=r,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=i.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${c} type.`);const[f,d]=s.shape.slice(0,2),p=s.shape.length===2?1:s.shape[2],g=n.data.get(s.dataId).values,m=s.dtype==="float32"?255:1,b=new Uint8ClampedArray(d*f*4);for(let v=0;v<f*d;++v){const y=[0,0,0,255*u];for(let C=0;C<p;C++){const T=g[v*p+C];if(s.dtype==="float32"){if(T<0||T>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${T}.`)}else if(s.dtype==="int32"&&(T<0||T>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${T}.`);p===1?(y[0]=T*m,y[1]=T*m,y[2]=T*m):y[C]=T*m}const w=v*4;b[w+0]=Math.round(y[0]),b[w+1]=Math.round(y[1]),b[w+2]=Math.round(y[2]),b[w+3]=Math.round(y[3])}i.width=d,i.height=f;const x=new ImageData(b,d,f);return h.putImageData(x,0,0),s}const xj={kernelName:cM,backendName:"cpu",kernelFunc:bj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T0(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r;Te(s,"sum");let a;s.dtype==="bool"?a=$o({inputs:{x:s},backend:n,attrs:{dtype:"int32"}}):a=si({inputs:{x:s},backend:n});const l=a.shape.length,u=et(i,a.shape),c=Rt(u,l);let h=u,f=a;c!=null&&(f=ar({inputs:{x:a},backend:n,attrs:{perm:c}}),h=Xt(h.length,l)),$n("sum",h,f.shape.length);const[d,p]=xn(f.shape,h),g=Cr(f.dtype,"int32");let m=Td(n,d,g);const b=se(p),x=n.data.get(m.dataId).values,v=n.data.get(f.dataId).values;for(let y=0;y<x.length;++y){const w=y*b;let C=0;for(let T=0;T<b;++T)C+=v[w+T];x[y]=C}if(o){const y=qt(m.shape,u),w=m;m=Ct({inputs:{x:m},backend:n,attrs:{shape:y}}),n.disposeIntermediateTensorInfo(w)}return n.disposeIntermediateTensorInfo(a),c!=null&&n.disposeIntermediateTensorInfo(f),m}const yj={kernelName:C1,backendName:"cpu",kernelFunc:T0};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vj(t){const{inputs:e,backend:n,attrs:r}=t,{equation:s}=r,i=e,{allDims:o,summedDims:a,idDims:l}=gy(s,i.length);xy(o.length,l,i);const{path:u,steps:c}=yy(a,l),h=c.length;let f=null,d=o.length;const p=[];for(let g=0;g<h;++g){for(const m of c[g]){const{permutationIndices:b,expandDims:x}=by(d,l[m]);let v;vy(b)?v=i[m]:(v=ar({inputs:{x:i[m]},backend:n,attrs:{perm:b}}),p.push(v));const y=v.shape.slice();for(let w=0;w<x.length;++w)y.splice(x[w],0,1);ft(v.shape,y)||(v=Ct({inputs:{x:v},backend:n,attrs:{shape:y}}),p.push(v)),f===null?f=v:(f=nm({inputs:{a:v,b:f},backend:n}),p.push(f))}g<h-1&&(u[g]>=0&&(f=T0({inputs:{x:f},backend:n,attrs:{axis:u[g]-(o.length-d),keepDims:!1}}),p.push(f)),d--)}for(const g of p)g!==f&&n.disposeIntermediateTensorInfo(g);return f}const wj={kernelName:q4,backendName:"cpu",kernelFunc:vj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kj(t){const{inputs:e,backend:n}=t,{dy:r,y:s}=e;Te([r,s],"eluGrad");const i=new Float32Array(se(s.shape)),o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return n.makeTensorInfo(s.shape,"float32",i)}const Sj={kernelName:X4,backendName:"cpu",kernelFunc:kj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cj=uy,$j=cy,Ij=hy,Tj=fy,Nj=dy,_j=py,Aj=mt(Eh,t=>{const e=Math.sign(t),n=Math.abs(t),r=1/(1+Cj*n);return e*(1-((((_j*r+Nj)*r+Tj)*r+Ij)*r+$j)*r*Math.exp(-n*n))}),Ej={kernelName:Eh,backendName:"cpu",kernelFunc:Aj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ad(t){const{inputs:e,backend:n,attrs:r}=t,{input:s}=e,{dim:i}=r,o=s.shape.length,a=s.shape.slice();let l=i;return i<0&&(L(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),Ct({inputs:{x:s},backend:n,attrs:{shape:a}})}const Rj={kernelName:Xp,backendName:"cpu",kernelFunc:Ad};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dj=Kt((t,e)=>t/e),Qy=un(_h,Dj),ub={kernelName:_h,backendName:"cpu",kernelFunc:Qy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R9(t,e,n){const r=t.shape,s=r[0],i=r[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[s,i],c=se(u),h=Nn("float32",c),f=Nn("float32",c);for(let m=0;m<s;m++){const b=za({inputs:{x:a},backend:n,attrs:{begin:[m,0],size:[1,i]}}),x=za({inputs:{x:l},backend:n,attrs:{begin:[m,0],size:[1,i]}}),v=kr({inputs:{real:b,imag:x},backend:n}),{real:y,imag:w}=Mj(v,e,n),C=Oi(y,w);for(let T=0;T<i;T++){const N=my(C,T);h[m*i+T]=N.real,f[m*i+T]=N.imag}n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(v)}const d=n.makeTensorInfo(u,"float32",h),p=n.makeTensorInfo(u,"float32",f),g=kr({inputs:{real:d,imag:p},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),g}function Mj(t,e,n){const r=se(t.shape),s=n.data.get(t.dataId),i=n.data.get(s.complexTensorInfos.real.dataId).values,o=n.data.get(s.complexTensorInfos.imag.dataId).values;if(Fj(r)){const a=cb(i,o,r,e,n),l=[t.shape[0],t.shape[1]];if(e){const u=n.makeTensorInfo(l,"float32",a.real),c=n.makeTensorInfo(l,"float32",a.imag),h=n.makeTensorInfo([],"float32",Oo(r,"float32")),f=si({inputs:{x:h},backend:n}),d=ub.kernelFunc({inputs:{a:u,b:h},backend:n}),p=ub.kernelFunc({inputs:{a:c,b:f},backend:n}),g=n.data.get(d.dataId).values,m=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),{real:g,imag:m}}return a}else{const a=Oi(i,o),l=Oj(a,r,e);return qS(l)}}function Fj(t){return(t&t-1)===0}function cb(t,e,n,r,s){if(n===1)return{real:t,imag:e};const i=Oi(t,e),o=n/2,a=XS(i),l=a.real,u=a.imag,c=[l.length],h=s.makeTensorInfo(c,"float32",l),f=s.makeTensorInfo(c,"float32",u),d=kr({inputs:{real:h,imag:f},backend:s}),p=jS(i),g=p.real,m=p.imag,b=[g.length],x=s.makeTensorInfo(b,"float32",g),v=s.makeTensorInfo(b,"float32",m),y=kr({inputs:{real:x,imag:v},backend:s}),w=cb(l,u,o,r,s),C=w.real,T=w.imag,N=[C.length],$=s.makeTensorInfo(N,"float32",C),_=s.makeTensorInfo(N,"float32",T),S=kr({inputs:{real:$,imag:_},backend:s}),M=cb(g,m,o,r,s),F=M.real,A=M.imag,E=[F.length],D=s.makeTensorInfo(E,"float32",F),P=s.makeTensorInfo(E,"float32",A),z=kr({inputs:{real:D,imag:P},backend:s}),B=YS(n,r),G=[B.real.length],j=s.makeTensorInfo(G,"float32",B.real),Z=s.makeTensorInfo(G,"float32",B.imag),ne=kr({inputs:{real:j,imag:Z},backend:s}),le=nm({inputs:{a:ne,b:z},backend:s}),oe=nu({inputs:{a:S,b:le},backend:s}),de=Zy({inputs:{a:S,b:le},backend:s}),fe=La({inputs:{input:oe},backend:s}),xe=La({inputs:{input:de},backend:s}),ie=ru({inputs:{input:oe},backend:s}),pe=ru({inputs:{input:de},backend:s}),ge=su({inputs:[fe,xe],backend:s,attrs:{axis:0}}),ae=su({inputs:[ie,pe],backend:s,attrs:{axis:0}}),Le=s.data.get(ge.dataId).values,De=s.data.get(ae.dataId).values;return s.disposeIntermediateTensorInfo(h),s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(x),s.disposeIntermediateTensorInfo(v),s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo($),s.disposeIntermediateTensorInfo(_),s.disposeIntermediateTensorInfo(S),s.disposeIntermediateTensorInfo(D),s.disposeIntermediateTensorInfo(P),s.disposeIntermediateTensorInfo(z),s.disposeIntermediateTensorInfo(j),s.disposeIntermediateTensorInfo(Z),s.disposeIntermediateTensorInfo(ne),s.disposeIntermediateTensorInfo(le),s.disposeIntermediateTensorInfo(oe),s.disposeIntermediateTensorInfo(de),s.disposeIntermediateTensorInfo(fe),s.disposeIntermediateTensorInfo(ie),s.disposeIntermediateTensorInfo(xe),s.disposeIntermediateTensorInfo(pe),s.disposeIntermediateTensorInfo(ge),s.disposeIntermediateTensorInfo(ae),{real:Le,imag:De}}function Oj(t,e,n){const r=new Float32Array(e*2);for(let s=0;s<e;s++){let i=0,o=0;for(let a=0;a<e;a++){const l=ZS(s*a,e,n),u=my(t,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}n&&(i/=e,o/=e),KS(r,i,o,s)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lj(t){const{inputs:e,backend:n}=t,{input:r}=e,s=se(r.shape),i=r.shape[r.shape.length-1],o=s/i,a=Ct({inputs:{x:r},backend:n,attrs:{shape:[o,i]}}),l=R9(a,!1,n),u=Ct({inputs:{x:l},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const zj={kernelName:j4,backendName:"cpu",kernelFunc:Lj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ev(t){const{backend:e,attrs:n}=t,{shape:r,value:s,dtype:i}=n,o=i||Nu(s),a=Gt(o,se(r));return Bj(a,s,o),e.makeTensorInfo(r,o,a)}const Pj={kernelName:K4,backendName:"cpu",kernelFunc:ev};function Bj(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vj={kernelName:Y4,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,s=n,i=Nn(r.dtype,se(r.shape)),[o,a,l,u]=r.shape,c=s.data.get(r.dataId).values;for(let f=0;f<o;f++){const d=f*l*a*u;for(let p=0;p<a;p++){const g=p*(l*u);for(let m=0;m<l;m++){const b=m*u;for(let x=0;x<u;x++){const v=Math.round(l-m-1),y=d+g+b+x;let w=c[y];if(v>=0&&v<l){const C=v*u,T=d+g+C+x;w=c[T]}i[y]=w}}}}return{dataId:s.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wj(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=r;let g=A9({inputs:{x:s,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:f}});if(o){const m=g;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const b=Ct({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});g=nu({inputs:{a:g,b},backend:n}),n.disposeIntermediateTensorInfo(b)}else g=nu({inputs:{a:g,b:o},backend:n});n.disposeIntermediateTensorInfo(m)}if(d){const m=g;if(c==="NCHW"&&d==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const b=Ct({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});g=_d(n,g,d,b,p),n.disposeIntermediateTensorInfo(b)}else g=_d(n,g,d,a,p);n.disposeIntermediateTensorInfo(m)}return g}const Uj={kernelName:ud,backendName:"cpu",kernelFunc:Wj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gj(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=r;let g=E9({inputs:{x:s,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:f}});if(o){const m=g;g=nu({inputs:{a:g,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(d){const m=g;g=_d(n,g,d,a,p),n.disposeIntermediateTensorInfo(m)}return g}const Hj={kernelName:Sk,backendName:"cpu",kernelFunc:Gj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qj(t){const{inputs:e,backend:n}=t,{params:r,indices:s}=e,i=se(r.shape),o=s.shape,a=o[o.length-1],[l,u,c,h]=Jx(r,s);if(u===0)return n.makeTensorInfo(l,r.dtype,[]);const f=n.data.get(s.dataId).values,d=n.bufferSync(r),p=WI(f,d,r.dtype,u,a,c,h,r.shape,i);return n.makeTensorInfo(l,r.dtype,p.values)}const Xj={kernelName:ok,backendName:"cpu",kernelFunc:qj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jj(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,indices:i}=e,{axis:o,batchDims:a}=r;Te([s,i],"gatherV2");const l=et(o,s.shape)[0],u=n.data.get(i.dataId).values,c=s.shape[l];for(let y=0;y<u.length;++y){const w=u[y];L(w<=c-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${c-1}]`)}let h=a;a==null&&(h=0);const f=se(i.shape),d=ky(s,i,l,h),p=Ct({inputs:{x:s},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),g=Ct({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,f/d.batchSize]}}),m=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize],b=n.bufferSync(g),x=n.bufferSync(p),v=UI(x,b,m);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(d.outputShape,v.dtype,v.values)}const Kj={kernelName:Kp,backendName:"cpu",kernelFunc:jj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yj(t){const{inputs:e,backend:n}=t,{input:r}=e,s=se(r.shape),i=r.shape[r.shape.length-1],o=s/i,a=Ct({inputs:{x:r},backend:n,attrs:{shape:[o,i]}}),l=R9(a,!0,n),u=Ct({inputs:{x:l},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const Zj={kernelName:Z4,backendName:"cpu",kernelFunc:Yj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jj=mt(zh,t=>Number.isFinite(t)?1:0,"bool"),Qj={kernelName:zh,backendName:"cpu",kernelFunc:Jj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eK=mt(Ph,t=>Math.abs(t)===1/0?1:0,"bool"),tK={kernelName:Ph,backendName:"cpu",kernelFunc:eK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nK=mt(Bh,t=>Number.isNaN(t)?1:0,"bool"),rK={kernelName:Bh,backendName:"cpu",kernelFunc:nK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sK(t){const{backend:e,attrs:n}=t,{start:r,stop:s,num:i}=n,o=jI(r,s,i);return e.makeTensorInfo([o.length],"float32",o)}const iK={kernelName:Q4,backendName:"cpu",kernelFunc:sK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oK=mt(Wh,t=>Math.log1p(t)),aK={kernelName:Wh,backendName:"cpu",kernelFunc:oK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lK=Kt((t,e)=>t&&e),uK=un(e1,lK,null,"bool"),cK={kernelName:e1,backendName:"cpu",kernelFunc:uK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hK=mt(t1,t=>t?0:1,"bool"),fK={kernelName:t1,backendName:"cpu",kernelFunc:hK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dK=Kt((t,e)=>t||e),pK=un(n1,dK,null,"bool"),mK={kernelName:n1,backendName:"cpu",kernelFunc:pK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gK(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=r;Te(s,"LRN");const u=s.shape[3],c=u-1,h=n.data.get(s.dataId).values,f=se(s.shape),d=new Float32Array(f);function p(g){const m=g%u;let b=g-m+Math.max(0,m-i);const x=g-m+Math.min(m+i,c);let v=0;for(;b<=x;b++){const y=h[b];v+=y*y}return v}for(let g=0;g<f;g++){const m=p(g),b=h[g]*Math.pow(o+a*m,-l);d[g]=b}return n.makeTensorInfo(s.shape,s.dtype,d)}const bK={kernelName:r1,backendName:"cpu",kernelFunc:gK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xK(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=r;Te(o,"LRNGrad");const h=se(o.shape),f=o.shape[3],d=n.data.get(o.dataId).values,p=n.data.get(s.dataId).values,g=n.data.get(i.dataId).values,m=new Float32Array(h),b=h;for(let x=0;x<b;x++){const v=x%f,y=x-v+Math.max(0,v-a),w=x-v+Math.min(f,v+a+1);let C=0;for(let T=y;T<w;T++)C+=Math.pow(p[T],2);C=u*C+l;for(let T=y;T<w;T++){let N=-2*u*c*p[T]*g[x]/C;x===T&&(N+=Math.pow(C,-c)),N*=d[x],m[T]+=N}}return n.makeTensorInfo(o.shape,s.dtype,m)}const yK={kernelName:ex,backendName:"cpu",kernelFunc:xK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D9(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{reductionIndices:i,keepDims:o}=r,a=n;let l=s.shape;const u=l.length,c=et(i,l);let h=c;const f=Rt(h,u);let d=a.data.get(s.dataId).values;if(f!=null){const y=new Array(u);for(let w=0;w<y.length;w++)y[w]=l[f[w]];d=Ky(d,l,s.dtype,f,y),h=Xt(h.length,u),l=y}Te(s,"max"),$n("max",h,u);const[p,g]=xn(l,h),m=se(g),b=YI(d,m,p,s.dtype),x=a.write(b,p,s.dtype);let v=p;return o&&(v=qt(p,c)),{dataId:x,shape:v,dtype:s.dtype}}const vK={kernelName:s1,backendName:"cpu",kernelFunc:D9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wK(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e;Te(s,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;L(Rn(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=us(s.shape,i,o,u,a,l);let h;if(c.filterWidth===1&&c.filterHeight===1&&ft(c.inShape,c.outShape))h=si({inputs:{x:s},backend:n});else{const f=n.data.get(s.dataId).values,d=Re(s.shape),p=Jy(f,s.shape,s.dtype,d,c,"max");h=n.makeTensorInfo(c.outShape,s.dtype,p.values)}return h}const kK={kernelName:i1,backendName:"cpu",kernelFunc:wK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SK(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=r;Te(s,"maxPool3d");const c=Ui(s.shape,i,o,1,a,l,u),h=n.data.get(s.dataId).values,f=_9(h,s.shape,s.dtype,Re(s.shape),c,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}const CK={kernelName:o1,backendName:"cpu",kernelFunc:SK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $K(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=r;Te([s,i],"maxPool3DGrad");const c=Ui(i.shape,o,a,1,l,u),h=n.bufferSync(i),f=dX(h,c),d=c.strideDepth,p=c.strideHeight,g=c.strideWidth,m=c.dilationDepth,b=c.dilationHeight,x=c.dilationWidth,v=c.effectiveFilterDepth,y=c.effectiveFilterHeight,w=c.effectiveFilterWidth,C=v-1-c.padInfo.front,T=w-1-c.padInfo.left,N=y-1-c.padInfo.top,$=Qe(i.shape,"float32"),_=n.bufferSync(s);for(let S=0;S<c.batchSize;++S)for(let M=0;M<c.inChannels;++M)for(let F=0;F<c.inDepth;++F)for(let A=0;A<c.inHeight;++A)for(let E=0;E<c.inWidth;++E){const D=F-C,P=A-N,z=E-T;let B=0;for(let G=0;G<v;G+=m){const j=(D+G)/d;if(!(j<0||j>=c.outDepth||Math.floor(j)!==j))for(let Z=0;Z<y;Z+=b){const ne=(P+Z)/p;if(!(ne<0||ne>=c.outHeight||Math.floor(ne)!==ne))for(let le=0;le<w;le+=x){const oe=(z+le)/g;if(oe<0||oe>=c.outWidth||Math.floor(oe)!==oe)continue;const de=v*y*w-1-f.get(S,j,ne,oe,M),fe=G*y*w+Z*w+le,xe=de===fe?1:0;if(xe===0)continue;const ie=_.get(S,j,ne,oe,M);B+=ie*xe}}}$.set(B,S,F,A,E,M)}return n.makeTensorInfo($.shape,$.dtype,$.values)}const IK={kernelName:nx,backendName:"cpu",kernelFunc:$K};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TK(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:i,output:o}=e,a=i;Te([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=r,f=us(a.shape,l,u,1,c,h),d=n.data.get(a.dataId).values,p=Qe(f.outShape,a.dtype,N9(d,a.shape,a.dtype,f).values),g=f.strideHeight,m=f.strideWidth,b=f.dilationHeight,x=f.dilationWidth,v=f.effectiveFilterHeight,y=f.effectiveFilterWidth,w=y-1-f.padInfo.left,C=v-1-f.padInfo.top,T=Qe(a.shape,"float32"),N=n.data.get(s.dataId).values,$=Qe(s.shape,"float32",N);for(let _=0;_<f.batchSize;++_)for(let S=0;S<f.inChannels;++S)for(let M=0;M<f.inHeight;++M)for(let F=0;F<f.inWidth;++F){const A=M-C,E=F-w;let D=0;for(let P=0;P<v;P+=b){const z=(A+P)/g;if(!(z<0||z>=f.outHeight||Math.floor(z)!==z))for(let B=0;B<y;B+=x){const G=(E+B)/m;if(G<0||G>=f.outWidth||Math.floor(G)!==G)continue;const j=v*y-1-p.get(_,z,G,S),Z=P*y+B,ne=j===Z?1:0;if(ne===0)continue;const le=$.get(_,z,G,S);D+=le*ne}}T.set(D,_,M,F,S)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const NK={kernelName:tx,backendName:"cpu",kernelFunc:TK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _K(t,e,n,r,s){const i=Re(e),o=Jy(t,e,n,i,s,"max"),a=N9(t,e,n,s,!0,r);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AK={kernelName:ak,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:s,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;Te(r,"MaxPoolWithArgmax");const u=l.data.get(r.dataId).values,c=us(r.shape,s,i,[1,1],o),[h,f]=_K(u,r.shape,r.dtype,a,c),d=l.write(h,c.outShape,r.dtype),p=l.write(f,c.outShape,r.dtype);return[{dataId:d,shape:c.outShape,dtype:r.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EK(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r,a=et(i,s.shape),u=xn(s.shape,a)[1],c=se(u),h=[],f=n.makeTensorInfo([],"float32",new Float32Array([c]));h.push(f);const d=$o({inputs:{x:s},backend:n,attrs:{dtype:"float32"}});h.push(d);const p=Qy({inputs:{a:d,b:f},backend:n});h.push(p);const g=T0({inputs:{x:p},backend:n,attrs:{axis:i,keepDims:o}});return h.forEach(m=>n.disposeIntermediateTensorInfo(m)),g}const RK={kernelName:a1,backendName:"cpu",kernelFunc:EK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DK(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r;Te(s,"min");const a=et(i,s.shape);let l=a;const u=Rt(l,s.shape.length);let c=s;u!=null&&(c=ar({inputs:{x:s},backend:n,attrs:{perm:u}}),l=Xt(l.length,s.shape.length)),$n("min",l,c.shape.length);const[h,f]=xn(c.shape,l),d=se(f),p=_n(se(h),c.dtype),g=n.data.get(c.dataId).values;for(let b=0;b<p.length;++b){const x=b*d;let v=g[x];for(let y=0;y<d;++y){const w=g[x+y];(Number.isNaN(w)||w<v)&&(v=w)}p[b]=v}u!=null&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(h,c.dtype,p);if(o){const b=qt(h,a),x=Ct({inputs:{x:m},backend:n,attrs:{shape:b}});return n.disposeIntermediateTensorInfo(m),x}return m}const MK={kernelName:l1,backendName:"cpu",kernelFunc:DK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FK(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{paddings:i,mode:o}=r;Te(s,"mirrorPad");const a=i.map((v,y)=>v[0]+s.shape[y]+v[1]),l=i.map(v=>v[0]),u=i.map((v,y)=>v[0]+s.shape[y]),c=o==="reflect"?0:1,h=n.data.get(s.dataId).values,f=s.shape.length,d=Re(s.shape),p=se(a),g=a.length,m=Re(a),b=Nn(s.dtype,p);for(let v=0;v<p;v++){let y=_u(v,g,m);for(let C=0;C<g;C++)y[C]<l[C]?y[C]=l[C]*2-y[C]-c:y[C]>=u[C]&&(y[C]=(u[C]-1)*2-y[C]+c);y=y.map((C,T)=>C-l[T]);const w=Xs(y,f,d);b[v]=h[w]}return{dataId:n.write(b,a,s.dtype),shape:a,dtype:s.dtype}}const OK={kernelName:u1,backendName:"cpu",kernelFunc:FK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LK=Kt((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),zK=un(Hh,LK),PK={kernelName:Hh,backendName:"cpu",kernelFunc:zK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M9(t){const{inputs:e,backend:n,attrs:r}=t,{logits:s}=e,{dim:i}=r,o=s.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=et([a],s.shape),u=D9({inputs:{x:s},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=qt(u.shape,l),h=Ct({inputs:{x:u},backend:n,attrs:{shape:c}}),f=Zy({inputs:{a:s,b:h},backend:n}),d=zI({inputs:{x:f},backend:n}),p=T0({inputs:{x:d},backend:n,attrs:{axis:l,keepDims:!1}}),g=Ct({inputs:{x:p},backend:n,attrs:{shape:c}}),m=Qy({inputs:{a:d,b:g},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}const BK={kernelName:T1,backendName:"cpu",kernelFunc:M9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VK(t){const{inputs:e,backend:n,attrs:r}=t,{logits:s}=e,{numSamples:i,seed:o,normalized:a}=r;Te(s,"multinomial");const l=a?s:M9({inputs:{logits:s},backend:n,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],h=n.data.get(l.dataId).values,f=[u,i],d=_n(se(f),"int32");for(let p=0;p<u;++p){const g=p*c,m=new Float32Array(c-1);m[0]=h[g];for(let v=1;v<m.length;++v)m[v]=m[v-1]+h[g+v];const b=Lx.alea(o.toString()),x=p*i;for(let v=0;v<i;++v){const y=b();d[x+v]=m.length;for(let w=0;w<m.length;w++)if(y<m[w]){d[x+v]=w;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(f,"int32",d)}const WK={kernelName:lk,backendName:"cpu",kernelFunc:VK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UK=qx;function GK(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r;Te(s,"NonMaxSuppression");const u=n.data.get(s.dataId).values,c=n.data.get(i.dataId).values,{selectedIndices:h}=UK(u,c,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const HK={kernelName:rx,backendName:"cpu",kernelFunc:GK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qK=Xx;function XK(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=r;Te(s,"NonMaxSuppressionPadded");const c=n.data.get(s.dataId).values,h=n.data.get(i.dataId).values,{selectedIndices:f,validOutputs:d}=qK(c,h,o,a,l,u);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const jK={kernelName:sx,backendName:"cpu",kernelFunc:XK};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KK=jx;function YK(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=r;Te(s,"NonMaxSuppressionWithScore");const c=n.data.get(s.dataId).values,h=n.data.get(i.dataId).values,f=o,d=a,p=l,g=u,{selectedIndices:m,selectedScores:b}=KK(c,h,f,d,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const ZK={kernelName:ix,backendName:"cpu",kernelFunc:YK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(t){const{inputs:e,backend:n,attrs:r}=t,{indices:s}=e,{dtype:i,depth:o,onValue:a,offValue:l}=r;Te(s,"oneHot");const u=se(s.shape),c=new Float32Array(u*o);c.fill(l);const h=n.data.get(s.dataId).values;for(let f=0;f<u;++f)h[f]>=0&&h[f]<o&&(c[f*o+h[f]]=a);return n.makeTensorInfo([...s.shape,o],i,c)}const QK={kernelName:d1,backendName:"cpu",kernelFunc:JK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ed(t){const{inputs:e,backend:n}=t,{x:r}=e;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const s=La({inputs:{input:r},backend:n}),i=Ed({inputs:{x:s},backend:n}),o=ru({inputs:{input:r},backend:n}),a=Ed({inputs:{x:o},backend:n}),l=kr({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return ev({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const eY={kernelName:A1,backendName:"cpu",kernelFunc:Ed};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F9(t){const{inputs:e,backend:n}=t,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const s=La({inputs:{input:r},backend:n}),i=F9({inputs:{x:s},backend:n}),o=ru({inputs:{input:r},backend:n}),a=Ed({inputs:{x:o},backend:n}),l=kr({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return ev({backend:n,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const tY={kernelName:f1,backendName:"cpu",kernelFunc:F9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O9(t){const{inputs:e,backend:n,attrs:r}=t,{axis:s}=r;if(e.length===1)return Ad({inputs:{input:e[0]},backend:n,attrs:{dim:s}});const i=e[0].shape,o=e[0].dtype;e.forEach(c=>{ls(i,c.shape,"All tensors passed to stack must have matching shapes"),L(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const h=Ad({inputs:{input:c},backend:n,attrs:{dim:s}});return a.push(h),h}),u=su({inputs:l,backend:n,attrs:{axis:s}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const nY={kernelName:p1,backendName:"cpu",kernelFunc:O9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rY(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{paddings:i,constantValue:o}=r;Te(s,"pad");const a=i.map((x,v)=>x[0]+s.shape[v]+x[1]),l=i.map(x=>x[0]),u=n.data.get(s.dataId).values,c=se(s.shape),h=s.shape.length,f=Re(s.shape),d=se(a),p=a.length,g=Re(a),m=Nn(s.dtype,d);o!==0&&m.fill(o);for(let x=0;x<c;x++){const y=_u(x,h,f).map((C,T)=>C+l[T]),w=Xs(y,p,g);m[w]=u[x]}return{dataId:n.write(m,a,s.dtype),shape:a,dtype:s.dtype}}const L9={kernelName:m1,backendName:"cpu",kernelFunc:rY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sY=Kt((t,e)=>Math.pow(t,e)),iY=un(Xh,sY),oY={kernelName:Xh,backendName:"cpu",kernelFunc:iY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aY(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:s,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=r,l=s.map(b=>n.data.get(b.dataId).values),u=s.map(b=>b.shape),c=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,[f,d,p]=n9(l,u,c,i.shape,i.dtype,h,o.shape),g=f.map(b=>n.makeTensorInfo([b.length],"int32",b)),m=n.makeTensorInfo(p,i.dtype,d);return g.concat([m])}const lY={kernelName:uk,backendName:"cpu",kernelFunc:aY};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uY(t){const{inputs:e,backend:n}=t,{starts:r,limits:s,deltas:i}=e,o=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,[u,c]=r9(o,r.shape,r.dtype,a,s.shape,l,i.shape),h=n.makeTensorInfo([u.length],"int32",u),f=n.makeTensorInfo([c.length],r.dtype,c);return[h,f]}const cY={kernelName:ck,backendName:"cpu",kernelFunc:uY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hY(t){const{inputs:e,backend:n,attrs:r}=t,{shape:s,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,u=n.data.get(s.dataId).values,c=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,f=a.map(m=>n.data.get(m.dataId).values),d=a.map(m=>m.shape),[p,g]=s9(u,s.shape,c,i.shape,i.dtype,h,o.shape,f,d,l);return n.makeTensorInfo(p,i.dtype,g)}const fY={kernelName:hk,backendName:"cpu",kernelFunc:hY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dY(t){const{backend:e,attrs:n}=t,{start:r,stop:s,dtype:i,step:o}=n,a=i9(r,s,o,i);return e.makeTensorInfo([a.length],i,a)}const pY={kernelName:ox,backendName:"cpu",kernelFunc:dY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mY=mt(jh,t=>1/t),gY={kernelName:jh,backendName:"cpu",kernelFunc:mY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bY(t){const{inputs:e,backend:n,attrs:r}=t,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r;Te(s,"resizeBilinear");const l=Re(s.shape),[u,c]=a,[h,f,d,p]=s.shape,g=n.data.get(s.dataId).values,m=new Float32Array(se([h,u,c,p])),b=[i&&u>1?f-1:f,i&&c>1?d-1:d],x=[i&&u>1?u-1:u,i&&c>1?c-1:c];let v=0;const y=b[0]/x[0],w=b[1]/x[1];for(let C=0;C<h;C++)for(let T=0;T<u;T++){let N;o?N=y*(T+.5)-.5:N=y*T;const $=Math.max(0,Math.floor(N)),_=N-$,S=Math.min(f-1,Math.ceil(N)),M=C*l[0]+$*l[1],F=C*l[0]+S*l[1];for(let A=0;A<c;A++){let E;o?E=w*(A+.5)-.5:E=w*A;const D=Math.max(0,Math.floor(E)),P=E-D,z=Math.min(d-1,Math.ceil(E)),B=M+D*l[2],G=F+D*l[2],j=M+z*l[2],Z=F+z*l[2];for(let ne=0;ne<p;ne++){const le=g[B+ne],oe=g[G+ne],de=g[j+ne],fe=g[Z+ne],xe=le+(de-le)*P,ie=oe+(fe-oe)*P,pe=xe+(ie-xe)*_;m[v++]=pe}}}return n.makeTensorInfo([h,u,c,p],"float32",m)}const xY={kernelName:v1,backendName:"cpu",kernelFunc:bY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yY(t){const{inputs:e,backend:n,attrs:r}=t,{images:s,dy:i}=e,{alignCorners:o}=r;Te([i,s],"resizeBilinearGrad");const a=Re(s.shape),[l,u,c,h]=s.shape,[,f,d]=i.shape,p=new Float32Array(l*u*c*h),g=[o&&f>1?u-1:u,o&&d>1?c-1:c],m=[o&&f>1?f-1:f,o&&d>1?d-1:d],b=g[0]/m[0],x=g[1]/m[1],v=n.data.get(i.dataId).values;let y=0;for(let w=0;w<l;w++){const C=w*a[0];for(let T=0;T<f;T++){const N=T*b,$=Math.floor(N),_=Math.min(Math.ceil(N),u-1),S=C+$*a[1],M=C+_*a[1],F=N-$,A=1-F;for(let E=0;E<d;E++){const D=E*x,P=Math.floor(D),z=Math.min(Math.ceil(D),c-1),B=D-P,G=1-B,j=S+P*a[2],Z=S+z*a[2],ne=M+P*a[2],le=M+z*a[2],oe=A*G,de=A*B,fe=F*G,xe=F*B;for(let ie=0;ie<h;ie++){const pe=v[y++];p[j+ie]+=pe*oe,p[Z+ie]+=pe*de,p[ne+ie]+=pe*fe,p[le+ie]+=pe*xe}}}}return n.makeTensorInfo([l,c,u,h],"float32",p)}const vY={kernelName:ux,backendName:"cpu",kernelFunc:yY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(t){const{inputs:e,backend:n,attrs:r}=t,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r;Te(s,"resizeNearestNeighbor");const l=Re(s.shape),[u,c]=a,[h,f,d,p]=s.shape,g=n.data.get(s.dataId).values,m=new Float32Array(h*u*c*p),b=[i&&u>1?f-1:f,i&&c>1?d-1:d],x=[i&&u>1?u-1:u,i&&c>1?c-1:c],v=b[0]/x[0],y=b[1]/x[1];let w=0;for(let C=0;C<h;C++){const T=C*l[0];for(let N=0;N<u;N++){const $=o?v*(N+.5):v*N;let _=Math.min(f-1,i?Math.round($):Math.floor($));o&&(_=Math.max(0,_));const S=T+_*l[1];for(let M=0;M<c;M++){const F=o?y*(M+.5):y*M;let A=Math.min(d-1,i?Math.round(F):Math.floor(F));o&&(A=Math.max(0,A));const E=S+A*l[2];for(let D=0;D<p;D++){const P=g[E+D];m[w++]=P}}}}return n.makeTensorInfo([h,u,c,p],s.dtype,m)}const kY={kernelName:y1,backendName:"cpu",kernelFunc:wY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SY(t){const{inputs:e,backend:n,attrs:r}=t,{images:s,dy:i}=e,{alignCorners:o}=r;Te([i,s],"resizeNearestNeighborGrad");const a=Re(s.shape),l=Re(i.shape),[u,c,h,f]=s.shape,[,d,p]=i.shape,g=new Float32Array(u*c*h*f),m=n.data.get(i.dataId).values,b=[o&&d>1?c-1:c,o&&p>1?h-1:h],x=[o&&d>1?d-1:d,o&&p>1?p-1:p],v=b[0]/x[0],y=b[1]/x[1],w=1/v,C=1/y,T=Math.ceil(w)*2+2,N=Math.ceil(C)*2+2;for(let $=0;$<u;$++){const _=$*a[0];for(let S=0;S<c;S++){const M=_+S*a[1],F=Math.floor(S*w),A=Math.floor(F-T/2);for(let E=0;E<h;E++){const D=M+E*a[2],P=Math.floor(E*C),z=Math.floor(P-N/2);for(let B=0;B<f;B++){let G=0;for(let j=0;j<T;j++){const Z=j+A;if(Z<0||Z>=d)continue;const ne=_+Z*l[1],le=Z*v,oe=Math.min(c-1,o?Math.round(le):Math.floor(le));if(S===oe)for(let de=0;de<N;de++){const fe=de+z;if(fe<0||fe>=p)continue;const xe=ne+fe*l[2],ie=fe*y,pe=Math.min(h-1,o?Math.round(ie):Math.floor(ie));E===pe&&(G+=m[xe+B])}}g[D+B]=G}}}}return n.makeTensorInfo(s.shape,s.dtype,g)}const CY={kernelName:lx,backendName:"cpu",kernelFunc:SY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{dims:i}=r;Te(s,"reverse");const o=s.shape.length,a=et(i,s.shape);if(o===0)return si({inputs:{x:s},backend:n});const l=new kn(s.shape,s.dtype),u=n.bufferSync(s);for(let c=0;c<l.size;c++){const h=l.indexToLoc(c),f=h.slice();a.forEach(d=>f[d]=s.shape[d]-1-f[d]),l.set(u.get(...f),...h)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const IY={kernelName:w1,backendName:"cpu",kernelFunc:$Y};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TY={kernelName:gx,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:s,fillValue:i,center:o}=e,a=n,l=Nn(r.dtype,se(r.shape)),[u,c,h,f]=r.shape,[d,p]=oy(o,c,h),g=255,m=Math.sin(s),b=Math.cos(s),x=a.data.get(r.dataId).values;for(let y=0;y<u;y++){const w=y*h*c*f;for(let C=0;C<c;C++){const T=C*(h*f);for(let N=0;N<h;N++){const $=N*f;for(let _=0;_<f;_++){const S=[u,C,N,_],M=S[2],F=S[1];let A=(M-d)*b-(F-p)*m,E=(M-d)*m+(F-p)*b;A=Math.round(A+d),E=Math.round(E+p);let D=i;if(typeof i!="number"&&(_===3?D=g:D=i[_]),A>=0&&A<h&&E>=0&&E<c){const z=E*(h*f),B=A*f,G=w+z+B+_;D=x[G]}const P=w+T+$+_;l[P]=D}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NY=mt(Zh,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),_Y={kernelName:Zh,backendName:"cpu",kernelFunc:NY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AY(t){const{inputs:e,backend:n,attrs:r}=t,{indices:s,updates:i}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=rl(i,s,o),f=!0,d=n.bufferSync(s),p=n.bufferSync(i),g=da(d,p,o,h,u,l,a,c,0,f);return n.makeTensorInfo(o,g.dtype,g.values)}const EY={kernelName:fk,backendName:"cpu",kernelFunc:AY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY(t,e){let n=0,r=t.length,s=0;for(;n<r;)s=Math.floor((n+r)/2),t[s]<e?n=s+1:r=s;return r}function DY(t,e){let n=0,r=t.length,s=0;for(;n<r;)s=Math.floor((n+r)/2),t[s]<=e?n=s+1:r=s;return r}function MY(t,e,n,r,s,i){const o=Gt("int32",n*s);for(let a=0;a<n;++a){const l=t.slice(a*r,(a+1)*r),u=a*s;for(let c=0;c<s;++c)o[u+c]=i==="left"?RY(l,e[c+u]):DY(l,e[c+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FY(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:s,values:i}=e,{side:o}=r,a=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,u=MY(a,l,s.shape[0],s.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",u)}const OY={kernelName:pk,backendName:"cpu",kernelFunc:FY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LY(t){const{inputs:e,backend:n}=t,{condition:r,t:s,e:i}=e;Te([r,s,i],"select");const o=r.shape.length,a=n.data.get(r.dataId).values,l=n.data.get(s.dataId).values,u=n.data.get(i.dataId).values,c=Cr(s.dtype,i.dtype),h=_n(se(s.shape),c);let f=0;const d=o===0||o>1||s.shape.length===1?1:se(s.shape.slice(1));for(let p=0;p<a.length;p++)for(let g=0;g<d;g++)a[p]===1?h[f++]=l[p]:h[f++]=u[p];return n.makeTensorInfo(s.shape,c,h)}const zY={kernelName:k1,backendName:"cpu",kernelFunc:LY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PY=U1,BY=G1,VY=mt(Qh,t=>t>=0?BY*t:PY*(Math.exp(t)-1)),WY={kernelName:Qh,backendName:"cpu",kernelFunc:VY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UY=mt(n0,t=>t<0?-1:t>0?1:0),GY={kernelName:n0,backendName:"cpu",kernelFunc:UY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HY=mt(e0,t=>Math.sin(t)),qY={kernelName:e0,backendName:"cpu",kernelFunc:HY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XY=mt(t0,t=>Math.sinh(t)),jY={kernelName:t0,backendName:"cpu",kernelFunc:XY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KY=11920928955078125e-23,b5=Math.log(KY)+2,YY=mt(s0,t=>{const e=t>-b5,n=t<b5,r=Math.exp(t);let s;return n?s=r:e?s=t:s=Math.log(1+r),s}),ZY={kernelName:s0,backendName:"cpu",kernelFunc:YY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JY(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockShape:i,paddings:o}=r;Te([s],"spaceToBatchND");const a=se(i),l=[[0,0]];l.push(...o);for(let C=1+i.length;C<s.shape.length;++C)l.push([0,0]);const u=L9.kernelFunc({inputs:{x:s},backend:n,attrs:{paddings:l,constantValue:0}}),c=g0(u.shape,i,a,!1),h=b0(c.length,i.length,!1),f=x0(u.shape,i,a,!1),g=Ct({inputs:{x:u},backend:n,attrs:{shape:c}}),x=ar({inputs:{x:g},backend:n,attrs:{perm:h}}),w=Ct({inputs:{x},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),w}const QY={kernelName:$1,backendName:"cpu",kernelFunc:JY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eZ(t){const{inputs:e,backend:n}=t,{indices:r,values:s,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${s.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(r.dataId).values,l=n.data.get(s.dataId).values,u=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values[0],[h,f,d,p,g]=u9(a,r.shape,r.dtype,l,s.dtype,u,c);return[n.makeTensorInfo(f,r.dtype,h),n.makeTensorInfo([f[0]],s.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(m=>Number(m)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}const tZ={kernelName:mk,backendName:"cpu",kernelFunc:eZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:s,newShape:i}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.data.get(s.dataId).values),a=n.data.get(r.dataId).values,l=Array.from(n.data.get(i.dataId).values),[u,c,h]=c9(a,r.shape,r.dtype,o,l);return[n.makeTensorInfo(c,r.dtype,u),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const rZ={kernelName:gk,backendName:"cpu",kernelFunc:nZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sZ(t){const{inputs:e,backend:n}=t,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(s.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,[u,c]=Yy(o,r.shape,r.dtype,a,l,!0);return n.makeTensorInfo(c,r.dtype,u)}const iZ={kernelName:bk,backendName:"cpu",kernelFunc:sZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oZ(t){const{inputs:e,backend:n}=t,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(s.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,[u,c]=Yy(o,r.shape,r.dtype,a,l);return n.makeTensorInfo(c,r.dtype,u)}const aZ={kernelName:xk,backendName:"cpu",kernelFunc:oZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lZ(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:s,sparseValues:i,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:f}=rl(i,s,a),d=!1,p=n.bufferSync(s);let g;switch(i.dtype){case"bool":{const m=n.bufferSync(i),b=!!n.data.get(o.dataId).values[0];g=da(p,m,a,f,c,u,l,h,b,d);break}case"float32":{const m=n.bufferSync(i),b=n.data.get(o.dataId).values[0];g=da(p,m,a,f,c,u,l,h,b,d);break}case"int32":{const m=n.bufferSync(i),b=n.data.get(o.dataId).values[0];g=da(p,m,a,f,c,u,l,h,b,d);break}case"string":{const m=n.bufferSync(i),b=vo(n.data.get(o.dataId).values[0]);g=da(p,m,a,f,c,u,l,h,b,d);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return n.makeTensorInfo(a,g.dtype,g.values)}const uZ={kernelName:yk,backendName:"cpu",kernelFunc:lZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cZ(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{numOrSizeSplits:i,axis:o}=r,a=et(o,s.shape)[0],l=wy(s,i,a),u=new Array(s.shape.length).fill(0),c=s.shape.slice();return l.map(h=>{const f=[...c];f[a]=h;const d=za({inputs:{x:s},backend:n,attrs:{begin:u,size:f}});return u[a]+=h,d})}const hZ={kernelName:I1,backendName:"cpu",kernelFunc:cZ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fZ={kernelName:cx,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,r=e;Te(n,"square");const s=r.data.get(n.dataId).values,i=new Float32Array(s.length);for(let a=0;a<s.length;++a){const l=s[a];i[a]=l*l}return{dataId:r.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dZ=mt(h0,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),pZ={kernelName:h0,backendName:"cpu",kernelFunc:dZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mZ(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:f}=r;Te(s,"stridedSlice");const{finalShapeSparse:d,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:b,begin:x,end:v,strides:y}=ry(s.shape,i,o,a,l,u,c,h,f);let w;if(g)w=Ct({inputs:{x:s},backend:n,attrs:{shape:p}});else if(m||b){L(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const C=ey(x,v,y),T=za({inputs:{x:s},backend:n,attrs:{begin:x,size:C}});w=Ct({inputs:{x:T},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(T)}else{const C=n.bufferSync(s),T=d9(d,C,y,x);w=n.makeTensorInfo(p,T.dtype,T.values)}return w}const gZ={kernelName:fx,backendName:"cpu",kernelFunc:mZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bZ(t){const{inputs:e,backend:n,attrs:r}=t,{separator:s,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=r,{data:c,dataSplits:h}=e,f=n.data.get(c.dataId).values,d=n.data.get(h.dataId).values,[p,g]=p9(f,d,s,i,o,a,l,u);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",g)]}const xZ={kernelName:vk,backendName:"cpu",kernelFunc:bZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yZ(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:s}=r,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],[u,c,h]=m9(a,l,s),f=c.length;return[n.makeTensorInfo([f,2],"int32",u),n.makeTensorInfo([f],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const vZ={kernelName:wk,backendName:"cpu",kernelFunc:yZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:s}=r,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(i.dataId).values,a=g9(o,s);return n.makeTensorInfo(i.shape,"int32",a)}const kZ={kernelName:kk,backendName:"cpu",kernelFunc:wZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SZ=mt(l0,t=>Math.tan(t)),CZ={kernelName:l0,backendName:"cpu",kernelFunc:SZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Z=mt(u0,t=>Math.tanh(t)),IZ={kernelName:u0,backendName:"cpu",kernelFunc:$Z};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TZ(t){const{inputs:e,backend:n}=t,{tensor:r,indices:s,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:c}=rl(i,s,r.shape),h=!1,f=n.bufferSync(s),d=n.bufferSync(i),p=n.bufferSync(r),g=da(f,d,r.shape,c,l,a,o,u,p,h);return n.makeTensorInfo(r.shape,g.dtype,g.values)}const NZ={kernelName:dk,backendName:"cpu",kernelFunc:TZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Z(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{reps:i}=r;Te(s,"tile");const o=x9(n.bufferSync(s),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const AZ={kernelName:c0,backendName:"cpu",kernelFunc:_Z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EZ(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{k:i,sorted:o}=r;Te(s,"topk");const a=n.data.get(s.dataId).values,[l,u]=v9(a,s.shape,s.dtype,i,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}const RZ={kernelName:dx,backendName:"cpu",kernelFunc:EZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DZ(t){const{inputs:e,attrs:n,backend:r}=t,{image:s,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=n,[c,h,f,d]=s.shape,[p,g]=u??[h,f],m=[c,p,g,d],b=Re(s.shape),x=b[0],v=b[1],y=b[2],w=Re(m),C=w[0],T=w[1],N=w[2],$=Nn(s.dtype,se(m));$.fill(l);const _=r.data.get(s.dataId).values,S=r.data.get(i.dataId).values;for(let F=0;F<c;++F){const A=i.shape[0]===1?S:S.subarray(F*8,F*8+8);for(let E=0;E<p;++E)for(let D=0;D<g;++D)for(let P=0;P<d;++P){let z;const B=A[6]*D+A[7]*E+1;if(B===0)continue;const G=(A[0]*D+A[1]*E+A[2])/B,j=(A[3]*D+A[4]*E+A[5])/B,Z=x5(G,f,a),ne=x5(j,h,a);switch(o){case"nearest":z=PZ(_,h,f,x,v,y,F,ne,Z,P,l);break;case"bilinear":z=BZ(_,h,f,x,v,y,F,ne,Z,P,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const le=F*C+E*T+D*N+P;$[le]=z}return r.makeTensorInfo(m,s.dtype,$)}return{dataId:r.write($,m,s.dtype),shape:s.shape,dtype:s.dtype}}const MZ={kernelName:px,backendName:"cpu",kernelFunc:DZ};function x5(t,e,n){switch(n){case"reflect":return FZ(t,e);case"wrap":return OZ(t,e);case"nearest":return zZ(t,e);case"constant":default:return LZ(t)}}function FZ(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const r=2*e;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-e?n+r:-n-1}else if(n>e-1)if(e<=1)n=0;else{const r=2*e;n-=r*Math.trunc(n/r),n>=e&&(n=r-n-1)}return Sa(0,n,e-1)}function OZ(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const r=e-1;n+=e*(Math.trunc(-n/r)+1)}else if(n>e-1)if(e<=1)n=0;else{const r=e-1;n-=e*Math.trunc(n/r)}return Sa(0,n,e-1)}function LZ(t,e){return t}function zZ(t,e){return Sa(0,t,e-1)}function mc(t,e,n,r,s,i,o,a,l,u,c){const h=o*r+a*s+l*i+u;return 0<=a&&a<e&&0<=l&&l<n?t[h]:c}function PZ(t,e,n,r,s,i,o,a,l,u,c){const h=Math.round(a),f=Math.round(l);return mc(t,e,n,r,s,i,o,h,f,u,c)}function BZ(t,e,n,r,s,i,o,a,l,u,c){const h=Math.floor(a),f=Math.floor(l),d=h+1,p=f+1,g=(p-l)*mc(t,e,n,r,s,i,o,h,f,u,c)+(l-f)*mc(t,e,n,r,s,i,o,h,p,u,c),m=(p-l)*mc(t,e,n,r,s,i,o,d,f,u,c)+(l-f)*mc(t,e,n,r,s,i,o,d,p,u,c);return(d-a)*g+(a-h)*m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VZ(t){const{inputs:e,attrs:n,backend:r}=t,{axis:s}=n,{x:i}=e;Te(i,"unique");const o=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=w9(o,s,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([u.length],"int32",u)]}const WZ={kernelName:mx,backendName:"cpu",kernelFunc:VZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UZ(t){const{inputs:e,backend:n,attrs:r}=t,{value:s}=e;let{axis:i}=r;i<0&&(i+=s.shape.length);const o=s.shape.length,a=s.shape[i],l=new Array(o-1);let u=0;for(let d=0;d<o;d++)d!==i&&(l[u++]=s.shape[d]);const c=new Array(o).fill(0),h=s.shape.slice();h[i]=1;const f=new Array(a);for(let d=0;d<f.length;d++){c[i]=d;const p=za({inputs:{x:s},backend:n,attrs:{begin:c,size:h}});f[d]=Ct({inputs:{x:p},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(p)}return f}const GZ={kernelName:N1,backendName:"cpu",kernelFunc:UZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HZ(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,segmentIds:i}=e,{numSegments:o}=r;Te(s,"unsortedSegmentSum");const a=s.shape.length,l=i.shape.length,u=[],c=[],h=a-l;let f=i;for(let p=0;p<h;++p){const g=Ad({inputs:{input:f},backend:n,attrs:{dim:p+1}});f=g,c.push(g)}for(let p=0;p<o;++p){const g=Oo(p,"int32"),m=n.makeTensorInfo([],"int32",g),b=OI({inputs:{a:m,b:f},backend:n}),x=$o({inputs:{x:b},backend:n,attrs:{dtype:"float32"}}),v=nm({inputs:{a:x,b:s},backend:n}),y=T0({inputs:{x:v},backend:n,attrs:{axis:0,keepDims:!1}});u.push(y),c.push(m),c.push(b),c.push(x),c.push(v),c.push(y)}const d=O9({inputs:u,backend:n,attrs:{axis:0}});return c.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const qZ={kernelName:_1,backendName:"cpu",kernelFunc:HZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XZ=[Vq,wH,Uq,Hq,TH,Xq,Kq,Zq,Qq,tX,rX,iX,aX,cX,fX,mX,bX,yX,wX,Pq,SX,$X,TX,_H,_X,$H,EH,EX,kH,DX,FX,OX,zX,BX,WX,GX,qX,jX,YX,JX,ej,nj,sj,oj,aj,uj,hj,dj,pj,mj,gj,xj,wj,Rq,Sj,RH,Ej,DH,Rj,FH,zj,Pj,Vj,LH,PH,Uj,Hj,Xj,Kj,VH,UH,SH,Zj,MX,Qj,tK,rK,Dq,HH,XH,iK,KH,aK,cK,fK,mK,bK,yK,vK,ZH,kK,CK,IK,NK,AK,RK,MK,QH,OK,PK,WK,tq,rq,HK,jK,ZK,iq,QK,tY,nY,L9,oY,Fq,lq,lY,cY,fY,pY,CH,ub,gY,Oq,Lq,zq,xY,vY,kY,CY,IY,TY,_Y,gq,EY,OY,zY,WY,xq,GY,qY,jY,yq,BK,ZY,QY,tZ,rZ,iZ,aZ,uZ,hZ,kq,fZ,Cq,Iq,pZ,gZ,xZ,vZ,kZ,Aq,yj,CZ,IZ,NZ,AZ,RZ,MZ,oq,WZ,GZ,qZ,eY];for(const t of XZ)Ck(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ua={},tf={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function jZ(t,e){ua[t]=e}function Ns(t,e){if(!(t in ua)||e!=null){const r=YZ(t,e);if(r!==null)ua[t]=r;else return console.log("Could not get context for WebGL version",t),null}const n=ua[t];return n==null||n.isContextLost()?(delete ua[t],Ns(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),ua[t])}function KZ(t){if(!ee().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function YZ(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??KZ(t);return n.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete ua[t]},!1),ee().getBool("SOFTWARE_WEBGL_ENABLED")&&(tf.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",tf)||n.getContext("experimental-webgl",tf):n.getContext("webgl2",tf)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var jc;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(jc||(jc={}));var Mr;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Mr||(Mr={}));var yn;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(yn||(yn={}));function N0(t,e){return[e,t]}function ZZ(t,e){return t*e}function nf(t){const e=se(t),n=Math.ceil(e/4);return R2(n)}function Ou(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function JZ(t,e){const[n,r]=Ou(t,e);return n*r*4}function tv(t,e){const n=t;let r,s,i,o,a,l,u,c,h,f;return ee().getNumber("WEBGL_VERSION")===2?(r=n.R32F,s=n.R16F,i=n.RGBA16F,o=n.RGBA32F,a=n.RED,u=4,c=1,h=n.HALF_FLOAT,f=n.FLOAT,l=n.RGBA8):(r=t.RGBA,s=t.RGBA,i=t.RGBA,o=n.RGBA,a=t.RGBA,u=4,c=4,h=e!=null?e.HALF_FLOAT_OES:null,f=t.FLOAT,l=t.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ke(t,e){const n=e();return ee().getBool("DEBUG")&&QZ(t),n}function QZ(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+rJ(t,e))}const eJ=596e-10,tJ=65504;function nJ(t){return!!(ee().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||eJ<Math.abs(t)&&Math.abs(t)<tJ)}function rJ(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function rf(t,e){return ji(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function sJ(t,e){const n=ji(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ke(t,()=>t.shaderSource(n,e)),ke(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function iJ(t,e){const n=ji(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ke(t,()=>t.shaderSource(n,e)),ke(t,()=>t.compileShader(n)),ee().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw z9(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const oJ=/ERROR: [0-9]+:([0-9]+):/g;function z9(t,e){const n=oJ.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const r=+n[1],s=t.split(`
`),i=s.length.toString().length+2,o=s.map((h,f)=>Ol((f+1).toString(),i)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const l=o.slice(0,r-1),u=o.slice(r-1,r),c=o.slice(r);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Ol(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function aJ(t){return ji(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function lJ(t,e){if(ke(t,()=>t.linkProgram(e)),!ee().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function $g(t,e){if(ke(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function uJ(t,e){const n=ji(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),ke(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function cJ(t,e){const n=ji(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ke(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),ke(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function hJ(t){return ji(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function fJ(t,e){const n=ee().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const r=`[${t}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n){const r=`[${t}x${e}]`,s=`[${n}x${n}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+s+".")}}function dJ(t){return ji(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function y5(t,e,n,r,s,i,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),ke(t,()=>t.vertexAttribPointer(a,s,t.FLOAT,!1,i,o)),ke(t,()=>t.enableVertexAttribArray(a)),!0)}function pJ(t,e,n){yJ(t,n),ke(t,()=>t.activeTexture(t.TEXTURE0+n)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function mJ(t,e,n){return ji(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function gJ(t,e,n){return t.getUniformLocation(e,n)}function bJ(t,e,n,r){ke(t,()=>pJ(t,e,r)),ke(t,()=>t.uniform1i(n,r))}function Ig(t,e,n){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),ke(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function v5(t,e){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),ke(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function sf(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+xJ(t,e))}function xJ(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function ji(t,e,n){const r=ke(t,()=>e());if(r==null)throw new Error(n);return r}function yJ(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n){const s=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${s}.`)}}function iu(t,e=2){return se(t.slice(0,t.length-e))}function ou(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function of(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[iu(t),...ou(t)]),e}function vJ(t,e=!1){let n=ee().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=ee().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&ee().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),e&&(n=n*2,r=r*2,t=t.map((a,l)=>l>=t.length-2?$4(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Fo(t).newShape);let s=se(t),i=null;t.length<=1&&s<=n?i=[1,s]:t.length===2&&t[0]<=n&&t[1]<=n?i=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?i=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?i=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?i=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(i=[t[0],t[1]*t[2]*t[3]]);const o=i!=null&&Math.max(...i)>r&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=iu(t);let l=2,u=2;t.length&&([l,u]=ou(t)),s=a*(l/2)*(u/2),i=R2(s).map(c=>c*2)}else i=R2(s);return i}function af(t){return t%2===0}function Rd(t,e){if(t=t.slice(-2),e=e.slice(-2),ft(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],r=e[e.length-1];if(n===r||af(n)&&af(r)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&af(t[0])&&af(e[0])}let Tg,Ng;function wJ(t){if(Tg==null){const e=Ns(t);Tg=e.getParameter(e.MAX_TEXTURE_SIZE)}return Tg}function kJ(t){if(Ng==null){const e=Ns(t);Ng=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ng)}function SJ(t){if(t===0)return 0;let e;const n=Ns(t);return es(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:es(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function es(t,e){return t.getExtension(e)!=null}function w5(t){try{if(Ns(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function CJ(t){if(t===0)return!1;const e=Ns(t);if(t===1){if(!es(e,"OES_texture_float"))return!1}else if(!es(e,"EXT_color_buffer_float"))return!1;return hb(e)}function $J(t){if(t===0)return!1;const e=Ns(t);if(t===1){if(!es(e,"OES_texture_float")||!es(e,"WEBGL_color_buffer_float"))return!1}else{if(es(e,"EXT_color_buffer_float"))return hb(e);const r="EXT_color_buffer_half_float";if(es(e,r)){const s=e.getExtension(r);return IJ(e,s)}return!1}return hb(e)}function hb(t){const e=tv(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(i),o}function IJ(t,e){const n=tv(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(o),a}function TJ(t){return t!==2?!1:Ns(t).fenceSync!=null}function _0(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&L(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _e=ee();_e.registerFlag("HAS_WEBGL",()=>_e.getNumber("WEBGL_VERSION")>0);_e.registerFlag("WEBGL_VERSION",()=>w5(2)?2:w5(1)?1:0);_e.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);_e.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>_e.get("WEBGL_VERSION")===2);_e.registerFlag("WEBGL_CPU_FORWARD",()=>!0);_e.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);_e.registerFlag("WEBGL_PACK",()=>_e.getBool("HAS_WEBGL"));_e.registerFlag("WEBGL_PACK_NORMALIZATION",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_PACK_CLIP",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_PACK_REDUCE",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_LAZILY_UNPACK",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_CONV_IM2COL",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>_e.getBool("WEBGL_PACK"));_e.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>wJ(_e.getNumber("WEBGL_VERSION")));_e.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>kJ(_e.getNumber("WEBGL_VERSION")));_e.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=_e.getNumber("WEBGL_VERSION");return t===0?0:SJ(t)});_e.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>_e.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Lk());_e.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>CJ(_e.getNumber("WEBGL_VERSION")));_e.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>_e.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:_e.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));_e.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>$J(_e.getNumber("WEBGL_VERSION")));_e.registerFlag("WEBGL_FENCE_API_ENABLED",()=>TJ(_e.getNumber("WEBGL_VERSION")));_e.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>_e.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);_e.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});_e.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Lk()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});_e.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);_e.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);_e.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);_e.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);_e.registerFlag("WEBGL_EXP_CONV",()=>!1);_e.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>_e.getBool("IS_TEST"));_e.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);_e.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);_e.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);_e.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qn(){let t,e,n,r,s,i,o,a,l,u;return ee().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",r="in",s="texture",i="outputColor",o="out vec4 outputColor;",a=ee().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",r="varying",s="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:s,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ol(t,e,n="index"){const r=Re(e);return r.map((s,i)=>{const o=`int ${t[i]} = ${n} / ${s}`,a=i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${s}`:`index -= ${t[i]} * ${s}`;return`${o}; ${a};`}).join("")}function rm(t,e,n="index"){const r=Re(e);return r.map((s,i)=>{const o=`int ${t[i]} = ${n} / outShapeStrides[${i}]`,a=i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function NJ(t,e){const n=t.length,r=t.map(i=>`${e}[${i}]`),s=new Array(n-1);s[n-2]=r[n-1];for(let i=n-3;i>=0;--i)s[i]=`(${s[i+1]} * ${r[i+1]})`;return s}function _J(t,e,n="index"){const r=t.map((i,o)=>o),s=NJ(r,e);return s.map((i,o)=>{const a=`int ${t[o]} = ${n} / ${s[o]}`,l=o===s.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${s[o]}`:`index -= ${t[o]} * ${s[o]}`;return`${a}; ${l};`}).join("")}function nv(t){const e=Re(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function rv(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const P9=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:B9}=gV;function AJ(t,e,n){const r=[];if(t.forEach(d=>{const p=se(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?r.push(`uniform float ${d.name}${p>1?`[${p}]`:""};`):(r.push(`uniform sampler2D ${d.name};`),r.push(`uniform int offset${d.name};`)),n.enableShapeUniforms){const{uniformShape:g}=sv(n.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape);switch(g.length){case 1:r.push(`uniform int ${d.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${d.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${d.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${d.name}Shape;`);break}r.push(`uniform ivec2 ${d.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(d=>{r.push(`uniform ${d.type} ${d.name}${d.arrayIndex?`[${d.arrayIndex}]`:""};`)});const s=r.join(`
`),i=t.map(d=>EJ(d,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=qn(),l=MJ(a);let u,c,h=LJ(a);return e.isPacked?(u=RJ(e.logicalShape,o,n.enableShapeUniforms),c=OJ(a)):(u=DJ(e.logicalShape,o,n.enableShapeUniforms),c=FJ(a)),n.packedInputs&&(h+=VJ),[h,l,c,s,u,i,n.userCode].join(`
`)}function Lu(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return QJ(t,e);case 1:return tQ(t,e);case 2:return rQ(t,e);case 3:return iQ(t,e);case 4:return aQ(t,e);case 5:return lQ(t);case 6:return uQ(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function V9(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return JJ(t);case 1:return eQ(t,e);case 2:return nQ(t,e);case 3:return sQ(t,e);default:return oQ(t,e)}}function EJ(t,e,n=!1,r){let s="";n?s+=V9(t,r):s+=Lu(t,r);const i=t.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(n?s+=cQ(t,e):s+=hQ(t,e)),s}function RJ(t,e,n){switch(t.length){case 0:return W9();case 1:return WJ(t,e,n);case 2:return YJ(t,e,n);case 3:return GJ(t,e,n);default:return qJ(t,e,n)}}function DJ(t,e,n){switch(t.length){case 0:return W9();case 1:return UJ(t,e,n);case 2:return ZJ(t,e,n);case 3:return HJ(t,e,n);case 4:return XJ(t,e,n);case 5:return jJ(t,e);case 6:return KJ(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function MJ(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function FJ(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function OJ(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function LJ(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${zJ}
    ${PJ}
    ${BJ}
  `}const zJ=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,PJ=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,BJ=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,VJ=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function W9(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function WJ(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function UJ(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function GJ(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(t[2]/2),i=s*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec3(b, r, c);
    }
  `}function HJ(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${rm(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const r=ol(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function qJ(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(t[t.length-1]/2),i=s*Math.ceil(t[t.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<t.length-1;u++)o*=t[t.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec${t.length}(${l});
    }
  `}function XJ(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${rm(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const r=ol(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function jJ(t,e){const n=ol(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function KJ(t,e){const n=ol(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function YJ(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(ft(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const s=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec2(r, c);
    }
  `}function ZJ(t,e,n){return ft(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function al(t){return`offset${t}`}function JJ(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=qn();return`
    vec4 ${n}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function QJ(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[s,i]=t.shapeInfo.texShape;if(s===1&&i===1)return`
      float ${r}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=al(n);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function eQ(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape,i=qn();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function tQ(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${zu(t)}
      }
    `;const s=t.shapeInfo.texShape,i=s[0],o=s[1];if(o===1&&i===1)return`
      float ${r}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=al(n);return o===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${n}, uv);
      }
    `:i===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function nQ(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,o=i[0],a=i[1],l=qn();if(i!=null&&ft(n,i))return e?`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${s}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${s}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function rQ(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape;if(i!=null&&ft(n,i)){if(e)return`
      float ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const f=i[0],d=i[1];return`
    float ${s}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${f}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:o,keptDims:a}=Fo(n),l=o;if(l.length<n.length){const f=Pu(t,l),d=["row","col"];return`
      ${Lu(f,e)}
      float ${s}(int row, int col) {
        return ${s}(${Bu(d,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${zu(t)}
      }
    `;const u=i[0],c=i[1],h=al(r);return c===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${r}, uv);
    }
  `:u===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${s}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${s}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function sQ(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(n[0]===1){const f=n.slice(1),d=[1,2],p=Pu(t,f),g=["b","row","col"];return`
        ${V9(p,e)}
        vec4 ${s}(int b, int row, int col) {
          return ${s}(${Bu(g,d)});
        }
      `}const a=qn();if(e)return`
    vec4 ${s}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const l=o[0],u=o[1],c=Math.ceil(n[2]/2),h=c*Math.ceil(n[1]/2);return`
    vec4 ${s}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${h}, ${c}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function iQ(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=Fo(n),u=a;if(u.length<n.length){const g=Pu(t,u),m=["row","col","depth"];return`
        ${Lu(g,e)}
        float ${s}(int row, int col, int depth) {
          return ${s}(${Bu(m,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${zu(t)}
      }
    `;const c=t.shapeInfo.texShape,h=c[0],f=c[1],d=t.shapeInfo.flatOffset;if(f===i&&d==null)return e?`
      float ${s}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${s}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${h}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(f===o&&d==null)return e?`
      float ${s}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `;const p=al(r);return e?`
    float ${s}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${s}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${p};
        vec2 uv = uvFromFlat(${h}, ${f}, index);
        return sampleTexture(${r}, uv);
      }
  `}function oQ(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),s=qn();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${n}, uv);
    }
  `;const i=t.shapeInfo.logicalShape,o=i.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],c=l[1],h=Math.ceil(i[o-1]/2);let f=h*Math.ceil(i[o-2]/2),d="int b, int row, int col",p=`b * ${f} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<o-1;g++)d=`int b${g}, `+d,f*=i[o-g-1],p=`b${g} * ${f} + `+p;return`
    vec4 ${r}(${d}) {
      int index = ${p};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${s.texture2D}(${n}, uv);
    }
  `}function aQ(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,a=n[1]*o,{newShape:l,keptDims:u}=Fo(n);if(l.length<n.length){const x=Pu(t,l),v=["row","col","depth","depth2"];return`
      ${Lu(x,e)}
      float ${s}(int row, int col, int depth, int depth2) {
        return ${s}(${Bu(v,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${zu(t)}
      }
    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],d=h[1],p=`int stride2 = ${r}Shape[3];`,g=`int stride1 = ${r}Shape[2] * stride2;`,m=`int stride0 = ${r}Shape[1] * stride1;`;if(d===a&&c==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        ${p}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(d===i&&c==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;const b=al(r);return e?`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${g}
      ${m}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${b});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${f}, ${d}, index + ${b});
      return sampleTexture(${r}, uv);
    }
  `}function lQ(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),s=e[4],i=e[3]*s,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=Fo(e);if(l.length<e.length){const g=Pu(t,l),m=["row","col","depth","depth2","depth3"];return`
      ${Lu(g)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${Bu(m,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${s})) +
          depth3;
        ${zu(t)}
      }
    `;const c=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],d=h[1];if(d===a&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(d===s&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=al(n);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${s} + depth3 + ${p};
      vec2 uv = uvFromFlat(${f}, ${d}, index);
      return sampleTexture(${n}, uv);
    }
  `}function uQ(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:s,keptDims:i}=Fo(e);if(s.length<e.length){const m=Pu(t,s),b=["row","col","depth","depth2","depth3","depth4"];return`
      ${Lu(m)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${Bu(b,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,c=e[1]*u;if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${zu(t)}
      }
    `;const h=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,d=f[0],p=f[1];if(p===c&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===o&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const g=al(n);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${g};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function zu(t){const e=t.name,n=se(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function cQ(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),s="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=B9(t.shapeInfo.logicalShape,e.logicalShape),l=gt(o),u=o-i;let c;const h=["x","y","z","w","u","v"];i===0?c="":o<2&&a.length>=1?c="coords = 0;":c=a.map(x=>`coords.${h[x+u]} = 0;`).join(`
`);let f="";o<2&&i>0?f="coords":f=t.shapeInfo.logicalShape.map((x,v)=>`coords.${h[v+u]}`).join(", ");let d="return outputValue;";const g=se(t.shapeInfo.logicalShape)===1,b=se(e.logicalShape)===1;if(i===1&&!g&&!b)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!b)o===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(a.length){const x=i-2,v=i-1;a.indexOf(x)>-1&&a.indexOf(v)>-1?d="return vec4(outputValue.x);":a.indexOf(x)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(v)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${s}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${r}(${f});
      ${d}
    }
  `}function hQ(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),s="get"+r+"AtOutCoords",i=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&ft(o,i))return`
      float ${s}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const u=gt(l),c=B9(t.shapeInfo.logicalShape,e.logicalShape),h=l-a;let f;const d=["x","y","z","w","u","v"];a===0?f="":l<2&&c.length>=1?f="coords = 0;":f=c.map(g=>`coords.${d[g+h]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=t.shapeInfo.logicalShape.map((g,m)=>`coords.${d[m+h]}`).join(", "),`
    float ${s}() {
      ${u} coords = getOutputCoords();
      ${f}
      return get${r}(${p});
    }
  `}function gt(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function sv(t,e,n){const{newShape:r,keptDims:s}=Fo(e),i=e.length,o=t&&i===3&&e[0]===1,a=o?e.slice(1):r,l=!t&&i>1&&!ft(e,n)&&r.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:s}}function Pu(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Bu(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ(t,e,n,r){const s=n.map((c,h)=>{const f={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(f.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:f}}),i=s.map(c=>c.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=AJ(s,o,e),l=iJ(t.gl,a),u=t.createProgram(l);return ee().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},U9(t,e,u)))}function U9(t,e,n){const r=[],s=[];let i,o,a,l=null,u=null;u=t.getUniformLocation(n,"NAN",!1),ee().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const h of e.variableNames){const f={name:h,uniform:t.getUniformLocation(n,h,c),offset:t.getUniformLocation(n,`offset${h}`,c)};e.enableShapeUniforms&&(f.shape=t.getUniformLocation(n,`${h}Shape`,c),f.texShape=t.getUniformLocation(n,`${h}TexShape`,c)),r.push(f)}if(e.enableShapeUniforms&&(i=t.getUniformLocation(n,"outShape",c),a=t.getUniformLocation(n,"outShapeStrides",c),o=t.getUniformLocation(n,"outTexShape",c)),e.customUniforms)for(const h of e.customUniforms)s.push(t.getUniformLocation(n,h.name,c));return{variablesLocations:r,customUniformLocations:s,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function k5(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,r)=>{const s=n.logicalShape,i=e[r],o=i.shape;if(!ft(s,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${s} and ${o} must match`);if(n.isUniform&&i.isUniform)return;const a=n.texShape,l=i.isUniform?null:i.texData.texShape;if(!ft(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function dQ(t,e,n,r,s){e.program.enableShapeUniforms||(k5(e.inShapeInfos,n),k5([e.outShapeInfo],[r]));const i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):t.setOutputMatrixTexture(i.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),ee().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const u=n[l],{uniform:c,offset:h,shape:f,texShape:d}=e.variablesLocations[l];if(f){const{uniformShape:p}=sv(e.program.packedInputs,u.shape,u.texData.texShape);switch(p.length){case 1:t.gl.uniform1iv(f,new Int32Array(p));break;case 2:t.gl.uniform2iv(f,new Int32Array(p));break;case 3:t.gl.uniform3iv(f,new Int32Array(p));break;case 4:t.gl.uniform4iv(f,new Int32Array(p));break}}if(d&&t.gl.uniform2i(d,u.texData.texShape[0],u.texData.texShape[1]),c!=null){if(u.isUniform){if(se(u.shape)<2)t.gl.uniform1f(c,u.uniformValues[0]);else{let p=u.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(c,p)}continue}u.texData.slice!=null&&h!=null&&t.gl.uniform1i(h,u.texData.slice.flatOffset),t.setInputMatrixTexture(u.texData.texture.texture,c,l)}}const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const l=Re(r.shape);switch(r.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&s)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],c=e.customUniformLocations[l],h=s[l];if(u.type==="float")t.gl.uniform1fv(c,h);else if(u.type==="vec2")t.gl.uniform2fv(c,h);else if(u.type==="vec3")t.gl.uniform3fv(c,h);else if(u.type==="vec4")t.gl.uniform4fv(c,h);else if(u.type==="int")t.gl.uniform1iv(c,h);else if(u.type==="ivec2")t.gl.uniform2iv(c,h);else if(u.type==="ivec3")t.gl.uniform3iv(c,h);else if(u.type==="ivec4")t.gl.uniform4iv(c,h);else throw Error(`uniform type ${u.type} is not supported yet.`)}t.executeProgram()}function pQ(t,e,n){let r="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:c,keptDims:h}=sv(t.packedInputs,o.shape,l);let f="",d="",p="";if(c.length===1&&t.packedInputs){const w=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${w[0]>1}_${w[1]>1}`}else if(c.length===2&&!t.packedInputs)d=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!t.packedInputs){const w=Re(c);p=`${w[0]===l[1]}_${w[w.length-1]===l[1]}`}const g=o.shape.length,m=c.length===2&&ft(o.shape,l),b=se(o.shape)===1,x=Jl(o.shape,n.shape),v=!t.packedInputs&&g===n.shape.length&&ft(l,n.texData.texShape),y=t.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;r+=`${g}_${v}_${u?h:""}_${c.length}_${b}_${x}_${m}_${f}_${d}_${p}_${y}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;r+=`${o.shape}_${l}_${a}`}});const s=t.userCode;let i=t.constructor.name;return i+="_"+r+"_"+s+`${ee().getNumber("WEBGL_VERSION")}`,i}function Mn(t){return ee().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mQ{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=jc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=qn();this.outputShape=e,this.enableShapeUniforms=Mn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?rm(["r","c","d"],e):ol(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gQ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=jc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=qn();this.outputShape=e,this.enableShapeUniforms=Mn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?rm(["r","c","d"],e):ol(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bQ{constructor(e){this.variableNames=["A"],this.outTexUsage=Mr.DOWNLOAD;const n=qn();this.outputShape=e,this.userCode=`
      ${P9}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xQ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Mr.DOWNLOAD;const n=qn();this.outputShape=e,this.userCode=`
      ${P9}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yQ={R:0,G:1,B:2,A:3};class S5{constructor(e,n=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=qn();this.outputShape=e,this.enableShapeUniforms=Mn(this.outputShape.length);let i="result";n&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<r.length;a++){const l=r[a];o+=`
          if(offset == ${a}) {
            result = values[${yQ[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?rv():nv(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${s.texture2D}(A, uv);
          ${o}
        }
        ${s.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vQ{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=qn();this.outputShape=e,this.enableShapeUniforms=Mn(this.outputShape.length);let s="",i="result";n&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;s+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?rv():nv(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${s}

          ${r.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wQ(t){const e=qn(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return sJ(t,n)}function kQ(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return uJ(t,e)}function SQ(t){const e=new Uint16Array([0,1,2,2,1,3]);return cJ(t,e)}function A0(t,e,n,r,s,i){fJ(e,n);const o=hJ(t),a=t.TEXTURE_2D;return ke(t,()=>t.bindTexture(a,o)),ke(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),ke(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),ke(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),ke(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),ee().getNumber("WEBGL_VERSION")===1?ke(t,()=>t.texImage2D(a,0,r,e,n,0,s,i,null)):ke(t,()=>t.texStorage2D(a,1,r,e,n)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function G9(t){return t.internalFormatFloat}function CQ(t,e,n,r){const[s,i]=N0(e,n);return A0(t,s,i,G9(r),r.textureFormatFloat,t.FLOAT)}function H9(t){return t.internalFormatHalfFloat}function $Q(t,e,n,r){const[s,i]=N0(e,n);return A0(t,s,i,H9(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function q9(t){return t.downloadTextureFormat}function IQ(t,e,n,r){const[s,i]=N0(e,n);return A0(t,s,i,q9(r),t.RGBA,t.UNSIGNED_BYTE)}function X9(t){return t.internalFormatPackedFloat}function TQ(t,e,n,r){const[s,i]=Ou(e,n);return A0(t,s,i,X9(r),t.RGBA,t.FLOAT)}function j9(t){return t.internalFormatPackedHalfFloat}function NQ(t,e,n,r){const[s,i]=Ou(e,n);return A0(t,s,i,j9(r),t.RGBA,r.textureTypeHalfFloat)}function _Q(t,e,n){return ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),y5(t,e,"clipSpacePos",n,3,20,0)&&y5(t,e,"uv",n,2,20,12)}function AQ(t,e,n,r,s,i){ke(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;s instanceof Uint8Array?(o=new Uint8Array(n*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*r*4),a=t.FLOAT,l=i.internalFormatPackedFloat),o.set(s),ee().getNumber("WEBGL_VERSION")===2?ke(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,a,o)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,r,0,t.RGBA,a,o)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function EQ(t,e,n){ke(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?ee().getNumber("WEBGL_VERSION")===2?ke(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):ee().getNumber("WEBGL_VERSION")===2?ke(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function RQ(t,e,n,r){const s=t.createBuffer();ke(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,s));const a=4*4*e*n;return ke(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),ke(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),ke(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),s}function DQ(t,e,n){const r=t,s=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function MQ(t,e,n,r){const[s,i]=N0(e,n),o=4,a=new Uint8Array(ZZ(e*n,o));return ke(t,()=>t.readPixels(0,0,s,i,r.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function FQ(t,e,n,r,s,i,o,a){const l=t,u=new Float32Array(JZ(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function OQ(t,e,n){const r=new Float32Array(e*n*4);return ke(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _g{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=ee().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,jZ(n,e)):this.gl=Ns(n),e=this.gl,ee().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>ke(i,()=>i.createVertexArray()),this.bindVertexArray=o=>ke(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>ke(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>ke(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ke(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>ke(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>ke(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>ke(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const s="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ee().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=rf(this.gl,i),es(this.gl,o))this.textureHalfFloatExtension=rf(this.gl,o);else if(ee().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),es(this.gl,s))this.colorBufferHalfFloatExtension=rf(this.gl,s);else if(ee().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",es(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(es(this.gl,s))this.colorBufferHalfFloatExtension=this.gl.getExtension(s);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=kQ(this.gl),this.indexBuffer=SQ(this.gl),this.framebuffer=dJ(this.gl),this.textureConfig=tv(this.gl,this.textureHalfFloatExtension)}get debug(){return ee().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;ke(e,()=>e.finish()),ke(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ke(e,()=>e.deleteFramebuffer(this.framebuffer)),ke(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),ke(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),ke(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),CQ(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),$Q(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),IQ(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),EQ(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,r,s){this.throwIfDisposed(),AQ(this.gl,e,n,r,s,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),NQ(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),TQ(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(v5(this.gl,this.framebuffer),this.outputTexture=null),ke(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,r){return this.downloadMatrixDriver(e,()=>MQ(this.gl,n,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,r,s,i,o){return FQ(this.gl,e,n,r,s,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return DQ(this.gl,e,n)}createBufferFromTexture(e,n,r){this.bindTextureToFrameBuffer(e);const s=RQ(this.gl,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,r;if(ee().getBool("WEBGL_FENCE_API_ENABLED")){const s=e,i=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const o=s.clientWaitSync(i,0,0);return o===s.ALREADY_SIGNALED||o===s.CONDITION_SATISFIED},n=i}else ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(n,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:n,isFencePassed:r}}downloadMatrixFromPackedTexture(e,n,r){return this.downloadMatrixDriver(e,()=>OQ(this.gl,n,r))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=wQ(n));const r=aJ(n);ke(n,()=>n.attachShader(r,this.vertexShader)),ke(n,()=>n.attachShader(r,e)),lJ(n,r);const s=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&$g(n,s),s}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;ke(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),_Q(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(ke(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&$g(this.gl,this.program),ke(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,r=!0){return this.throwIfDisposed(),r?mJ(this.gl,e,n):gJ(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),ke(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),bJ(this.gl,e,n,r)}setOutputMatrixTexture(e,n,r){this.setOutputMatrixTextureDriver(e,r,n)}setOutputPackedMatrixTexture(e,n,r){this.throwIfDisposed();const[s,i]=Ou(n,r);this.setOutputMatrixTextureDriver(e,s,i)}setOutputMatrixWriteRegion(e,n,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,n)}setOutputPackedMatrixWriteRegion(e,n,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&$g(this.gl,this.program),sf(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ke(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ke(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=rf(this.gl,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(s.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await nw(()=>this.disposed||this.isQueryAvailable(e,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),s=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),s&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=LQ(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:r}=this.itemsToPoll[n];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in ee().platform&&(r=ee().platform.setTimeoutCustom.bind(ee().platform)),nw(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Ig(this.gl,e,this.framebuffer),this.debug&&sf(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Ig(this.gl,this.outputTexture,this.framebuffer),this.debug&&sf(this.gl)):v5(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const r=n();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,n,r){this.throwIfDisposed();const s=this.gl;Ig(s,e,this.framebuffer),this.debug&&sf(s),this.outputTexture=e,ke(s,()=>s.viewport(0,0,n,r)),ke(s,()=>s.scissor(0,0,n,r))}setOutputMatrixWriteRegionDriver(e,n,r,s){this.throwIfDisposed(),ke(this.gl,()=>this.gl.scissor(e,n,r,s))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function LQ(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:zQ,bincountImpl:K9,bincountReduceImpl:PQ,bitwiseAndImpl:BQ,castImpl:VQ,ceilImpl:WQ,concatImpl:UQ,equalImpl:GQ,expImpl:HQ,expm1Impl:qQ,floorImpl:XQ,gatherNdImpl:jQ,gatherV2Impl:KQ,greaterImpl:YQ,greaterEqualImpl:ZQ,lessImpl:JQ,lessEqualImpl:QQ,linSpaceImpl:eee,logImpl:tee,maxImpl:nee,maximumImpl:ree,minimumImpl:see,multiplyImpl:iee,negImpl:oee,notEqualImpl:aee,prodImpl:lee,raggedGatherImpl:uee,raggedRangeImpl:cee,raggedTensorToTensorImpl:hee,rangeImpl:fee,rsqrtImpl:dee,scatterImpl:pee,sigmoidImpl:mee,simpleAbsImpl:Y9,sliceImpl:gee,sparseFillEmptyRowsImpl:bee,sparseReshapeImpl:xee,sparseSegmentReductionImpl:Z9,sqrtImpl:yee,staticRegexReplaceImpl:vee,stridedSliceImpl:wee,stringNGramsImpl:kee,stringSplitImpl:See,stringToHashBucketFastImpl:Cee,subImpl:$ee,tileImpl:Iee,topKImpl:Tee,transposeImpl:iv,uniqueImpl:Nee}=Eq;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J9(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function Wn(t,e){return e===1?[t]:J9(t,e)}function _ee(t,e){if(t===1)return"rc";let n="";for(let r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aee{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Mn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=Wn("rc",this.rank),r=gt(this.rank),s=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${s}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let i=`${r===0?"r":"rp1"}, ${s===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;n.push(i)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let r=this.rank-2;r<this.rank;r++)n+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],s=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${s};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q9{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Mn(this.outputShape.length);let r="";for(let s=0;s<4;s++){let i="thisRC = rc;";s%2===1&&(i+="thisRC.z += 1;"),s>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${s}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${s>0?"}":""}
      `}this.userCode=`
      ${Eee(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?rv():nv(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function Eee(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?_J(["r","c","d"],"inputShape"):ol(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ree{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,r){const s=$5(n,r),i=I5(e,s,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=C5(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return s===yn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===yn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===yn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===yn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===yn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,r,s){if(this.freeTextures==null)return;const i=$5(r,s),o=I5(n,i,s);o in this.freeTextures||(this.freeTextures[o]=[]);const a=C5(n,i,this.gpgpu.gl,this.gpgpu.textureConfig,s),l=ee().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],c=u&&u.indexOf(e);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Dee(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function C5(t,e,n,r,s){const i=Mee(e,r);let o;if(s){const[l,u]=Ou(t[0],t[1]);o=l*u}else{const[l,u]=N0(t[0],t[1]);o=l*u}const a=Dee(n,i);return o*a}function Mee(t,e){switch(t){case yn.PACKED_2X2_FLOAT32:return X9(e);case yn.PACKED_2X2_FLOAT16:return j9(e);case yn.UNPACKED_FLOAT32:return G9(e);case yn.UNPACKED_FLOAT16:return H9(e);case yn.PACKED_4X1_UNSIGNED_BYTE:return q9(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function Fee(t){return ee().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?yn.PACKED_2X2_FLOAT32:yn.UNPACKED_FLOAT32:t?yn.PACKED_2X2_FLOAT16:yn.UNPACKED_FLOAT16}function $5(t,e){if(t===Mr.UPLOAD)return yn.PACKED_2X2_FLOAT32;if(t===Mr.RENDER||t==null)return Fee(e);if(t===Mr.DOWNLOAD||t===Mr.PIXELS)return yn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function I5(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Us{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Mn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const hs="if (isnan(x)) return x;",Oee="return x;",T5="return abs(x);",Lee="return (x >= 0.0) ? x : (exp(x) - 1.0);",zee=hs+`
  return (x < 0.0) ? 0.0 : x;
`,Pee=hs+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,so="return x;",Bee="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vee="return x;",Wee=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Uee=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Gee=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Hee="return 1.0 / (1.0 + exp(-1.0 * x));";class uo{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Mn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qee{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Mn(this.outputShape.length);const n=e.length,r=Wn("rc",n),s=gt(n),i=_ee(n,r),o=r.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${s} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xee=kS,jee=1e-7,Kee=1e-4,lf={};function Yee(t){return t in lf||(lf[t]={}),lf[t]}const Zee=ee().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Jee=600;function Qee(){return ee().global.screen==null?1024:ee().global.screen.height*ee().global.screen.width*window.devicePixelRatio*Jee/1024/1024}class sm extends C4{nextDataId(){return sm.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ee().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof _g)n=e;else{const r=Ns(ee().getNumber("WEBGL_VERSION"),e);n=new _g(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=Ns(ee().getNumber("WEBGL_VERSION"));n=new _g(r),this.binaryCache=Yee(ee().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Ree(this.gpgpu),this.numMBBeforeWarning=Qee(),this.texData=new Y8(this,Fs())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,r,s,i,o){const a=this.makeTensorInfo(n,r),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[s,i]},l.texShape=[s,i];const u=of(n),c=new S5(u,!1,o),h=this.runWebGLProgram(c,[a],r,[[s,i]]);return h.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,n,r){if((ee().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ee().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const s={id:this.nextDataId()};return this.texData.set(s,{shape:n,dtype:r,values:e,usage:Mr.UPLOAD,refCount:1}),s}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,r,s,i){if(ee().getBool("DEBUG")&&this.checkNumericalProblems(n),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:s,values:n,usage:Mr.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:r,dtype:s,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=n;if(o!=null){let f;l?f=new uo(a,so):f=new Us(a,so);const d=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:s}],s),p=this.readSync(d.dataId);return this.disposeIntermediateTensorInfo(d),p}if(r!=null)return this.convertAndCacheOnCPU(e);if(s==="string")return r;const u=this.activeTimers!=null;let c;u&&(c=Kn());let h;if(s==="complex64"){const f=this.readSync(i.real.dataId),d=this.readSync(i.imag.dataId);h=Oi(f,d)}else h=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=Kn()-c),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(g=>p.push(g))}const n=this.texData.get(e),{values:r,shape:s,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(i!=null){let p;l?p=new uo(s,so):p=new Us(s,so);const g=this.runWebGLProgram(p,[{dataId:e,shape:s,dtype:o}],o),m=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),m}if(r!=null)return this.convertAndCacheOnCPU(e);if(ee().getBool("DEBUG")&&!ee().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ee().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,c;if(o!=="complex64"&&ee().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const p=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(p.texture.texture,...nf(s))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=p[0],m=p[1];h=Oi(g,m)}else if(u==null)h=this.getValuesFromTexture(e);else{const p=se(s);h=this.gpgpu.downloadFloat32MatrixFromBuffer(u,p)}if(c!=null&&this.disposeIntermediateTensorInfo(c),u!=null){const p=this.gpgpu.gl;ke(p,()=>p.deleteBuffer(u))}const f=this.convertAndCacheOnCPU(e,h),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach(p=>p(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Fs().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,n={}){const r=this.texData.get(e),{values:s,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=r;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let d;l?d=new uo(i,so):d=new Us(i,so);const p=this.runWebGLProgram(d,[{dataId:e,shape:i,dtype:a}],a),g=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),g}if(u==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,n.customTexShape),h=Fs().makeTensorFromTensorInfo(c),f=this.texData.get(c.dataId);return Object.assign({tensorRef:h},f.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const r=n.map(s=>vo(s));return Qe(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Qe(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const r=e[n];if(!nJ(r))throw ee().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:r,isPacked:s}=this.texData.get(e),i=se(n);if(ee().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),d=this.texData.get(f.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(d.texture.texture,...nf(n)).subarray(0,i);return this.disposeIntermediateTensorInfo(f),p}const o=ee().getBool("WEBGL_PACK")&&s===!0,a=o?of(n):n,l=o?new xQ(a):new bQ(a),u=this.runWebGLProgram(l,[{shape:a,dtype:r,dataId:e}],"float32"),c=this.texData.get(u.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),h}timerAvailable(){return ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,r=[];let s=!1;this.programTimersStack==null?(this.programTimersStack=r,s=!0):this.activeTimers.push(r),this.activeTimers=r,e();const i=Ca(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Ca(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,s&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=ZD(l),a.getExtraProfileInfo=()=>l.map((u,c)=>({name:o[c],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Kn(),endMs:null}}endTimer(e){return ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Kn(),e)}async getQueryTime(e){if(ee().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,n),this.disposeData(r.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:r,texShape:s,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(s,r),this.textureManager.releaseTexture(n,s,i,o)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=Zee){return ee().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&se(r.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Rr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return Xee(e.shape,n)}packedUnaryOp(e,n,r){const s=new uo(e.shape,n),i=this.compileAndRun(s,[e],r);return Fs().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const s=Y9(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,s)}if(ee().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,T5,e.dtype);const n=new Us(e.shape,T5),r=this.compileAndRun(n,[e]);return Fs().makeTensorFromTensorInfo(r)}makeTensorInfo(e,n,r){let s;if(n==="string"&&r!=null&&r.length>0&&gh(r[0])){const i=r.map(o=>mo(o));s=this.write(i,e,n)}else s=this.write(r,e,n);return this.texData.get(s).usage=null,{dataId:s,shape:e,dtype:n}}makeOutput(e,n,r){return Fs().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,r),this)}unpackTensor(e){const n=new qee(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new Aee(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const r=[iu(e.shape),...ou(e.shape)],s={dtype:e.dtype,shape:r,dataId:e.dataId},i=[iu(n),...ou(n)],o=new Q9(i,r),a=!0,l=[r],u=this.runWebGLProgram(o,[s],e.dtype,l,a);return{dataId:u.dataId,shape:n,dtype:u.dtype}}decode(e,n){const r=this.texData.get(e),{isPacked:s,shape:i,dtype:o}=r;if(n!=null){const f=se(i),d=n[0]*n[1]*4;L(f<=d,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=of(i);let l;s?l=new gQ(a):l=new mQ(a);const u=!0,c=[n??nf(a)],h=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,c,u,n);return{dtype:o,shape:i,dataId:h.dataId}}runWebGLProgram(e,n,r,s,i=!1,o){const a=this.makeTensorInfo(e.outputShape,r),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===jc.DENSE){const b=o??nf(e.outputShape);l.texShape=b.map(x=>x*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),se(a.shape)===0)return l.values=Nn(a.dtype,0),a;const u=[],c=n.map(b=>{if(b.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let x=this.texData.get(b.dataId);if(x.texture==null){if(!e.packedInputs&&se(b.shape)<=ee().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:x.values};e.packedInputs&&(x.isPacked=!0,x.shape=b.shape)}if(this.uploadToGPU(b.dataId),!!x.isPacked!=!!e.packedInputs)b=x.isPacked?this.unpackTensor(b):this.packTensor(b),u.push(b),x=this.texData.get(b.dataId);else if(x.isPacked&&!Rd(x.shape,b.shape)){const v=b,y=b.shape;b.shape=x.shape,b=this.packedReshape(b,y),u.push(b),x=this.texData.get(b.dataId),v.shape=y}return{shape:b.shape,texData:x,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:l,isUniform:!1},f=pQ(e,c,h),d=this.getAndSaveBinary(f,()=>fQ(this.gpgpu,e,c,h)),p=this.activeTimers!=null;let g;p&&(g=this.startTimer()),ee().get("ENGINE_COMPILE_ONLY")||dQ(this.gpgpu,d,c,h,s),u.forEach(b=>this.disposeIntermediateTensorInfo(b)),p&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));const m=ee().getNumber("WEBGL_FLUSH_THRESHOLD");if(m>0){const b=Kn();b-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!ee().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const b=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),b}return a}compileAndRun(e,n,r,s,i=!1){return r=r||n[0].dtype,this.runWebGLProgram(e,n,r,s,i)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ee().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Q(()=>{if(!ee().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ee().getBool("DEBUG");ee().set("DEBUG",!1);const n=this.abs(He(1e-8)).dataSync()[0];if(ee().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?jee:Kee}uploadToGPU(e){const n=this.texData.get(e),{shape:r,dtype:s,values:i,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const u=this.activeTimers!=null;let c;u&&(c=Kn());let h=n.texShape;if(h==null&&(h=vJ(r,l),n.texShape=h),i!=null){const f=of(r);let d,p=h[1],g=h[0];const m=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!m)&&([p,g]=Ou(h[0],h[1])),l?d=new vQ(f,m):d=new S5(f,m);const b=m?[g,p]:h,x=this.makeTensorInfo(b,s),v=this.texData.get(x.dataId);m?v.usage=Mr.PIXELS:v.usage=Mr.UPLOAD,v.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),p,g,i);const y=[[g,p]],C=this.runWebGLProgram(d,[x],s,y,!0),T=this.texData.get(C.dataId);n.texShape=T.texShape,n.isPacked=T.isPacked,n.usage=T.usage,ee().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=T.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(x),u&&(this.uploadWaitMs+=Kn()-c)}else{const f=this.acquireTexture(h,a,s,l);n.texture=f}}convertAndCacheOnCPU(e,n){const r=this.texData.get(e),{dtype:s}=r;return n!=null&&(r.values=ete(n,s)),r.values}acquireTexture(e,n,r,s){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,s)}computeBytes(e,n){return e[0]*e[1]*ad(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const r=new Promise(s=>{try{this.checkCompletion_(n),s(!0)}catch(i){throw i}});e.push(r)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await VS(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(z9(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:r,infLoc:s,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=U9(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=r,e.infLoc=s,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,r){e.channels=e.channels||"RGBA";const{texture:s,height:i,width:o,channels:a}=e,l=Fs().backend;if(!l.gpgpu.gl.isTexture(s))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(s,n,r,i,o,a);return Fs().makeTensorFromDataId(u,n,r,l)}}sm.nextDataId=0;function ete(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */zk()&&Vk("webgl",()=>new sm,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ov=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Pa{constructor(e,n,r){this.variableNames=["A","B"],this.outputShape=Xe(n,r),this.enableShapeUniforms=Mn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ll=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Vu{constructor(e,n,r,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Xe(n,r);const i=this.outputShape.length;this.enableShapeUniforms=Mn(i);let o="";if(s)if(i===0||se(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${gt(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Wn("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ir(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const tte={kernelName:Lh,backendName:"webgl",kernelFunc:Ir};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Go(t){const{inputs:e,backend:n}=t,{real:r,imag:s}=e,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),a=Ir({inputs:{x:r},backend:n}),l=Ir({inputs:{x:s},backend:n});return o.complexTensorInfos={real:a,imag:l},i}const nte={kernelName:O4,backendName:"webgl",kernelFunc:Go};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eT="return (a < 0.) ? b * a : a;",tT=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function rte(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{alpha:i}=r,o=n.makeTensorInfo([],"float32",Oo(i,"float32")),a=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vu(tT,s.shape,o.shape):new Pa(eT,s.shape,o.shape),l=n.runWebGLProgram(a,[s,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const ste={kernelName:Zp,backendName:"webgl",kernelFunc:rte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nT="return (a < 0.) ? b * a : a;",rT=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function ite(t){const{inputs:e,backend:n}=t,{x:r,alpha:s}=e,i=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vu(rT,r.shape,s.shape):new Pa(nT,r.shape,s.shape);return n.runWebGLProgram(i,[r,s],"float32")}const ote={kernelName:g1,backendName:"webgl",kernelFunc:ite};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wu="if (isnan(x)) return x;";function ot({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:r}){return({inputs:s,backend:i})=>{const{x:o}=s,a=i,l=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const h=a.texData.get(o.dataId),f=n(h.values,l);return a.makeTensorInfo(o.shape,l,f)}const u=ee().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let c;return u?c=new uo(o.shape,e):c=new Us(o.shape,t),a.runWebGLProgram(c,[o],l)}}function In({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,c=a;if(r&&l.dtype==="complex64"){const p=c.texData.get(l.dataId),g=c.texData.get(u.dataId),[m,b]=[[p.complexTensorInfos.real,g.complexTensorInfos.real],[p.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(v=>{const[y,w]=v,C={dataId:y.dataId,dtype:y.dtype,shape:l.shape},T={dataId:w.dataId,dtype:w.dtype,shape:u.shape},N=new Pa(t,l.shape,u.shape);return c.runWebGLProgram(N,[C,T],Cr(y.dtype,w.dtype))}),x=Go({inputs:{real:m,imag:b},backend:c});return c.disposeIntermediateTensorInfo(m),c.disposeIntermediateTensorInfo(b),x}const h=i||Cr(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||c.shouldExecuteOnCPU([l,u]))&&s!=null){const p=c.texData.get(l.dataId).values,g=c.texData.get(u.dataId).values,m=l.dtype==="string"?Li(p):p,b=l.dtype==="string"?Li(g):g,[x,v]=s(l.shape,u.shape,m,b,h),y=c.makeTensorInfo(v,h),w=c.texData.get(y.dataId);return w.values=x,y}const f=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let d;return f?d=new Vu(e,l.shape,u.shape,n):d=new Pa(t,l.shape,u.shape),c.runWebGLProgram(d,[l,u],h)}}function Kc(t,e=!1){if(t==="linear")return e?Vee:Oee;if(t==="relu")return e?Uee:zee;if(t==="elu")return e?Wee:Lee;if(t==="relu6")return e?Gee:Pee;if(t==="prelu")return e?rT:nT;if(t==="leakyrelu")return e?tT:eT;if(t==="sigmoid")return e?Hee:Bee;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sT{constructor(e,n,r,s=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=Mn(this.outputShape.length);const c=s?e[1]:e[2],h=Math.ceil(c/2),f=s?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",p=s?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",b="";a&&(l?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:m=`vec4 activation(vec4 x) {
          ${a}
        }`,b="result = activation(result);");const x=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let v="rc.x",y="rc.x";e[0]<n[0]?v=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(y=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${m}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${v};
        int batchB = ${y};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${g[0]});
          result += (${p[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${x}

        ${b}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N5={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class _5{constructor(e,n,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Xe(n,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A5="return a * b;";function av(t){const{inputs:e,backend:n}=t,{a:r,b:s}=e,i=Cr(r.dtype,s.dtype);if(r.dtype==="complex64"){const a=n.texData.get(r.dataId),l=n.texData.get(s.dataId),u=new _5(N5.REAL,r.shape,s.shape),c=new _5(N5.IMAG,r.shape,s.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:s.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:s.shape}],f=n.runWebGLProgram(u,h,"float32"),d=n.runWebGLProgram(c,h,"float32"),p=Go({inputs:{real:f,imag:d},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),p}if(n.shouldExecuteOnCPU([r,s])){const a=n.texData.get(r.dataId),l=n.texData.get(s.dataId),[u,c]=iee(r.shape,s.shape,a.values,l.values,i),h=n.makeTensorInfo(c,i),f=n.texData.get(h.dataId);return f.values=u,h}let o;return ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Vu(A5,r.shape,s.shape):o=new Pa(A5,r.shape,s.shape),n.runWebGLProgram(o,[r,s],i)}const ate={kernelName:qh,backendName:"webgl",kernelFunc:av};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lte(t,e,n){const r=[iu(t.shape),...ou(t.shape)],s={dtype:t.dtype,shape:r,dataId:t.dataId},i=[iu(e),...ou(e)],o=new Q9(i,r),a=!0,l=[r],u=n.runWebGLProgram(o,[s],t.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function be(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{shape:i}=r,o=n,a=se(s.shape),l=J8(i,a),u=se(l);L(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${s.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(s.dataId);return c.isPacked&&!Rd(s.shape,l)&&!(c.texture!==null&&Rd(c.shape,l))?lte(s,l,o):(o.incRef(s.dataId),{dataId:s.dataId,shape:l,dtype:s.dtype})}const ute={kernelName:x1,backendName:"webgl",kernelFunc:be};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E5{constructor(e,n){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:i,outSize:o}=e;this.outputShape=[s,o];const a=Math.floor(r/4)*4,l=r%4;let u="sumValue += dot(values, ones);";if(n!=null){const h=1/n;u=`sumValue += dot(values * ${Kl(h)?h.toPrecision(2):h}, ones);`}let c="";i%r>0&&(c=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cte{constructor(e,n){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:i,outSize:o}=e;this.outputShape=[s,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");const c=Math.floor(r/4)*4,h=r%4;let f=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";n==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):n==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let p="";i%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hte(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],r=W1(n);e.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return e}function ul(t,e,n,r){const s=hte(t.shape);let i=t;for(let o=0;o<s.length;o++){const{inSize:a,windowSize:l,outSize:u}=s[o];let c,h;n==="mean"?c=o===0?new E5({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},a):new E5({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u}):c=new cte({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},n),h=i,i=r.runWebGLProgram(c,[i],e),h.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(h)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fte{constructor(e,n){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[n[o]];this.outputShape=r,this.rank=r.length;const s=gt(this.rank),i=dte(n);this.userCode=`
    void main() {
      ${s} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function dte(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let s=0;s<t.length;s++)r[t[s]]=n[s];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pte{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let c=0;c<r.length;c++)r[c]=e[n[c]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const s=gt(this.rank),i=J9("rc",this.rank),o=new Array(this.rank);for(let c=0;c<n.length;c++)o[n[c]]=i[c];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${s} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function im(t,e,n){const r=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pte(t.shape,e):new fte(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mte(t,e,n,r){const s=e,i=t.shape.length,o=et(s,t.shape);let a=o;const l=Rt(a,i),u=l!=null;let c=t;u&&(c=im(t,l,r),a=Xt(a.length,i)),$n("sum",a,i);const[h,f]=xn(c.shape,a);let d=h;n&&(d=qt(h,o));const p=se(f),m=se(t.shape)/p,b=be({inputs:{x:c},attrs:{shape:[m,p]},backend:r}),x=bx(t.dtype),v=ul(b,x,"sum",r),y=be({inputs:{x:v},attrs:{shape:d},backend:r});return r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(v),u&&r.disposeIntermediateTensorInfo(c),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function om(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r;return mte(s,i,o,n)}const gte={kernelName:C1,backendName:"webgl",kernelFunc:om};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hn(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{perm:i}=r,o=n,a=s.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=s.shape[i[c]];let u;if(o.shouldExecuteOnCPU([s])){const h=o.texData.get(s.dataId).values,f=iv(h,s.shape,s.dtype,i,l);u=o.makeTensorInfo(l,s.dtype);const d=o.texData.get(u.dataId);d.values=f}else u=im(s,i,o);return u}const bte={kernelName:Ll,backendName:"webgl",kernelFunc:Hn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iT=1e3;function Dd({a:t,b:e,transposeA:n,transposeB:r,backend:s,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=t.shape.length,c=e.shape.length,h=n?t.shape[u-2]:t.shape[u-1],f=r?e.shape[c-1]:e.shape[c-2],d=n?t.shape[u-1]:t.shape[u-2],p=r?e.shape[c-2]:e.shape[c-1],g=t.shape.slice(0,-2),m=e.shape.slice(0,-2),b=se(g),x=se(m),y=Xe(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([d,p]);L(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${r} must match.`);const w=n?[b,h,d]:[b,d,h],C=r?[x,p,f]:[x,f,p],T=be({inputs:{x:t},backend:s,attrs:{shape:w}}),N=be({inputs:{x:e},backend:s,attrs:{shape:C}}),$=[T,N],_=Math.max(b,x),S=n?T.shape[1]:T.shape[2],M=i!=null,F=o!=null,A=l==="leakyrelu",E=l!=null?Kc(l,!0):null,D=M||F||A||E!=null;let P;if((d===1||p===1)&&S>iT&&D===!1){let B=T,G=N;n&&(B=Hn({inputs:{x:T},backend:s,attrs:{perm:[0,2,1]}}),$.push(B)),r&&(G=Hn({inputs:{x:N},backend:s,attrs:{perm:[0,2,1]}}),$.push(G));const j=p!==1,Z=p===1;let ne=B;j&&(ne=be({inputs:{x:B},backend:s,attrs:{shape:[_,S,1]}}),$.push(ne));const le=p===1?2:1;let oe=G;Z&&(oe=be({inputs:{x:G},backend:s,attrs:{shape:[_,1,S]}}),$.push(oe));const de=av({inputs:{a:ne,b:oe},backend:s});P=om({inputs:{x:de},backend:s,attrs:{axis:le,keepDims:!0}}),$.push(de)}else{const B=Cr(t.dtype,e.dtype),G=new sT(w,C,[_,d,p],n,r,M,E,F,A),j=[T,N];if(i!=null&&j.push(i),F&&j.push(o),A){const Z=s.makeTensorInfo([],"float32",Oo(a,"float32"));j.push(Z),$.push(Z)}P=s.runWebGLProgram(G,j,B)}const z=be({inputs:{x:P},backend:s,attrs:{shape:y}});$.push(P);for(const B of $)s.disposeIntermediateTensorInfo(B);return z}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xte(t){const{inputs:e,backend:n,attrs:r}=t,{a:s,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=r;return Dd({a:s,b:i,transposeA:l,transposeB:u,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:c})}const yte={kernelName:ld,backendName:"webgl",kernelFunc:xte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R5="return abs(x);";function vte(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const i=n.texData.get(r.dataId),o=Y9(i.values);return n.makeTensorInfo(r.shape,r.dtype,o)}let s;return ee().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new uo(r.shape,R5):s=new Us(r.shape,R5),n.runWebGLProgram(s,[r],r.dtype)}const wte={kernelName:Ep,backendName:"webgl",kernelFunc:vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kte=hs+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Ste=ot({opSnippet:kte}),Cte={kernelName:bh,backendName:"webgl",kernelFunc:Ste};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $te=hs+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Ite=ot({opSnippet:$te}),Tte={kernelName:xh,backendName:"webgl",kernelFunc:Ite};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D5="return a + b;",Nte=In({opSnippet:D5,packedOpSnippet:D5,supportsComplex:!0,cpuKernelImpl:zQ}),_te={kernelName:Au,backendName:"webgl",kernelFunc:Nte};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ate{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});const s=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ete{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});const s=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${s};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xf(t){const{inputs:e,backend:n}=t,r=e;if(r.length===1)return Ir({inputs:{x:r[0]},backend:n});if(r.length>ee().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(r.length/2),u=Xf({inputs:r.slice(0,l),backend:n}),c=Xf({inputs:r.slice(l),backend:n});return Xf({inputs:[u,c],backend:n})}const s=r.map(l=>l.dtype).reduce((l,u)=>Cr(l,u)),i=r.map(l=>l.shape),a=ee().getBool("WEBGL_PACK")?new Ete(r[0].shape,i):new Ate(r[0].shape,i);return n.runWebGLProgram(a,r,s)}const Rte={kernelName:_4,backendName:"webgl",kernelFunc:Xf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dte(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=et(i,s.shape);let u=l;const c=Rt(u,a);let h=s;c!=null&&(h=Hn({inputs:{x:s},backend:n,attrs:{perm:c}}),u=Xt(u.length,a)),$n("all",u,a);const[f,d]=xn(h.shape,u),p=se(d),g=be({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),m=ul(g,g.dtype,"all",n);let b;if(o){const x=qt(f,l);b=be({inputs:{x:m},backend:n,attrs:{shape:x}})}else b=be({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),c!=null&&n.disposeIntermediateTensorInfo(h),b}const Mte={kernelName:A4,backendName:"webgl",kernelFunc:Dte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fte(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=et(i,s.shape);let u=l;const c=Rt(u,a);let h=s;c!=null&&(h=Hn({inputs:{x:s},backend:n,attrs:{perm:c}}),u=Xt(u.length,a)),$n("any",u,a);const[f,d]=xn(h.shape,u),p=se(d),g=be({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),m=ul(g,g.dtype,"any",n);let b;if(o){const x=qt(f,l);b=be({inputs:{x:m},backend:n,attrs:{shape:x}})}else b=be({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),c!=null&&n.disposeIntermediateTensorInfo(h),b}const Ote={kernelName:E4,backendName:"webgl",kernelFunc:Fte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lte{constructor(e,n,r){this.variableNames=["A"];const{windowSize:s,batchSize:i,outSize:o}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=n==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${s}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zte{constructor(e,n,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,L(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),s||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=gt(l),c=Wn("coords",l);let h,f;if(o===1){f=l+1;const N=gt(f);h=`
        ${N} sourceLocR = ${N}(${c.join()}, 0);
        ++${c[l-1]};
        ${N} sourceLocG = ${N}(${c.join()}, 0);
        ++${c[l-2]};
        ${N} sourceLocA = ${N}(${c.join()}, 0);
        --${c[l-1]};
        ${N} sourceLocB = ${N}(${c.join()}, 0);
        --${c[l-2]};`}else f=l,h=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;const d=["x","y","z","w","u","v"].slice(0,f),p="."+d[f-1],g=d.map(N=>"int "+N),m=Wn("sourceLocR",f-1).concat("inIdx.r"),b=Wn("sourceLocG",f-1).concat("inIdx.g"),x=Wn("sourceLocB",f-1).concat("inIdx.b"),v=Wn("sourceLocA",f-1).concat("inIdx.a"),y=r==="max"?"greaterThan":"lessThan",w=s?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${v.join()})));`,C=`vec4(
            getAChannel(${m.join()}),
            hasNextCol ? getAChannel(${b.join()}) : 0.,
            hasNextRow ? getAChannel(${x.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,T=s?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${T}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${y}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oT(t,e,n,r=null){let s=e.shape[0],i=e.shape[1];r!=null&&(s=r.shape[0],i=r.shape[1]);const o=W1(i),a={windowSize:o,inSize:i,batchSize:s,outSize:Math.ceil(i/o)},l=new Lte(a,n,r==null),u=[e];r!=null&&u.push(r);const c=t.runWebGLProgram(l,u,"int32");if(c.shape[1]===1)return c;const h=oT(t,e,n,c);return t.disposeIntermediateTensorInfo(c),h}function aT(t,e,n,r=null){const s=r!=null?r.shape:e.shape,i=s[s.length-1],o=W1(i),a=new zte(s,o,n,r==null),l=r==null?[e]:[e,r],u=t.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const c=aT(t,e,n,u);return t.disposeIntermediateTensorInfo(u),c}return u}function lT(t,e,n,r){const s=[n];if($n("arg"+r.charAt(0).toUpperCase()+r.slice(1),s,e.shape.length),!ee().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),i.push(l));const[u,c]=xn(l.shape,s),h=se(c),f=be({inputs:{x:l},backend:t,attrs:{shape:[-1,h]}});i.push(f);const d=oT(t,f,r);i.push(d);const p=be({inputs:{x:d},backend:t,attrs:{shape:u}});return i.forEach(g=>t.disposeIntermediateTensorInfo(g)),p}return aT(t,e,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pte(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i}=r;let o=et(i,s.shape);const a=Rt(o,s.shape.length);let l=s;const u=[];a!=null&&(l=Hn({inputs:{x:s},backend:n,attrs:{perm:a}}),u.push(l),o=Xt(o.length,l.shape.length)),$n("argMax",[o[0]],l.shape.length);const c=lT(n,l,o[0],"max");return u.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const Bte={kernelName:Rp,backendName:"webgl",kernelFunc:Pte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vte(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i}=r;let o=et(i,s.shape);const a=Rt(o,s.shape.length);let l=s;const u=[];a!=null&&(l=Hn({inputs:{x:s},backend:n,attrs:{perm:a}}),u.push(l),o=Xt(o.length,l.shape.length)),$n("argMin",[o[0]],l.shape.length);const c=lT(n,l,o[0],"min");return u.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}const Wte={kernelName:Dp,backendName:"webgl",kernelFunc:Vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ute=hs+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Gte=ot({opSnippet:Ute}),Hte={kernelName:yh,backendName:"webgl",kernelFunc:Gte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qte=hs+"return log(x + sqrt(x * x + 1.0));",Xte=ot({opSnippet:qte}),jte={kernelName:vh,backendName:"webgl",kernelFunc:Xte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kte=hs+`
  return atan(x);
`,Yte=ot({opSnippet:Kte}),Zte={kernelName:wh,backendName:"webgl",kernelFunc:Yte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jte=ov+`
  return atan(a, b);
`,Qte=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ll+`
  return result;
`,ene=In({opSnippet:Jte,packedOpSnippet:Qte}),tne={kernelName:Sh,backendName:"webgl",kernelFunc:ene};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nne=hs+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,rne=ot({opSnippet:nne}),sne={kernelName:kh,backendName:"webgl",kernelFunc:rne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yc{constructor(e,n,r,s=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const g=n==="avg",m=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,b=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let x="0.0";if(g||(x="-1.0 / 1e-20"),r){const N=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${d}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${N} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${s?i?m:b:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let y=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(y="avgValue / max(count, 1.0)");const w=Math.floor(o/4)*4,C=o%4,T=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${d}, ${p});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${T}
          }

          int xC = xCCorner + ${w};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${T}
          }
        }
        setOutput(${y});
      }
    `}}class lv{constructor(e,n,r,s=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,h=e.dilationHeight,f=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,g=e.effectiveFilterWidth,m=e.padInfo.front,b=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const v=n==="avg";let y="0.0";if(v||(y="-1.0 / 1e-20"),r){const _=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${m}, ${b}, ${x});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${_} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${s?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const T=Math.floor(o/4)*4,N=o%4,$=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${m}, ${b}, ${x});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${T}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${$}
            }

            int xC = xCCorner + ${T};
            if (${N===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${N===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${N===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${$}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ine(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e;_0(s,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;L(Rn(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=us(s.shape,i,o,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&ft(c.inShape,c.outShape))return Ir({inputs:{x:s},backend:n});const h=new Yc(c,"avg",!1);return n.runWebGLProgram(h,[s],"float32")}const one={kernelName:Mp,backendName:"webgl",kernelFunc:ine};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ane(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=r,c=[1,1,1],h=Ui(s.shape,i,o,c,a,l,u),f=new lv(h,"avg",!1);return n.runWebGLProgram(f,[s],"float32")}const lne={kernelName:Fp,backendName:"webgl",kernelFunc:ane};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class une{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=l-1-e.padInfo.top,h=u-1-e.padInfo.left,f=1/(n*r);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${h});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class cne{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,r=e.filterHeight,s=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=h-1-e.padInfo.front,g=f-1-e.padInfo.top,m=d-1-e.padInfo.left,b=1/(n*r*s);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${g}, ${m});
      const float avgMultiplier = float(${b});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hne(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=r,h=[1,1,1],f=Ui(o.shape,a,l,h,u,c),d=new cne(f);return n.runWebGLProgram(d,[s],o.dtype)}const fne={kernelName:D4,backendName:"webgl",kernelFunc:hne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dne(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:i}=e,o=i;_0([s,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=r,c=us(o.shape,a,l,1,u),h=new une(c);return n.runWebGLProgram(h,[s],o.dtype)}const pne={kernelName:R4,backendName:"webgl",kernelFunc:dne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mne(t){const{inputs:e,backend:n,attrs:r}=t,{a:s,b:i}=e,{transposeA:o,transposeB:a}=r;return Dd({a:s,b:i,transposeA:o,transposeB:a,backend:n})}const gne={kernelName:Op,backendName:"webgl",kernelFunc:mne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bne{constructor(e,n,r,s,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Xe(e,n),Xe(e,r);let a="0.0";s!=null&&(Xe(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(Xe(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xne{constructor(e,n,r,s,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Xe(e,n),Xe(e,r);let a="vec4(0.0)";s!=null&&(Xe(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(Xe(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yne=({inputs:t,backend:e,attrs:n})=>{const{x:r,mean:s,variance:i,offset:o,scale:a}=t;L(s.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),L(o==null||s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),L(a==null||s.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const u=[r,s,i];let c=null;o!=null&&(c=o.shape,u.push(o));let h=null;a!=null&&(h=a.shape,u.push(a));const f=ee().getBool("WEBGL_PACK_NORMALIZATION")?new xne(r.shape,s.shape,i.shape,c,h,l):new bne(r.shape,s.shape,i.shape,c,h,l);return e.runWebGLProgram(f,u,u[0].dtype)},vne={kernelName:jp,backendName:"webgl",kernelFunc:yne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wne{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=gt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=kne(this.rank);let s;const i=e.map((o,a)=>`sourceLoc.${fb[a]} = start[${a}] + coords.${fb[a]};`);s=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${s}
        setOutput(getSource(${r}));
      }
    `}}const fb=["x","y","z","w","u","v"];function kne(t){if(t===1)return"sourceLoc";if(t<=6)return fb.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sne{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=gt(this.rank),r=Wn("coords",this.rank),s=Wn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${s.slice(-2).join()})`,o=`getChannel(getSource(${s.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${s[this.rank-1]};
        result.y = ${o};
        --${s[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${s[this.rank-2]};
        result.z = ${o};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${s[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((c,h)=>`start[${h}]`).join()});`:e.map((c,h)=>`${s[h]} = ${r[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cne(t,e,n,r){const s=r.texData.get(t.dataId),i=r.makeTensorInfo(n,t.dtype),o=r.texData.get(i.dataId);Object.assign(o,s),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=ny(e,Re(t.shape));s.slice&&(a+=s.slice.flatOffset),o.slice={flatOffset:a,origDataId:s.slice&&s.slice.origDataId||t.dataId};const l=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,l+1),i}function Uu(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{begin:i,size:o}=r,[a,l]=V1(s,i,o);if(Qx(s,a,l),se(l)===0)return n.makeTensorInfo(l,s.dtype,[]);if(n.shouldExecuteOnCPU([s])||s.dtype==="string"){const h=n.texData.get(s.dataId),f=gee(h.values,a,l,s.shape,s.dtype);return n.makeTensorInfo(l,s.dtype,f)}const{isPacked:u}=n.texData.get(s.dataId),c=ty(s.shape,a,l);if(u||!c){const h=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Sne(l):new wne(l),f=[a];return n.runWebGLProgram(h,[s],s.dtype,f)}return n.uploadToGPU(s.dataId),Cne(s,a,l,n)}const $ne={kernelName:S1,backendName:"webgl",kernelFunc:Uu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ine=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockShape:i,crops:o}=r;L(s.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((x,v)=>x*v),l=g0(s.shape,i,a),u=b0(l.length,i.length),c=x0(s.shape,i,a),h=ay(o,i.length),f=ly(c,o,i.length),d=[],p=be({inputs:{x:s},backend:n,attrs:{shape:l}}),g=Hn({inputs:{x:p},backend:n,attrs:{perm:u}}),m=be({inputs:{x:g},backend:n,attrs:{shape:c}}),b=Uu({inputs:{x:m},backend:n,attrs:{begin:h,size:f}});return d.push(p),d.push(g),d.push(m),d.forEach(x=>n.disposeIntermediateTensorInfo(x)),b},Tne={kernelName:Lp,backendName:"webgl",kernelFunc:Ine};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nne(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,weights:i}=e,{size:o}=r,a=n.readSync(s.dataId),l=n.readSync(i.dataId),u=K9(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}const _ne={kernelName:M4,backendName:"webgl",kernelFunc:Nne};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ane=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,Ene=`
  return float(int(a.r) & int(b.r));
`;function Rne(t){const{inputs:e,backend:n}=t,{a:r,b:s}=e,i=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=ee().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,s])||o===1){const l=n.texData.get(r.dataId).values,u=n.texData.get(s.dataId).values,[c,h]=BQ(r.shape,s.shape,l,u,r.dtype),f=n.makeTensorInfo(h,r.dtype),d=n.texData.get(f.dataId);return d.values=c,f}let a;return i?a=new Vu(Ane,r.shape,s.shape,!1):a=new Pa(Ene,r.shape,s.shape),n.runWebGLProgram(a,[r,s],r.dtype)}const Dne={kernelName:F4,backendName:"webgl",kernelFunc:Rne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mne(t){const{inputs:e,backend:n}=t,{s0:r,s1:s}=e,i=n.readSync(r.dataId),o=n.readSync(s.dataId),a=Xe(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Fne={kernelName:sk,backendName:"webgl",kernelFunc:Mne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const One="return float(a != b);",uT=In({opSnippet:One,cpuKernelImpl:aee,dtype:"bool"}),Lne={kernelName:h1,backendName:"webgl",kernelFunc:uT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E0(t){const{inputs:e,backend:n}=t,{input:r}=e,s=n.texData.get(r.dataId);return Ir({inputs:{x:s.complexTensorInfos.real},backend:n})}const zne={kernelName:ax,backendName:"webgl",kernelFunc:E0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pne="return float(int(x));";function Bne(t,e){const n=new Us(t.shape,Pne),r=e.runWebGLProgram(n,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function db(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{dtype:i}=r;if(i==="complex64"){if(s.dtype==="complex64")return Ir({inputs:{x:s},backend:n});const o=tn(s.shape),a=db({inputs:{x:s},backend:n,attrs:{dtype:"float32"}}),l=Go({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(s.dtype==="complex64"){const o=E0({inputs:{input:s},backend:n}),a=db({inputs:{x:o},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(o),a}if(!Q8(s.dtype,i)){const o=Ir({inputs:{x:s},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(n.shouldExecuteOnCPU([s])){const o=n.texData.get(s.dataId).values,[a,l,u]=VQ(o,s.shape,s.dtype,i);return n.makeTensorInfo(a,l,u)}if(i==="int32")return Bne(s,n);if(i==="bool"){const o=n.makeTensorInfo([],"bool",Nn("bool",1)),l=uT({inputs:{a:s,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${i}`)}const Vne={kernelName:Ch,backendName:"webgl",kernelFunc:db};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M5="return ceil(x);",Wne=ot({opSnippet:M5,packedOpSnippet:M5,cpuKernelImpl:WQ}),Une={kernelName:$h,backendName:"webgl",kernelFunc:Wne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gne{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hne{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qne(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{clipValueMin:i,clipValueMax:o}=r;let a;ee().getBool("WEBGL_PACK_CLIP")?a=new Hne(s.shape):a=new Gne(s.shape);const l=[[i],[o]];return n.runWebGLProgram(a,[s],s.dtype,l)}const Xne={kernelName:Ih,backendName:"webgl",kernelFunc:qne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jne{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F5(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function Kne(t){const{inputs:e,backend:n}=t,{x:r}=e,s=n.texData.get(r.dataId),i=new jne(r.shape),o=[F5(r,s.complexTensorInfos.real),F5(r,s.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}const Yne={kernelName:zp,backendName:"webgl",kernelFunc:Kne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zne{constructor(e){this.outputShape=[],this.outputShape=Ys(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const r=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];r.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const s=n.length,i=n[n.length-1];r.push(`else setOutput(getT${s}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jne{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ys(e,n);const r=this.outputShape,s=r.length,i=gt(s),o=Wn("coords",s),a=["x","y","z","w","u","v"].slice(0,s);this.variableNames=e.map((g,m)=>`T${m}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let g=1;g<l.length;g++)l[g]=l[g-1]+e[g][n];const u=a[n],c=a.slice(-2),h=a.join();let f=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${h}), vec2(${c.join()}));
        }`;for(let g=1;g<l.length;g++){const m=l[g-1];f+=`
        if (${u} < ${l[g]}  && ${u} >= ${l[g-1]}) {
          return getChannel(
            getT${g}(${uf(a,u,m)}),
            vec2(${uf(c,u,m)}));
        }`}const d=l.length,p=l[l.length-1];f+=`
        return getChannel(
          getT${d}(${uf(a,u,p)}),
          vec2(${uf(c,u,p)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${f}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[s-1]} = ${o[s-1]} + 1;
        if (${o[s-1]} < ${r[s-1]}) {
          result.g = getValue(${o});
        }

        ${o[s-2]} = ${o[s-2]} + 1;
        if (${o[s-2]} < ${r[s-2]}) {
          result.a = getValue(${o});
        }

        ${o[s-1]} = ${o[s-1]} - 1;
        if (${o[s-2]} < ${r[s-2]} &&
            ${o[s-1]} < ${r[s-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function uf(t,e,n){const r=t.indexOf(e);return t.map((i,o)=>o===r?`${i} - ${n}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function am(t){const{inputs:e,backend:n}=t,{input:r}=e,s=n.texData.get(r.dataId);return Ir({inputs:{x:s.complexTensorInfos.imag},backend:n})}const Qne={kernelName:J4,backendName:"webgl",kernelFunc:am};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gc(t,e,n){const r=t[0].dtype;if(r==="complex64"){const d=t.map(x=>E0({inputs:{input:x},backend:n})),p=t.map(x=>am({inputs:{input:x},backend:n})),g=gc(d,e,n),m=gc(p,e,n),b=Go({inputs:{real:g,imag:m},backend:n});return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),p.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),b}let s=n.shouldExecuteOnCPU(t);if(r==="string"&&(s=!0),s){const d=t.map(y=>{const C=[-1,se(y.shape.slice(e))];return be({inputs:{x:y},backend:n,attrs:{shape:C}})}),p=d.map(y=>({vals:n.readSync(y.dataId),shape:y.shape})),g=Ys(d.map(y=>y.shape),1),m=d[0].shape[0]===1,b=UQ(p,g,r,m),x=Ys(t.map(y=>y.shape),e),v=n.makeTensorInfo(x,r,b);return d.forEach(y=>n.disposeIntermediateTensorInfo(y)),v}const i=t.filter(d=>se(d.shape)>0),o=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const d=o?new Us(t[0].shape,so):new uo(t[0].shape,so);return n.runWebGLProgram(d,t,r)}const a=ee().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const d=[];for(let g=0;g<i.length;g+=a){const m=i.slice(g,g+a);d.push(gc(m,e,n))}const p=gc(d,e,n);for(const g of d)n.disposeIntermediateTensorInfo(g);return p}if(o){const d=new Jne(i.map(p=>p.shape),e);return n.runWebGLProgram(d,i,r)}const{tensors2D:l,outShape:u}=ere(i,e,n),c=new Zne(l.map(d=>d.shape)),h=n.runWebGLProgram(c,l,r);l.forEach(d=>n.disposeIntermediateTensorInfo(d));const f=be({inputs:{x:h},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(h),f}function ere(t,e,n){const r=Ys(t.map(i=>i.shape),e);return{tensors2D:t.map(i=>be({inputs:{x:i},attrs:{shape:[-1,se(i.shape.slice(e))]},backend:n})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cT(t){const{inputs:e,backend:n,attrs:r}=t,{axis:s}=r,i=et(s,e[0].shape)[0],o=e.map(u=>u.shape);sy(o,i);const a=Ys(e.map(u=>u.shape),i);if(se(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>se(u.shape)>0);return l.length===1?Ir({inputs:{x:l[0]},backend:n}):gc(l,i,n)}const tre={kernelName:Pp,backendName:"webgl",kernelFunc:cT};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hT{constructor(e,n=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,d=e.filterWidth,p=Math.floor(e.inChannels/4)*4,g=e.inChannels%4,m=e.dataFormat==="channelsLast",b=m?1:2,x=m?2:3,v=m?3:1;let y="",w="";r&&(s?y=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?y=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:y=`
          float activation(float x) {
            ${r}
          }
        `,w="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${y}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${v}];

        ivec2 xRCCorner =
            ivec2(coords[${b}], coords[${x}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${m}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${m}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${m}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${m}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${w}
        setOutput(result);
      }
    `}}class nre{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,r=e.padInfo.top,s=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.filterDepth,f=e.filterHeight,d=e.filterWidth,p=Math.floor(e.inChannels/4)*4,g=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${r}, ${s});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fT{constructor(e,n=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Mn(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,h=c;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let m=0;m<c;m++)f+=`
           vec4 xTexelC${m*2};
           int xTexelC${m*2}Ready;
           vec4 xTexelC${m*2+1};
           int xTexelC${m*2+1}Ready;
           vec4 xC${m};`;f+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let m=0;m<c;m++)f+=`
           xTexelC${m*2} = vec4(0.0);
           xTexelC${m*2}Ready = 0;
           xTexelC${m*2+1} = vec4(0.0);
           xTexelC${m*2+1}Ready = 0;
           xC${m} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let m=0;m<(h+1)/2;m++){const b=m*2;if(f+=`
           xC = xCCorner + ${b*l};
           `,a===1){if(b<c&&(o%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }
               `,l===1&&b>0?f+=`
                 xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                   } else {
                     xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xC${b} = xTexelC${b};
                 `,b+1<c)){const x=o%2===0?$4(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${x};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                     xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${b+1}.zw = vec2(0.0);
                     }
                     xTexelC${b+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                     } else {
                      xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                     }
                     `:f+=`
                     xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                     `):x===1?f+=`
                     xC${b+1} = xTexelC${b};
                     `:f+=`
                     xCOffset = xC + ${x};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                       xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${b+1}.zw = vec2(0.0);
                       }
                       xTexelC${b+1}Ready = 1;
                     }

                     xC${b+1} = xTexelC${b+1};
                     `}}else b<c&&(o%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.0);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
               `,b+1<c&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(
                   xTexelC${b}.xy, xTexelC${b+1}.xy);
               `,b+1<c&&(f+=`
                   xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                 `)));b<c&&(f+=`
             wTexel = getW(r, ${b}, d1, d2);
             dotProd += xC${b}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${b}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,b+1<c&&(f+=`
               wTexel = getW(r, ${b+1}, d1, d2);
               dotProd += xC${b+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${b+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let d="",p="";r&&(s?d=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:i?d=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:d=`vec4 activation(vec4 x) {
           ${r}
         }`,p="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${d}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rre{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Mn(this.outputShape.length);const{dataFormat:r}=n,s=qn(),i=r==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)u+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${c};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${s.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Md(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function dT({x:t,filter:e,convInfo:n,backend:r,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,u=r.texData.get(t.dataId),c=n.inChannels,h=l[0]*l[1]*l[2],f=n.outChannels,d=n.dataFormat==="channelsLast",p=!1,g=!1;let m;const b=[];if(i!=null){const y=Md(i.shape,d);y!=null&&(i=be({inputs:{x:i},backend:r,attrs:{shape:y}}),b.push(i))}if(s!=null){const y=Md(s.shape,d);y!=null&&(s=be({inputs:{x:s},backend:r,attrs:{shape:y}}),b.push(s))}if(!((h===1||f===1)&&c>iT)&&u.isPacked&&d&&u.texture!=null&&l[2]%2!==0&&ft(u.shape.slice(-3),l.slice(-3))){const y=l[0]*l[1]*(l[2]+1),w={dataId:t.dataId,shape:[1,y,n.inChannels],dtype:t.dtype},C=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,L(Rd(u.shape,w.shape),()=>`packed reshape ${u.shape} to ${w.shape} isn't free`);const T=be({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});b.push(T);const N=Dd({a:w,b:T,backend:r,transposeA:p,transposeB:g,bias:s,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),$=r.texData.get(N.dataId);L($.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=C,$.shape=n.outShape,m=Ir({inputs:{x:N},backend:r}),m.shape=n.outShape,b.push(N)}else{const y=n.outHeight*n.outWidth,w=be({inputs:{x:t},backend:r,attrs:{shape:d?[n.batchSize,y,n.inChannels]:[n.batchSize,n.inChannels,y]}}),C=be({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),T=Dd({a:d?w:C,b:d?C:w,transposeA:!d,transposeB:g,backend:r,bias:s,activation:a,preluActivationWeights:i,leakyreluAlpha:o});m=be({inputs:{x:T},backend:r,attrs:{shape:n.outShape}}),b.push(w),b.push(C),b.push(T)}for(const y of b)r.disposeIntermediateTensorInfo(y);return m}function pT({x:t,filter:e,convInfo:n,backend:r,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:c,outWidth:h,outHeight:f,dataFormat:d}=n,p=d==="channelsLast",g=l*u*c,m=f*h,b=[n.batchSize,g,m],x=!0,v=!1,y=[];if(i!=null){const z=Md(i.shape,p);z!=null&&(i=be({inputs:{x:i},backend:r,attrs:{shape:z}}),y.push(i))}if(s!=null){const z=Md(s.shape,p);z!=null&&(s=be({inputs:{x:s},backend:r,attrs:{shape:z}}),y.push(s))}const w=be({inputs:{x:e},backend:r,attrs:{shape:[1,g,se(e.shape)/g]}});y.push(w);const C=new rre(b,n),T=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],N=r.runWebGLProgram(C,[t],"float32",T),$=be({inputs:{x:N},backend:r,attrs:{shape:b}});y.push(N),y.push($);const _=s!=null,S=i!=null,M=a==="leakyrelu",F=a?Kc(a,!0):null,A=new sT(p?$.shape:w.shape,p?w.shape:$.shape,p?[n.batchSize,m,n.outChannels]:[n.batchSize,n.outChannels,m],x,v,_,F,S,M),E=p?[$,w]:[w,$];if(s&&E.push(s),S&&E.push(i),M){const z=r.makeTensorInfo([],"float32",Oo(o,"float32"));E.push(z),y.push(z)}const D=r.runWebGLProgram(A,E,"float32"),P=be({inputs:{x:D},backend:r,attrs:{shape:n.outShape}});y.push(D);for(const z of y)r.disposeIntermediateTensorInfo(z);return P}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sre(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=r,h=Gi(l),f=Cn(s.shape,i.shape,o,u,a,c,!1,h);let d;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))d=dT({x:s,filter:i,convInfo:f,backend:n});else if(f.strideWidth<=2&&h==="channelsLast"&&ee().getBool("WEBGL_EXP_CONV")){const g=new fT(f),m=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];d=n.runWebGLProgram(g,[s,i],"float32",m)}else if(ee().getBool("WEBGL_CONV_IM2COL"))d=pT({x:s,filter:i,convInfo:f,backend:n});else{const g=new hT(f);d=n.runWebGLProgram(g,[s,i],"float32")}const p=be({inputs:{x:d},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(d),p}const ire={kernelName:Bp,backendName:"webgl",kernelFunc:sre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ore{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class are{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=r-1-e.padInfo.left,u=o?1:2,c=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class lre{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,r=e.strideHeight,s=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${s} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class ure{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,r=e.filterHeight,s=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,u=r-1-e.padInfo.top,c=s-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${s}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${s} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cre(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=r,h=Gi(l),f=Cn(s.shape,c,o,1,a,u,!1,h),d=new ore(f);return n.runWebGLProgram(d,[s,i],"float32")}const hre={kernelName:L4,backendName:"webgl",kernelFunc:cre};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fre{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Mn(this.outputShape.length);const n=e.filterHeight,r=e.filterWidth,s=n-1-e.padInfo.top,i=r-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dre(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=r,h=Gi(u),f=Cn(o,i.shape,a,1,l,c,!1,h);if(ee().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const d=[[f.strideHeight,f.strideWidth]],p=new fre(f);return n.runWebGLProgram(p,[s,i],"float32",d)}else{const d=new are(f);return n.runWebGLProgram(d,[s,i],"float32")}}const pre={kernelName:Vp,backendName:"webgl",kernelFunc:dre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mre(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r,u=zo(s.shape,i.shape,o,l,a),c=new nre(u);return n.runWebGLProgram(c,[s,i],"float32")}const gre={kernelName:Wp,backendName:"webgl",kernelFunc:mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bre(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:i}=e,{strides:o,pad:a,filterShape:l}=r,u=zo(s.shape,l,o,1,a),c=new lre(u);return n.runWebGLProgram(c,[s,i],"float32")}const xre={kernelName:z4,backendName:"webgl",kernelFunc:bre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yre(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:i}=e,{pad:o,strides:a,inputShape:l}=r,u=zo(l,i.shape,a,1,o),c=new ure(u);return n.runWebGLProgram(c,[s,i],"float32")}const vre={kernelName:P4,backendName:"webgl",kernelFunc:yre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wre=Wu+`
  return cos(x);
`,kre=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${ll}
  return result;
`,Sre=ot({opSnippet:wre,packedOpSnippet:kre}),Cre={kernelName:Th,backendName:"webgl",kernelFunc:Sre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $re=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Ire=ot({opSnippet:$re}),Tre={kernelName:Nh,backendName:"webgl",kernelFunc:Ire};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nre{constructor(e,n,r,s,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[c]=n,[h,f]=r;this.outputShape=[c,h,f,u];const d=s==="bilinear"?1:0,[p,g]=[`${a-1}.0`,`${l-1}.0`],[m,b,x]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[v,y,w]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${m});
      const float width_ratio = float(${v});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${b};
        float width_scale = ${y};

        float in_y = ${x};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _re=t=>{const{inputs:e,backend:n,attrs:r}=t,{image:s,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=r,c=new Nre(s.shape,i.shape,a,l,u);return n.runWebGLProgram(c,[s,i,o],"float32")},Are={kernelName:V4,backendName:"webgl",kernelFunc:_re};var Zc;(function(t){t.Prod="*",t.Sum="+"})(Zc||(Zc={}));class O5{constructor(e,n,r,s){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===Zc.Prod?"1.0":"0.0",a=r?o:`getX(${L5(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",c="";r?(u=s?`end != ${l-1}`:"end != 0",c=s?"end + 1":"end - 1"):(u=s?`end + pow2 < ${l}`:"end >= pow2",c=s?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${gt(i)} coords = getOutputCoords();
        int end = ${z5(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${c};
          ${z5(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${L5(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function L5(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function z5(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mT(t,e,n,r,s,i){const o=e.shape.length,a=Rt([r],o);let l=e;a!=null&&(l=Hn({inputs:{x:e},backend:n,attrs:{perm:a}}));const u=Xt(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const c=l.shape[u];let h=Ir({inputs:{x:l},backend:n});for(let f=0;f<=Math.ceil(Math.log2(c))-1;f++){const d=new O5(t,l.shape,!1,i),p=[[f]],g=h;h=n.runWebGLProgram(d,[h],h.dtype,p),n.disposeIntermediateTensorInfo(g)}if(s){const f=new O5(t,l.shape,s,i),d=h;h=n.runWebGLProgram(f,[h],h.dtype),n.disposeIntermediateTensorInfo(d)}if(a!=null){const f=Po(a),d=Hn({inputs:{x:h},backend:n,attrs:{perm:f}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),d}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ere(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;return mT(Zc.Prod,s,n,i,o,a)}const Rre={kernelName:B4,backendName:"webgl",kernelFunc:Ere};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dre(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,exclusive:o,reverse:a}=r;return mT(Zc.Sum,s,n,i,o,a)}const Mre={kernelName:Up,backendName:"webgl",kernelFunc:Dre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fre(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,weights:i}=e,{size:o,binaryOutput:a}=r;if(s.shape.length===1){const l=n.readSync(s.dataId),u=n.readSync(i.dataId),c=K9(l,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}else if(s.shape.length===2){const l=n.bufferSync(s),u=n.bufferSync(i),c=PQ(l,u,o,a);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const Ore={kernelName:W4,backendName:"webgl",kernelFunc:Fre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lre{constructor(e,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zre(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockSize:i,dataFormat:o}=r,a=s.shape[0],l=o==="NHWC"?s.shape[1]:s.shape[2],u=o==="NHWC"?s.shape[2]:s.shape[3],c=o==="NHWC"?s.shape[3]:s.shape[1],h=l*i,f=u*i,d=c/(i*i),p=o==="NHWC"?[a,h,f,d]:[a,d,h,f],g=new Lre(p,i,o);return n.runWebGLProgram(g,[s],s.dtype)}const Pre={kernelName:U4,backendName:"webgl",kernelFunc:zre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gT{constructor(e,n=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Mn(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",c="";r&&(s?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:u=`
          float activation(float x) {
            ${r}
          }
        `,c="result = activation(result);");const h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bT{constructor(e,n=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Mn(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,f=h;let d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<h;b++)d+=`
          vec4 xTexelC${b*2};
          int xTexelC${b*2}Ready;
          vec4 xTexelC${b*2+1};
          int xTexelC${b*2+1}Ready;
          vec4 xC${b};`;d+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let b=0;b<h;b++)d+=`
          xTexelC${b*2} = vec4(0.0);
          xTexelC${b*2}Ready = 0;
          xTexelC${b*2+1} = vec4(0.0);
          xTexelC${b*2+1}Ready = 0;
          xC${b} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let b=0;b<(f+1)/2;b++){const x=b*2;if(d+=`
          xC = xCCorner + ${x*u};
          `,l===1){if(x<h&&(a%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }
              `,u===1&&x>0?d+=`
                xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                  } else {
                    xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xC${x} = xTexelC${x};
                `,x+1<h)){const v=a%2===0?$4(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${v};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                    xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${x+1}.zw = vec2(0.0);
                    }
                    xTexelC${x+1}Ready = 1;
                  }
                  `,u>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                    } else {
                     xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                    }
                    `:d+=`
                    xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                    `):v===1?d+=`
                    xC${x+1} = xTexelC${x};
                    `:d+=`
                    xCOffset = xC + ${v};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                      xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${x+1}.zw = vec2(0.0);
                      }
                      xTexelC${x+1}Ready = 1;
                    }

                    xC${x+1} = xTexelC${x+1};
                    `}}else x<h&&(a%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.0);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
              `,x+1<h&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(
                  xTexelC${x}.xy, xTexelC${x+1}.xy);
              `,x+1<h&&(d+=`
                  xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                `)));x<h&&(d+=`
            wTexel = getW(r, ${x}, d1, q);
            dotProd += xC${x} * vec4(wTexel.xz, wTexel.xz);
          `,x+1<h&&(d+=`
              wTexel = getW(r, ${x+1}, d1, q);
              dotProd += xC${x+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  `,d+=`
      }
    `;let p="",g="";r&&(s?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:p=`vec4 activation(vec4 x) {
          ${r}
        }`,g="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${m}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bre(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=r;let c=l;c==null&&(c=[1,1]),L(Rn(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=Cn(s.shape,i.shape,o,c,a,u,!0);let f;ee().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?f=new bT(h):f=new gT(h);const d=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(f,[s,i],"float32",d)}const Vre={kernelName:Gp,backendName:"webgl",kernelFunc:Bre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wre{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Ure{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,o=n-1-e.padInfo.top,a=r-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gre(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=r,h=Cn(s.shape,c,o,a,l,u,!0),f=new Wre(h);return n.runWebGLProgram(f,[s,i],"float32")}const Hre={kernelName:G4,backendName:"webgl",kernelFunc:Gre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qre(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=r,h=Cn(c,i.shape,o,a,l,u,!0),f=new Ure(h);return n.runWebGLProgram(f,[s,i],"float32")}const Xre={kernelName:H4,backendName:"webgl",kernelFunc:qre};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jre{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kre(t){const{inputs:e,backend:n}=t,{x:r}=e,s=[...r.shape,...r.shape],i=se(r.shape),o=be({inputs:{x:r},backend:n,attrs:{shape:[i]}}),a=new jre(i),l=n.runWebGLProgram(a,[o],o.dtype),u=be({inputs:{x:l},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),u}const Yre={kernelName:ik,backendName:"webgl",kernelFunc:Kre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zre{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:r,padInfo:s,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:c}=e,{top:h,left:f}=s;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${h}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jre(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i}=e,{strides:o,pad:a,dilations:l}=r,u=f0(s.shape,i.shape,o,a,"NHWC",l);let c;const h=new Zre(u);c=n.runWebGLProgram(h,[s,i],"float32");const f=be({inputs:{x:c},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(c),f}const Qre={kernelName:Hp,backendName:"webgl",kernelFunc:Jre};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ese(t){const{inputs:e,backend:n,attrs:r}=t,{equation:s}=r,i=e,{allDims:o,summedDims:a,idDims:l}=gy(s,i.length);xy(o.length,l,i);const{path:u,steps:c}=yy(a,l),h=c.length;let f=null,d=o.length;const p=[];for(let g=0;g<h;++g){for(const m of c[g]){const{permutationIndices:b,expandDims:x}=by(d,l[m]);let v;vy(b)?v=i[m]:(v=Hn({inputs:{x:i[m]},backend:n,attrs:{perm:b}}),p.push(v));const y=v.shape.slice();for(let w=0;w<x.length;++w)y.splice(x[w],0,1);ft(v.shape,y)||(v=be({inputs:{x:v},backend:n,attrs:{shape:y}}),p.push(v)),f===null?f=v:(f=av({inputs:{a:v,b:f},backend:n}),p.push(f))}g<h-1&&(u[g]>=0&&(f=om({inputs:{x:f},backend:n,attrs:{axis:u[g]-(o.length-d),keepDims:!1}}),p.push(f)),d--)}for(const g of p)g!==f&&n.disposeIntermediateTensorInfo(g);return f}const tse={kernelName:q4,backendName:"webgl",kernelFunc:ese};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nse="return (x >= 0.0) ? x : (exp(x) - 1.0);",rse=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,sse=ot({opSnippet:nse,packedOpSnippet:rse}),ise={kernelName:Ah,backendName:"webgl",kernelFunc:sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ose="return (b >= 0.0) ? a : a * (b + 1.0);",ase=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,lse=t=>{const{inputs:e,backend:n}=t,{dy:r,y:s}=e,i=ee().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vu(ase,r.shape,s.shape):new Pa(ose,r.shape,s.shape);return n.runWebGLProgram(i,[r,s],r.dtype)},use={kernelName:X4,backendName:"webgl",kernelFunc:lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cse=`
  return vec4(equal(a, b));
`,hse="return float(a == b);",fse=In({opSnippet:hse,packedOpSnippet:cse,dtype:"bool",cpuKernelImpl:GQ}),dse={kernelName:qp,backendName:"webgl",kernelFunc:fse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pse=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${uy};
  float a1 = ${cy};
  float a2 = ${hy};
  float a3 = ${fy};
  float a4 = ${dy};
  float a5 = ${py};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,mse=ot({opSnippet:pse}),gse={kernelName:Eh,backendName:"webgl",kernelFunc:mse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bse=Wu+`
  return exp(x);
`,xse=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,xT=ot({opSnippet:bse,packedOpSnippet:xse,cpuKernelImpl:HQ,dtype:"float32"}),yse={kernelName:Rh,backendName:"webgl",kernelFunc:xT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pb(t){const{inputs:e,attrs:n,backend:r}=t,{dim:s}=n,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=s;return s<0&&(L(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+s+1),a.splice(l,0,1),be({inputs:{x:i},backend:r,attrs:{shape:a}})}const vse={kernelName:Xp,backendName:"webgl",kernelFunc:pb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P5="return exp(x) - 1.0;",wse=ot({opSnippet:P5,packedOpSnippet:P5,cpuKernelImpl:qQ}),kse={kernelName:Dh,backendName:"webgl",kernelFunc:wse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B5{constructor(e,n,r){this.variableNames=["real","imag"];const s=n[1];this.outputShape=n;const i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=r?`${s}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${s});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${s}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yT(t,e,n){const r=n.texData.get(t.dataId),s=se(t.shape),i=t.shape[t.shape.length-1],o=s/i,a=be({inputs:{x:t},backend:n,attrs:{shape:[o,i]}}),l=a.shape,u=new B5("real",l,e),c=new B5("imag",l,e),h=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],f=n.runWebGLProgram(u,h,"float32"),d=n.runWebGLProgram(c,h,"float32"),p=Go({inputs:{real:f,imag:d},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d);const g=be({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(t){const{inputs:e,backend:n}=t,{input:r}=e;return yT(r,!1,n)}const Cse={kernelName:j4,backendName:"webgl",kernelFunc:Sse};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $se{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R0(t){const{backend:e,attrs:n}=t,{shape:r,value:s}=n;let{dtype:i}=n;if(i=i||Nu(s),i==="string"){const o=Gt(i,se(r));return o.fill(s),e.makeTensorInfo(r,i,o)}else{const o=new $se(r,s),a=[[s]];return e.runWebGLProgram(o,[],i,a)}}const Ise={kernelName:K4,backendName:"webgl",kernelFunc:R0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tse{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nse={kernelName:Y4,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,r=e,s=new Tse(n.shape);return r.runWebGLProgram(s,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V5="return floor(x);",_se=ot({opSnippet:V5,packedOpSnippet:V5,cpuKernelImpl:XQ}),Ase={kernelName:Mh,backendName:"webgl",kernelFunc:_se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ese=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Rse=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Dse=In({opSnippet:Ese,packedOpSnippet:Rse,dtype:"int32"}),Mse={kernelName:Fh,backendName:"webgl",kernelFunc:Dse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fse{constructor(e){this.variableNames=["A"];const n=qn(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}.0, ${r}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ose{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=qn(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${s}.0, ${r}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lse={kernelName:fM,backendName:"webgl",kernelFunc:zse};let xl,Ag=ee().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function zse(t){const{inputs:e,backend:n,attrs:r}=t;let{pixels:s}=e;const{numChannels:i}=r,o=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,[l,u]=o?[s.videoWidth,s.videoHeight]:[s.width,s.height],c=[u,l],h=[u,l,i];if(a||o){const g=ee().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(xl==null||g!==Ag)&&(Ag=g,xl=document.createElement("canvas").getContext("2d",{willReadFrequently:Ag})),xl.canvas.width=l,xl.canvas.height=u,xl.drawImage(s,0,0,l,u),s=xl.canvas}const f=n.makeTensorInfo(c,"int32");n.texData.get(f.dataId).usage=Mr.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),s);const d=ee().getBool("WEBGL_PACK")?new Ose(h):new Fse(h),p=n.runWebGLProgram(d,[f],"int32");return n.disposeData(f.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pse(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=r,g=Gi(c),m=Cn(s.shape,i.shape,l,h,u,f,!1,g);let b;const x=[],v=o!=null,y=a!=null,w=d==="leakyrelu",C=()=>{const N=[s,i],$=(_,S)=>{if(S==="NCHW"&&_.shape.length===1&&_.shape[0]!==1){const M=be({inputs:{x:_},backend:n,attrs:{shape:[_.shape[0],1,1]}});return x.push(M),M}return _};if(v&&N.push($(o,c)),y&&N.push($(a,c)),w){const _=n.makeTensorInfo([],"float32",Oo(p,"float32"));N.push(_),x.push(_)}return N};if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))b=dT({x:s,filter:i,convInfo:m,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else if(m.strideWidth<=2&&g==="channelsLast"&&ee().getBool("WEBGL_EXP_CONV")){const N=d?Kc(d,!0):null,$=new fT(m,v,N,y,w),_=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],S=C();b=n.runWebGLProgram($,S,"float32",_)}else if(ee().getBool("WEBGL_CONV_IM2COL"))b=pT({x:s,filter:i,convInfo:m,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else{const N=d?Kc(d,!1):null,$=new hT(m,v,N,y,w),_=C();b=n.runWebGLProgram($,_,"float32")}const T=be({inputs:{x:b},backend:n,attrs:{shape:m.outShape}});return x.push(b),x.forEach(N=>n.disposeIntermediateTensorInfo(N)),T}const Bse={kernelName:ud,backendName:"webgl",kernelFunc:Pse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vse(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:h,activation:f,leakyreluAlpha:d}=r,p=[];let g=c;g==null&&(g=[1,1]),L(Rn(l,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${g}'`);const m=Cn(s.shape,i.shape,l,g,u,h,!0),b=ee().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,x=f?Kc(f,b):null,v=[s,i],y=o!=null,w=a!=null,C=f==="leakyrelu";if(y&&v.push(o),w&&v.push(a),C){const _=n.makeTensorInfo([],"float32",Oo(d,"float32"));v.push(_),p.push(_)}let T;b?T=new bT(m,y,x,w,C):T=new gT(m,y,x,w,C);const N=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],$=n.runWebGLProgram(T,v,"float32",N);return p.forEach(_=>n.disposeIntermediateTensorInfo(_)),$}const Wse={kernelName:Sk,backendName:"webgl",kernelFunc:Vse};class Use{constructor(e,n,r,s){this.sliceDim=e,this.strides=n,this.paramsShape=s,this.variableNames=["x","indices"],this.outputShape=r;const i=gt(r.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gse(t){const{inputs:e,backend:n}=t,{params:r,indices:s}=e,i=s.shape,o=i[i.length-1],a=se(r.shape),[l,u,c,h]=Jx(r,s),f=be({inputs:{x:s},backend:n,attrs:{shape:[u,o]}}),d=be({inputs:{x:r},backend:n,attrs:{shape:[se(r.shape)/c,c]}});if(n.shouldExecuteOnCPU([r,s])||r.dtype==="string"){const b=n.readSync(s.dataId),x=n.bufferSync(r),v=jQ(b,x,r.dtype,u,o,c,h,r.shape,a);return n.makeTensorInfo(l,r.dtype,v.values)}const p=new Use(o,h,[u,c],r.shape),g=n.runWebGLProgram(p,[d,f],d.dtype),m=be({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(g),m}const Hse={kernelName:ok,backendName:"webgl",kernelFunc:Gse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qse{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const r=gt(this.rank),s=Xse(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${s}));
      }
    `}}function Xse(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let s=0;s<t.length;s++)s===2?r.push("index"):r.push(`${n[s]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vT(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,indices:i}=e,{axis:o,batchDims:a}=r,l=et(o,s.shape)[0];if(ee().get("DEBUG")){const x=n.readSync(i.dataId),v=s.shape[l];for(let y=0;y<x.length;++y){const w=x[y];L(w<=v-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${v-1}]`)}}const u=ky(s,i,l,a),c=se(i.shape),h=[],f=be({inputs:{x:s},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),d=be({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});h.push(f),h.push(d);const p=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const x=n.bufferSync(d),v=n.bufferSync(f),y=KQ(v,x,p);return h.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(u.outputShape,y.dtype,y.values)}const g=new qse(f.shape,p),m=n.runWebGLProgram(g,[f,d],f.dtype);h.push(m);const b=be({inputs:{x:m},backend:n,attrs:{shape:u.outputShape}});return h.forEach(x=>n.disposeIntermediateTensorInfo(x)),b}const jse={kernelName:Kp,backendName:"webgl",kernelFunc:vT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kse="return float(a > b);",Yse=`
  return vec4(greaterThan(a, b));
`,Zse=In({opSnippet:Kse,packedOpSnippet:Yse,cpuKernelImpl:YQ,dtype:"bool"}),Jse={kernelName:Yp,backendName:"webgl",kernelFunc:Zse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qse="return float(a >= b);",eie=`
  return vec4(greaterThanEqual(a, b));
`,tie=In({opSnippet:Qse,packedOpSnippet:eie,dtype:"bool",cpuKernelImpl:ZQ}),nie={kernelName:Oh,backendName:"webgl",kernelFunc:tie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rie(t){const{inputs:e,backend:n}=t,{input:r}=e;return yT(r,!0,n)}const sie={kernelName:Z4,backendName:"webgl",kernelFunc:rie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iie="return float(!isnan(x) && !isinf(x));",oie=ot({opSnippet:iie,dtype:"bool"}),aie={kernelName:zh,backendName:"webgl",kernelFunc:oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lie="return float(isinf(x));",uie=ot({opSnippet:lie,dtype:"bool"}),cie={kernelName:Ph,backendName:"webgl",kernelFunc:uie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hie="return float(isnan(x));",fie=ot({opSnippet:hie,dtype:"bool"}),die={kernelName:Bh,backendName:"webgl",kernelFunc:fie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pie="return float(a < b);",mie=`
  return vec4(lessThan(a, b));
`,gie=In({opSnippet:pie,packedOpSnippet:mie,cpuKernelImpl:JQ,dtype:"bool"}),bie={kernelName:Jp,backendName:"webgl",kernelFunc:gie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xie="return float(a <= b);",yie=`
  return vec4(lessThanEqual(a, b));
`,vie=In({opSnippet:xie,packedOpSnippet:yie,cpuKernelImpl:QQ,dtype:"bool"}),wie={kernelName:Qp,backendName:"webgl",kernelFunc:vie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kie(t){const{backend:e,attrs:n}=t,{start:r,stop:s,num:i}=n,o=eee(r,s,i);return e.makeTensorInfo([o.length],"float32",o)}const Sie={kernelName:Q4,backendName:"webgl",kernelFunc:kie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cie=Wu+`
  return x < 0.0 ? 0./0. : log(x);
`,$ie=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Iie=ot({opSnippet:Cie,packedOpSnippet:$ie,cpuKernelImpl:tee}),Tie={kernelName:Vh,backendName:"webgl",kernelFunc:Iie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nie=Wu+`
  return log(1.0 + x);
`,_ie=ot({opSnippet:Nie}),Aie={kernelName:Wh,backendName:"webgl",kernelFunc:_ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eie="return float(a >= 1.0 && b >= 1.0);",Rie=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Die=In({opSnippet:Eie,packedOpSnippet:Rie,dtype:"bool"}),Mie={kernelName:e1,backendName:"webgl",kernelFunc:Die};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fie="return float(!(x >= 1.0));",Oie=ot({opSnippet:Fie}),Lie={kernelName:t1,backendName:"webgl",kernelFunc:Oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zie="return float(a >= 1.0 || b >= 1.0);",Pie=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Bie=In({opSnippet:zie,packedOpSnippet:Pie,dtype:"bool"}),Vie={kernelName:n1,backendName:"webgl",kernelFunc:Bie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wie{constructor(e,n,r,s,i){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${r}) + float(${s}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uie{constructor(e,n,r,s,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${r}) + float(${s}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gie=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=r,u=ee().getBool("WEBGL_PACK_NORMALIZATION")?new Uie(s.shape,i,o,a,l):new Wie(s.shape,i,o,a,l);return n.runWebGLProgram(u,[s],s.dtype)},Hie={kernelName:r1,backendName:"webgl",kernelFunc:Gie};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qie{constructor(e,n,r,s,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=r,this.alpha=s,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${s}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${s})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xie=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=r,h=new qie(s.shape,a,l,u,c);return n.runWebGLProgram(h,[s,i,o],s.dtype)},jie={kernelName:ex,backendName:"webgl",kernelFunc:Xie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kie(t,e,n,r){const s=se(e),o=se(t.shape)/s,a=be({inputs:{x:t},attrs:{shape:[o,s]},backend:r}),l=ul(a,t.dtype,"max",r),u=be({inputs:{x:l},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wT(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{reductionIndices:i,keepDims:o}=r,a=s.shape.length,l=et(i,s.shape);let u=l;const c=Rt(u,a),h=c!=null,f=n.shouldExecuteOnCPU([s]);let d=s;if(h){if(f){const v=n.texData.get(d.dataId).values,y=new Array(a);for(let T=0;T<y.length;T++)y[T]=s.shape[c[T]];const w=iv(v,s.shape,s.dtype,c,y);d=n.makeTensorInfo(y,s.dtype);const C=n.texData.get(d.dataId);C.values=w}else d=im(s,c,n);u=Xt(u.length,a)}$n("max",u,a);const[p,g]=xn(d.shape,u);let m=p;o&&(m=qt(p,l));let b;if(f){const v=n.texData.get(d.dataId).values,y=nee(v,se(g),m,s.dtype);b=n.makeTensorInfo(m,s.dtype);const w=n.texData.get(b.dataId);w.values=y}else b=Kie(d,g,m,n);return h&&n.disposeIntermediateTensorInfo(d),b}const Yie={kernelName:s1,backendName:"webgl",kernelFunc:wT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zie=ov+`
  return max(a, b);
`,Jie=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ll+`
  return result;
`,Qie=In({opSnippet:Zie,packedOpSnippet:Jie,cpuKernelImpl:ree}),eoe={kernelName:Uh,backendName:"webgl",kernelFunc:Qie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function toe(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e;_0(s,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=r,u=1;L(Rn(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=us(s.shape,i,o,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&ft(c.inShape,c.outShape))return Ir({inputs:{x:s},backend:n});const h=new Yc(c,"max",!1);return n.runWebGLProgram(h,[s],s.dtype)}const noe={kernelName:i1,backendName:"webgl",kernelFunc:toe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function roe(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=r,c=[1,1,1],h=Ui(s.shape,i,o,c,a,u,l),f=new lv(h,"max",!1);return n.runWebGLProgram(f,[s],s.dtype)}const soe={kernelName:o1,backendName:"webgl",kernelFunc:roe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ioe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class ooe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,r=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=l-1-e.padInfo.front,f=u-1-e.padInfo.top,d=c-1-e.padInfo.left,p=l*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${f}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aoe(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=r,h=[1,1,1],f=Ui(o.shape,a,l,h,u,c),d=new lv(f,"max",!0),p=n.runWebGLProgram(d,[o],o.dtype),g=new ooe(f),m=n.runWebGLProgram(g,[s,p],o.dtype);return n.disposeIntermediateTensorInfo(p),m}const loe={kernelName:nx,backendName:"webgl",kernelFunc:aoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uoe(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:i,output:o}=e,a=i;_0([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=r,f=us(a.shape,l,u,1,c,h),d=!0,p=new Yc(f,"max",d),g=n.runWebGLProgram(p,[a],a.dtype),m=new ioe(f),b=n.runWebGLProgram(m,[s,g],a.dtype);return n.disposeIntermediateTensorInfo(g),b}const coe={kernelName:tx,backendName:"webgl",kernelFunc:uoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hoe(t,e,n,r){let s=new Yc(n,"max",!1);const i=r.runWebGLProgram(s,[t],"float32");s=new Yc(n,"max",!0,!0,e);const o=r.runWebGLProgram(s,[t],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const foe={kernelName:ak,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:s,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;L(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const u=[1,1];L(Rn(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=us(r.shape,s,i,u,o),[h,f]=hoe(r,a,c,l);return[h,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(t,e,n,r){const s=se(e),o=se(t.shape)/s,a=be({inputs:{x:t},attrs:{shape:[o,s]},backend:r}),l=ul(a,"float32","mean",r),u=be({inputs:{x:l},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const poe={kernelName:a1,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{keepDims:s,axis:i}=e,o=n,a=r.shape.length,l=et(i,r.shape);let u=l;const c=Rt(u,a),h=c!=null,f=o.shouldExecuteOnCPU([r]),d=[];let p=r;if(h){if(f){const y=o.texData.get(p.dataId).values,w=new Array(a);for(let N=0;N<w.length;N++)w[N]=r.shape[c[N]];const C=iv(y,r.shape,r.dtype,c,w);p=o.makeTensorInfo(w,r.dtype);const T=o.texData.get(p.dataId);T.values=C}else p=im(r,c,o);d.push(p),u=Xt(u.length,a)}$n("sum",u,a);const[g,m]=xn(p.shape,u);let b=g;s&&(b=qt(g,l));const x=doe(p,m,b,o);for(const v of d)o.disposeIntermediateTensorInfo(v);return x}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function moe(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=et(i,s.shape);let u=l;const c=Rt(u,a);let h=s;c!=null&&(h=Hn({inputs:{x:s},backend:n,attrs:{perm:c}}),u=Xt(u.length,s.shape.length)),$n("min",u,a);const[f,d]=xn(h.shape,u),p=se(d),g=be({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),m=ul(g,g.dtype,"min",n);let b;if(o){const x=qt(f,l);b=be({inputs:{x:m},backend:n,attrs:{shape:x}})}else b=be({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),c!=null&&n.disposeIntermediateTensorInfo(h),b}const goe={kernelName:l1,backendName:"webgl",kernelFunc:moe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const boe=ov+`
  return min(a, b);
`,xoe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ll+`
  return result;
`,yoe=In({opSnippet:boe,packedOpSnippet:xoe,cpuKernelImpl:see}),voe={kernelName:Gh,backendName:"webgl",kernelFunc:yoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class woe{constructor(e,n,r){this.variableNames=["x"],this.outputShape=n.map((c,h)=>c[0]+e[h]+c[1]);const s=e.length,i=gt(s),o=n.map(c=>c[0]).join(","),a=n.map((c,h)=>c[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s),u=r==="reflect"?0:1;if(s===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${s}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class koe{constructor(e,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,g)=>p[0]+e[g]+p[1]);const s=e.length,i=gt(s),o=n.map(p=>p[0]).join(","),a=n.map((p,g)=>p[0]+e[g]).join(","),l=Wn("rc",s),u=Wn("source",s),c=`${l[s-1]} < ${this.outputShape[s-1]}`,h=s===1?"source":`vec2(${u.slice(-2).join()})`,f=r==="reflect"?0:1;let d="";if(s===1){const p=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;d=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[s-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
      `}else{const p=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;d=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[s-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
        rc = outputLoc;
        ${l[s-2]} += 1;
        if(${l[s-2]} < ${this.outputShape[s-2]}) {
          ${p}
          result[2] = getChannel(getX(${u.join()}), ${h});
          ${l[s-1]} += 1;
          if(${c}) {
            ${p}
            result[3] = getChannel(getX(${u.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Soe=({inputs:t,backend:e,attrs:n})=>{const{x:r}=t,{paddings:s,mode:i}=n,o=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new koe(r.shape,s,i):new woe(r.shape,s,i);return e.runWebGLProgram(o,[r],r.dtype)},Coe={kernelName:u1,backendName:"webgl",kernelFunc:Soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $oe=`if (b == 0.0) return NAN;
  return mod(a, b);`,Ioe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ll+`
  return result;
`,Toe=In({opSnippet:$oe,packedOpSnippet:Ioe}),Noe={kernelName:Hh,backendName:"webgl",kernelFunc:Toe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _oe{constructor(e,n,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aoe=`
if (a == b) {
  return 1.0;
};
return a / b;`,Eoe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,kT=In({opSnippet:Aoe,packedOpSnippet:Eoe,checkOutOfBounds:!0}),Roe={kernelName:_h,backendName:"webgl",kernelFunc:kT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W5="return a - b;",ST=In({opSnippet:W5,packedOpSnippet:W5,supportsComplex:!0,cpuKernelImpl:$ee}),Doe={kernelName:a0,backendName:"webgl",kernelFunc:ST};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CT(t){const{inputs:e,backend:n,attrs:r}=t,{logits:s}=e,{dim:i}=r,o=et([i],s.shape),a=wT({inputs:{x:s},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=qt(a.shape,o),u=be({inputs:{x:a},backend:n,attrs:{shape:l}}),c=ST({inputs:{a:s,b:u},backend:n}),h=xT({inputs:{x:c},backend:n}),f=om({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),d=be({inputs:{x:f},backend:n,attrs:{shape:l}}),p=kT({inputs:{a:h,b:d},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),p}const Moe={kernelName:T1,backendName:"webgl",kernelFunc:CT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Foe(t){const{inputs:e,backend:n,attrs:r}=t,{logits:s}=e,{numSamples:i,seed:o,normalized:a}=r,l=a?s:CT({inputs:{logits:s},backend:n,attrs:{dim:s.shape.length-1}}),u=l.shape[0],c=l.shape[1],h=new _oe(u,c,i),f=[[o]],d=n.runWebGLProgram(h,[l],"int32",f);return a||n.disposeIntermediateTensorInfo(l),d}const Ooe={kernelName:lk,backendName:"webgl",kernelFunc:Foe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Loe=hs+`
  return -x;
`,zoe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Poe(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])){const i=n.texData.get(r.dataId),[o,a]=oee(i.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,o)}let s;return ee().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new uo(r.shape,zoe):s=new Us(r.shape,Loe),n.runWebGLProgram(s,[r],r.dtype)}const Boe={kernelName:c1,backendName:"webgl",kernelFunc:Poe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Voe=qx;function Woe(t){Rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=r,u=n.readSync(s.dataId),c=n.readSync(i.dataId),{selectedIndices:h}=Voe(u,c,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const Uoe={kernelName:rx,backendName:"webgl",kernelFunc:Woe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Goe=Xx;function Hoe(t){Rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=r,c=n.readSync(s.dataId),h=n.readSync(i.dataId),{selectedIndices:f,validOutputs:d}=Goe(c,h,o,a,l,u);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const qoe={kernelName:sx,backendName:"webgl",kernelFunc:Hoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xoe=jx;function joe(t){Rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=r,c=n.readSync(s.dataId),h=n.readSync(i.dataId),f=o,d=a,p=l,g=u,{selectedIndices:m,selectedScores:b}=Xoe(c,h,f,d,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const Koe={kernelName:ix,backendName:"webgl",kernelFunc:joe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yoe{constructor(e,n,r,s){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${s}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zoe=t=>{const{inputs:e,backend:n,attrs:r}=t,{indices:s}=e,{dtype:i,depth:o,onValue:a,offValue:l}=r,u=se(s.shape),c=new Yoe(u,o,a,l),h=be({inputs:{x:s},backend:n,attrs:{shape:[u]}}),f=n.runWebGLProgram(c,[h],i);n.disposeIntermediateTensorInfo(h);const d=[...s.shape,o],p=be({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),p},Joe={kernelName:d1,backendName:"webgl",kernelFunc:Zoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fd(t){const{inputs:e,backend:n}=t,{x:r}=e;if(r.dtype==="complex64"){const s=E0({inputs:{input:r},backend:n}),i=Fd({inputs:{x:s},backend:n}),o=am({inputs:{input:r},backend:n}),a=Fd({inputs:{x:o},backend:n}),l=Go({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return R0({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:n})}const Qoe={kernelName:A1,backendName:"webgl",kernelFunc:Fd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $T(t){const{inputs:e,backend:n}=t,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const s=E0({inputs:{input:r},backend:n}),i=$T({inputs:{x:s},backend:n}),o=am({inputs:{input:r},backend:n}),a=Fd({inputs:{x:o},backend:n}),l=Go({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return R0({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n})}const eae={kernelName:f1,backendName:"webgl",kernelFunc:$T};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tae(t){const{inputs:e,backend:n,attrs:r}=t,{axis:s}=r;if(e.length===1)return pb({inputs:{input:e[0]},backend:n,attrs:{dim:s}});const i=e[0].shape,o=e[0].dtype;e.forEach(c=>{ls(i,c.shape,"All tensors passed to stack must have matching shapes"),L(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const h=pb({inputs:{input:c},backend:n,attrs:{dim:s}});return a.push(h),h}),u=cT({inputs:l,backend:n,attrs:{axis:s}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const nae={kernelName:p1,backendName:"webgl",kernelFunc:tae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rae{constructor(e,n,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((u,c)=>u[0]+e[c]+u[1]);const s=e.length,i=gt(s),o=n.map(u=>u[0]).join(","),a=n.map((u,c)=>u[0]+e[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s);if(s===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sae{constructor(e,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((g,m)=>g[0]+e[m]+g[1]);const s=e.length,i=gt(s),o=n.map(g=>g[0]).join(","),a=n.map((g,m)=>g[0]+e[m]).join(","),l=Wn("rc",s),u=Wn("source",s),c=`${l[s-1]} < ${this.outputShape[s-1]}`,h=s===1?"source":`vec2(${u.slice(-2).join()})`,f=[`${i} rc = outputLoc;`,`${l[s-1]} += 1;
       if(${c}) {
      `,s===1?"":`}
       rc = outputLoc;
       ${l[s-2]} += 1;
       if(${l[s-2]} < ${this.outputShape[s-2]}) {`,s===1?"":`  ${l[s-1]} += 1;
         if(${c}) {`],d=s===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let g=0,m=s===1?2:4;g<m;g++)p+=`
        ${f[g]}
        if (${d}) {
          result[${g}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${g}] = getChannel(getX(${u.join()}), ${h});
        }
      `;p+=s===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IT=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{paddings:i,constantValue:o}=r;if(se(s.shape)===0){const u=i.map((c,h)=>c[0]+s.shape[h]+c[1]);return R0({backend:n,attrs:{shape:u,value:o,dtype:s.dtype}})}const a=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sae(s.shape,i,o):new rae(s.shape,i,o),l=[[o]];return n.runWebGLProgram(a,[s],s.dtype,l)},iae={kernelName:m1,backendName:"webgl",kernelFunc:IT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oae=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,aae=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ll+`
  return result;
`,lae=In({opSnippet:oae,packedOpSnippet:aae}),uae={kernelName:Xh,backendName:"webgl",kernelFunc:lae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:i,keepDims:o}=r,a=s.shape.length,l=[],u=et(i,s.shape);let c=u;const h=Rt(c,a);let f=s;h!=null&&(f=Hn({inputs:{x:s},backend:n,attrs:{perm:h}}),c=Xt(c.length,a),l.push(f)),$n("prod",c,a);let d;if(n.shouldExecuteOnCPU([f])){const p=n.texData.get(f.dataId).values,{outVals:g,outShape:m,outDtype:b}=lee(f.shape,f.dtype,p,c);d=n.makeTensorInfo(m,b,g)}else{const[p,g]=xn(f.shape,c),m=se(g),b=be({inputs:{x:f},backend:n,attrs:{shape:[-1,m]}}),x=bx(s.dtype),v=ul(b,x,"prod",n);d=be({inputs:{x:v},backend:n,attrs:{shape:p}}),l.push(b),l.push(v)}if(o){l.push(d);const p=qt(d.shape,u);d=be({inputs:{x:d},backend:n,attrs:{shape:p}})}return l.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const hae={kernelName:b1,backendName:"webgl",kernelFunc:cae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fae(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:s,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=r,l=s.map(b=>n.readSync(b.dataId)),u=s.map(b=>b.shape),c=n.readSync(i.dataId),h=n.readSync(o.dataId),[f,d,p]=uee(l,u,c,i.shape,i.dtype,h,o.shape,a),g=f.map(b=>n.makeTensorInfo([b.length],"int32",b)),m=n.makeTensorInfo(p,i.dtype,d);return g.concat([m])}const dae={kernelName:uk,backendName:"webgl",kernelFunc:fae};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pae(t){const{inputs:e,backend:n}=t,{starts:r,limits:s,deltas:i}=e,o=n.readSync(r.dataId),a=n.readSync(s.dataId),l=n.readSync(i.dataId),[u,c]=cee(o,r.shape,r.dtype,a,s.shape,l,i.shape),h=n.makeTensorInfo([u.length],"int32",u),f=n.makeTensorInfo([c.length],r.dtype,c);return[h,f]}const mae={kernelName:ck,backendName:"webgl",kernelFunc:pae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gae(t){const{inputs:e,backend:n,attrs:r}=t,{shape:s,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,u=n.readSync(s.dataId),c=n.readSync(i.dataId),h=n.readSync(o.dataId),f=a.map(m=>n.readSync(m.dataId)),d=a.map(m=>m.shape),[p,g]=hee(u,s.shape,c,i.shape,i.dtype,h,o.shape,f,d,l);return n.makeTensorInfo(p,i.dtype,g)}const bae={kernelName:hk,backendName:"webgl",kernelFunc:gae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TT=t=>{const{backend:e,attrs:n}=t,{start:r,stop:s,step:i,dtype:o}=n,a=fee(r,s,i,o);return e.makeTensorInfo([a.length],o,a)},xae={kernelName:ox,backendName:"webgl",kernelFunc:TT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yae="return 1.0 / x;",vae=ot({opSnippet:yae}),wae={kernelName:jh,backendName:"webgl",kernelFunc:vae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kae=hs+`
  return (x < 0.0) ? 0.0 : x;
`,Sae=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Cae=ot({opSnippet:kae,packedOpSnippet:Sae}),$ae={kernelName:Kh,backendName:"webgl",kernelFunc:Cae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iae=hs+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Tae=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Nae=ot({opSnippet:Iae,packedOpSnippet:Tae}),_ae={kernelName:Yh,backendName:"webgl",kernelFunc:Nae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aae{constructor(e,n,r,s,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,r,u];const c=[s&&n>1?a-1:a,s&&r>1?l-1:l],h=[s&&n>1?n-1:n,s&&r>1?r-1:r];let f;i?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eae{constructor(e,n,r,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,r,u];const c=[s&&n>1?a-1:a,s&&r>1?l-1:l],h=[s&&n>1?n-1:n,s&&r>1?r-1:r];let f;i?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rae(t){const{inputs:e,backend:n,attrs:r}=t,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r,[l,u]=a,c=ee().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Eae(s.shape,l,u,i,o):new Aae(s.shape,l,u,i,o);return n.runWebGLProgram(c,[s],"float32")}const Dae={kernelName:v1,backendName:"webgl",kernelFunc:Rae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mae{constructor(e,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,s,i]=n,[,o,a]=e,l=[r&&o>1?s-1:s,r&&a>1?i-1:i],u=[r&&o>1?o-1:o,r&&a>1?a-1:a],c=l[0]/u[0],h=l[1]/u[1],f=1/c,d=1/h,p=Math.ceil(f)*2+2,g=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${s-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fae(t){const{inputs:e,backend:n,attrs:r}=t,{images:s,dy:i}=e,{alignCorners:o}=r,a=new Mae(i.shape,s.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const Oae={kernelName:ux,backendName:"webgl",kernelFunc:Fae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lae{constructor(e,n,r,s,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,r,u];const c=[s&&n>1?a-1:a,s&&r>1?l-1:l],h=[s&&n>1?n-1:n,s&&r>1?r-1:r],f=s?"0.5":"0.0";let d;i?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zae{constructor(e,n,r,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,n,r,u];const c=[s&&n>1?a-1:a,s&&r>1?l-1:l],h=[s&&n>1?n-1:n,s&&r>1?r-1:r],f=s?"0.5":"0.0";let d;i?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pae(t){const{inputs:e,backend:n,attrs:r}=t,{images:s}=e,{alignCorners:i,halfPixelCenters:o,size:a}=r,[l,u]=a,c=ee().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new zae(s.shape,l,u,i,o):new Lae(s.shape,l,u,i,o);return n.runWebGLProgram(c,[s],s.dtype)}const Bae={kernelName:y1,backendName:"webgl",kernelFunc:Pae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vae{constructor(e,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,s,i]=n,[,o,a]=e,l=[r&&o>1?s-1:s,r&&a>1?i-1:i],u=[r&&o>1?o-1:o,r&&a>1?a-1:a],c=l[0]/u[0],h=l[1]/u[1],f=1/c,d=1/h,p=Math.ceil(f)*2+2,g=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(t){const{inputs:e,backend:n,attrs:r}=t,{images:s,dy:i}=e,{alignCorners:o}=r,a=new Vae(i.shape,s.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const Uae={kernelName:lx,backendName:"webgl",kernelFunc:Wae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gae{constructor(e,n){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const s=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>s(l)).join(","),o=gt(r);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hae{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const s=Wn("rc",r),i=`${s[r-1]} + 1 < ${this.outputShape[r-1]}`,o=`${s[r-2]} + 1 < ${this.outputShape[r-2]}`,a=gt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(s.slice())};
          if(${i}){
            result.g = ${u(s.slice())};
          }
          if(${o}) {
            result.b = ${c(s.slice())};
            if(${i}) {
              result.a = ${h(s.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return f(p)}function u(p){return p[r-1]="("+p[r-1]+" + 1)",f(p)}function c(p){return p[r-2]="("+p[r-2]+" + 1)",f(p)}function h(p){return p[r-1]="("+p[r-1]+" + 1)",p[r-2]="("+p[r-2]+" + 1)",f(p)}function f(p){const g=e.map((x,v)=>d(v,p)),m=g.join(","),b=g.slice(-2).join(",");return`getChannel(getX(${m}), vec2(${b}))`}function d(p,g){return n.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${g[p]} - 1`:`${g[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qae(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{dims:i}=r,o=s.shape.length,a=et(i,s.shape);if(o===0)return Ir({inputs:{x:s},backend:n});const l=ee().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Hae(s.shape,a):new Gae(s.shape,a);return n.runWebGLProgram(l,[s],s.dtype)}const Xae={kernelName:w1,backendName:"webgl",kernelFunc:qae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jae{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],s=e[2];this.outputShape=e;let i="";typeof n=="number"?i=`float outputValue = ${n.toFixed(2)};`:i=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${s} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kae={kernelName:gx,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:s,fillValue:i,center:o}=e,a=n,l=new jae(r.shape,i),[u,c]=oy(o,r.shape[1],r.shape[2]),h=[[u,c,Math.sin(s),Math.cos(s)]];return a.runWebGLProgram(l,[r],r.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yae=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Zae=ot({opSnippet:Yae}),Jae={kernelName:Zh,backendName:"webgl",kernelFunc:Zae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qae="return inversesqrt(x);",ele=ot({opSnippet:Qae,cpuKernelImpl:dee}),tle={kernelName:Jh,backendName:"webgl",kernelFunc:ele};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uv{constructor(e,n,r,s,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=gt(i.length),c=gt(o.length);let h="";r===1?h="i":r===2&&(h="i, j");const f=`getIndices(${h})`;let d="";s===1?d="i":s===2&&(d="i, coords[1]");const p=`getUpdates(${d})`;let g="";l&&(g="coords[0], coords[1]");const m=`getDefaultValue(${g})`,b=n>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${b};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${m}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nle{constructor(e,n,r,s,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=gt(i.length),c=gt(o.length);let h="";r===1?h="i":r===2&&(h="i, j");const f=`getIndices(${h})`;let d="";s===1?d="i":s===2&&(d="i, coords[1]");const p=`getUpdates(${d})`;let g="";l&&(g="coords[0], coords[1]");const m=`getDefaultValue(${g})`,b=n>1?"strides[j]":"strides",x=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${b};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${x};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${m}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rle(t){const{inputs:e,backend:n,attrs:r}=t,{indices:s,updates:i}=e,{shape:o}=r,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=rl(i,s,o),f=[h/u,u];if(h===0)return n.makeTensorInfo(o,s.dtype);const d=be({inputs:{x:s},backend:n,attrs:{shape:[l,a]}}),p=be({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));let m;ee().getBool("WEBGL_PACK")?m=new nle(l,a,d.shape.length,p.shape.length,c,f):m=new uv(l,a,d.shape.length,p.shape.length,c,f);const b=n.runWebGLProgram(m,[p,d,g],p.dtype),x=be({inputs:{x:b},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(g),x}const sle={kernelName:fk,backendName:"webgl",kernelFunc:rle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ile{constructor(e,n,r,s){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=ee().getNumber("WEBGL_VERSION")===2?i:o,l=s==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ole(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:s,values:i}=e,{side:o}=r,a=new ile(s.shape[0],s.shape[1],i.shape[1],o),l=[[s.shape[1]]];return n.runWebGLProgram(a,[s,i],"int32",l)}const ale={kernelName:pk,backendName:"webgl",kernelFunc:ole};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lle{constructor(e,n,r){this.variableNames=["c","a","b"],this.outputShape=n;let s,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",s="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let c=0;c<n.length;c++)u.push(`${a[c]}`),c<e&&l.push(`${a[c]}`);s=l.join(),i=u.join()}const o=gt(r);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${s});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ule(t){const{inputs:e,backend:n}=t,{condition:r,t:s,e:i}=e,o=new lle(r.shape.length,s.shape,s.shape.length);return n.runWebGLProgram(o,[r,s,i],Cr(s.dtype,i.dtype))}const cle={kernelName:k1,backendName:"webgl",kernelFunc:ule};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hle=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${U1};
  float scale = ${G1};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,fle=ot({opSnippet:hle}),dle={kernelName:Qh,backendName:"webgl",kernelFunc:fle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ple=Wu+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,mle=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,gle=ot({opSnippet:ple,packedOpSnippet:mle,cpuKernelImpl:mee}),ble={kernelName:r0,backendName:"webgl",kernelFunc:gle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xle=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,yle=ot({opSnippet:xle}),vle={kernelName:n0,backendName:"webgl",kernelFunc:yle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wle=Wu+`
  return sin(x);
`,kle=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${ll}
  return result;
`,Sle=ot({opSnippet:wle,packedOpSnippet:kle}),Cle={kernelName:e0,backendName:"webgl",kernelFunc:Sle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $le=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Ile=ot({opSnippet:$le}),Tle={kernelName:t0,backendName:"webgl",kernelFunc:Ile};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nle=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,_le=ot({opSnippet:Nle}),Ale={kernelName:s0,backendName:"webgl",kernelFunc:_le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ele=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockShape:i,paddings:o}=r;L(s.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((b,x)=>b*x),l=[[0,0]];l.push(...o);for(let b=1+i.length;b<s.shape.length;++b)l.push([0,0]);const u=[],c=IT({inputs:{x:s},backend:n,attrs:{paddings:l,constantValue:0}}),h=g0(c.shape,i,a,!1),f=b0(h.length,i.length,!1),d=x0(c.shape,i,a,!1),p=be({inputs:{x:c},backend:n,attrs:{shape:h}}),g=Hn({inputs:{x:p},backend:n,attrs:{perm:f}}),m=be({inputs:{x:g},backend:n,attrs:{shape:d}});return u.push(c),u.push(p),u.push(g),u.forEach(b=>n.disposeIntermediateTensorInfo(b)),m},Rle={kernelName:$1,backendName:"webgl",kernelFunc:Ele};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dle(t){const{inputs:e,backend:n}=t,{indices:r,values:s,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${s.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(r.dataId),l=n.readSync(s.dataId),u=n.readSync(i.dataId),c=n.readSync(o.dataId)[0],[h,f,d,p,g]=bee(a,r.shape,r.dtype,l,s.dtype,u,c);return[n.makeTensorInfo(f,r.dtype,h),n.makeTensorInfo([f[0]],s.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(m=>Number(m)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}const Mle={kernelName:mk,backendName:"webgl",kernelFunc:Dle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:s,newShape:i}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.readSync(s.dataId)),a=n.readSync(r.dataId),l=Array.from(n.readSync(i.dataId)),[u,c,h]=xee(a,r.shape,r.dtype,o,l);return[n.makeTensorInfo(c,r.dtype,u),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const Ole={kernelName:gk,backendName:"webgl",kernelFunc:Fle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lle(t){const{inputs:e,backend:n}=t,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=n.readSync(r.dataId),a=n.readSync(s.dataId),l=n.readSync(i.dataId),[u,c]=Z9(o,r.shape,r.dtype,a,l,!0);return n.makeTensorInfo(c,r.dtype,u)}const zle={kernelName:bk,backendName:"webgl",kernelFunc:Lle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple(t){const{inputs:e,backend:n}=t,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=n.readSync(r.dataId),a=n.readSync(s.dataId),l=n.readSync(i.dataId),[u,c]=Z9(o,r.shape,r.dtype,a,l);return n.makeTensorInfo(c,r.dtype,u)}const Ble={kernelName:xk,backendName:"webgl",kernelFunc:Ple};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vle(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:s,sparseValues:i,defaultValue:o}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:f}=rl(i,s,a),d=!1;if(i.dtype==="string"){const b=n.bufferSync(s),x=n.bufferSync(i),v=vo(n.readSync(o.dataId)[0]),y=pee(b,x,a,f,c,u,l,h,v,d);return n.makeTensorInfo(a,y.dtype,y.values)}const p=new uv(u,l,s.shape.length,i.shape.length,h,[f,1],d),g=n.runWebGLProgram(p,[i,s,o],i.dtype),m=be({inputs:{x:g},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(g),m}const Wle={kernelName:yk,backendName:"webgl",kernelFunc:Vle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ule(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{numOrSizeSplits:i,axis:o}=r,a=et(o,s.shape)[0],l=wy(s,i,a),u=s.shape.length,c=new Array(u).fill(0),h=s.shape.slice();return l.map(f=>{const d=[...h];d[a]=f;const p=Uu({inputs:{x:s},backend:n,attrs:{begin:c,size:d}});return c[a]+=f,p})}const Gle={kernelName:I1,backendName:"webgl",kernelFunc:Ule};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U5="return sqrt(x);",Hle=ot({opSnippet:U5,packedOpSnippet:U5,cpuKernelImpl:yee}),qle={kernelName:i0,backendName:"webgl",kernelFunc:Hle};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xle="return x * x;",jle=ot({opSnippet:Xle}),Kle={kernelName:cx,backendName:"webgl",kernelFunc:jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G5="return (a - b) * (a - b);",Yle=In({opSnippet:G5,packedOpSnippet:G5}),Zle={kernelName:o0,backendName:"webgl",kernelFunc:Yle};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jle(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");const i=n.readSync(s.dataId),o=Li(i),a=vee(o,"string",r);return n.makeTensorInfo(s.shape,"string",a)}const Qle={kernelName:hx,backendName:"webgl",kernelFunc:Jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eue({inputs:t,attrs:e,backend:n}){const{x:r}=t,s=hs+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new Us(r.shape,s);return n.runWebGLProgram(i,[r],r.dtype)}const tue={kernelName:h0,backendName:"webgl",kernelFunc:eue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nue{constructor(e,n,r){this.variableNames=["x"],this.outputShape=r;const s=r.length,i=gt(r.length),o=gt(r.length);let a="";if(s===1)a="coords * strides + begin";else{let l=0;a=r.map((u,c)=>(l++,r.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${l-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rue(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:f}=r,{finalShapeSparse:d,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:b,begin:x,end:v,strides:y}=ry(s.shape,i,o,a,l,u,c,h,f);let w;if(g)w=be({inputs:{x:s},backend:n,attrs:{shape:p}});else if(m||b){L(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const T=ey(x,v,y),N=Uu({inputs:{x:s},backend:n,attrs:{begin:x,size:T}});w=be({inputs:{x:N},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(N)}else if(n.shouldExecuteOnCPU([s])){const N=n.readSync(s.dataId),$=Qe(s.shape,s.dtype,N),_=wee(d,$,y,x);w=n.makeTensorInfo(p,s.dtype,_.values)}else{const N=new nue(x,y,d);w=n.runWebGLProgram(N,[s],s.dtype)}const C=be({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),C}const sue={kernelName:fx,backendName:"webgl",kernelFunc:rue};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iue(t){const{inputs:e,backend:n,attrs:r}=t,{separator:s,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=r,{data:c,dataSplits:h}=e,f=n.readSync(c.dataId),d=n.readSync(h.dataId),[p,g]=kee(f,d,s,i,o,a,l,u);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",g)]}const oue={kernelName:vk,backendName:"webgl",kernelFunc:iue};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aue(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:s}=r,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],[u,c,h]=See(a,l,s),f=c.length;return[n.makeTensorInfo([f,2],"int32",u),n.makeTensorInfo([f],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const lue={kernelName:wk,backendName:"webgl",kernelFunc:aue};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uue(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:s}=r,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(i.dataId),a=Cee(o,s);return n.makeTensorInfo(i.shape,"int32",a)}const cue={kernelName:kk,backendName:"webgl",kernelFunc:uue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hue="return tan(x);",fue=ot({opSnippet:hue}),due={kernelName:l0,backendName:"webgl",kernelFunc:fue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pue=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,mue=ot({opSnippet:pue}),gue={kernelName:u0,backendName:"webgl",kernelFunc:mue};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bue(t){const{inputs:e,backend:n,attrs:r}=t,{tensor:s,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=rl(o,i,s.shape),f=[h/u,u];if(h===0)return n.makeTensorInfo(s.shape,i.dtype);const d=be({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),p=be({inputs:{x:o},backend:n,attrs:{shape:[l,u]}}),g=be({inputs:{x:s},backend:n,attrs:{shape:f}}),m=new uv(l,a,d.shape.length,p.shape.length,c,f,!1,!0),b=n.runWebGLProgram(m,[p,d,g],g.dtype),x=be({inputs:{x:b},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),x}const xue={kernelName:dk,backendName:"webgl",kernelFunc:bue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yue{constructor(e,n){this.variableNames=["A"];const r=new Array(e.length);for(let o=0;o<r.length;o++)r[o]=e[o]*n[o];this.outputShape=r,this.rank=r.length;const s=gt(this.rank),i=vue(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function vue(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let s=0;s<t.length;s++)r.push(`imod(${n[s]}, ${t[s]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NT(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{reps:i}=r;if(s.dtype==="string"||s.shape.length>5){const l=n.readSync(s.dataId),u=s.dtype==="string"?l.map(f=>vo(f)):l,c=Qe(s.shape,s.dtype,u),h=Iee(c,i);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new yue(s.shape,i);return n.runWebGLProgram(o,[s],s.dtype)}const wue={kernelName:c0,backendName:"webgl",kernelFunc:NT};class kue{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Sue{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jo(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function H5(t){let e=1;for(;e<t;)e*=2;return e}function Cue(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{k:i,sorted:o}=r,a=ee().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=ee().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=s.shape,c=u[u.length-1];if(n.shouldExecuteOnCPU([s])||c<a||i>l){const _=n.readSync(s.dataId),[S,M]=Tee(_,u,s.dtype,i,o);return[n.makeTensorInfo(S.shape,S.dtype,S.values),n.makeTensorInfo(M.shape,M.dtype,M.values)]}if(i===0)return u[u.length-1]=0,[n.makeTensorInfo(u,s.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(c===1)return[s,R0({attrs:{shape:u,dtype:"int32",value:0},backend:n})];const h=n.texData.get(s.dataId),f=h!==null&&h.isPacked,d=f?n.unpackTensor(s):s,g=se(u)/c,m=be({inputs:{x:d},attrs:{shape:[g,c]},backend:n});f&&Jo(n,d);const b=H5(i),x=H5(c);let v=null;const y=()=>v===null?[m,m]:[m,v],w=(_,S,M)=>{const F=y(),A=new kue(M),D=[[c],[v===null?1:0],[Number.NEGATIVE_INFINITY],[_],[S]],P=v;v=n.runWebGLProgram(A,F,"int32",D),Jo(n,P)};for(let _=1;_<b;_*=2){const S=_*2;for(let M=_;M>=1;M/=2)w(S,M,[g,x])}for(let _=x;_>b;_/=2){const S=y(),M=new Sue([g,_/2]),A=[[c],[v===null?1:0],[b]],E=v;v=n.runWebGLProgram(M,S,"int32",A),Jo(n,E);const D=b/2,P=D*2;for(let z=D;z>=1;z/=2)w(P,z,v.shape)}let C=v;v=Uu({inputs:{x:v},backend:n,attrs:{begin:0,size:[g,i]}}),Jo(n,C);let T=vT({inputs:{x:m,indices:v},backend:n,attrs:{axis:1,batchDims:1}});Jo(n,m);const N=u.slice(0,-1);N.push(i),C=v,v=be({inputs:{x:v},attrs:{shape:N},backend:n}),Jo(n,C);const $=T;return T=be({inputs:{x:T},attrs:{shape:N},backend:n}),Jo(n,$),[T,v]}const $ue={kernelName:dx,backendName:"webgl",kernelFunc:Cue};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iue{constructor(e,n,r,s,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=r==="nearest"?1:2;let l;switch(s){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tue(t){const{inputs:e,backend:n,attrs:r}=t,{image:s,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=r,[c,h,f,d]=s.shape,[p,g]=u??[h,f],m=[c,p,g,d],b=new Iue(h,f,o,a,l,m);return n.runWebGLProgram(b,[s,i],"float32")}const Nue={kernelName:px,backendName:"webgl",kernelFunc:Tue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ue(t){const{inputs:e,attrs:n,backend:r}=t,{axis:s}=n,{x:i}=e;_0(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=Nee(o,s,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([u.length],"int32",u)]}const Aue={kernelName:mx,backendName:"webgl",kernelFunc:_ue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eue(t){const{inputs:e,backend:n,attrs:r}=t,{value:s}=e;let{axis:i}=r;i<0&&(i+=s.shape.length);const o=s,a=o.shape.length,l=s.shape[i],u=new Array(a-1);let c=0;for(let g=0;g<a;g++)g!==i&&(u[c++]=o.shape[g]);const h=[],f=new Array(a).fill(0),d=o.shape.slice();d[i]=1;const p=new Array(l);for(let g=0;g<p.length;g++){f[i]=g;const m=Uu({inputs:{x:o},backend:n,attrs:{begin:f,size:d}}),b=be({inputs:{x:m},backend:n,attrs:{shape:u}});p[g]=b,h.push(m)}return h.forEach(g=>n.disposeIntermediateTensorInfo(g)),p}const Rue={kernelName:N1,backendName:"webgl",kernelFunc:Eue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Due{constructor(e,n){this.variableNames=["x","segmentIds"];const r=e.windowSize,s=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/r);this.outputShape=[s,a];const l="0.0",u="sumValue",c=Math.floor(r/4)*4,h=r%4,f=`
        sumValue += dot(values, segFilter);
    `;let d="";i%r>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let p="";i%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mue(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,segmentIds:i}=e,{numSegments:o}=r,a=s.shape.length,l=[];let u=0;const c=Rt([u],a);let h=s;c!=null&&(h=Hn({inputs:{x:s},backend:n,attrs:{perm:c}}),l.push(h),u=Xt(1,a)[0]);const f=cC(h.shape,u,o),d=se([h.shape[u]]),p=be({inputs:{x:h},backend:n,attrs:{shape:[-1,d]}});l.push(p);const g=bx(s.dtype),m=(y,w,C,T,N)=>{const $=y.shape[0],_=y.shape[1],S=uC(_,N),M={windowSize:S,inSize:_,batchSize:$,numSegments:N},F=new Due(M,w),A=n.compileAndRun(F,[y,C],T);if(l.push(A),A.shape[1]===N)return A;const E=TT({backend:n,attrs:{start:0,stop:N,step:1,dtype:"float32"}}),D=NT({inputs:{x:E},backend:n,attrs:{reps:[_/S]}});return l.push(E),l.push(D),m(A,w,D,T,N)},b=m(p,"unsortedSegmentSum",i,g,o),x=be({inputs:{x:b},backend:n,attrs:{shape:f}});let v=x;if(c!=null){l.push(x);const y=Po(c);v=Hn({inputs:{x:v},backend:n,attrs:{perm:y}})}return l.forEach(y=>n.disposeIntermediateTensorInfo(y)),v}const Fue={kernelName:_1,backendName:"webgl",kernelFunc:Mue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oue=[yte,wte,Cte,Tte,_te,Rte,Mte,Ote,Bte,Wte,Hte,jte,Zte,tne,sne,one,lne,fne,pne,gne,vne,Tne,_ne,Dne,Fne,Vne,Une,Xne,nte,Yne,tre,ire,hre,pre,gre,xre,vre,Cre,Tre,Are,Rre,Mre,Ore,Pre,Vre,Hre,Xre,Yre,Qre,tse,ise,use,dse,gse,yse,vse,kse,Cse,Ise,Nse,Ase,Mse,Lse,Bse,Wse,Hse,jse,Jse,nie,tte,sie,Qne,aie,cie,die,ste,bie,wie,Sie,Tie,Aie,Mie,Lie,Vie,Hie,jie,Yie,eoe,noe,soe,loe,coe,foe,poe,goe,voe,Coe,Noe,Ooe,ate,Boe,Uoe,qoe,Koe,Lne,Joe,eae,nae,iae,uae,ote,hae,dae,mae,bae,xae,zne,Roe,wae,$ae,_ae,ute,Dae,Oae,Bae,Uae,Xae,Kae,Jae,tle,sle,ale,cle,dle,ble,vle,Cle,Tle,$ne,Moe,Ale,Rle,Mle,Ole,zle,Ble,Wle,Gle,qle,Kle,Zle,Qle,tue,sue,oue,lue,cue,Doe,gte,due,gue,xue,wue,$ue,Nue,bte,Aue,Rue,Fue,Qoe];for(const t of Oue)Ck(t);function zt(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function _T(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function lm(t){let e,n,r;t.length!==2?(e=zt,n=(a,l)=>zt(t(a),l),r=(a,l)=>t(a)-l):(e=t===zt||t===_T?t:Lue,n=t,r=t);function s(a,l,u=0,c=a.length){if(u<c){if(e(l,l)!==0)return c;do{const h=u+c>>>1;n(a[h],l)<0?u=h+1:c=h}while(u<c)}return u}function i(a,l,u=0,c=a.length){if(u<c){if(e(l,l)!==0)return c;do{const h=u+c>>>1;n(a[h],l)<=0?u=h+1:c=h}while(u<c)}return u}function o(a,l,u=0,c=a.length){const h=s(a,l,u,c-1);return h>u&&r(a[h-1],l)>-r(a[h],l)?h-1:h}return{left:s,center:o,right:i}}function Lue(){return 0}function Od(t){return t===null?NaN:+t}function*zue(t,e){if(e===void 0)for(let n of t)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of t)(r=e(r,++n,t))!=null&&(r=+r)>=r&&(yield r)}}const AT=lm(zt),Io=AT.right,Pue=AT.left,Bue=lm(Od).center;function Vue(t,e){if(!((e=+e)>=0))throw new RangeError("invalid r");let n=t.length;if(!((n=Math.floor(n))>=0))throw new RangeError("invalid length");if(!n||!e)return t;const r=cv(e),s=t.slice();return r(t,s,0,n,1),r(s,t,0,n,1),r(t,s,0,n,1),t}const ET=RT(cv),Wue=RT(Uue);function RT(t){return function(e,n,r=n){if(!((n=+n)>=0))throw new RangeError("invalid rx");if(!((r=+r)>=0))throw new RangeError("invalid ry");let{data:s,width:i,height:o}=e;if(!((i=Math.floor(i))>=0))throw new RangeError("invalid width");if(!((o=Math.floor(o!==void 0?o:s.length/i))>=0))throw new RangeError("invalid height");if(!i||!o||!n&&!r)return e;const a=n&&t(n),l=r&&t(r),u=s.slice();return a&&l?(yl(a,u,s,i,o),yl(a,s,u,i,o),yl(a,u,s,i,o),vl(l,s,u,i,o),vl(l,u,s,i,o),vl(l,s,u,i,o)):a?(yl(a,s,u,i,o),yl(a,u,s,i,o),yl(a,s,u,i,o)):l&&(vl(l,s,u,i,o),vl(l,u,s,i,o),vl(l,s,u,i,o)),e}}function yl(t,e,n,r,s){for(let i=0,o=r*s;i<o;)t(e,n,i,i+=r,1)}function vl(t,e,n,r,s){for(let i=0,o=r*s;i<r;++i)t(e,n,i,i+o,r)}function Uue(t){const e=cv(t);return(n,r,s,i,o)=>{s<<=2,i<<=2,o<<=2,e(n,r,s+0,i+0,o),e(n,r,s+1,i+1,o),e(n,r,s+2,i+2,o),e(n,r,s+3,i+3,o)}}function cv(t){const e=Math.floor(t);if(e===t)return Gue(t);const n=t-e,r=2*t+1;return(s,i,o,a,l)=>{if(!((a-=l)>=o))return;let u=e*i[o];const c=l*e,h=c+l;for(let f=o,d=o+c;f<d;f+=l)u+=i[Math.min(a,f)];for(let f=o,d=a;f<=d;f+=l)u+=i[Math.min(a,f+c)],s[f]=(u+n*(i[Math.max(o,f-h)]+i[Math.min(a,f+h)]))/r,u-=i[Math.max(o,f-c)]}}function Gue(t){const e=2*t+1;return(n,r,s,i,o)=>{if(!((i-=o)>=s))return;let a=t*r[s];const l=o*t;for(let u=s,c=s+l;u<c;u+=o)a+=r[Math.min(i,u)];for(let u=s,c=i;u<=c;u+=o)a+=r[Math.min(i,u+l)],n[u]=a/e,a-=r[Math.max(s,u-l)]}}function um(t,e){let n=0;if(e===void 0)for(let r of t)r!=null&&(r=+r)>=r&&++n;else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(s=+s)>=s&&++n}return n}function Hue(t){return t.length|0}function que(t){return!(t>0)}function Xue(t){return typeof t!="object"||"length"in t?t:Array.from(t)}function jue(t){return e=>t(...e)}function Kue(...t){const e=typeof t[t.length-1]=="function"&&jue(t.pop());t=t.map(Xue);const n=t.map(Hue),r=t.length-1,s=new Array(r+1).fill(0),i=[];if(r<0||n.some(que))return i;for(;;){i.push(s.map((a,l)=>t[l][a]));let o=r;for(;++s[o]===n[o];){if(o===0)return e?i.map(e):i;s[o--]=0}}}function Yue(t,e){var n=0,r=0;return Float64Array.from(t,e===void 0?s=>n+=+s||0:s=>n+=+e(s,r++,t)||0)}function DT(t,e){let n=0,r,s=0,i=0;if(e===void 0)for(let o of t)o!=null&&(o=+o)>=o&&(r=o-s,s+=r/++n,i+=r*(o-s));else{let o=-1;for(let a of t)(a=e(a,++o,t))!=null&&(a=+a)>=a&&(r=a-s,s+=r/++n,i+=r*(a-s))}if(n>1)return i/(n-1)}function MT(t,e){const n=DT(t,e);return n&&Math.sqrt(n)}function Rc(t,e){let n,r;if(e===void 0)for(const s of t)s!=null&&(n===void 0?s>=s&&(n=r=s):(n>s&&(n=s),r<s&&(r=s)));else{let s=-1;for(let i of t)(i=e(i,++s,t))!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)))}return[n,r]}class bn{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const n=this._partials;let r=0;for(let s=0;s<this._n&&s<32;s++){const i=n[s],o=e+i,a=Math.abs(e)<Math.abs(i)?e-(o-i):i-(o-e);a&&(n[r++]=a),e=o}return n[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let n=this._n,r,s,i,o=0;if(n>0){for(o=e[--n];n>0&&(r=o,s=e[--n],o=r+s,i=s-(o-r),!i););n>0&&(i<0&&e[n-1]<0||i>0&&e[n-1]>0)&&(s=i*2,r=o+s,s==r-o&&(o=r))}return o}}function Zue(t,e){const n=new bn;if(e===void 0)for(let r of t)(r=+r)&&n.add(r);else{let r=-1;for(let s of t)(s=+e(s,++r,t))&&n.add(s)}return+n}function Jue(t,e){const n=new bn;let r=-1;return Float64Array.from(t,e===void 0?s=>n.add(+s||0):s=>n.add(+e(s,++r,t)||0))}class Jc extends Map{constructor(e,n=LT){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[r,s]of e)this.set(r,s)}get(e){return super.get(mb(this,e))}has(e){return super.has(mb(this,e))}set(e,n){return super.set(FT(this,e),n)}delete(e){return super.delete(OT(this,e))}}class Ba extends Set{constructor(e,n=LT){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const r of e)this.add(r)}has(e){return super.has(mb(this,e))}add(e){return super.add(FT(this,e))}delete(e){return super.delete(OT(this,e))}}function mb({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function FT({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function OT({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function LT(t){return t!==null&&typeof t=="object"?t.valueOf():t}function au(t){return t}function zT(t,...e){return Gu(t,au,au,e)}function PT(t,...e){return Gu(t,Array.from,au,e)}function BT(t,e){for(let n=1,r=e.length;n<r;++n)t=t.flatMap(s=>s.pop().map(([i,o])=>[...s,i,o]));return t}function Que(t,...e){return BT(PT(t,...e),e)}function ece(t,e,...n){return BT(WT(t,e,...n),n)}function VT(t,e,...n){return Gu(t,au,e,n)}function WT(t,e,...n){return Gu(t,Array.from,e,n)}function tce(t,...e){return Gu(t,au,UT,e)}function nce(t,...e){return Gu(t,Array.from,UT,e)}function UT(t){if(t.length!==1)throw new Error("duplicate key");return t[0]}function Gu(t,e,n,r){return function s(i,o){if(o>=r.length)return n(i);const a=new Jc,l=r[o++];let u=-1;for(const c of i){const h=l(c,++u,i),f=a.get(h);f?f.push(c):a.set(h,[c])}for(const[c,h]of a)a.set(c,s(h,o));return e(a)}(t,0)}function GT(t,e){return Array.from(e,n=>t[n])}function gb(t,...e){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");t=Array.from(t);let[n]=e;if(n&&n.length!==2||e.length>1){const r=Uint32Array.from(t,(s,i)=>i);return e.length>1?(e=e.map(s=>t.map(s)),r.sort((s,i)=>{for(const o of e){const a=lu(o[s],o[i]);if(a)return a}})):(n=t.map(n),r.sort((s,i)=>lu(n[s],n[i]))),GT(t,r)}return t.sort(hv(n))}function hv(t=zt){if(t===zt)return lu;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,n)=>{const r=t(e,n);return r||r===0?r:(t(n,n)===0)-(t(e,e)===0)}}function lu(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}function rce(t,e,n){return(e.length!==2?gb(VT(t,e,n),([r,s],[i,o])=>zt(s,o)||zt(r,i)):gb(zT(t,n),([r,s],[i,o])=>e(s,o)||zt(r,i))).map(([r])=>r)}var sce=Array.prototype,ice=sce.slice;function Eg(t){return()=>t}const oce=Math.sqrt(50),ace=Math.sqrt(10),lce=Math.sqrt(2);function Ld(t,e,n){const r=(e-t)/Math.max(0,n),s=Math.floor(Math.log10(r)),i=r/Math.pow(10,s),o=i>=oce?10:i>=ace?5:i>=lce?2:1;let a,l,u;return s<0?(u=Math.pow(10,-s)/o,a=Math.round(t*u),l=Math.round(e*u),a/u<t&&++a,l/u>e&&--l,u=-u):(u=Math.pow(10,s)*o,a=Math.round(t/u),l=Math.round(e/u),a*u<t&&++a,l*u>e&&--l),l<a&&.5<=n&&n<2?Ld(t,e,n*2):[a,l,u]}function Va(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[s,i,o]=r?Ld(e,t,n):Ld(t,e,n);if(!(i>=s))return[];const a=i-s+1,l=new Array(a);if(r)if(o<0)for(let u=0;u<a;++u)l[u]=(i-u)/-o;else for(let u=0;u<a;++u)l[u]=(i-u)*o;else if(o<0)for(let u=0;u<a;++u)l[u]=(s+u)/-o;else for(let u=0;u<a;++u)l[u]=(s+u)*o;return l}function Wa(t,e,n){return e=+e,t=+t,n=+n,Ld(t,e,n)[2]}function zd(t,e,n){e=+e,t=+t,n=+n;const r=e<t,s=r?Wa(e,t,n):Wa(t,e,n);return(r?-1:1)*(s<0?1/-s:s)}function fv(t,e,n){let r;for(;;){const s=Wa(t,e,n);if(s===r||s===0||!isFinite(s))return[t,e];s>0?(t=Math.floor(t/s)*s,e=Math.ceil(e/s)*s):s<0&&(t=Math.ceil(t*s)/s,e=Math.floor(e*s)/s),r=s}}function dv(t){return Math.max(1,Math.ceil(Math.log(um(t))/Math.LN2)+1)}function q5(){var t=au,e=Rc,n=dv;function r(s){Array.isArray(s)||(s=Array.from(s));var i,o=s.length,a,l,u=new Array(o);for(i=0;i<o;++i)u[i]=t(s[i],i,s);var c=e(u),h=c[0],f=c[1],d=n(u,h,f);if(!Array.isArray(d)){const v=f,y=+d;if(e===Rc&&([h,f]=fv(h,f,y)),d=Va(h,f,y),d[0]<=h&&(l=Wa(h,f,y)),d[d.length-1]>=f)if(v>=f&&e===Rc){const w=Wa(h,f,y);isFinite(w)&&(w>0?f=(Math.floor(f/w)+1)*w:w<0&&(f=(Math.ceil(f*-w)+1)/-w))}else d.pop()}for(var p=d.length,g=0,m=p;d[g]<=h;)++g;for(;d[m-1]>f;)--m;(g||m<p)&&(d=d.slice(g,m),p=m-g);var b=new Array(p+1),x;for(i=0;i<=p;++i)x=b[i]=[],x.x0=i>0?d[i-1]:h,x.x1=i<p?d[i]:f;if(isFinite(l)){if(l>0)for(i=0;i<o;++i)(a=u[i])!=null&&h<=a&&a<=f&&b[Math.min(p,Math.floor((a-h)/l))].push(s[i]);else if(l<0){for(i=0;i<o;++i)if((a=u[i])!=null&&h<=a&&a<=f){const v=Math.floor((h-a)*l);b[Math.min(p,v+(d[v]<=a))].push(s[i])}}}else for(i=0;i<o;++i)(a=u[i])!=null&&h<=a&&a<=f&&b[Io(d,a,0,p)].push(s[i]);return b}return r.value=function(s){return arguments.length?(t=typeof s=="function"?s:Eg(s),r):t},r.domain=function(s){return arguments.length?(e=typeof s=="function"?s:Eg([s[0],s[1]]),r):e},r.thresholds=function(s){return arguments.length?(n=typeof s=="function"?s:Eg(Array.isArray(s)?ice.call(s):s),r):n},r}function _s(t,e){let n;if(e===void 0)for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(n<s||n===void 0&&s>=s)&&(n=s)}return n}function pv(t,e){let n,r=-1,s=-1;if(e===void 0)for(const i of t)++s,i!=null&&(n<i||n===void 0&&i>=i)&&(n=i,r=s);else for(let i of t)(i=e(i,++s,t))!=null&&(n<i||n===void 0&&i>=i)&&(n=i,r=s);return r}function ii(t,e){let n;if(e===void 0)for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(n>s||n===void 0&&s>=s)&&(n=s)}return n}function mv(t,e){let n,r=-1,s=-1;if(e===void 0)for(const i of t)++s,i!=null&&(n>i||n===void 0&&i>=i)&&(n=i,r=s);else for(let i of t)(i=e(i,++s,t))!=null&&(n>i||n===void 0&&i>=i)&&(n=i,r=s);return r}function cm(t,e,n=0,r=1/0,s){if(e=Math.floor(e),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(t.length-1,r)),!(n<=e&&e<=r))return t;for(s=s===void 0?lu:hv(s);r>n;){if(r-n>600){const l=r-n+1,u=e-n+1,c=Math.log(l),h=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*h*(l-h)/l)*(u-l/2<0?-1:1),d=Math.max(n,Math.floor(e-u*h/l+f)),p=Math.min(r,Math.floor(e+(l-u)*h/l+f));cm(t,e,d,p,s)}const i=t[e];let o=n,a=r;for(rc(t,n,e),s(t[r],i)>0&&rc(t,n,r);o<a;){for(rc(t,o,a),++o,--a;s(t[o],i)<0;)++o;for(;s(t[a],i)>0;)--a}s(t[n],i)===0?rc(t,n,a):(++a,rc(t,a,r)),a<=e&&(n=a+1),e<=a&&(r=a-1)}return t}function rc(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function HT(t,e=zt){let n,r=!1;if(e.length===1){let s;for(const i of t){const o=e(i);(r?zt(o,s)>0:zt(o,o)===0)&&(n=i,s=o,r=!0)}}else for(const s of t)(r?e(s,n)>0:e(s,s)===0)&&(n=s,r=!0);return n}function Qc(t,e,n){if(t=Float64Array.from(zue(t,n)),!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return ii(t);if(e>=1)return _s(t);var r,s=(r-1)*e,i=Math.floor(s),o=_s(cm(t,i).subarray(0,i+1)),a=ii(t.subarray(i+1));return o+(a-o)*(s-i)}}function qT(t,e,n=Od){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,s=(r-1)*e,i=Math.floor(s),o=+n(t[i],i,t),a=+n(t[i+1],i+1,t);return o+(a-o)*(s-i)}}function XT(t,e,n=Od){if(!isNaN(e=+e)){if(r=Float64Array.from(t,(a,l)=>Od(n(t[l],l,t))),e<=0)return mv(r);if(e>=1)return pv(r);var r,s=Uint32Array.from(t,(a,l)=>l),i=r.length-1,o=Math.floor(i*e);return cm(s,o,0,i,(a,l)=>lu(r[a],r[l])),o=HT(s.subarray(0,o+1),a=>r[a]),o>=0?o:-1}}function uce(t,e,n){const r=um(t),s=Qc(t,.75)-Qc(t,.25);return r&&s?Math.ceil((n-e)/(2*s*Math.pow(r,-1/3))):1}function cce(t,e,n){const r=um(t),s=MT(t);return r&&s?Math.ceil((n-e)*Math.cbrt(r)/(3.49*s)):1}function hce(t,e){let n=0,r=0;if(e===void 0)for(let s of t)s!=null&&(s=+s)>=s&&(++n,r+=s);else{let s=-1;for(let i of t)(i=e(i,++s,t))!=null&&(i=+i)>=i&&(++n,r+=i)}if(n)return r/n}function fce(t,e){return Qc(t,.5,e)}function dce(t,e){return XT(t,.5,e)}function*pce(t){for(const e of t)yield*e}function gv(t){return Array.from(pce(t))}function mce(t,e){const n=new Jc;if(e===void 0)for(let i of t)i!=null&&i>=i&&n.set(i,(n.get(i)||0)+1);else{let i=-1;for(let o of t)(o=e(o,++i,t))!=null&&o>=o&&n.set(o,(n.get(o)||0)+1)}let r,s=0;for(const[i,o]of n)o>s&&(s=o,r=i);return r}function gce(t,e=bce){const n=[];let r,s=!1;for(const i of t)s&&n.push(e(r,i)),r=i,s=!0;return n}function bce(t,e){return[t,e]}function co(t,e,n){t=+t,e=+e,n=(s=arguments.length)<2?(e=t,t=0,1):s<3?1:+n;for(var r=-1,s=Math.max(0,Math.ceil((e-t)/n))|0,i=new Array(s);++r<s;)i[r]=t+r*n;return i}function xce(t,e=zt){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");let n=Array.from(t);const r=new Float64Array(n.length);e.length!==2&&(n=n.map(e),e=zt);const s=(a,l)=>e(n[a],n[l]);let i,o;return t=Uint32Array.from(n,(a,l)=>l),t.sort(e===zt?(a,l)=>lu(n[a],n[l]):hv(s)),t.forEach((a,l)=>{const u=s(a,i===void 0?a:i);u>=0?((i===void 0||u>0)&&(i=a,o=l),r[a]=o):r[a]=NaN}),r}function yce(t,e=zt){let n,r=!1;if(e.length===1){let s;for(const i of t){const o=e(i);(r?zt(o,s)<0:zt(o,o)===0)&&(n=i,s=o,r=!0)}}else for(const s of t)(r?e(s,n)<0:e(s,s)===0)&&(n=s,r=!0);return n}function jT(t,e=zt){if(e.length===1)return mv(t,e);let n,r=-1,s=-1;for(const i of t)++s,(r<0?e(i,i)===0:e(i,n)<0)&&(n=i,r=s);return r}function vce(t,e=zt){if(e.length===1)return pv(t,e);let n,r=-1,s=-1;for(const i of t)++s,(r<0?e(i,i)===0:e(i,n)>0)&&(n=i,r=s);return r}function wce(t,e){const n=jT(t,e);return n<0?void 0:n}const kce=KT(Math.random);function KT(t){return function(n,r=0,s=n.length){let i=s-(r=+r);for(;i;){const o=t()*i--|0,a=n[i+r];n[i+r]=n[o+r],n[o+r]=a}return n}}function Sce(t,e){let n=0;if(e===void 0)for(let r of t)(r=+r)&&(n+=r);else{let r=-1;for(let s of t)(s=+e(s,++r,t))&&(n+=s)}return n}function YT(t){if(!(i=t.length))return[];for(var e=-1,n=ii(t,Cce),r=new Array(n);++e<n;)for(var s=-1,i,o=r[e]=new Array(i);++s<i;)o[s]=t[s][e];return r}function Cce(t){return t.length}function $ce(){return YT(arguments)}function Ice(t,e){if(typeof e!="function")throw new TypeError("test is not a function");let n=-1;for(const r of t)if(!e(r,++n,t))return!1;return!0}function Tce(t,e){if(typeof e!="function")throw new TypeError("test is not a function");let n=-1;for(const r of t)if(e(r,++n,t))return!0;return!1}function Nce(t,e){if(typeof e!="function")throw new TypeError("test is not a function");const n=[];let r=-1;for(const s of t)e(s,++r,t)&&n.push(s);return n}function _ce(t,e){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");if(typeof e!="function")throw new TypeError("mapper is not a function");return Array.from(t,(n,r)=>e(n,r,t))}function Ace(t,e,n){if(typeof e!="function")throw new TypeError("reducer is not a function");const r=t[Symbol.iterator]();let s,i,o=-1;if(arguments.length<3){if({done:s,value:n}=r.next(),s)return;++o}for(;{done:s,value:i}=r.next(),!s;)n=e(n,i,++o,t);return n}function Ece(t){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(t).reverse()}function Rce(t,...e){t=new Ba(t);for(const n of e)for(const r of n)t.delete(r);return t}function Dce(t,e){const n=e[Symbol.iterator](),r=new Ba;for(const s of t){if(r.has(s))return!1;let i,o;for(;({value:i,done:o}=n.next())&&!o;){if(Object.is(s,i))return!1;r.add(i)}}return!0}function Mce(t,...e){t=new Ba(t),e=e.map(Fce);e:for(const n of t)for(const r of e)if(!r.has(n)){t.delete(n);continue e}return t}function Fce(t){return t instanceof Ba?t:new Ba(t)}function ZT(t,e){const n=t[Symbol.iterator](),r=new Set;for(const s of e){const i=X5(s);if(r.has(i))continue;let o,a;for(;{value:o,done:a}=n.next();){if(a)return!1;const l=X5(o);if(r.add(l),Object.is(i,l))break}}return!0}function X5(t){return t!==null&&typeof t=="object"?t.valueOf():t}function Oce(t,e){return ZT(e,t)}function Lce(...t){const e=new Ba;for(const n of t)for(const r of n)e.add(r);return e}function zce(t){return t}var jf=1,Kf=2,bb=3,bc=4,j5=1e-6;function Pce(t){return"translate("+t+",0)"}function Bce(t){return"translate(0,"+t+")"}function Vce(t){return e=>+t(e)}function Wce(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function Uce(){return!this.__axis}function hm(t,e){var n=[],r=null,s=null,i=6,o=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,u=t===jf||t===bc?-1:1,c=t===bc||t===Kf?"x":"y",h=t===jf||t===bb?Pce:Bce;function f(d){var p=r??(e.ticks?e.ticks.apply(e,n):e.domain()),g=s??(e.tickFormat?e.tickFormat.apply(e,n):zce),m=Math.max(i,0)+a,b=e.range(),x=+b[0]+l,v=+b[b.length-1]+l,y=(e.bandwidth?Wce:Vce)(e.copy(),l),w=d.selection?d.selection():d,C=w.selectAll(".domain").data([null]),T=w.selectAll(".tick").data(p,e).order(),N=T.exit(),$=T.enter().append("g").attr("class","tick"),_=T.select("line"),S=T.select("text");C=C.merge(C.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),T=T.merge($),_=_.merge($.append("line").attr("stroke","currentColor").attr(c+"2",u*i)),S=S.merge($.append("text").attr("fill","currentColor").attr(c,u*m).attr("dy",t===jf?"0em":t===bb?"0.71em":"0.32em")),d!==w&&(C=C.transition(d),T=T.transition(d),_=_.transition(d),S=S.transition(d),N=N.transition(d).attr("opacity",j5).attr("transform",function(M){return isFinite(M=y(M))?h(M+l):this.getAttribute("transform")}),$.attr("opacity",j5).attr("transform",function(M){var F=this.parentNode.__axis;return h((F&&isFinite(F=F(M))?F:y(M))+l)})),N.remove(),C.attr("d",t===bc||t===Kf?o?"M"+u*o+","+x+"H"+l+"V"+v+"H"+u*o:"M"+l+","+x+"V"+v:o?"M"+x+","+u*o+"V"+l+"H"+v+"V"+u*o:"M"+x+","+l+"H"+v),T.attr("opacity",1).attr("transform",function(M){return h(y(M)+l)}),_.attr(c+"2",u*i),S.attr(c,u*m).text(g),w.filter(Uce).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===Kf?"start":t===bc?"end":"middle"),w.each(function(){this.__axis=y})}return f.scale=function(d){return arguments.length?(e=d,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),f):n.slice()},f.tickValues=function(d){return arguments.length?(r=d==null?null:Array.from(d),f):r&&r.slice()},f.tickFormat=function(d){return arguments.length?(s=d,f):s},f.tickSize=function(d){return arguments.length?(i=o=+d,f):i},f.tickSizeInner=function(d){return arguments.length?(i=+d,f):i},f.tickSizeOuter=function(d){return arguments.length?(o=+d,f):o},f.tickPadding=function(d){return arguments.length?(a=+d,f):a},f.offset=function(d){return arguments.length?(l=+d,f):l},f}function Gce(t){return hm(jf,t)}function Hce(t){return hm(Kf,t)}function qce(t){return hm(bb,t)}function Xce(t){return hm(bc,t)}var jce={value:()=>{}};function cl(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Yf(n)}function Yf(t){this._=t}function Kce(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",s=n.indexOf(".");if(s>=0&&(r=n.slice(s+1),n=n.slice(0,s)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Yf.prototype=cl.prototype={constructor:Yf,on:function(t,e){var n=this._,r=Kce(t+"",n),s,i=-1,o=r.length;if(arguments.length<2){for(;++i<o;)if((s=(t=r[i]).type)&&(s=Yce(n[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++i<o;)if(s=(t=r[i]).type)n[s]=K5(n[s],t.name,e);else if(e==null)for(s in n)n[s]=K5(n[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Yf(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var n=new Array(s),r=0,s,i;r<s;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],s=0,i=r.length;s<i;++s)r[s].value.apply(e,n)}};function Yce(t,e){for(var n=0,r=t.length,s;n<r;++n)if((s=t[n]).name===e)return s.value}function K5(t,e,n){for(var r=0,s=t.length;r<s;++r)if(t[r].name===e){t[r]=jce,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var xb="http://www.w3.org/1999/xhtml";const yb={svg:"http://www.w3.org/2000/svg",xhtml:xb,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function D0(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),yb.hasOwnProperty(e)?{space:yb[e],local:t}:t}function Zce(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===xb&&e.documentElement.namespaceURI===xb?e.createElement(t):e.createElementNS(n,t)}}function Jce(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function fm(t){var e=D0(t);return(e.local?Jce:Zce)(e)}function Qce(){}function dm(t){return t==null?Qce:function(){return this.querySelector(t)}}function ehe(t){typeof t!="function"&&(t=dm(t));for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s)for(var i=e[s],o=i.length,a=r[s]=new Array(o),l,u,c=0;c<o;++c)(l=i[c])&&(u=t.call(l,l.__data__,c,i))&&("__data__"in l&&(u.__data__=l.__data__),a[c]=u);return new lr(r,this._parents)}function JT(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function the(){return[]}function bv(t){return t==null?the:function(){return this.querySelectorAll(t)}}function nhe(t){return function(){return JT(t.apply(this,arguments))}}function rhe(t){typeof t=="function"?t=nhe(t):t=bv(t);for(var e=this._groups,n=e.length,r=[],s=[],i=0;i<n;++i)for(var o=e[i],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(r.push(t.call(l,l.__data__,u,o)),s.push(l));return new lr(r,s)}function xv(t){return function(){return this.matches(t)}}function QT(t){return function(e){return e.matches(t)}}var she=Array.prototype.find;function ihe(t){return function(){return she.call(this.children,t)}}function ohe(){return this.firstElementChild}function ahe(t){return this.select(t==null?ohe:ihe(typeof t=="function"?t:QT(t)))}var lhe=Array.prototype.filter;function uhe(){return Array.from(this.children)}function che(t){return function(){return lhe.call(this.children,t)}}function hhe(t){return this.selectAll(t==null?uhe:che(typeof t=="function"?t:QT(t)))}function fhe(t){typeof t!="function"&&(t=xv(t));for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s)for(var i=e[s],o=i.length,a=r[s]=[],l,u=0;u<o;++u)(l=i[u])&&t.call(l,l.__data__,u,i)&&a.push(l);return new lr(r,this._parents)}function eN(t){return new Array(t.length)}function dhe(){return new lr(this._enter||this._groups.map(eN),this._parents)}function Pd(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Pd.prototype={constructor:Pd,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function phe(t){return function(){return t}}function mhe(t,e,n,r,s,i){for(var o=0,a,l=e.length,u=i.length;o<u;++o)(a=e[o])?(a.__data__=i[o],r[o]=a):n[o]=new Pd(t,i[o]);for(;o<l;++o)(a=e[o])&&(s[o]=a)}function ghe(t,e,n,r,s,i,o){var a,l,u=new Map,c=e.length,h=i.length,f=new Array(c),d;for(a=0;a<c;++a)(l=e[a])&&(f[a]=d=o.call(l,l.__data__,a,e)+"",u.has(d)?s[a]=l:u.set(d,l));for(a=0;a<h;++a)d=o.call(t,i[a],a,i)+"",(l=u.get(d))?(r[a]=l,l.__data__=i[a],u.delete(d)):n[a]=new Pd(t,i[a]);for(a=0;a<c;++a)(l=e[a])&&u.get(f[a])===l&&(s[a]=l)}function bhe(t){return t.__data__}function xhe(t,e){if(!arguments.length)return Array.from(this,bhe);var n=e?ghe:mhe,r=this._parents,s=this._groups;typeof t!="function"&&(t=phe(t));for(var i=s.length,o=new Array(i),a=new Array(i),l=new Array(i),u=0;u<i;++u){var c=r[u],h=s[u],f=h.length,d=yhe(t.call(c,c&&c.__data__,u,r)),p=d.length,g=a[u]=new Array(p),m=o[u]=new Array(p),b=l[u]=new Array(f);n(c,h,g,m,b,d,e);for(var x=0,v=0,y,w;x<p;++x)if(y=g[x]){for(x>=v&&(v=x+1);!(w=m[v])&&++v<p;);y._next=w||null}}return o=new lr(o,r),o._enter=a,o._exit=l,o}function yhe(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function vhe(){return new lr(this._exit||this._groups.map(eN),this._parents)}function whe(t,e,n){var r=this.enter(),s=this,i=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(s=e(s),s&&(s=s.selection())),n==null?i.remove():n(i),r&&s?r.merge(s).order():s}function khe(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,s=n.length,i=r.length,o=Math.min(s,i),a=new Array(s),l=0;l<o;++l)for(var u=n[l],c=r[l],h=u.length,f=a[l]=new Array(h),d,p=0;p<h;++p)(d=u[p]||c[p])&&(f[p]=d);for(;l<s;++l)a[l]=n[l];return new lr(a,this._parents)}function She(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],s=r.length-1,i=r[s],o;--s>=0;)(o=r[s])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function Che(t){t||(t=$he);function e(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var n=this._groups,r=n.length,s=new Array(r),i=0;i<r;++i){for(var o=n[i],a=o.length,l=s[i]=new Array(a),u,c=0;c<a;++c)(u=o[c])&&(l[c]=u);l.sort(e)}return new lr(s,this._parents).order()}function $he(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Ihe(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function The(){return Array.from(this)}function Nhe(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],s=0,i=r.length;s<i;++s){var o=r[s];if(o)return o}return null}function _he(){let t=0;for(const e of this)++t;return t}function Ahe(){return!this.node()}function Ehe(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var s=e[n],i=0,o=s.length,a;i<o;++i)(a=s[i])&&t.call(a,a.__data__,i,s);return this}function Rhe(t){return function(){this.removeAttribute(t)}}function Dhe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Mhe(t,e){return function(){this.setAttribute(t,e)}}function Fhe(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ohe(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Lhe(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function zhe(t,e){var n=D0(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Dhe:Rhe:typeof e=="function"?n.local?Lhe:Ohe:n.local?Fhe:Mhe)(n,e))}function yv(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Phe(t){return function(){this.style.removeProperty(t)}}function Bhe(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Vhe(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Whe(t,e,n){return arguments.length>1?this.each((e==null?Phe:typeof e=="function"?Vhe:Bhe)(t,e,n??"")):Ua(this.node(),t)}function Ua(t,e){return t.style.getPropertyValue(e)||yv(t).getComputedStyle(t,null).getPropertyValue(e)}function Uhe(t){return function(){delete this[t]}}function Ghe(t,e){return function(){this[t]=e}}function Hhe(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function qhe(t,e){return arguments.length>1?this.each((e==null?Uhe:typeof e=="function"?Hhe:Ghe)(t,e)):this.node()[t]}function tN(t){return t.trim().split(/^|\s+/)}function vv(t){return t.classList||new nN(t)}function nN(t){this._node=t,this._names=tN(t.getAttribute("class")||"")}nN.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function rN(t,e){for(var n=vv(t),r=-1,s=e.length;++r<s;)n.add(e[r])}function sN(t,e){for(var n=vv(t),r=-1,s=e.length;++r<s;)n.remove(e[r])}function Xhe(t){return function(){rN(this,t)}}function jhe(t){return function(){sN(this,t)}}function Khe(t,e){return function(){(e.apply(this,arguments)?rN:sN)(this,t)}}function Yhe(t,e){var n=tN(t+"");if(arguments.length<2){for(var r=vv(this.node()),s=-1,i=n.length;++s<i;)if(!r.contains(n[s]))return!1;return!0}return this.each((typeof e=="function"?Khe:e?Xhe:jhe)(n,e))}function Zhe(){this.textContent=""}function Jhe(t){return function(){this.textContent=t}}function Qhe(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function e0e(t){return arguments.length?this.each(t==null?Zhe:(typeof t=="function"?Qhe:Jhe)(t)):this.node().textContent}function t0e(){this.innerHTML=""}function n0e(t){return function(){this.innerHTML=t}}function r0e(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function s0e(t){return arguments.length?this.each(t==null?t0e:(typeof t=="function"?r0e:n0e)(t)):this.node().innerHTML}function i0e(){this.nextSibling&&this.parentNode.appendChild(this)}function o0e(){return this.each(i0e)}function a0e(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function l0e(){return this.each(a0e)}function u0e(t){var e=typeof t=="function"?t:fm(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function c0e(){return null}function h0e(t,e){var n=typeof t=="function"?t:fm(t),r=e==null?c0e:typeof e=="function"?e:dm(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function f0e(){var t=this.parentNode;t&&t.removeChild(this)}function d0e(){return this.each(f0e)}function p0e(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function m0e(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function g0e(t){return this.select(t?m0e:p0e)}function b0e(t){return arguments.length?this.property("__data__",t):this.node().__data__}function x0e(t){return function(e){t.call(this,e,this.__data__)}}function y0e(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function v0e(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,s=e.length,i;n<s;++n)i=e[n],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):e[++r]=i;++r?e.length=r:delete this.__on}}}function w0e(t,e,n){return function(){var r=this.__on,s,i=x0e(e);if(r){for(var o=0,a=r.length;o<a;++o)if((s=r[o]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=i,s.options=n),s.value=e;return}}this.addEventListener(t.type,i,n),s={type:t.type,name:t.name,value:e,listener:i,options:n},r?r.push(s):this.__on=[s]}}function k0e(t,e,n){var r=y0e(t+""),s,i=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,c;l<u;++l)for(s=0,c=a[l];s<i;++s)if((o=r[s]).type===c.type&&o.name===c.name)return c.value}return}for(a=e?w0e:v0e,s=0;s<i;++s)this.each(a(r[s],e,n));return this}function iN(t,e,n){var r=yv(t),s=r.CustomEvent;typeof s=="function"?s=new s(e,n):(s=r.document.createEvent("Event"),n?(s.initEvent(e,n.bubbles,n.cancelable),s.detail=n.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function S0e(t,e){return function(){return iN(this,t,e)}}function C0e(t,e){return function(){return iN(this,t,e.apply(this,arguments))}}function $0e(t,e){return this.each((typeof e=="function"?C0e:S0e)(t,e))}function*I0e(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],s=0,i=r.length,o;s<i;++s)(o=r[s])&&(yield o)}var wv=[null];function lr(t,e){this._groups=t,this._parents=e}function hl(){return new lr([[document.documentElement]],wv)}function T0e(){return this}lr.prototype=hl.prototype={constructor:lr,select:ehe,selectAll:rhe,selectChild:ahe,selectChildren:hhe,filter:fhe,data:xhe,enter:dhe,exit:vhe,join:whe,merge:khe,selection:T0e,order:She,sort:Che,call:Ihe,nodes:The,node:Nhe,size:_he,empty:Ahe,each:Ehe,attr:zhe,style:Whe,property:qhe,classed:Yhe,text:e0e,html:s0e,raise:o0e,lower:l0e,append:u0e,insert:h0e,remove:d0e,clone:g0e,datum:b0e,on:k0e,dispatch:$0e,[Symbol.iterator]:I0e};function nn(t){return typeof t=="string"?new lr([[document.querySelector(t)]],[document.documentElement]):new lr([[t]],wv)}function N0e(t){return nn(fm(t).call(document.documentElement))}var _0e=0;function oN(){return new vb}function vb(){this._="@"+(++_0e).toString(36)}vb.prototype=oN.prototype={constructor:vb,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};function aN(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Ar(t,e){if(t=aN(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}}return[t.pageX,t.pageY]}function A0e(t,e){return t.target&&(t=aN(t),e===void 0&&(e=t.currentTarget),t=t.touches||[t]),Array.from(t,n=>Ar(n,e))}function E0e(t){return typeof t=="string"?new lr([document.querySelectorAll(t)],[document.documentElement]):new lr([JT(t)],wv)}const R0e={passive:!1},eh={capture:!0,passive:!1};function Rg(t){t.stopImmediatePropagation()}function Vl(t){t.preventDefault(),t.stopImmediatePropagation()}function pm(t){var e=t.document.documentElement,n=nn(t).on("dragstart.drag",Vl,eh);"onselectstart"in e?n.on("selectstart.drag",Vl,eh):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function mm(t,e){var n=t.document.documentElement,r=nn(t).on("dragstart.drag",null);e&&(r.on("click.drag",Vl,eh),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const cf=t=>()=>t;function wb(t,{sourceEvent:e,subject:n,target:r,identifier:s,active:i,x:o,y:a,dx:l,dy:u,dispatch:c}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:c}})}wb.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function D0e(t){return!t.ctrlKey&&!t.button}function M0e(){return this.parentNode}function F0e(t,e){return e??{x:t.x,y:t.y}}function O0e(){return navigator.maxTouchPoints||"ontouchstart"in this}function L0e(){var t=D0e,e=M0e,n=F0e,r=O0e,s={},i=cl("start","drag","end"),o=0,a,l,u,c,h=0;function f(y){y.on("mousedown.drag",d).filter(r).on("touchstart.drag",m).on("touchmove.drag",b,R0e).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(y,w){if(!(c||!t.call(this,y,w))){var C=v(this,e.call(this,y,w),y,w,"mouse");C&&(nn(y.view).on("mousemove.drag",p,eh).on("mouseup.drag",g,eh),pm(y.view),Rg(y),u=!1,a=y.clientX,l=y.clientY,C("start",y))}}function p(y){if(Vl(y),!u){var w=y.clientX-a,C=y.clientY-l;u=w*w+C*C>h}s.mouse("drag",y)}function g(y){nn(y.view).on("mousemove.drag mouseup.drag",null),mm(y.view,u),Vl(y),s.mouse("end",y)}function m(y,w){if(t.call(this,y,w)){var C=y.changedTouches,T=e.call(this,y,w),N=C.length,$,_;for($=0;$<N;++$)(_=v(this,T,y,w,C[$].identifier,C[$]))&&(Rg(y),_("start",y,C[$]))}}function b(y){var w=y.changedTouches,C=w.length,T,N;for(T=0;T<C;++T)(N=s[w[T].identifier])&&(Vl(y),N("drag",y,w[T]))}function x(y){var w=y.changedTouches,C=w.length,T,N;for(c&&clearTimeout(c),c=setTimeout(function(){c=null},500),T=0;T<C;++T)(N=s[w[T].identifier])&&(Rg(y),N("end",y,w[T]))}function v(y,w,C,T,N,$){var _=i.copy(),S=Ar($||C,w),M,F,A;if((A=n.call(y,new wb("beforestart",{sourceEvent:C,target:f,identifier:N,active:o,x:S[0],y:S[1],dx:0,dy:0,dispatch:_}),T))!=null)return M=A.x-S[0]||0,F=A.y-S[1]||0,function E(D,P,z){var B=S,G;switch(D){case"start":s[N]=E,G=o++;break;case"end":delete s[N],--o;case"drag":S=Ar(z||P,w),G=o;break}_.call(D,y,new wb(D,{sourceEvent:P,subject:A,target:f,identifier:N,active:G,x:S[0]+M,y:S[1]+F,dx:S[0]-B[0],dy:S[1]-B[1],dispatch:_}),T)}}return f.filter=function(y){return arguments.length?(t=typeof y=="function"?y:cf(!!y),f):t},f.container=function(y){return arguments.length?(e=typeof y=="function"?y:cf(y),f):e},f.subject=function(y){return arguments.length?(n=typeof y=="function"?y:cf(y),f):n},f.touchable=function(y){return arguments.length?(r=typeof y=="function"?y:cf(!!y),f):r},f.on=function(){var y=i.on.apply(i,arguments);return y===i?f:y},f.clickDistance=function(y){return arguments.length?(h=(y=+y)*y,f):Math.sqrt(h)},f}function Hu(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function M0(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ho(){}var Ga=.7,uu=1/Ga,Wl="\\s*([+-]?\\d+)\\s*",th="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ei="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",z0e=/^#([0-9a-f]{3,8})$/,P0e=new RegExp(`^rgb\\(${Wl},${Wl},${Wl}\\)$`),B0e=new RegExp(`^rgb\\(${ei},${ei},${ei}\\)$`),V0e=new RegExp(`^rgba\\(${Wl},${Wl},${Wl},${th}\\)$`),W0e=new RegExp(`^rgba\\(${ei},${ei},${ei},${th}\\)$`),U0e=new RegExp(`^hsl\\(${th},${ei},${ei}\\)$`),G0e=new RegExp(`^hsla\\(${th},${ei},${ei},${th}\\)$`),Y5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Hu(Ho,zi,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Z5,formatHex:Z5,formatHex8:H0e,formatHsl:q0e,formatRgb:J5,toString:J5});function Z5(){return this.rgb().formatHex()}function H0e(){return this.rgb().formatHex8()}function q0e(){return lN(this).formatHsl()}function J5(){return this.rgb().formatRgb()}function zi(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=z0e.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Q5(e):n===3?new vn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?hf(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?hf(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=P0e.exec(t))?new vn(e[1],e[2],e[3],1):(e=B0e.exec(t))?new vn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=V0e.exec(t))?hf(e[1],e[2],e[3],e[4]):(e=W0e.exec(t))?hf(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=U0e.exec(t))?n6(e[1],e[2]/100,e[3]/100,1):(e=G0e.exec(t))?n6(e[1],e[2]/100,e[3]/100,e[4]):Y5.hasOwnProperty(t)?Q5(Y5[t]):t==="transparent"?new vn(NaN,NaN,NaN,0):null}function Q5(t){return new vn(t>>16&255,t>>8&255,t&255,1)}function hf(t,e,n,r){return r<=0&&(t=e=n=NaN),new vn(t,e,n,r)}function kv(t){return t instanceof Ho||(t=zi(t)),t?(t=t.rgb(),new vn(t.r,t.g,t.b,t.opacity)):new vn}function cu(t,e,n,r){return arguments.length===1?kv(t):new vn(t,e,n,r??1)}function vn(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Hu(vn,cu,M0(Ho,{brighter(t){return t=t==null?uu:Math.pow(uu,t),new vn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Ga:Math.pow(Ga,t),new vn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new vn(ya(this.r),ya(this.g),ya(this.b),Bd(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:e6,formatHex:e6,formatHex8:X0e,formatRgb:t6,toString:t6}));function e6(){return`#${pa(this.r)}${pa(this.g)}${pa(this.b)}`}function X0e(){return`#${pa(this.r)}${pa(this.g)}${pa(this.b)}${pa((isNaN(this.opacity)?1:this.opacity)*255)}`}function t6(){const t=Bd(this.opacity);return`${t===1?"rgb(":"rgba("}${ya(this.r)}, ${ya(this.g)}, ${ya(this.b)}${t===1?")":`, ${t})`}`}function Bd(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ya(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function pa(t){return t=ya(t),(t<16?"0":"")+t.toString(16)}function n6(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ys(t,e,n,r)}function lN(t){if(t instanceof ys)return new ys(t.h,t.s,t.l,t.opacity);if(t instanceof Ho||(t=zi(t)),!t)return new ys;if(t instanceof ys)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,s=Math.min(e,n,r),i=Math.max(e,n,r),o=NaN,a=i-s,l=(i+s)/2;return a?(e===i?o=(n-r)/a+(n<r)*6:n===i?o=(r-e)/a+2:o=(e-n)/a+4,a/=l<.5?i+s:2-i-s,o*=60):a=l>0&&l<1?0:o,new ys(o,a,l,t.opacity)}function Vd(t,e,n,r){return arguments.length===1?lN(t):new ys(t,e,n,r??1)}function ys(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Hu(ys,Vd,M0(Ho,{brighter(t){return t=t==null?uu:Math.pow(uu,t),new ys(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Ga:Math.pow(Ga,t),new ys(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,s=2*n-r;return new vn(Dg(t>=240?t-240:t+120,s,r),Dg(t,s,r),Dg(t<120?t+240:t-120,s,r),this.opacity)},clamp(){return new ys(r6(this.h),ff(this.s),ff(this.l),Bd(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Bd(this.opacity);return`${t===1?"hsl(":"hsla("}${r6(this.h)}, ${ff(this.s)*100}%, ${ff(this.l)*100}%${t===1?")":`, ${t})`}`}}));function r6(t){return t=(t||0)%360,t<0?t+360:t}function ff(t){return Math.max(0,Math.min(1,t||0))}function Dg(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const uN=Math.PI/180,cN=180/Math.PI,Wd=18,hN=.96422,fN=1,dN=.82521,pN=4/29,Ul=6/29,mN=3*Ul*Ul,j0e=Ul*Ul*Ul;function gN(t){if(t instanceof $s)return new $s(t.l,t.a,t.b,t.opacity);if(t instanceof Gs)return xN(t);t instanceof vn||(t=kv(t));var e=Lg(t.r),n=Lg(t.g),r=Lg(t.b),s=Mg((.2225045*e+.7168786*n+.0606169*r)/fN),i,o;return e===n&&n===r?i=o=s:(i=Mg((.4360747*e+.3850649*n+.1430804*r)/hN),o=Mg((.0139322*e+.0971045*n+.7141733*r)/dN)),new $s(116*s-16,500*(i-s),200*(s-o),t.opacity)}function K0e(t,e){return new $s(t,0,0,e??1)}function Ud(t,e,n,r){return arguments.length===1?gN(t):new $s(t,e,n,r??1)}function $s(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}Hu($s,Ud,M0(Ho,{brighter(t){return new $s(this.l+Wd*(t??1),this.a,this.b,this.opacity)},darker(t){return new $s(this.l-Wd*(t??1),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return e=hN*Fg(e),t=fN*Fg(t),n=dN*Fg(n),new vn(Og(3.1338561*e-1.6168667*t-.4906146*n),Og(-.9787684*e+1.9161415*t+.033454*n),Og(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}}));function Mg(t){return t>j0e?Math.pow(t,1/3):t/mN+pN}function Fg(t){return t>Ul?t*t*t:mN*(t-pN)}function Og(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Lg(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function bN(t){if(t instanceof Gs)return new Gs(t.h,t.c,t.l,t.opacity);if(t instanceof $s||(t=gN(t)),t.a===0&&t.b===0)return new Gs(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*cN;return new Gs(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function Y0e(t,e,n,r){return arguments.length===1?bN(t):new Gs(n,e,t,r??1)}function Gd(t,e,n,r){return arguments.length===1?bN(t):new Gs(t,e,n,r??1)}function Gs(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function xN(t){if(isNaN(t.h))return new $s(t.l,0,0,t.opacity);var e=t.h*uN;return new $s(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}Hu(Gs,Gd,M0(Ho,{brighter(t){return new Gs(this.h,this.c,this.l+Wd*(t??1),this.opacity)},darker(t){return new Gs(this.h,this.c,this.l-Wd*(t??1),this.opacity)},rgb(){return xN(this).rgb()}}));var yN=-.14861,Sv=1.78277,Cv=-.29227,gm=-.90649,nh=1.97294,s6=nh*gm,i6=nh*Sv,o6=Sv*Cv-gm*yN;function Z0e(t){if(t instanceof va)return new va(t.h,t.s,t.l,t.opacity);t instanceof vn||(t=kv(t));var e=t.r/255,n=t.g/255,r=t.b/255,s=(o6*r+s6*e-i6*n)/(o6+s6-i6),i=r-s,o=(nh*(n-s)-Cv*i)/gm,a=Math.sqrt(o*o+i*i)/(nh*s*(1-s)),l=a?Math.atan2(o,i)*cN-120:NaN;return new va(l<0?l+360:l,a,s,t.opacity)}function As(t,e,n,r){return arguments.length===1?Z0e(t):new va(t,e,n,r??1)}function va(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Hu(va,As,M0(Ho,{brighter(t){return t=t==null?uu:Math.pow(uu,t),new va(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Ga:Math.pow(Ga,t),new va(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*uN,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),s=Math.sin(t);return new vn(255*(e+n*(yN*r+Sv*s)),255*(e+n*(Cv*r+gm*s)),255*(e+n*(nh*r)),this.opacity)}}));function vN(t,e,n,r,s){var i=t*t,o=i*t;return((1-3*t+3*i-o)*e+(4-6*i+3*o)*n+(1+3*t+3*i-3*o)*r+o*s)/6}function wN(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),s=t[r],i=t[r+1],o=r>0?t[r-1]:2*s-i,a=r<e-1?t[r+2]:2*i-s;return vN((n-r/e)*e,o,s,i,a)}}function kN(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),s=t[(r+e-1)%e],i=t[r%e],o=t[(r+1)%e],a=t[(r+2)%e];return vN((n-r/e)*e,s,i,o,a)}}const bm=t=>()=>t;function SN(t,e){return function(n){return t+n*e}}function J0e(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function xm(t,e){var n=e-t;return n?SN(t,n>180||n<-180?n-360*Math.round(n/360):n):bm(isNaN(t)?e:t)}function Q0e(t){return(t=+t)==1?wn:function(e,n){return n-e?J0e(e,n,t):bm(isNaN(e)?n:e)}}function wn(t,e){var n=e-t;return n?SN(t,n):bm(isNaN(t)?e:t)}const rh=function t(e){var n=Q0e(e);function r(s,i){var o=n((s=cu(s)).r,(i=cu(i)).r),a=n(s.g,i.g),l=n(s.b,i.b),u=wn(s.opacity,i.opacity);return function(c){return s.r=o(c),s.g=a(c),s.b=l(c),s.opacity=u(c),s+""}}return r.gamma=t,r}(1);function CN(t){return function(e){var n=e.length,r=new Array(n),s=new Array(n),i=new Array(n),o,a;for(o=0;o<n;++o)a=cu(e[o]),r[o]=a.r||0,s[o]=a.g||0,i[o]=a.b||0;return r=t(r),s=t(s),i=t(i),a.opacity=1,function(l){return a.r=r(l),a.g=s(l),a.b=i(l),a+""}}}var $N=CN(wN),efe=CN(kN);function $v(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),s;return function(i){for(s=0;s<n;++s)r[s]=t[s]*(1-i)+e[s]*i;return r}}function IN(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function tfe(t,e){return(IN(e)?$v:TN)(t,e)}function TN(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,s=new Array(r),i=new Array(n),o;for(o=0;o<r;++o)s[o]=qo(t[o],e[o]);for(;o<n;++o)i[o]=e[o];return function(a){for(o=0;o<r;++o)i[o]=s[o](a);return i}}function NN(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Kr(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function _N(t,e){var n={},r={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?n[s]=qo(t[s],e[s]):r[s]=e[s];return function(i){for(s in n)r[s]=n[s](i);return r}}var kb=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zg=new RegExp(kb.source,"g");function nfe(t){return function(){return t}}function rfe(t){return function(e){return t(e)+""}}function Iv(t,e){var n=kb.lastIndex=zg.lastIndex=0,r,s,i,o=-1,a=[],l=[];for(t=t+"",e=e+"";(r=kb.exec(t))&&(s=zg.exec(e));)(i=s.index)>n&&(i=e.slice(n,i),a[o]?a[o]+=i:a[++o]=i),(r=r[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,l.push({i:o,x:Kr(r,s)})),n=zg.lastIndex;return n<e.length&&(i=e.slice(n),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?rfe(l[0].x):nfe(e):(e=l.length,function(u){for(var c=0,h;c<e;++c)a[(h=l[c]).i]=h.x(u);return a.join("")})}function qo(t,e){var n=typeof e,r;return e==null||n==="boolean"?bm(e):(n==="number"?Kr:n==="string"?(r=zi(e))?(e=r,rh):Iv:e instanceof zi?rh:e instanceof Date?NN:IN(e)?$v:Array.isArray(e)?TN:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?_N:Kr)(t,e)}function sfe(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}function ife(t,e){var n=xm(+t,+e);return function(r){var s=n(r);return s-360*Math.floor(s/360)}}function ym(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var a6=180/Math.PI,Sb={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function AN(t,e,n,r,s,i){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),t*r<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:s,translateY:i,rotate:Math.atan2(e,t)*a6,skewX:Math.atan(l)*a6,scaleX:o,scaleY:a}}var df;function ofe(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Sb:AN(e.a,e.b,e.c,e.d,e.e,e.f)}function afe(t){return t==null||(df||(df=document.createElementNS("http://www.w3.org/2000/svg","g")),df.setAttribute("transform",t),!(t=df.transform.baseVal.consolidate()))?Sb:(t=t.matrix,AN(t.a,t.b,t.c,t.d,t.e,t.f))}function EN(t,e,n,r){function s(u){return u.length?u.pop()+" ":""}function i(u,c,h,f,d,p){if(u!==h||c!==f){var g=d.push("translate(",null,e,null,n);p.push({i:g-4,x:Kr(u,h)},{i:g-2,x:Kr(c,f)})}else(h||f)&&d.push("translate("+h+e+f+n)}function o(u,c,h,f){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),f.push({i:h.push(s(h)+"rotate(",null,r)-2,x:Kr(u,c)})):c&&h.push(s(h)+"rotate("+c+r)}function a(u,c,h,f){u!==c?f.push({i:h.push(s(h)+"skewX(",null,r)-2,x:Kr(u,c)}):c&&h.push(s(h)+"skewX("+c+r)}function l(u,c,h,f,d,p){if(u!==h||c!==f){var g=d.push(s(d)+"scale(",null,",",null,")");p.push({i:g-4,x:Kr(u,h)},{i:g-2,x:Kr(c,f)})}else(h!==1||f!==1)&&d.push(s(d)+"scale("+h+","+f+")")}return function(u,c){var h=[],f=[];return u=t(u),c=t(c),i(u.translateX,u.translateY,c.translateX,c.translateY,h,f),o(u.rotate,c.rotate,h,f),a(u.skewX,c.skewX,h,f),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,h,f),u=c=null,function(d){for(var p=-1,g=f.length,m;++p<g;)h[(m=f[p]).i]=m.x(d);return h.join("")}}}var RN=EN(ofe,"px, ","px)","deg)"),DN=EN(afe,", ",")",")"),lfe=1e-12;function l6(t){return((t=Math.exp(t))+1/t)/2}function ufe(t){return((t=Math.exp(t))-1/t)/2}function cfe(t){return((t=Math.exp(2*t))-1)/(t+1)}const MN=function t(e,n,r){function s(i,o){var a=i[0],l=i[1],u=i[2],c=o[0],h=o[1],f=o[2],d=c-a,p=h-l,g=d*d+p*p,m,b;if(g<lfe)b=Math.log(f/u)/e,m=function(T){return[a+T*d,l+T*p,u*Math.exp(e*T*b)]};else{var x=Math.sqrt(g),v=(f*f-u*u+r*g)/(2*u*n*x),y=(f*f-u*u-r*g)/(2*f*n*x),w=Math.log(Math.sqrt(v*v+1)-v),C=Math.log(Math.sqrt(y*y+1)-y);b=(C-w)/e,m=function(T){var N=T*b,$=l6(w),_=u/(n*x)*($*cfe(e*N+w)-ufe(w));return[a+_*d,l+_*p,u*$/l6(e*N+w)]}}return m.duration=b*1e3*e/Math.SQRT2,m}return s.rho=function(i){var o=Math.max(.001,+i),a=o*o,l=a*a;return t(o,a,l)},s}(Math.SQRT2,2,4);function FN(t){return function(e,n){var r=t((e=Vd(e)).h,(n=Vd(n)).h),s=wn(e.s,n.s),i=wn(e.l,n.l),o=wn(e.opacity,n.opacity);return function(a){return e.h=r(a),e.s=s(a),e.l=i(a),e.opacity=o(a),e+""}}}const hfe=FN(xm);var ffe=FN(wn);function dfe(t,e){var n=wn((t=Ud(t)).l,(e=Ud(e)).l),r=wn(t.a,e.a),s=wn(t.b,e.b),i=wn(t.opacity,e.opacity);return function(o){return t.l=n(o),t.a=r(o),t.b=s(o),t.opacity=i(o),t+""}}function ON(t){return function(e,n){var r=t((e=Gd(e)).h,(n=Gd(n)).h),s=wn(e.c,n.c),i=wn(e.l,n.l),o=wn(e.opacity,n.opacity);return function(a){return e.h=r(a),e.c=s(a),e.l=i(a),e.opacity=o(a),e+""}}}const pfe=ON(xm);var mfe=ON(wn);function LN(t){return function e(n){n=+n;function r(s,i){var o=t((s=As(s)).h,(i=As(i)).h),a=wn(s.s,i.s),l=wn(s.l,i.l),u=wn(s.opacity,i.opacity);return function(c){return s.h=o(c),s.s=a(c),s.l=l(Math.pow(c,n)),s.opacity=u(c),s+""}}return r.gamma=e,r}(1)}const gfe=LN(xm);var vm=LN(wn);function zN(t,e){e===void 0&&(e=t,t=qo);for(var n=0,r=e.length-1,s=e[0],i=new Array(r<0?0:r);n<r;)i[n]=t(s,s=e[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return i[a](o-a)}}function bfe(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}var hu=0,xc=0,sc=0,PN=1e3,Hd,yc,qd=0,Ha=0,wm=0,sh=typeof performance=="object"&&performance.now?performance:Date,BN=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function F0(){return Ha||(BN(xfe),Ha=sh.now()+wm)}function xfe(){Ha=0}function ih(){this._call=this._time=this._next=null}ih.prototype=km.prototype={constructor:ih,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?F0():+n)+(e==null?0:+e),!this._next&&yc!==this&&(yc?yc._next=this:Hd=this,yc=this),this._call=t,this._time=n,Cb()},stop:function(){this._call&&(this._call=null,this._time=1/0,Cb())}};function km(t,e,n){var r=new ih;return r.restart(t,e,n),r}function VN(){F0(),++hu;for(var t=Hd,e;t;)(e=Ha-t._time)>=0&&t._call.call(void 0,e),t=t._next;--hu}function u6(){Ha=(qd=sh.now())+wm,hu=xc=0;try{VN()}finally{hu=0,vfe(),Ha=0}}function yfe(){var t=sh.now(),e=t-qd;e>PN&&(wm-=e,qd=t)}function vfe(){for(var t,e=Hd,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Hd=n);yc=t,Cb(r)}function Cb(t){if(!hu){xc&&(xc=clearTimeout(xc));var e=t-Ha;e>24?(t<1/0&&(xc=setTimeout(u6,t-sh.now()-wm)),sc&&(sc=clearInterval(sc))):(sc||(qd=sh.now(),sc=setInterval(yfe,PN)),hu=1,BN(u6))}}function $b(t,e,n){var r=new ih;return e=e==null?0:+e,r.restart(s=>{r.stop(),t(s+e)},e,n),r}function wfe(t,e,n){var r=new ih,s=e;return e==null?(r.restart(t,e,n),r):(r._restart=r.restart,r.restart=function(i,o,a){o=+o,a=a==null?F0():+a,r._restart(function l(u){u+=s,r._restart(l,s+=o,a),i(u)},o,a)},r.restart(t,e,n),r)}var kfe=cl("start","end","cancel","interrupt"),Sfe=[],WN=0,Ib=1,Tb=2,Zf=3,c6=4,Nb=5,Jf=6;function Sm(t,e,n,r,s,i){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Cfe(t,n,{name:e,index:r,group:s,on:kfe,tween:Sfe,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:WN})}function Tv(t,e){var n=Ms(t,e);if(n.state>WN)throw new Error("too late; already scheduled");return n}function fi(t,e){var n=Ms(t,e);if(n.state>Zf)throw new Error("too late; already running");return n}function Ms(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Cfe(t,e,n){var r=t.__transition,s;r[e]=n,n.timer=km(i,0,n.time);function i(u){n.state=Ib,n.timer.restart(o,n.delay,n.time),n.delay<=u&&o(u-n.delay)}function o(u){var c,h,f,d;if(n.state!==Ib)return l();for(c in r)if(d=r[c],d.name===n.name){if(d.state===Zf)return $b(o);d.state===c6?(d.state=Jf,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[c]):+c<e&&(d.state=Jf,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[c])}if($b(function(){n.state===Zf&&(n.state=c6,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=Tb,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Tb){for(n.state=Zf,s=new Array(f=n.tween.length),c=0,h=-1;c<f;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(s[++h]=d);s.length=h+1}}function a(u){for(var c=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=Nb,1),h=-1,f=s.length;++h<f;)s[h].call(t,c);n.state===Nb&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=Jf,n.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function wa(t,e){var n=t.__transition,r,s,i=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){i=!1;continue}s=r.state>Tb&&r.state<Nb,r.state=Jf,r.timer.stop(),r.on.call(s?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}i&&delete t.__transition}}function $fe(t){return this.each(function(){wa(this,t)})}function Ife(t,e){var n,r;return function(){var s=fi(this,t),i=s.tween;if(i!==n){r=n=i;for(var o=0,a=r.length;o<a;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}s.tween=r}}function Tfe(t,e,n){var r,s;if(typeof n!="function")throw new Error;return function(){var i=fi(this,t),o=i.tween;if(o!==r){s=(r=o).slice();for(var a={name:e,value:n},l=0,u=s.length;l<u;++l)if(s[l].name===e){s[l]=a;break}l===u&&s.push(a)}i.tween=s}}function Nfe(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Ms(this.node(),n).tween,s=0,i=r.length,o;s<i;++s)if((o=r[s]).name===t)return o.value;return null}return this.each((e==null?Ife:Tfe)(n,t,e))}function Nv(t,e,n){var r=t._id;return t.each(function(){var s=fi(this,r);(s.value||(s.value={}))[e]=n.apply(this,arguments)}),function(s){return Ms(s,r).value[e]}}function UN(t,e){var n;return(typeof e=="number"?Kr:e instanceof zi?rh:(n=zi(e))?(e=n,rh):Iv)(t,e)}function _fe(t){return function(){this.removeAttribute(t)}}function Afe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Efe(t,e,n){var r,s=n+"",i;return function(){var o=this.getAttribute(t);return o===s?null:o===r?i:i=e(r=o,n)}}function Rfe(t,e,n){var r,s=n+"",i;return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===r?i:i=e(r=o,n)}}function Dfe(t,e,n){var r,s,i;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=a+"",o===l?null:o===r&&l===s?i:(s=l,i=e(r=o,a)))}}function Mfe(t,e,n){var r,s,i;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=a+"",o===l?null:o===r&&l===s?i:(s=l,i=e(r=o,a)))}}function Ffe(t,e){var n=D0(t),r=n==="transform"?DN:UN;return this.attrTween(t,typeof e=="function"?(n.local?Mfe:Dfe)(n,r,Nv(this,"attr."+t,e)):e==null?(n.local?Afe:_fe)(n):(n.local?Rfe:Efe)(n,r,e))}function Ofe(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Lfe(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function zfe(t,e){var n,r;function s(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&Lfe(t,i)),n}return s._value=e,s}function Pfe(t,e){var n,r;function s(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&Ofe(t,i)),n}return s._value=e,s}function Bfe(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=D0(t);return this.tween(n,(r.local?zfe:Pfe)(r,e))}function Vfe(t,e){return function(){Tv(this,t).delay=+e.apply(this,arguments)}}function Wfe(t,e){return e=+e,function(){Tv(this,t).delay=e}}function Ufe(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Vfe:Wfe)(e,t)):Ms(this.node(),e).delay}function Gfe(t,e){return function(){fi(this,t).duration=+e.apply(this,arguments)}}function Hfe(t,e){return e=+e,function(){fi(this,t).duration=e}}function qfe(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Gfe:Hfe)(e,t)):Ms(this.node(),e).duration}function Xfe(t,e){if(typeof e!="function")throw new Error;return function(){fi(this,t).ease=e}}function jfe(t){var e=this._id;return arguments.length?this.each(Xfe(e,t)):Ms(this.node(),e).ease}function Kfe(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;fi(this,t).ease=n}}function Yfe(t){if(typeof t!="function")throw new Error;return this.each(Kfe(this._id,t))}function Zfe(t){typeof t!="function"&&(t=xv(t));for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s)for(var i=e[s],o=i.length,a=r[s]=[],l,u=0;u<o;++u)(l=i[u])&&t.call(l,l.__data__,u,i)&&a.push(l);return new oi(r,this._parents,this._name,this._id)}function Jfe(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,s=n.length,i=Math.min(r,s),o=new Array(r),a=0;a<i;++a)for(var l=e[a],u=n[a],c=l.length,h=o[a]=new Array(c),f,d=0;d<c;++d)(f=l[d]||u[d])&&(h[d]=f);for(;a<r;++a)o[a]=e[a];return new oi(o,this._parents,this._name,this._id)}function Qfe(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function ede(t,e,n){var r,s,i=Qfe(e)?Tv:fi;return function(){var o=i(this,t),a=o.on;a!==r&&(s=(r=a).copy()).on(e,n),o.on=s}}function tde(t,e){var n=this._id;return arguments.length<2?Ms(this.node(),n).on.on(t):this.each(ede(n,t,e))}function nde(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function rde(){return this.on("end.remove",nde(this._id))}function sde(t){var e=this._name,n=this._id;typeof t!="function"&&(t=dm(t));for(var r=this._groups,s=r.length,i=new Array(s),o=0;o<s;++o)for(var a=r[o],l=a.length,u=i[o]=new Array(l),c,h,f=0;f<l;++f)(c=a[f])&&(h=t.call(c,c.__data__,f,a))&&("__data__"in c&&(h.__data__=c.__data__),u[f]=h,Sm(u[f],e,n,f,u,Ms(c,n)));return new oi(i,this._parents,e,n)}function ide(t){var e=this._name,n=this._id;typeof t!="function"&&(t=bv(t));for(var r=this._groups,s=r.length,i=[],o=[],a=0;a<s;++a)for(var l=r[a],u=l.length,c,h=0;h<u;++h)if(c=l[h]){for(var f=t.call(c,c.__data__,h,l),d,p=Ms(c,n),g=0,m=f.length;g<m;++g)(d=f[g])&&Sm(d,e,n,g,f,p);i.push(f),o.push(c)}return new oi(i,o,e,n)}var ode=hl.prototype.constructor;function ade(){return new ode(this._groups,this._parents)}function lde(t,e){var n,r,s;return function(){var i=Ua(this,t),o=(this.style.removeProperty(t),Ua(this,t));return i===o?null:i===n&&o===r?s:s=e(n=i,r=o)}}function GN(t){return function(){this.style.removeProperty(t)}}function ude(t,e,n){var r,s=n+"",i;return function(){var o=Ua(this,t);return o===s?null:o===r?i:i=e(r=o,n)}}function cde(t,e,n){var r,s,i;return function(){var o=Ua(this,t),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),Ua(this,t))),o===l?null:o===r&&l===s?i:(s=l,i=e(r=o,a))}}function hde(t,e){var n,r,s,i="style."+e,o="end."+i,a;return function(){var l=fi(this,t),u=l.on,c=l.value[i]==null?a||(a=GN(e)):void 0;(u!==n||s!==c)&&(r=(n=u).copy()).on(o,s=c),l.on=r}}function fde(t,e,n){var r=(t+="")=="transform"?RN:UN;return e==null?this.styleTween(t,lde(t,r)).on("end.style."+t,GN(t)):typeof e=="function"?this.styleTween(t,cde(t,r,Nv(this,"style."+t,e))).each(hde(this._id,t)):this.styleTween(t,ude(t,r,e),n).on("end.style."+t,null)}function dde(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function pde(t,e,n){var r,s;function i(){var o=e.apply(this,arguments);return o!==s&&(r=(s=o)&&dde(t,o,n)),r}return i._value=e,i}function mde(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,pde(t,e,n??""))}function gde(t){return function(){this.textContent=t}}function bde(t){return function(){var e=t(this);this.textContent=e??""}}function xde(t){return this.tween("text",typeof t=="function"?bde(Nv(this,"text",t)):gde(t==null?"":t+""))}function yde(t){return function(e){this.textContent=t.call(this,e)}}function vde(t){var e,n;function r(){var s=t.apply(this,arguments);return s!==n&&(e=(n=s)&&yde(s)),e}return r._value=t,r}function wde(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,vde(t))}function kde(){for(var t=this._name,e=this._id,n=qN(),r=this._groups,s=r.length,i=0;i<s;++i)for(var o=r[i],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var c=Ms(l,e);Sm(l,t,n,u,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new oi(r,this._parents,t,n)}function Sde(){var t,e,n=this,r=n._id,s=n.size();return new Promise(function(i,o){var a={value:o},l={value:function(){--s===0&&i()}};n.each(function(){var u=fi(this,r),c=u.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),u.on=e}),s===0&&i()})}var Cde=0;function oi(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function HN(t){return hl().transition(t)}function qN(){return++Cde}var xi=hl.prototype;oi.prototype=HN.prototype={constructor:oi,select:sde,selectAll:ide,selectChild:xi.selectChild,selectChildren:xi.selectChildren,filter:Zfe,merge:Jfe,selection:ade,transition:kde,call:xi.call,nodes:xi.nodes,node:xi.node,size:xi.size,empty:xi.empty,each:xi.each,on:tde,attr:Ffe,attrTween:Bfe,style:fde,styleTween:mde,text:xde,textTween:wde,remove:rde,tween:Nfe,delay:Ufe,duration:qfe,ease:jfe,easeVarying:Yfe,end:Sde,[Symbol.iterator]:xi[Symbol.iterator]};const $de=t=>+t;function Ide(t){return t*t}function Tde(t){return t*(2-t)}function h6(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function Nde(t){return t*t*t}function _de(t){return--t*t*t+1}function _b(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var _v=3,Ade=function t(e){e=+e;function n(r){return Math.pow(r,e)}return n.exponent=t,n}(_v),Ede=function t(e){e=+e;function n(r){return 1-Math.pow(1-r,e)}return n.exponent=t,n}(_v),f6=function t(e){e=+e;function n(r){return((r*=2)<=1?Math.pow(r,e):2-Math.pow(2-r,e))/2}return n.exponent=t,n}(_v),XN=Math.PI,jN=XN/2;function Rde(t){return+t==1?1:1-Math.cos(t*jN)}function Dde(t){return Math.sin(t*jN)}function d6(t){return(1-Math.cos(XN*t))/2}function To(t){return(Math.pow(2,-10*t)-.0009765625)*1.0009775171065494}function Mde(t){return To(1-+t)}function Fde(t){return 1-To(t)}function p6(t){return((t*=2)<=1?To(1-t):2-To(t-1))/2}function Ode(t){return 1-Math.sqrt(1-t*t)}function Lde(t){return Math.sqrt(1- --t*t)}function m6(t){return((t*=2)<=1?1-Math.sqrt(1-t*t):Math.sqrt(1-(t-=2)*t)+1)/2}var Ab=4/11,zde=6/11,Pde=8/11,Bde=3/4,Vde=9/11,Wde=10/11,Ude=15/16,Gde=21/22,Hde=63/64,pf=1/Ab/Ab;function qde(t){return 1-oh(1-t)}function oh(t){return(t=+t)<Ab?pf*t*t:t<Pde?pf*(t-=zde)*t+Bde:t<Wde?pf*(t-=Vde)*t+Ude:pf*(t-=Gde)*t+Hde}function Xde(t){return((t*=2)<=1?1-oh(1-t):oh(t-1)+1)/2}var Av=1.70158,jde=function t(e){e=+e;function n(r){return(r=+r)*r*(e*(r-1)+r)}return n.overshoot=t,n}(Av),Kde=function t(e){e=+e;function n(r){return--r*r*((r+1)*e+r)+1}return n.overshoot=t,n}(Av),g6=function t(e){e=+e;function n(r){return((r*=2)<1?r*r*((e+1)*r-e):(r-=2)*r*((e+1)*r+e)+2)/2}return n.overshoot=t,n}(Av),fu=2*Math.PI,Ev=1,Rv=.3,Yde=function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=fu);function s(i){return e*To(- --i)*Math.sin((r-i)/n)}return s.amplitude=function(i){return t(i,n*fu)},s.period=function(i){return t(e,i)},s}(Ev,Rv),b6=function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=fu);function s(i){return 1-e*To(i=+i)*Math.sin((i+r)/n)}return s.amplitude=function(i){return t(i,n*fu)},s.period=function(i){return t(e,i)},s}(Ev,Rv),Zde=function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=fu);function s(i){return((i=i*2-1)<0?e*To(-i)*Math.sin((r-i)/n):2-e*To(i)*Math.sin((r+i)/n))/2}return s.amplitude=function(i){return t(i,n*fu)},s.period=function(i){return t(e,i)},s}(Ev,Rv),Jde={time:null,delay:0,duration:250,ease:_b};function Qde(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function epe(t){var e,n;t instanceof oi?(e=t._id,t=t._name):(e=qN(),(n=Jde).time=F0(),t=t==null?null:t+"");for(var r=this._groups,s=r.length,i=0;i<s;++i)for(var o=r[i],a=o.length,l,u=0;u<a;++u)(l=o[u])&&Sm(l,t,e,u,o,n||Qde(l,e));return new oi(r,this._parents,t,e)}hl.prototype.interrupt=$fe;hl.prototype.transition=epe;var tpe=[null];function npe(t,e){var n=t.__transition,r,s;if(n){e=e==null?null:e+"";for(s in n)if((r=n[s]).state>Ib&&r.name===e)return new oi([[t]],tpe,e,+s)}return null}const Pg=t=>()=>t;function rpe(t,{sourceEvent:e,target:n,selection:r,mode:s,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},selection:{value:r,enumerable:!0,configurable:!0},mode:{value:s,enumerable:!0,configurable:!0},_:{value:i}})}function spe(t){t.stopImmediatePropagation()}function Bg(t){t.preventDefault(),t.stopImmediatePropagation()}var x6={name:"drag"},Vg={name:"space"},wl={name:"handle"},kl={name:"center"};const{abs:y6,max:On,min:Ln}=Math;function v6(t){return[+t[0],+t[1]]}function Eb(t){return[v6(t[0]),v6(t[1])]}var Qf={name:"x",handles:["w","e"].map(ah),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},ed={name:"y",handles:["n","s"].map(ah),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},ipe={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(ah),input:function(t){return t==null?null:Eb(t)},output:function(t){return t}},yi={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},w6={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},k6={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},ope={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},ape={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function ah(t){return{type:t}}function lpe(t){return!t.ctrlKey&&!t.button}function upe(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function cpe(){return navigator.maxTouchPoints||"ontouchstart"in this}function Wg(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function hpe(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function fpe(t){var e=t.__brush;return e?e.dim.output(e.selection):null}function dpe(){return Dv(Qf)}function ppe(){return Dv(ed)}function mpe(){return Dv(ipe)}function Dv(t){var e=upe,n=lpe,r=cpe,s=!0,i=cl("start","brush","end"),o=6,a;function l(m){var b=m.property("__brush",g).selectAll(".overlay").data([ah("overlay")]);b.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",yi.overlay).merge(b).each(function(){var v=Wg(this).extent;nn(this).attr("x",v[0][0]).attr("y",v[0][1]).attr("width",v[1][0]-v[0][0]).attr("height",v[1][1]-v[0][1])}),m.selectAll(".selection").data([ah("selection")]).enter().append("rect").attr("class","selection").attr("cursor",yi.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var x=m.selectAll(".handle").data(t.handles,function(v){return v.type});x.exit().remove(),x.enter().append("rect").attr("class",function(v){return"handle handle--"+v.type}).attr("cursor",function(v){return yi[v.type]}),m.each(u).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(r).on("touchstart.brush",f).on("touchmove.brush",d).on("touchend.brush touchcancel.brush",p).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}l.move=function(m,b,x){m.tween?m.on("start.brush",function(v){c(this,arguments).beforestart().start(v)}).on("interrupt.brush end.brush",function(v){c(this,arguments).end(v)}).tween("brush",function(){var v=this,y=v.__brush,w=c(v,arguments),C=y.selection,T=t.input(typeof b=="function"?b.apply(this,arguments):b,y.extent),N=qo(C,T);function $(_){y.selection=_===1&&T===null?null:N(_),u.call(v),w.brush()}return C!==null&&T!==null?$:$(1)}):m.each(function(){var v=this,y=arguments,w=v.__brush,C=t.input(typeof b=="function"?b.apply(v,y):b,w.extent),T=c(v,y).beforestart();wa(v),w.selection=C===null?null:C,u.call(v),T.start(x).brush(x).end(x)})},l.clear=function(m,b){l.move(m,null,b)};function u(){var m=nn(this),b=Wg(this).selection;b?(m.selectAll(".selection").style("display",null).attr("x",b[0][0]).attr("y",b[0][1]).attr("width",b[1][0]-b[0][0]).attr("height",b[1][1]-b[0][1]),m.selectAll(".handle").style("display",null).attr("x",function(x){return x.type[x.type.length-1]==="e"?b[1][0]-o/2:b[0][0]-o/2}).attr("y",function(x){return x.type[0]==="s"?b[1][1]-o/2:b[0][1]-o/2}).attr("width",function(x){return x.type==="n"||x.type==="s"?b[1][0]-b[0][0]+o:o}).attr("height",function(x){return x.type==="e"||x.type==="w"?b[1][1]-b[0][1]+o:o})):m.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(m,b,x){var v=m.__brush.emitter;return v&&(!x||!v.clean)?v:new h(m,b,x)}function h(m,b,x){this.that=m,this.args=b,this.state=m.__brush,this.active=0,this.clean=x}h.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(m,b){return this.starting?(this.starting=!1,this.emit("start",m,b)):this.emit("brush",m),this},brush:function(m,b){return this.emit("brush",m,b),this},end:function(m,b){return--this.active===0&&(delete this.state.emitter,this.emit("end",m,b)),this},emit:function(m,b,x){var v=nn(this.that).datum();i.call(m,this.that,new rpe(m,{sourceEvent:b,target:l,selection:t.output(this.state.selection),mode:x,dispatch:i}),v)}};function f(m){if(a&&!m.touches||!n.apply(this,arguments))return;var b=this,x=m.target.__data__.type,v=(s&&m.metaKey?x="overlay":x)==="selection"?x6:s&&m.altKey?kl:wl,y=t===ed?null:ope[x],w=t===Qf?null:ape[x],C=Wg(b),T=C.extent,N=C.selection,$=T[0][0],_,S,M=T[0][1],F,A,E=T[1][0],D,P,z=T[1][1],B,G,j=0,Z=0,ne,le=y&&w&&s&&m.shiftKey,oe,de,fe=Array.from(m.touches||[m],ve=>{const Fe=ve.identifier;return ve=Ar(ve,b),ve.point0=ve.slice(),ve.identifier=Fe,ve});wa(b);var xe=c(b,arguments,!0).beforestart();if(x==="overlay"){N&&(ne=!0);const ve=[fe[0],fe[1]||fe[0]];C.selection=N=[[_=t===ed?$:Ln(ve[0][0],ve[1][0]),F=t===Qf?M:Ln(ve[0][1],ve[1][1])],[D=t===ed?E:On(ve[0][0],ve[1][0]),B=t===Qf?z:On(ve[0][1],ve[1][1])]],fe.length>1&&Le(m)}else _=N[0][0],F=N[0][1],D=N[1][0],B=N[1][1];S=_,A=F,P=D,G=B;var ie=nn(b).attr("pointer-events","none"),pe=ie.selectAll(".overlay").attr("cursor",yi[x]);if(m.touches)xe.moved=ae,xe.ended=De;else{var ge=nn(m.view).on("mousemove.brush",ae,!0).on("mouseup.brush",De,!0);s&&ge.on("keydown.brush",qe,!0).on("keyup.brush",Ue,!0),pm(m.view)}u.call(b),xe.start(m,v.name);function ae(ve){for(const Fe of ve.changedTouches||[ve])for(const Jt of fe)Jt.identifier===Fe.identifier&&(Jt.cur=Ar(Fe,b));if(le&&!oe&&!de&&fe.length===1){const Fe=fe[0];y6(Fe.cur[0]-Fe[0])>y6(Fe.cur[1]-Fe[1])?de=!0:oe=!0}for(const Fe of fe)Fe.cur&&(Fe[0]=Fe.cur[0],Fe[1]=Fe.cur[1]);ne=!0,Bg(ve),Le(ve)}function Le(ve){const Fe=fe[0],Jt=Fe.point0;var xt;switch(j=Fe[0]-Jt[0],Z=Fe[1]-Jt[1],v){case Vg:case x6:{y&&(j=On($-_,Ln(E-D,j)),S=_+j,P=D+j),w&&(Z=On(M-F,Ln(z-B,Z)),A=F+Z,G=B+Z);break}case wl:{fe[1]?(y&&(S=On($,Ln(E,fe[0][0])),P=On($,Ln(E,fe[1][0])),y=1),w&&(A=On(M,Ln(z,fe[0][1])),G=On(M,Ln(z,fe[1][1])),w=1)):(y<0?(j=On($-_,Ln(E-_,j)),S=_+j,P=D):y>0&&(j=On($-D,Ln(E-D,j)),S=_,P=D+j),w<0?(Z=On(M-F,Ln(z-F,Z)),A=F+Z,G=B):w>0&&(Z=On(M-B,Ln(z-B,Z)),A=F,G=B+Z));break}case kl:{y&&(S=On($,Ln(E,_-j*y)),P=On($,Ln(E,D+j*y))),w&&(A=On(M,Ln(z,F-Z*w)),G=On(M,Ln(z,B+Z*w)));break}}P<S&&(y*=-1,xt=_,_=D,D=xt,xt=S,S=P,P=xt,x in w6&&pe.attr("cursor",yi[x=w6[x]])),G<A&&(w*=-1,xt=F,F=B,B=xt,xt=A,A=G,G=xt,x in k6&&pe.attr("cursor",yi[x=k6[x]])),C.selection&&(N=C.selection),oe&&(S=N[0][0],P=N[1][0]),de&&(A=N[0][1],G=N[1][1]),(N[0][0]!==S||N[0][1]!==A||N[1][0]!==P||N[1][1]!==G)&&(C.selection=[[S,A],[P,G]],u.call(b),xe.brush(ve,v.name))}function De(ve){if(spe(ve),ve.touches){if(ve.touches.length)return;a&&clearTimeout(a),a=setTimeout(function(){a=null},500)}else mm(ve.view,ne),ge.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);ie.attr("pointer-events","all"),pe.attr("cursor",yi.overlay),C.selection&&(N=C.selection),hpe(N)&&(C.selection=null,u.call(b)),xe.end(ve,v.name)}function qe(ve){switch(ve.keyCode){case 16:{le=y&&w;break}case 18:{v===wl&&(y&&(D=P-j*y,_=S+j*y),w&&(B=G-Z*w,F=A+Z*w),v=kl,Le(ve));break}case 32:{(v===wl||v===kl)&&(y<0?D=P-j:y>0&&(_=S-j),w<0?B=G-Z:w>0&&(F=A-Z),v=Vg,pe.attr("cursor",yi.selection),Le(ve));break}default:return}Bg(ve)}function Ue(ve){switch(ve.keyCode){case 16:{le&&(oe=de=le=!1,Le(ve));break}case 18:{v===kl&&(y<0?D=P:y>0&&(_=S),w<0?B=G:w>0&&(F=A),v=wl,Le(ve));break}case 32:{v===Vg&&(ve.altKey?(y&&(D=P-j*y,_=S+j*y),w&&(B=G-Z*w,F=A+Z*w),v=kl):(y<0?D=P:y>0&&(_=S),w<0?B=G:w>0&&(F=A),v=wl),pe.attr("cursor",yi[x]),Le(ve));break}default:return}Bg(ve)}}function d(m){c(this,arguments).moved(m)}function p(m){c(this,arguments).ended(m)}function g(){var m=this.__brush||{selection:null};return m.extent=Eb(e.apply(this,arguments)),m.dim=t,m}return l.extent=function(m){return arguments.length?(e=typeof m=="function"?m:Pg(Eb(m)),l):e},l.filter=function(m){return arguments.length?(n=typeof m=="function"?m:Pg(!!m),l):n},l.touchable=function(m){return arguments.length?(r=typeof m=="function"?m:Pg(!!m),l):r},l.handleSize=function(m){return arguments.length?(o=+m,l):o},l.keyModifiers=function(m){return arguments.length?(s=!!m,l):s},l.on=function(){var m=i.on.apply(i,arguments);return m===i?l:m},l}var S6=Math.abs,Sl=Math.cos,Cl=Math.sin,KN=Math.PI,mf=KN/2,C6=KN*2,$6=Math.max,Ug=1e-12;function Gg(t,e){return Array.from({length:e-t},(n,r)=>t+r)}function gpe(t){return function(e,n){return t(e.source.value+e.target.value,n.source.value+n.target.value)}}function bpe(){return Mv(!1,!1)}function xpe(){return Mv(!1,!0)}function ype(){return Mv(!0,!1)}function Mv(t,e){var n=0,r=null,s=null,i=null;function o(a){var l=a.length,u=new Array(l),c=Gg(0,l),h=new Array(l*l),f=new Array(l),d=0,p;a=Float64Array.from({length:l*l},e?(g,m)=>a[m%l][m/l|0]:(g,m)=>a[m/l|0][m%l]);for(let g=0;g<l;++g){let m=0;for(let b=0;b<l;++b)m+=a[g*l+b]+t*a[b*l+g];d+=u[g]=m}d=$6(0,C6-n*l)/d,p=d?n:C6/l;{let g=0;r&&c.sort((m,b)=>r(u[m],u[b]));for(const m of c){const b=g;if(t){const x=Gg(~l+1,l).filter(v=>v<0?a[~v*l+m]:a[m*l+v]);s&&x.sort((v,y)=>s(v<0?-a[~v*l+m]:a[m*l+v],y<0?-a[~y*l+m]:a[m*l+y]));for(const v of x)if(v<0){const y=h[~v*l+m]||(h[~v*l+m]={source:null,target:null});y.target={index:m,startAngle:g,endAngle:g+=a[~v*l+m]*d,value:a[~v*l+m]}}else{const y=h[m*l+v]||(h[m*l+v]={source:null,target:null});y.source={index:m,startAngle:g,endAngle:g+=a[m*l+v]*d,value:a[m*l+v]}}f[m]={index:m,startAngle:b,endAngle:g,value:u[m]}}else{const x=Gg(0,l).filter(v=>a[m*l+v]||a[v*l+m]);s&&x.sort((v,y)=>s(a[m*l+v],a[m*l+y]));for(const v of x){let y;if(m<v?(y=h[m*l+v]||(h[m*l+v]={source:null,target:null}),y.source={index:m,startAngle:g,endAngle:g+=a[m*l+v]*d,value:a[m*l+v]}):(y=h[v*l+m]||(h[v*l+m]={source:null,target:null}),y.target={index:m,startAngle:g,endAngle:g+=a[m*l+v]*d,value:a[m*l+v]},m===v&&(y.source=y.target)),y.source&&y.target&&y.source.value<y.target.value){const w=y.source;y.source=y.target,y.target=w}}f[m]={index:m,startAngle:b,endAngle:g,value:u[m]}}g+=p}}return h=Object.values(h),h.groups=f,i?h.sort(i):h}return o.padAngle=function(a){return arguments.length?(n=$6(0,a),o):n},o.sortGroups=function(a){return arguments.length?(r=a,o):r},o.sortSubgroups=function(a){return arguments.length?(s=a,o):s},o.sortChords=function(a){return arguments.length?(a==null?i=null:(i=gpe(a))._=a,o):i&&i._},o}const Rb=Math.PI,Db=2*Rb,ia=1e-6,vpe=Db-ia;function YN(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function wpe(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return YN;const n=10**e;return function(r){this._+=r[0];for(let s=1,i=r.length;s<i;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}let O0=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?YN:wpe(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,s){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+s}`}bezierCurveTo(e,n,r,s,i,o){this._append`C${+e},${+n},${+r},${+s},${this._x1=+i},${this._y1=+o}`}arcTo(e,n,r,s,i){if(e=+e,n=+n,r=+r,s=+s,i=+i,i<0)throw new Error(`negative radius: ${i}`);let o=this._x1,a=this._y1,l=r-e,u=s-n,c=o-e,h=a-n,f=c*c+h*h;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(f>ia)if(!(Math.abs(h*l-u*c)>ia)||!i)this._append`L${this._x1=e},${this._y1=n}`;else{let d=r-o,p=s-a,g=l*l+u*u,m=d*d+p*p,b=Math.sqrt(g),x=Math.sqrt(f),v=i*Math.tan((Rb-Math.acos((g+f-m)/(2*b*x)))/2),y=v/x,w=v/b;Math.abs(y-1)>ia&&this._append`L${e+y*c},${n+y*h}`,this._append`A${i},${i},0,0,${+(h*d>c*p)},${this._x1=e+w*l},${this._y1=n+w*u}`}}arc(e,n,r,s,i,o){if(e=+e,n=+n,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(s),l=r*Math.sin(s),u=e+a,c=n+l,h=1^o,f=o?s-i:i-s;this._x1===null?this._append`M${u},${c}`:(Math.abs(this._x1-u)>ia||Math.abs(this._y1-c)>ia)&&this._append`L${u},${c}`,r&&(f<0&&(f=f%Db+Db),f>vpe?this._append`A${r},${r},0,1,${h},${e-a},${n-l}A${r},${r},0,1,${h},${this._x1=u},${this._y1=c}`:f>ia&&this._append`A${r},${r},0,${+(f>=Rb)},${h},${this._x1=e+r*Math.cos(i)},${this._y1=n+r*Math.sin(i)}`)}rect(e,n,r,s){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+s}h${-r}Z`}toString(){return this._}};function Fv(){return new O0}Fv.prototype=O0.prototype;function kpe(t=3){return new O0(+t)}var Spe=Array.prototype.slice;function Qo(t){return function(){return t}}function Cpe(t){return t.source}function $pe(t){return t.target}function I6(t){return t.radius}function Ipe(t){return t.startAngle}function Tpe(t){return t.endAngle}function Npe(){return 0}function _pe(){return 10}function ZN(t){var e=Cpe,n=$pe,r=I6,s=I6,i=Ipe,o=Tpe,a=Npe,l=null;function u(){var c,h=e.apply(this,arguments),f=n.apply(this,arguments),d=a.apply(this,arguments)/2,p=Spe.call(arguments),g=+r.apply(this,(p[0]=h,p)),m=i.apply(this,p)-mf,b=o.apply(this,p)-mf,x=+s.apply(this,(p[0]=f,p)),v=i.apply(this,p)-mf,y=o.apply(this,p)-mf;if(l||(l=c=Fv()),d>Ug&&(S6(b-m)>d*2+Ug?b>m?(m+=d,b-=d):(m-=d,b+=d):m=b=(m+b)/2,S6(y-v)>d*2+Ug?y>v?(v+=d,y-=d):(v-=d,y+=d):v=y=(v+y)/2),l.moveTo(g*Sl(m),g*Cl(m)),l.arc(0,0,g,m,b),m!==v||b!==y)if(t){var w=+t.apply(this,arguments),C=x-w,T=(v+y)/2;l.quadraticCurveTo(0,0,C*Sl(v),C*Cl(v)),l.lineTo(x*Sl(T),x*Cl(T)),l.lineTo(C*Sl(y),C*Cl(y))}else l.quadraticCurveTo(0,0,x*Sl(v),x*Cl(v)),l.arc(0,0,x,v,y);if(l.quadraticCurveTo(0,0,g*Sl(m),g*Cl(m)),l.closePath(),c)return l=null,c+""||null}return t&&(u.headRadius=function(c){return arguments.length?(t=typeof c=="function"?c:Qo(+c),u):t}),u.radius=function(c){return arguments.length?(r=s=typeof c=="function"?c:Qo(+c),u):r},u.sourceRadius=function(c){return arguments.length?(r=typeof c=="function"?c:Qo(+c),u):r},u.targetRadius=function(c){return arguments.length?(s=typeof c=="function"?c:Qo(+c),u):s},u.startAngle=function(c){return arguments.length?(i=typeof c=="function"?c:Qo(+c),u):i},u.endAngle=function(c){return arguments.length?(o=typeof c=="function"?c:Qo(+c),u):o},u.padAngle=function(c){return arguments.length?(a=typeof c=="function"?c:Qo(+c),u):a},u.source=function(c){return arguments.length?(e=c,u):e},u.target=function(c){return arguments.length?(n=c,u):n},u.context=function(c){return arguments.length?(l=c??null,u):l},u}function Ape(){return ZN()}function Epe(){return ZN(_pe)}var Rpe=Array.prototype,JN=Rpe.slice;function Dpe(t,e){return t-e}function Mpe(t){for(var e=0,n=t.length,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r}const io=t=>()=>t;function Fpe(t,e){for(var n=-1,r=e.length,s;++n<r;)if(s=Ope(t,e[n]))return s;return 0}function Ope(t,e){for(var n=e[0],r=e[1],s=-1,i=0,o=t.length,a=o-1;i<o;a=i++){var l=t[i],u=l[0],c=l[1],h=t[a],f=h[0],d=h[1];if(Lpe(l,h,e))return 0;c>r!=d>r&&n<(f-u)*(r-c)/(d-c)+u&&(s=-s)}return s}function Lpe(t,e,n){var r;return zpe(t,e,n)&&Ppe(t[r=+(t[0]===e[0])],n[r],e[r])}function zpe(t,e,n){return(e[0]-t[0])*(n[1]-t[1])===(n[0]-t[0])*(e[1]-t[1])}function Ppe(t,e,n){return t<=e&&e<=n||n<=e&&e<=t}function Bpe(){}var vi=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Mb(){var t=1,e=1,n=dv,r=l;function s(u){var c=n(u);if(Array.isArray(c))c=c.slice().sort(Dpe);else{const h=Rc(u,Vpe);for(c=Va(...fv(h[0],h[1],c),c);c[c.length-1]>=h[1];)c.pop();for(;c[1]<h[0];)c.shift()}return c.map(h=>i(u,h))}function i(u,c){const h=c==null?NaN:+c;if(isNaN(h))throw new Error(`invalid value: ${c}`);var f=[],d=[];return o(u,h,function(p){r(p,u,h),Mpe(p)>0?f.push([p]):d.push(p)}),d.forEach(function(p){for(var g=0,m=f.length,b;g<m;++g)if(Fpe((b=f[g])[0],p)!==-1){b.push(p);return}}),{type:"MultiPolygon",value:c,coordinates:f}}function o(u,c,h){var f=new Array,d=new Array,p,g,m,b,x,v;for(p=g=-1,b=ea(u[0],c),vi[b<<1].forEach(y);++p<t-1;)m=b,b=ea(u[p+1],c),vi[m|b<<1].forEach(y);for(vi[b<<0].forEach(y);++g<e-1;){for(p=-1,b=ea(u[g*t+t],c),x=ea(u[g*t],c),vi[b<<1|x<<2].forEach(y);++p<t-1;)m=b,b=ea(u[g*t+t+p+1],c),v=x,x=ea(u[g*t+p+1],c),vi[m|b<<1|x<<2|v<<3].forEach(y);vi[b|x<<3].forEach(y)}for(p=-1,x=u[g*t]>=c,vi[x<<2].forEach(y);++p<t-1;)v=x,x=ea(u[g*t+p+1],c),vi[x<<2|v<<3].forEach(y);vi[x<<3].forEach(y);function y(w){var C=[w[0][0]+p,w[0][1]+g],T=[w[1][0]+p,w[1][1]+g],N=a(C),$=a(T),_,S;(_=d[N])?(S=f[$])?(delete d[_.end],delete f[S.start],_===S?(_.ring.push(T),h(_.ring)):f[_.start]=d[S.end]={start:_.start,end:S.end,ring:_.ring.concat(S.ring)}):(delete d[_.end],_.ring.push(T),d[_.end=$]=_):(_=f[$])?(S=d[N])?(delete f[_.start],delete d[S.end],_===S?(_.ring.push(T),h(_.ring)):f[S.start]=d[_.end]={start:S.start,end:_.end,ring:S.ring.concat(_.ring)}):(delete f[_.start],_.ring.unshift(C),f[_.start=N]=_):f[N]=d[$]={start:N,end:$,ring:[C,T]}}}function a(u){return u[0]*2+u[1]*(t+1)*4}function l(u,c,h){u.forEach(function(f){var d=f[0],p=f[1],g=d|0,m=p|0,b=Hg(c[m*t+g]);d>0&&d<t&&g===d&&(f[0]=T6(d,Hg(c[m*t+g-1]),b,h)),p>0&&p<e&&m===p&&(f[1]=T6(p,Hg(c[(m-1)*t+g]),b,h))})}return s.contour=i,s.size=function(u){if(!arguments.length)return[t,e];var c=Math.floor(u[0]),h=Math.floor(u[1]);if(!(c>=0&&h>=0))throw new Error("invalid size");return t=c,e=h,s},s.thresholds=function(u){return arguments.length?(n=typeof u=="function"?u:Array.isArray(u)?io(JN.call(u)):io(u),s):n},s.smooth=function(u){return arguments.length?(r=u?l:Bpe,s):r===l},s}function Vpe(t){return isFinite(t)?t:NaN}function ea(t,e){return t==null?!1:+t>=e}function Hg(t){return t==null||isNaN(t=+t)?-1/0:t}function T6(t,e,n,r){const s=r-e,i=n-e,o=isFinite(s)||isFinite(i)?s/i:Math.sign(s)/Math.sign(i);return isNaN(o)?t:t+o-.5}function Wpe(t){return t[0]}function Upe(t){return t[1]}function Gpe(){return 1}function QN(){var t=Wpe,e=Upe,n=Gpe,r=960,s=500,i=20,o=2,a=i*3,l=r+a*2>>o,u=s+a*2>>o,c=io(20);function h(x){var v=new Float32Array(l*u),y=Math.pow(2,-o),w=-1;for(const F of x){var C=(t(F,++w,x)+a)*y,T=(e(F,w,x)+a)*y,N=+n(F,w,x);if(N&&C>=0&&C<l&&T>=0&&T<u){var $=Math.floor(C),_=Math.floor(T),S=C-$-.5,M=T-_-.5;v[$+_*l]+=(1-S)*(1-M)*N,v[$+1+_*l]+=S*(1-M)*N,v[$+1+(_+1)*l]+=S*M*N,v[$+(_+1)*l]+=(1-S)*M*N}}return ET({data:v,width:l,height:u},i*y),v}function f(x){var v=h(x),y=c(v),w=Math.pow(2,2*o);return Array.isArray(y)||(y=Va(Number.MIN_VALUE,_s(v)/w,y)),Mb().size([l,u]).thresholds(y.map(C=>C*w))(v).map((C,T)=>(C.value=+y[T],d(C)))}f.contours=function(x){var v=h(x),y=Mb().size([l,u]),w=Math.pow(2,2*o),C=T=>{T=+T;var N=d(y.contour(v,T*w));return N.value=T,N};return Object.defineProperty(C,"max",{get:()=>_s(v)/w}),C};function d(x){return x.coordinates.forEach(p),x}function p(x){x.forEach(g)}function g(x){x.forEach(m)}function m(x){x[0]=x[0]*Math.pow(2,o)-a,x[1]=x[1]*Math.pow(2,o)-a}function b(){return a=i*3,l=r+a*2>>o,u=s+a*2>>o,f}return f.x=function(x){return arguments.length?(t=typeof x=="function"?x:io(+x),f):t},f.y=function(x){return arguments.length?(e=typeof x=="function"?x:io(+x),f):e},f.weight=function(x){return arguments.length?(n=typeof x=="function"?x:io(+x),f):n},f.size=function(x){if(!arguments.length)return[r,s];var v=+x[0],y=+x[1];if(!(v>=0&&y>=0))throw new Error("invalid size");return r=v,s=y,b()},f.cellSize=function(x){if(!arguments.length)return 1<<o;if(!((x=+x)>=1))throw new Error("invalid cell size");return o=Math.floor(Math.log(x)/Math.LN2),b()},f.thresholds=function(x){return arguments.length?(c=typeof x=="function"?x:Array.isArray(x)?io(JN.call(x)):io(x),f):c},f.bandwidth=function(x){if(!arguments.length)return Math.sqrt(i*(i+1));if(!((x=+x)>=0))throw new Error("invalid bandwidth");return i=(Math.sqrt(4*x*x+1)-1)/2,b()},f}const Ri=11102230246251565e-32,zn=134217729,Hpe=(3+8*Ri)*Ri;function qg(t,e,n,r,s){let i,o,a,l,u=e[0],c=r[0],h=0,f=0;c>u==c>-u?(i=u,u=e[++h]):(i=c,c=r[++f]);let d=0;if(h<t&&f<n)for(c>u==c>-u?(o=u+i,a=i-(o-u),u=e[++h]):(o=c+i,a=i-(o-c),c=r[++f]),i=o,a!==0&&(s[d++]=a);h<t&&f<n;)c>u==c>-u?(o=i+u,l=o-i,a=i-(o-l)+(u-l),u=e[++h]):(o=i+c,l=o-i,a=i-(o-l)+(c-l),c=r[++f]),i=o,a!==0&&(s[d++]=a);for(;h<t;)o=i+u,l=o-i,a=i-(o-l)+(u-l),u=e[++h],i=o,a!==0&&(s[d++]=a);for(;f<n;)o=i+c,l=o-i,a=i-(o-l)+(c-l),c=r[++f],i=o,a!==0&&(s[d++]=a);return(i!==0||d===0)&&(s[d++]=i),d}function qpe(t,e){let n=e[0];for(let r=1;r<t;r++)n+=e[r];return n}function L0(t){return new Float64Array(t)}const Xpe=(3+16*Ri)*Ri,jpe=(2+12*Ri)*Ri,Kpe=(9+64*Ri)*Ri*Ri,$l=L0(4),N6=L0(8),_6=L0(12),A6=L0(16),Xn=L0(4);function Ype(t,e,n,r,s,i,o){let a,l,u,c,h,f,d,p,g,m,b,x,v,y,w,C,T,N;const $=t-s,_=n-s,S=e-i,M=r-i;y=$*M,f=zn*$,d=f-(f-$),p=$-d,f=zn*M,g=f-(f-M),m=M-g,w=p*m-(y-d*g-p*g-d*m),C=S*_,f=zn*S,d=f-(f-S),p=S-d,f=zn*_,g=f-(f-_),m=_-g,T=p*m-(C-d*g-p*g-d*m),b=w-T,h=w-b,$l[0]=w-(b+h)+(h-T),x=y+b,h=x-y,v=y-(x-h)+(b-h),b=v-C,h=v-b,$l[1]=v-(b+h)+(h-C),N=x+b,h=N-x,$l[2]=x-(N-h)+(b-h),$l[3]=N;let F=qpe(4,$l),A=jpe*o;if(F>=A||-F>=A||(h=t-$,a=t-($+h)+(h-s),h=n-_,u=n-(_+h)+(h-s),h=e-S,l=e-(S+h)+(h-i),h=r-M,c=r-(M+h)+(h-i),a===0&&l===0&&u===0&&c===0)||(A=Kpe*o+Hpe*Math.abs(F),F+=$*c+M*a-(S*u+_*l),F>=A||-F>=A))return F;y=a*M,f=zn*a,d=f-(f-a),p=a-d,f=zn*M,g=f-(f-M),m=M-g,w=p*m-(y-d*g-p*g-d*m),C=l*_,f=zn*l,d=f-(f-l),p=l-d,f=zn*_,g=f-(f-_),m=_-g,T=p*m-(C-d*g-p*g-d*m),b=w-T,h=w-b,Xn[0]=w-(b+h)+(h-T),x=y+b,h=x-y,v=y-(x-h)+(b-h),b=v-C,h=v-b,Xn[1]=v-(b+h)+(h-C),N=x+b,h=N-x,Xn[2]=x-(N-h)+(b-h),Xn[3]=N;const E=qg(4,$l,4,Xn,N6);y=$*c,f=zn*$,d=f-(f-$),p=$-d,f=zn*c,g=f-(f-c),m=c-g,w=p*m-(y-d*g-p*g-d*m),C=S*u,f=zn*S,d=f-(f-S),p=S-d,f=zn*u,g=f-(f-u),m=u-g,T=p*m-(C-d*g-p*g-d*m),b=w-T,h=w-b,Xn[0]=w-(b+h)+(h-T),x=y+b,h=x-y,v=y-(x-h)+(b-h),b=v-C,h=v-b,Xn[1]=v-(b+h)+(h-C),N=x+b,h=N-x,Xn[2]=x-(N-h)+(b-h),Xn[3]=N;const D=qg(E,N6,4,Xn,_6);y=a*c,f=zn*a,d=f-(f-a),p=a-d,f=zn*c,g=f-(f-c),m=c-g,w=p*m-(y-d*g-p*g-d*m),C=l*u,f=zn*l,d=f-(f-l),p=l-d,f=zn*u,g=f-(f-u),m=u-g,T=p*m-(C-d*g-p*g-d*m),b=w-T,h=w-b,Xn[0]=w-(b+h)+(h-T),x=y+b,h=x-y,v=y-(x-h)+(b-h),b=v-C,h=v-b,Xn[1]=v-(b+h)+(h-C),N=x+b,h=N-x,Xn[2]=x-(N-h)+(b-h),Xn[3]=N;const P=qg(D,_6,4,Xn,A6);return A6[P-1]}function gf(t,e,n,r,s,i){const o=(e-i)*(n-s),a=(t-s)*(r-i),l=o-a,u=Math.abs(o+a);return Math.abs(l)>=Xpe*u?l:-Ype(t,e,n,r,s,i,u)}const E6=Math.pow(2,-52),bf=new Uint32Array(512);class Xd{static from(e,n=t1e,r=n1e){const s=e.length,i=new Float64Array(s*2);for(let o=0;o<s;o++){const a=e[o];i[2*o]=n(a),i[2*o+1]=r(a)}return new Xd(i)}constructor(e){const n=e.length>>1;if(n>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:e,_hullPrev:n,_hullNext:r,_hullTri:s,_hullHash:i}=this,o=e.length>>1;let a=1/0,l=1/0,u=-1/0,c=-1/0;for(let $=0;$<o;$++){const _=e[2*$],S=e[2*$+1];_<a&&(a=_),S<l&&(l=S),_>u&&(u=_),S>c&&(c=S),this._ids[$]=$}const h=(a+u)/2,f=(l+c)/2;let d,p,g;for(let $=0,_=1/0;$<o;$++){const S=Xg(h,f,e[2*$],e[2*$+1]);S<_&&(d=$,_=S)}const m=e[2*d],b=e[2*d+1];for(let $=0,_=1/0;$<o;$++){if($===d)continue;const S=Xg(m,b,e[2*$],e[2*$+1]);S<_&&S>0&&(p=$,_=S)}let x=e[2*p],v=e[2*p+1],y=1/0;for(let $=0;$<o;$++){if($===d||$===p)continue;const _=Qpe(m,b,x,v,e[2*$],e[2*$+1]);_<y&&(g=$,y=_)}let w=e[2*g],C=e[2*g+1];if(y===1/0){for(let S=0;S<o;S++)this._dists[S]=e[2*S]-e[0]||e[2*S+1]-e[1];Ml(this._ids,this._dists,0,o-1);const $=new Uint32Array(o);let _=0;for(let S=0,M=-1/0;S<o;S++){const F=this._ids[S],A=this._dists[F];A>M&&($[_++]=F,M=A)}this.hull=$.subarray(0,_),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(gf(m,b,x,v,w,C)<0){const $=p,_=x,S=v;p=g,x=w,v=C,g=$,w=_,C=S}const T=e1e(m,b,x,v,w,C);this._cx=T.x,this._cy=T.y;for(let $=0;$<o;$++)this._dists[$]=Xg(e[2*$],e[2*$+1],T.x,T.y);Ml(this._ids,this._dists,0,o-1),this._hullStart=d;let N=3;r[d]=n[g]=p,r[p]=n[d]=g,r[g]=n[p]=d,s[d]=0,s[p]=1,s[g]=2,i.fill(-1),i[this._hashKey(m,b)]=d,i[this._hashKey(x,v)]=p,i[this._hashKey(w,C)]=g,this.trianglesLen=0,this._addTriangle(d,p,g,-1,-1,-1);for(let $=0,_,S;$<this._ids.length;$++){const M=this._ids[$],F=e[2*M],A=e[2*M+1];if($>0&&Math.abs(F-_)<=E6&&Math.abs(A-S)<=E6||(_=F,S=A,M===d||M===p||M===g))continue;let E=0;for(let G=0,j=this._hashKey(F,A);G<this._hashSize&&(E=i[(j+G)%this._hashSize],!(E!==-1&&E!==r[E]));G++);E=n[E];let D=E,P;for(;P=r[D],gf(F,A,e[2*D],e[2*D+1],e[2*P],e[2*P+1])>=0;)if(D=P,D===E){D=-1;break}if(D===-1)continue;let z=this._addTriangle(D,M,r[D],-1,-1,s[D]);s[M]=this._legalize(z+2),s[D]=z,N++;let B=r[D];for(;P=r[B],gf(F,A,e[2*B],e[2*B+1],e[2*P],e[2*P+1])<0;)z=this._addTriangle(B,M,P,s[M],-1,s[B]),s[M]=this._legalize(z+2),r[B]=B,N--,B=P;if(D===E)for(;P=n[D],gf(F,A,e[2*P],e[2*P+1],e[2*D],e[2*D+1])<0;)z=this._addTriangle(P,M,D,-1,s[D],s[P]),this._legalize(z+2),s[P]=z,r[D]=D,N--,D=P;this._hullStart=n[M]=D,r[D]=n[B]=M,r[M]=B,i[this._hashKey(F,A)]=M,i[this._hashKey(e[2*D],e[2*D+1])]=D}this.hull=new Uint32Array(N);for(let $=0,_=this._hullStart;$<N;$++)this.hull[$]=_,_=r[_];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,n){return Math.floor(Zpe(e-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:n,_halfedges:r,coords:s}=this;let i=0,o=0;for(;;){const a=r[e],l=e-e%3;if(o=l+(e+2)%3,a===-1){if(i===0)break;e=bf[--i];continue}const u=a-a%3,c=l+(e+1)%3,h=u+(a+2)%3,f=n[o],d=n[e],p=n[c],g=n[h];if(Jpe(s[2*f],s[2*f+1],s[2*d],s[2*d+1],s[2*p],s[2*p+1],s[2*g],s[2*g+1])){n[e]=g,n[a]=f;const b=r[h];if(b===-1){let v=this._hullStart;do{if(this._hullTri[v]===h){this._hullTri[v]=e;break}v=this._hullPrev[v]}while(v!==this._hullStart)}this._link(e,b),this._link(a,r[o]),this._link(o,h);const x=u+(a+1)%3;i<bf.length&&(bf[i++]=x)}else{if(i===0)break;e=bf[--i]}}return o}_link(e,n){this._halfedges[e]=n,n!==-1&&(this._halfedges[n]=e)}_addTriangle(e,n,r,s,i,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=n,this._triangles[a+2]=r,this._link(a,s),this._link(a+1,i),this._link(a+2,o),this.trianglesLen+=3,a}}function Zpe(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}function Xg(t,e,n,r){const s=t-n,i=e-r;return s*s+i*i}function Jpe(t,e,n,r,s,i,o,a){const l=t-o,u=e-a,c=n-o,h=r-a,f=s-o,d=i-a,p=l*l+u*u,g=c*c+h*h,m=f*f+d*d;return l*(h*m-g*d)-u*(c*m-g*f)+p*(c*d-h*f)<0}function Qpe(t,e,n,r,s,i){const o=n-t,a=r-e,l=s-t,u=i-e,c=o*o+a*a,h=l*l+u*u,f=.5/(o*u-a*l),d=(u*c-a*h)*f,p=(o*h-l*c)*f;return d*d+p*p}function e1e(t,e,n,r,s,i){const o=n-t,a=r-e,l=s-t,u=i-e,c=o*o+a*a,h=l*l+u*u,f=.5/(o*u-a*l),d=t+(u*c-a*h)*f,p=e+(o*h-l*c)*f;return{x:d,y:p}}function Ml(t,e,n,r){if(r-n<=20)for(let s=n+1;s<=r;s++){const i=t[s],o=e[i];let a=s-1;for(;a>=n&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=i}else{const s=n+r>>1;let i=n+1,o=r;ic(t,s,i),e[t[n]]>e[t[r]]&&ic(t,n,r),e[t[i]]>e[t[r]]&&ic(t,i,r),e[t[n]]>e[t[i]]&&ic(t,n,i);const a=t[i],l=e[a];for(;;){do i++;while(e[t[i]]<l);do o--;while(e[t[o]]>l);if(o<i)break;ic(t,i,o)}t[n+1]=t[o],t[o]=a,r-i+1>=o-n?(Ml(t,e,i,r),Ml(t,e,n,o-1)):(Ml(t,e,n,o-1),Ml(t,e,i,r))}}function ic(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function t1e(t){return t[0]}function n1e(t){return t[1]}const R6=1e-6;class ma{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,n){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,n){this._+=`L${this._x1=+e},${this._y1=+n}`}arc(e,n,r){e=+e,n=+n,r=+r;const s=e+r,i=n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${s},${i}`:(Math.abs(this._x1-s)>R6||Math.abs(this._y1-i)>R6)&&(this._+="L"+s+","+i),r&&(this._+=`A${r},${r},0,1,1,${e-r},${n}A${r},${r},0,1,1,${this._x1=s},${this._y1=i}`)}rect(e,n,r,s){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${+r}v${+s}h${-r}Z`}value(){return this._||null}}class Fb{constructor(){this._=[]}moveTo(e,n){this._.push([e,n])}closePath(){this._.push(this._[0].slice())}lineTo(e,n){this._.push([e,n])}value(){return this._.length?this._:null}}class e_{constructor(e,[n,r,s,i]=[0,0,960,500]){if(!((s=+s)>=(n=+n))||!((i=+i)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=s,this.xmin=n,this.ymax=i,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:n,triangles:r},vectors:s}=this;let i,o;const a=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let g=0,m=0,b=r.length,x,v;g<b;g+=3,m+=2){const y=r[g]*2,w=r[g+1]*2,C=r[g+2]*2,T=e[y],N=e[y+1],$=e[w],_=e[w+1],S=e[C],M=e[C+1],F=$-T,A=_-N,E=S-T,D=M-N,P=(F*D-A*E)*2;if(Math.abs(P)<1e-9){if(i===void 0){i=o=0;for(const B of n)i+=e[B*2],o+=e[B*2+1];i/=n.length,o/=n.length}const z=1e9*Math.sign((i-T)*D-(o-N)*E);x=(T+S)/2-z*D,v=(N+M)/2+z*E}else{const z=1/P,B=F*F+A*A,G=E*E+D*D;x=T+(D*B-A*G)*z,v=N+(F*G-E*B)*z}a[m]=x,a[m+1]=v}let l=n[n.length-1],u,c=l*4,h,f=e[2*l],d,p=e[2*l+1];s.fill(0);for(let g=0;g<n.length;++g)l=n[g],u=c,h=f,d=p,c=l*4,f=e[2*l],p=e[2*l+1],s[u+2]=s[c]=d-p,s[u+3]=s[c+1]=f-h}render(e){const n=e==null?e=new ma:void 0,{delaunay:{halfedges:r,inedges:s,hull:i},circumcenters:o,vectors:a}=this;if(i.length<=1)return null;for(let c=0,h=r.length;c<h;++c){const f=r[c];if(f<c)continue;const d=Math.floor(c/3)*2,p=Math.floor(f/3)*2,g=o[d],m=o[d+1],b=o[p],x=o[p+1];this._renderSegment(g,m,b,x,e)}let l,u=i[i.length-1];for(let c=0;c<i.length;++c){l=u,u=i[c];const h=Math.floor(s[u]/3)*2,f=o[h],d=o[h+1],p=l*4,g=this._project(f,d,a[p+2],a[p+3]);g&&this._renderSegment(f,d,g[0],g[1],e)}return n&&n.value()}renderBounds(e){const n=e==null?e=new ma:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(e,n){const r=n==null?n=new ma:void 0,s=this._clip(e);if(s===null||!s.length)return;n.moveTo(s[0],s[1]);let i=s.length;for(;s[0]===s[i-2]&&s[1]===s[i-1]&&i>1;)i-=2;for(let o=2;o<i;o+=2)(s[o]!==s[o-2]||s[o+1]!==s[o-1])&&n.lineTo(s[o],s[o+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let n=0,r=e.length/2;n<r;++n){const s=this.cellPolygon(n);s&&(s.index=n,yield s)}}cellPolygon(e){const n=new Fb;return this.renderCell(e,n),n.value()}_renderSegment(e,n,r,s,i){let o;const a=this._regioncode(e,n),l=this._regioncode(r,s);a===0&&l===0?(i.moveTo(e,n),i.lineTo(r,s)):(o=this._clipSegment(e,n,r,s,a,l))&&(i.moveTo(o[0],o[1]),i.lineTo(o[2],o[3]))}contains(e,n,r){return n=+n,n!==n||(r=+r,r!==r)?!1:this.delaunay._step(e,n,r)===e}*neighbors(e){const n=this._clip(e);if(n)for(const r of this.delaunay.neighbors(e)){const s=this._clip(r);if(s){e:for(let i=0,o=n.length;i<o;i+=2)for(let a=0,l=s.length;a<l;a+=2)if(n[i]===s[a]&&n[i+1]===s[a+1]&&n[(i+2)%o]===s[(a+l-2)%l]&&n[(i+3)%o]===s[(a+l-1)%l]){yield r;break e}}}}_cell(e){const{circumcenters:n,delaunay:{inedges:r,halfedges:s,triangles:i}}=this,o=r[e];if(o===-1)return null;const a=[];let l=o;do{const u=Math.floor(l/3);if(a.push(n[u*2],n[u*2+1]),l=l%3===2?l-2:l+1,i[l]!==e)break;l=s[l]}while(l!==o&&l!==-1);return a}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(e);if(n===null)return null;const{vectors:r}=this,s=e*4;return this._simplify(r[s]||r[s+1]?this._clipInfinite(e,n,r[s],r[s+1],r[s+2],r[s+3]):this._clipFinite(e,n))}_clipFinite(e,n){const r=n.length;let s=null,i,o,a=n[r-2],l=n[r-1],u,c=this._regioncode(a,l),h,f=0;for(let d=0;d<r;d+=2)if(i=a,o=l,a=n[d],l=n[d+1],u=c,c=this._regioncode(a,l),u===0&&c===0)h=f,f=0,s?s.push(a,l):s=[a,l];else{let p,g,m,b,x;if(u===0){if((p=this._clipSegment(i,o,a,l,u,c))===null)continue;[g,m,b,x]=p}else{if((p=this._clipSegment(a,l,i,o,c,u))===null)continue;[b,x,g,m]=p,h=f,f=this._edgecode(g,m),h&&f&&this._edge(e,h,f,s,s.length),s?s.push(g,m):s=[g,m]}h=f,f=this._edgecode(b,x),h&&f&&this._edge(e,h,f,s,s.length),s?s.push(b,x):s=[b,x]}if(s)h=f,f=this._edgecode(s[0],s[1]),h&&f&&this._edge(e,h,f,s,s.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return s}_clipSegment(e,n,r,s,i,o){const a=i<o;for(a&&([e,n,r,s,i,o]=[r,s,e,n,o,i]);;){if(i===0&&o===0)return a?[r,s,e,n]:[e,n,r,s];if(i&o)return null;let l,u,c=i||o;c&8?(l=e+(r-e)*(this.ymax-n)/(s-n),u=this.ymax):c&4?(l=e+(r-e)*(this.ymin-n)/(s-n),u=this.ymin):c&2?(u=n+(s-n)*(this.xmax-e)/(r-e),l=this.xmax):(u=n+(s-n)*(this.xmin-e)/(r-e),l=this.xmin),i?(e=l,n=u,i=this._regioncode(e,n)):(r=l,s=u,o=this._regioncode(r,s))}}_clipInfinite(e,n,r,s,i,o){let a=Array.from(n),l;if((l=this._project(a[0],a[1],r,s))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],i,o))&&a.push(l[0],l[1]),a=this._clipFinite(e,a))for(let u=0,c=a.length,h,f=this._edgecode(a[c-2],a[c-1]);u<c;u+=2)h=f,f=this._edgecode(a[u],a[u+1]),h&&f&&(u=this._edge(e,h,f,a,u),c=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,n,r,s,i){for(;n!==r;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(s[i]!==o||s[i+1]!==a)&&this.contains(e,o,a)&&(s.splice(i,0,o,a),i+=2)}return i}_project(e,n,r,s){let i=1/0,o,a,l;if(s<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/s)<i&&(l=this.ymin,a=e+(i=o)*r)}else if(s>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/s)<i&&(l=this.ymax,a=e+(i=o)*r)}if(r>0){if(e>=this.xmax)return null;(o=(this.xmax-e)/r)<i&&(a=this.xmax,l=n+(i=o)*s)}else if(r<0){if(e<=this.xmin)return null;(o=(this.xmin-e)/r)<i&&(a=this.xmin,l=n+(i=o)*s)}return[a,l]}_edgecode(e,n){return(e===this.xmin?1:e===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(e,n){return(e<this.xmin?1:e>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let n=0;n<e.length;n+=2){const r=(n+2)%e.length,s=(n+4)%e.length;(e[n]===e[r]&&e[r]===e[s]||e[n+1]===e[r+1]&&e[r+1]===e[s+1])&&(e.splice(r,2),n-=2)}e.length||(e=null)}return e}}const r1e=2*Math.PI,Il=Math.pow;function s1e(t){return t[0]}function i1e(t){return t[1]}function o1e(t){const{triangles:e,coords:n}=t;for(let r=0;r<e.length;r+=3){const s=2*e[r],i=2*e[r+1],o=2*e[r+2];if((n[o]-n[s])*(n[i+1]-n[s+1])-(n[i]-n[s])*(n[o+1]-n[s+1])>1e-10)return!1}return!0}function a1e(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class Ov{static from(e,n=s1e,r=i1e,s){return new Ov("length"in e?l1e(e,n,r,s):Float64Array.from(u1e(e,n,r,s)))}constructor(e){this._delaunator=new Xd(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,n=this.points;if(e.hull&&e.hull.length>2&&o1e(e)){this.collinear=Int32Array.from({length:n.length/2},(f,d)=>d).sort((f,d)=>n[2*f]-n[2*d]||n[2*f+1]-n[2*d+1]);const l=this.collinear[0],u=this.collinear[this.collinear.length-1],c=[n[2*l],n[2*l+1],n[2*u],n[2*u+1]],h=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let f=0,d=n.length/2;f<d;++f){const p=a1e(n[2*f],n[2*f+1],h);n[2*f]=p[0],n[2*f+1]=p[1]}this._delaunator=new Xd(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,s=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,u=r.length;l<u;++l){const c=i[l%3===2?l-2:l+1];(r[l]===-1||o[c]===-1)&&(o[c]=l)}for(let l=0,u=s.length;l<u;++l)a[s[l]]=l;s.length<=2&&s.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=s[0],o[s[0]]=1,s.length===2&&(o[s[1]]=0,this.triangles[1]=s[1],this.triangles[2]=s[1]))}voronoi(e){return new e_(this,e)}*neighbors(e){const{inedges:n,hull:r,_hullIndex:s,halfedges:i,triangles:o,collinear:a}=this;if(a){const h=a.indexOf(e);h>0&&(yield a[h-1]),h<a.length-1&&(yield a[h+1]);return}const l=n[e];if(l===-1)return;let u=l,c=-1;do{if(yield c=o[u],u=u%3===2?u-2:u+1,o[u]!==e)return;if(u=i[u],u===-1){const h=r[(s[e]+1)%r.length];h!==c&&(yield h);return}}while(u!==l)}find(e,n,r=0){if(e=+e,e!==e||(n=+n,n!==n))return-1;const s=r;let i;for(;(i=this._step(r,e,n))>=0&&i!==r&&i!==s;)r=i;return i}_step(e,n,r){const{inedges:s,hull:i,_hullIndex:o,halfedges:a,triangles:l,points:u}=this;if(s[e]===-1||!u.length)return(e+1)%(u.length>>1);let c=e,h=Il(n-u[e*2],2)+Il(r-u[e*2+1],2);const f=s[e];let d=f;do{let p=l[d];const g=Il(n-u[p*2],2)+Il(r-u[p*2+1],2);if(g<h&&(h=g,c=p),d=d%3===2?d-2:d+1,l[d]!==e)break;if(d=a[d],d===-1){if(d=i[(o[e]+1)%i.length],d!==p&&Il(n-u[d*2],2)+Il(r-u[d*2+1],2)<h)return d;break}}while(d!==f);return c}render(e){const n=e==null?e=new ma:void 0,{points:r,halfedges:s,triangles:i}=this;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(l<o)continue;const u=i[o]*2,c=i[l]*2;e.moveTo(r[u],r[u+1]),e.lineTo(r[c],r[c+1])}return this.renderHull(e),n&&n.value()}renderPoints(e,n){n===void 0&&(!e||typeof e.moveTo!="function")&&(n=e,e=null),n=n==null?2:+n;const r=e==null?e=new ma:void 0,{points:s}=this;for(let i=0,o=s.length;i<o;i+=2){const a=s[i],l=s[i+1];e.moveTo(a+n,l),e.arc(a,l,n,0,r1e)}return r&&r.value()}renderHull(e){const n=e==null?e=new ma:void 0,{hull:r,points:s}=this,i=r[0]*2,o=r.length;e.moveTo(s[i],s[i+1]);for(let a=1;a<o;++a){const l=2*r[a];e.lineTo(s[l],s[l+1])}return e.closePath(),n&&n.value()}hullPolygon(){const e=new Fb;return this.renderHull(e),e.value()}renderTriangle(e,n){const r=n==null?n=new ma:void 0,{points:s,triangles:i}=this,o=i[e*=3]*2,a=i[e+1]*2,l=i[e+2]*2;return n.moveTo(s[o],s[o+1]),n.lineTo(s[a],s[a+1]),n.lineTo(s[l],s[l+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:e}=this;for(let n=0,r=e.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(e){const n=new Fb;return this.renderTriangle(e,n),n.value()}}function l1e(t,e,n,r){const s=t.length,i=new Float64Array(s*2);for(let o=0;o<s;++o){const a=t[o];i[o*2]=e.call(r,a,o,t),i[o*2+1]=n.call(r,a,o,t)}return i}function*u1e(t,e,n,r){let s=0;for(const i of t)yield e.call(r,i,s,t),yield n.call(r,i,s,t),++s}var D6={},jg={},Kg=34,oc=10,Yg=13;function t_(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function c1e(t,e){var n=t_(t);return function(r,s){return e(n(r),s,t)}}function M6(t){var e=Object.create(null),n=[];return t.forEach(function(r){for(var s in r)s in e||n.push(e[s]=s)}),n}function gr(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function h1e(t){return t<0?"-"+gr(-t,6):t>9999?"+"+gr(t,6):gr(t,4)}function f1e(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),s=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":h1e(t.getUTCFullYear())+"-"+gr(t.getUTCMonth()+1,2)+"-"+gr(t.getUTCDate(),2)+(s?"T"+gr(e,2)+":"+gr(n,2)+":"+gr(r,2)+"."+gr(s,3)+"Z":r?"T"+gr(e,2)+":"+gr(n,2)+":"+gr(r,2)+"Z":n||e?"T"+gr(e,2)+":"+gr(n,2)+"Z":"")}function Cm(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function r(h,f){var d,p,g=s(h,function(m,b){if(d)return d(m,b-1);p=m,d=f?c1e(m,f):t_(m)});return g.columns=p||[],g}function s(h,f){var d=[],p=h.length,g=0,m=0,b,x=p<=0,v=!1;h.charCodeAt(p-1)===oc&&--p,h.charCodeAt(p-1)===Yg&&--p;function y(){if(x)return jg;if(v)return v=!1,D6;var C,T=g,N;if(h.charCodeAt(T)===Kg){for(;g++<p&&h.charCodeAt(g)!==Kg||h.charCodeAt(++g)===Kg;);return(C=g)>=p?x=!0:(N=h.charCodeAt(g++))===oc?v=!0:N===Yg&&(v=!0,h.charCodeAt(g)===oc&&++g),h.slice(T+1,C-1).replace(/""/g,'"')}for(;g<p;){if((N=h.charCodeAt(C=g++))===oc)v=!0;else if(N===Yg)v=!0,h.charCodeAt(g)===oc&&++g;else if(N!==n)continue;return h.slice(T,C)}return x=!0,h.slice(T,p)}for(;(b=y())!==jg;){for(var w=[];b!==D6&&b!==jg;)w.push(b),b=y();f&&(w=f(w,m++))==null||d.push(w)}return d}function i(h,f){return h.map(function(d){return f.map(function(p){return c(d[p])}).join(t)})}function o(h,f){return f==null&&(f=M6(h)),[f.map(c).join(t)].concat(i(h,f)).join(`
`)}function a(h,f){return f==null&&(f=M6(h)),i(h,f).join(`
`)}function l(h){return h.map(u).join(`
`)}function u(h){return h.map(c).join(t)}function c(h){return h==null?"":h instanceof Date?f1e(h):e.test(h+="")?'"'+h.replace(/"/g,'""')+'"':h}return{parse:r,parseRows:s,format:o,formatBody:a,formatRows:l,formatRow:u,formatValue:c}}var fl=Cm(","),n_=fl.parse,d1e=fl.parseRows,p1e=fl.format,m1e=fl.formatBody,g1e=fl.formatRows,b1e=fl.formatRow,x1e=fl.formatValue,dl=Cm("	"),r_=dl.parse,y1e=dl.parseRows,v1e=dl.format,w1e=dl.formatBody,k1e=dl.formatRows,S1e=dl.formatRow,C1e=dl.formatValue;function $1e(t){for(var e in t){var n=t[e].trim(),r,s;if(!n)n=null;else if(n==="true")n=!0;else if(n==="false")n=!1;else if(n==="NaN")n=NaN;else if(!isNaN(r=+n))n=r;else if(s=n.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/))I1e&&s[4]&&!s[7]&&(n=n.replace(/-/g,"/").replace(/T/," ")),n=new Date(n);else continue;t[e]=n}return t}const I1e=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function T1e(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.blob()}function N1e(t,e){return fetch(t,e).then(T1e)}function _1e(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.arrayBuffer()}function A1e(t,e){return fetch(t,e).then(_1e)}function E1e(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function $m(t,e){return fetch(t,e).then(E1e)}function s_(t){return function(e,n,r){return arguments.length===2&&typeof n=="function"&&(r=n,n=void 0),$m(e,n).then(function(s){return t(s,r)})}}function R1e(t,e,n,r){arguments.length===3&&typeof n=="function"&&(r=n,n=void 0);var s=Cm(t);return $m(e,n).then(function(i){return s.parse(i,r)})}var D1e=s_(n_),M1e=s_(r_);function F1e(t,e){return new Promise(function(n,r){var s=new Image;for(var i in e)s[i]=e[i];s.onerror=r,s.onload=function(){n(s)},s.src=t})}function O1e(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(!(t.status===204||t.status===205))return t.json()}function L1e(t,e){return fetch(t,e).then(O1e)}function Lv(t){return(e,n)=>$m(e,n).then(r=>new DOMParser().parseFromString(r,t))}const z1e=Lv("application/xml");var P1e=Lv("text/html"),B1e=Lv("image/svg+xml");function V1e(t,e){var n,r=1;t==null&&(t=0),e==null&&(e=0);function s(){var i,o=n.length,a,l=0,u=0;for(i=0;i<o;++i)a=n[i],l+=a.x,u+=a.y;for(l=(l/o-t)*r,u=(u/o-e)*r,i=0;i<o;++i)a=n[i],a.x-=l,a.y-=u}return s.initialize=function(i){n=i},s.x=function(i){return arguments.length?(t=+i,s):t},s.y=function(i){return arguments.length?(e=+i,s):e},s.strength=function(i){return arguments.length?(r=+i,s):r},s}function W1e(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return i_(this.cover(e,n),e,n,t)}function i_(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var s,i=t._root,o={data:r},a=t._x0,l=t._y0,u=t._x1,c=t._y1,h,f,d,p,g,m,b,x;if(!i)return t._root=o,t;for(;i.length;)if((g=e>=(h=(a+u)/2))?a=h:u=h,(m=n>=(f=(l+c)/2))?l=f:c=f,s=i,!(i=i[b=m<<1|g]))return s[b]=o,t;if(d=+t._x.call(null,i.data),p=+t._y.call(null,i.data),e===d&&n===p)return o.next=i,s?s[b]=o:t._root=o,t;do s=s?s[b]=new Array(4):t._root=new Array(4),(g=e>=(h=(a+u)/2))?a=h:u=h,(m=n>=(f=(l+c)/2))?l=f:c=f;while((b=m<<1|g)===(x=(p>=f)<<1|d>=h));return s[x]=i,s[b]=o,t}function U1e(t){var e,n,r=t.length,s,i,o=new Array(r),a=new Array(r),l=1/0,u=1/0,c=-1/0,h=-1/0;for(n=0;n<r;++n)isNaN(s=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(o[n]=s,a[n]=i,s<l&&(l=s),s>c&&(c=s),i<u&&(u=i),i>h&&(h=i));if(l>c||u>h)return this;for(this.cover(l,u).cover(c,h),n=0;n<r;++n)i_(this,o[n],a[n],t[n]);return this}function G1e(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,s=this._x1,i=this._y1;if(isNaN(n))s=(n=Math.floor(t))+1,i=(r=Math.floor(e))+1;else{for(var o=s-n||1,a=this._root,l,u;n>t||t>=s||r>e||e>=i;)switch(u=(e<r)<<1|t<n,l=new Array(4),l[u]=a,a=l,o*=2,u){case 0:s=n+o,i=r+o;break;case 1:n=s-o,i=r+o;break;case 2:s=n+o,r=i-o;break;case 3:n=s-o,r=i-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=r,this._x1=s,this._y1=i,this}function H1e(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function q1e(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function nr(t,e,n,r,s){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=s}function X1e(t,e,n){var r,s=this._x0,i=this._y0,o,a,l,u,c=this._x1,h=this._y1,f=[],d=this._root,p,g;for(d&&f.push(new nr(d,s,i,c,h)),n==null?n=1/0:(s=t-n,i=e-n,c=t+n,h=e+n,n*=n);p=f.pop();)if(!(!(d=p.node)||(o=p.x0)>c||(a=p.y0)>h||(l=p.x1)<s||(u=p.y1)<i))if(d.length){var m=(o+l)/2,b=(a+u)/2;f.push(new nr(d[3],m,b,l,u),new nr(d[2],o,b,m,u),new nr(d[1],m,a,l,b),new nr(d[0],o,a,m,b)),(g=(e>=b)<<1|t>=m)&&(p=f[f.length-1],f[f.length-1]=f[f.length-1-g],f[f.length-1-g]=p)}else{var x=t-+this._x.call(null,d.data),v=e-+this._y.call(null,d.data),y=x*x+v*v;if(y<n){var w=Math.sqrt(n=y);s=t-w,i=e-w,c=t+w,h=e+w,r=d.data}}return r}function j1e(t){if(isNaN(c=+this._x.call(null,t))||isNaN(h=+this._y.call(null,t)))return this;var e,n=this._root,r,s,i,o=this._x0,a=this._y0,l=this._x1,u=this._y1,c,h,f,d,p,g,m,b;if(!n)return this;if(n.length)for(;;){if((p=c>=(f=(o+l)/2))?o=f:l=f,(g=h>=(d=(a+u)/2))?a=d:u=d,e=n,!(n=n[m=g<<1|p]))return this;if(!n.length)break;(e[m+1&3]||e[m+2&3]||e[m+3&3])&&(r=e,b=m)}for(;n.data!==t;)if(s=n,!(n=n.next))return this;return(i=n.next)&&delete n.next,s?(i?s.next=i:delete s.next,this):e?(i?e[m]=i:delete e[m],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[b]=n:this._root=n),this):(this._root=i,this)}function K1e(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function Y1e(){return this._root}function Z1e(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function J1e(t){var e=[],n,r=this._root,s,i,o,a,l;for(r&&e.push(new nr(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,i=n.x0,o=n.y0,a=n.x1,l=n.y1)&&r.length){var u=(i+a)/2,c=(o+l)/2;(s=r[3])&&e.push(new nr(s,u,c,a,l)),(s=r[2])&&e.push(new nr(s,i,c,u,l)),(s=r[1])&&e.push(new nr(s,u,o,a,c)),(s=r[0])&&e.push(new nr(s,i,o,u,c))}return this}function Q1e(t){var e=[],n=[],r;for(this._root&&e.push(new nr(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var s=r.node;if(s.length){var i,o=r.x0,a=r.y0,l=r.x1,u=r.y1,c=(o+l)/2,h=(a+u)/2;(i=s[0])&&e.push(new nr(i,o,a,c,h)),(i=s[1])&&e.push(new nr(i,c,a,l,h)),(i=s[2])&&e.push(new nr(i,o,h,c,u)),(i=s[3])&&e.push(new nr(i,c,h,l,u))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function eme(t){return t[0]}function tme(t){return arguments.length?(this._x=t,this):this._x}function nme(t){return t[1]}function rme(t){return arguments.length?(this._y=t,this):this._y}function Im(t,e,n){var r=new zv(e??eme,n??nme,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function zv(t,e,n,r,s,i){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=s,this._y1=i,this._root=void 0}function F6(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var dr=Im.prototype=zv.prototype;dr.copy=function(){var t=new zv(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=F6(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var s=0;s<4;++s)(r=e.source[s])&&(r.length?n.push({source:r,target:e.target[s]=new Array(4)}):e.target[s]=F6(r));return t};dr.add=W1e;dr.addAll=U1e;dr.cover=G1e;dr.data=H1e;dr.extent=q1e;dr.find=X1e;dr.remove=j1e;dr.removeAll=K1e;dr.root=Y1e;dr.size=Z1e;dr.visit=J1e;dr.visitAfter=Q1e;dr.x=tme;dr.y=rme;function gn(t){return function(){return t}}function ho(t){return(t()-.5)*1e-6}function sme(t){return t.x+t.vx}function ime(t){return t.y+t.vy}function ome(t){var e,n,r,s=1,i=1;typeof t!="function"&&(t=gn(t==null?1:+t));function o(){for(var u,c=e.length,h,f,d,p,g,m,b=0;b<i;++b)for(h=Im(e,sme,ime).visitAfter(a),u=0;u<c;++u)f=e[u],g=n[f.index],m=g*g,d=f.x+f.vx,p=f.y+f.vy,h.visit(x);function x(v,y,w,C,T){var N=v.data,$=v.r,_=g+$;if(N){if(N.index>f.index){var S=d-N.x-N.vx,M=p-N.y-N.vy,F=S*S+M*M;F<_*_&&(S===0&&(S=ho(r),F+=S*S),M===0&&(M=ho(r),F+=M*M),F=(_-(F=Math.sqrt(F)))/F*s,f.vx+=(S*=F)*(_=($*=$)/(m+$)),f.vy+=(M*=F)*_,N.vx-=S*(_=1-_),N.vy-=M*_)}return}return y>d+_||C<d-_||w>p+_||T<p-_}}function a(u){if(u.data)return u.r=n[u.data.index];for(var c=u.r=0;c<4;++c)u[c]&&u[c].r>u.r&&(u.r=u[c].r)}function l(){if(e){var u,c=e.length,h;for(n=new Array(c),u=0;u<c;++u)h=e[u],n[h.index]=+t(h,u,e)}}return o.initialize=function(u,c){e=u,r=c,l()},o.iterations=function(u){return arguments.length?(i=+u,o):i},o.strength=function(u){return arguments.length?(s=+u,o):s},o.radius=function(u){return arguments.length?(t=typeof u=="function"?u:gn(+u),l(),o):t},o}function ame(t){return t.index}function O6(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function lme(t){var e=ame,n=h,r,s=gn(30),i,o,a,l,u,c=1;t==null&&(t=[]);function h(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function f(m){for(var b=0,x=t.length;b<c;++b)for(var v=0,y,w,C,T,N,$,_;v<x;++v)y=t[v],w=y.source,C=y.target,T=C.x+C.vx-w.x-w.vx||ho(u),N=C.y+C.vy-w.y-w.vy||ho(u),$=Math.sqrt(T*T+N*N),$=($-i[v])/$*m*r[v],T*=$,N*=$,C.vx-=T*(_=l[v]),C.vy-=N*_,w.vx+=T*(_=1-_),w.vy+=N*_}function d(){if(o){var m,b=o.length,x=t.length,v=new Map(o.map((w,C)=>[e(w,C,o),w])),y;for(m=0,a=new Array(b);m<x;++m)y=t[m],y.index=m,typeof y.source!="object"&&(y.source=O6(v,y.source)),typeof y.target!="object"&&(y.target=O6(v,y.target)),a[y.source.index]=(a[y.source.index]||0)+1,a[y.target.index]=(a[y.target.index]||0)+1;for(m=0,l=new Array(x);m<x;++m)y=t[m],l[m]=a[y.source.index]/(a[y.source.index]+a[y.target.index]);r=new Array(x),p(),i=new Array(x),g()}}function p(){if(o)for(var m=0,b=t.length;m<b;++m)r[m]=+n(t[m],m,t)}function g(){if(o)for(var m=0,b=t.length;m<b;++m)i[m]=+s(t[m],m,t)}return f.initialize=function(m,b){o=m,u=b,d()},f.links=function(m){return arguments.length?(t=m,d(),f):t},f.id=function(m){return arguments.length?(e=m,f):e},f.iterations=function(m){return arguments.length?(c=+m,f):c},f.strength=function(m){return arguments.length?(n=typeof m=="function"?m:gn(+m),p(),f):n},f.distance=function(m){return arguments.length?(s=typeof m=="function"?m:gn(+m),g(),f):s},f}const ume=1664525,cme=1013904223,L6=4294967296;function hme(){let t=1;return()=>(t=(ume*t+cme)%L6)/L6}function fme(t){return t.x}function dme(t){return t.y}var pme=10,mme=Math.PI*(3-Math.sqrt(5));function gme(t){var e,n=1,r=.001,s=1-Math.pow(r,1/300),i=0,o=.6,a=new Map,l=km(h),u=cl("tick","end"),c=hme();t==null&&(t=[]);function h(){f(),u.call("tick",e),n<r&&(l.stop(),u.call("end",e))}function f(g){var m,b=t.length,x;g===void 0&&(g=1);for(var v=0;v<g;++v)for(n+=(i-n)*s,a.forEach(function(y){y(n)}),m=0;m<b;++m)x=t[m],x.fx==null?x.x+=x.vx*=o:(x.x=x.fx,x.vx=0),x.fy==null?x.y+=x.vy*=o:(x.y=x.fy,x.vy=0);return e}function d(){for(var g=0,m=t.length,b;g<m;++g){if(b=t[g],b.index=g,b.fx!=null&&(b.x=b.fx),b.fy!=null&&(b.y=b.fy),isNaN(b.x)||isNaN(b.y)){var x=pme*Math.sqrt(.5+g),v=g*mme;b.x=x*Math.cos(v),b.y=x*Math.sin(v)}(isNaN(b.vx)||isNaN(b.vy))&&(b.vx=b.vy=0)}}function p(g){return g.initialize&&g.initialize(t,c),g}return d(),e={tick:f,restart:function(){return l.restart(h),e},stop:function(){return l.stop(),e},nodes:function(g){return arguments.length?(t=g,d(),a.forEach(p),e):t},alpha:function(g){return arguments.length?(n=+g,e):n},alphaMin:function(g){return arguments.length?(r=+g,e):r},alphaDecay:function(g){return arguments.length?(s=+g,e):+s},alphaTarget:function(g){return arguments.length?(i=+g,e):i},velocityDecay:function(g){return arguments.length?(o=1-g,e):1-o},randomSource:function(g){return arguments.length?(c=g,a.forEach(p),e):c},force:function(g,m){return arguments.length>1?(m==null?a.delete(g):a.set(g,p(m)),e):a.get(g)},find:function(g,m,b){var x=0,v=t.length,y,w,C,T,N;for(b==null?b=1/0:b*=b,x=0;x<v;++x)T=t[x],y=g-T.x,w=m-T.y,C=y*y+w*w,C<b&&(N=T,b=C);return N},on:function(g,m){return arguments.length>1?(u.on(g,m),e):u.on(g)}}}function bme(){var t,e,n,r,s=gn(-30),i,o=1,a=1/0,l=.81;function u(d){var p,g=t.length,m=Im(t,fme,dme).visitAfter(h);for(r=d,p=0;p<g;++p)e=t[p],m.visit(f)}function c(){if(t){var d,p=t.length,g;for(i=new Array(p),d=0;d<p;++d)g=t[d],i[g.index]=+s(g,d,t)}}function h(d){var p=0,g,m,b=0,x,v,y;if(d.length){for(x=v=y=0;y<4;++y)(g=d[y])&&(m=Math.abs(g.value))&&(p+=g.value,b+=m,x+=m*g.x,v+=m*g.y);d.x=x/b,d.y=v/b}else{g=d,g.x=g.data.x,g.y=g.data.y;do p+=i[g.data.index];while(g=g.next)}d.value=p}function f(d,p,g,m){if(!d.value)return!0;var b=d.x-e.x,x=d.y-e.y,v=m-p,y=b*b+x*x;if(v*v/l<y)return y<a&&(b===0&&(b=ho(n),y+=b*b),x===0&&(x=ho(n),y+=x*x),y<o&&(y=Math.sqrt(o*y)),e.vx+=b*d.value*r/y,e.vy+=x*d.value*r/y),!0;if(d.length||y>=a)return;(d.data!==e||d.next)&&(b===0&&(b=ho(n),y+=b*b),x===0&&(x=ho(n),y+=x*x),y<o&&(y=Math.sqrt(o*y)));do d.data!==e&&(v=i[d.data.index]*r/y,e.vx+=b*v,e.vy+=x*v);while(d=d.next)}return u.initialize=function(d,p){t=d,n=p,c()},u.strength=function(d){return arguments.length?(s=typeof d=="function"?d:gn(+d),c(),u):s},u.distanceMin=function(d){return arguments.length?(o=d*d,u):Math.sqrt(o)},u.distanceMax=function(d){return arguments.length?(a=d*d,u):Math.sqrt(a)},u.theta=function(d){return arguments.length?(l=d*d,u):Math.sqrt(l)},u}function xme(t,e,n){var r,s=gn(.1),i,o;typeof t!="function"&&(t=gn(+t)),e==null&&(e=0),n==null&&(n=0);function a(u){for(var c=0,h=r.length;c<h;++c){var f=r[c],d=f.x-e||1e-6,p=f.y-n||1e-6,g=Math.sqrt(d*d+p*p),m=(o[c]-g)*i[c]*u/g;f.vx+=d*m,f.vy+=p*m}}function l(){if(r){var u,c=r.length;for(i=new Array(c),o=new Array(c),u=0;u<c;++u)o[u]=+t(r[u],u,r),i[u]=isNaN(o[u])?0:+s(r[u],u,r)}}return a.initialize=function(u){r=u,l()},a.strength=function(u){return arguments.length?(s=typeof u=="function"?u:gn(+u),l(),a):s},a.radius=function(u){return arguments.length?(t=typeof u=="function"?u:gn(+u),l(),a):t},a.x=function(u){return arguments.length?(e=+u,a):e},a.y=function(u){return arguments.length?(n=+u,a):n},a}function yme(t){var e=gn(.1),n,r,s;typeof t!="function"&&(t=gn(t==null?0:+t));function i(a){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vx+=(s[l]-c.x)*r[l]*a}function o(){if(n){var a,l=n.length;for(r=new Array(l),s=new Array(l),a=0;a<l;++a)r[a]=isNaN(s[a]=+t(n[a],a,n))?0:+e(n[a],a,n)}}return i.initialize=function(a){n=a,o()},i.strength=function(a){return arguments.length?(e=typeof a=="function"?a:gn(+a),o(),i):e},i.x=function(a){return arguments.length?(t=typeof a=="function"?a:gn(+a),o(),i):t},i}function vme(t){var e=gn(.1),n,r,s;typeof t!="function"&&(t=gn(t==null?0:+t));function i(a){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vy+=(s[l]-c.y)*r[l]*a}function o(){if(n){var a,l=n.length;for(r=new Array(l),s=new Array(l),a=0;a<l;++a)r[a]=isNaN(s[a]=+t(n[a],a,n))?0:+e(n[a],a,n)}}return i.initialize=function(a){n=a,o()},i.strength=function(a){return arguments.length?(e=typeof a=="function"?a:gn(+a),o(),i):e},i.y=function(a){return arguments.length?(t=typeof a=="function"?a:gn(+a),o(),i):t},i}function wme(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function jd(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function du(t){return t=jd(Math.abs(t)),t?t[1]:NaN}function kme(t,e){return function(n,r){for(var s=n.length,i=[],o=0,a=t[0],l=0;s>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),i.push(n.substring(s-=a,s+a)),!((l+=a+1)>r));)a=t[o=(o+1)%t.length];return i.reverse().join(e)}}function Sme(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Cme=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function pu(t){if(!(e=Cme.exec(t)))throw new Error("invalid format: "+t);var e;return new Tm({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}pu.prototype=Tm.prototype;function Tm(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Tm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function $me(t){e:for(var e=t.length,n=1,r=-1,s;n<e;++n)switch(t[n]){case".":r=s=n;break;case"0":r===0&&(r=n),s=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(s+1):t}var o_;function Ime(t,e){var n=jd(t,e);if(!n)return t+"";var r=n[0],s=n[1],i=s-(o_=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,o=r.length;return i===o?r:i>o?r+new Array(i-o+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+jd(t,Math.max(0,e+i-1))[0]}function z6(t,e){var n=jd(t,e);if(!n)return t+"";var r=n[0],s=n[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}const P6={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:wme,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>z6(t*100,e),r:z6,s:Ime,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function B6(t){return t}var V6=Array.prototype.map,W6=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function a_(t){var e=t.grouping===void 0||t.thousands===void 0?B6:kme(V6.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",i=t.numerals===void 0?B6:Sme(V6.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function u(h){h=pu(h);var f=h.fill,d=h.align,p=h.sign,g=h.symbol,m=h.zero,b=h.width,x=h.comma,v=h.precision,y=h.trim,w=h.type;w==="n"?(x=!0,w="g"):P6[w]||(v===void 0&&(v=12),y=!0,w="g"),(m||f==="0"&&d==="=")&&(m=!0,f="0",d="=");var C=g==="$"?n:g==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",T=g==="$"?r:/[%p]/.test(w)?o:"",N=P6[w],$=/[defgprs%]/.test(w);v=v===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function _(S){var M=C,F=T,A,E,D;if(w==="c")F=N(S)+F,S="";else{S=+S;var P=S<0||1/S<0;if(S=isNaN(S)?l:N(Math.abs(S),v),y&&(S=$me(S)),P&&+S==0&&p!=="+"&&(P=!1),M=(P?p==="("?p:a:p==="-"||p==="("?"":p)+M,F=(w==="s"?W6[8+o_/3]:"")+F+(P&&p==="("?")":""),$){for(A=-1,E=S.length;++A<E;)if(D=S.charCodeAt(A),48>D||D>57){F=(D===46?s+S.slice(A+1):S.slice(A))+F,S=S.slice(0,A);break}}}x&&!m&&(S=e(S,1/0));var z=M.length+S.length+F.length,B=z<b?new Array(b-z+1).join(f):"";switch(x&&m&&(S=e(B+S,B.length?b-F.length:1/0),B=""),d){case"<":S=M+S+F+B;break;case"=":S=M+B+S+F;break;case"^":S=B.slice(0,z=B.length>>1)+M+S+F+B.slice(z);break;default:S=B+M+S+F;break}return i(S)}return _.toString=function(){return h+""},_}function c(h,f){var d=u((h=pu(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(du(f)/3)))*3,g=Math.pow(10,-p),m=W6[8+p/3];return function(b){return d(g*b)+m}}return{format:u,formatPrefix:c}}var xf,Nm,Pv;l_({thousands:",",grouping:[3],currency:["$",""]});function l_(t){return xf=a_(t),Nm=xf.format,Pv=xf.formatPrefix,xf}function u_(t){return Math.max(0,-du(Math.abs(t)))}function c_(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(du(e)/3)))*3-du(Math.abs(t)))}function h_(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,du(e)-du(t))+1}var Pe=1e-6,Kd=1e-12,nt=Math.PI,Ut=nt/2,Yd=nt/4,ur=nt*2,wt=180/nt,Oe=nt/180,rt=Math.abs,qu=Math.atan,cr=Math.atan2,Ae=Math.cos,yf=Math.ceil,f_=Math.exp,Ob=Math.hypot,Zd=Math.log,Zg=Math.pow,$e=Math.sin,ts=Math.sign||function(t){return t>0?1:t<0?-1:0},Sn=Math.sqrt,Bv=Math.tan;function d_(t){return t>1?0:t<-1?nt:Math.acos(t)}function hr(t){return t>1?Ut:t<-1?-Ut:Math.asin(t)}function U6(t){return(t=$e(t/2))*t}function Lt(){}function Jd(t,e){t&&H6.hasOwnProperty(t.type)&&H6[t.type](t,e)}var G6={Feature:function(t,e){Jd(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,s=n.length;++r<s;)Jd(n[r].geometry,e)}},H6={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,s=n.length;++r<s;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){Lb(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,s=n.length;++r<s;)Lb(n[r],e,0)},Polygon:function(t,e){q6(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,s=n.length;++r<s;)q6(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,s=n.length;++r<s;)Jd(n[r],e)}};function Lb(t,e,n){var r=-1,s=t.length-n,i;for(e.lineStart();++r<s;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function q6(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)Lb(t[n],e,1);e.polygonEnd()}function vs(t,e){t&&G6.hasOwnProperty(t.type)?G6[t.type](t,e):Jd(t,e)}var Qd=new bn,ep=new bn,p_,m_,zb,Pb,Bb,ai={point:Lt,lineStart:Lt,lineEnd:Lt,polygonStart:function(){Qd=new bn,ai.lineStart=Tme,ai.lineEnd=Nme},polygonEnd:function(){var t=+Qd;ep.add(t<0?ur+t:t),this.lineStart=this.lineEnd=this.point=Lt},sphere:function(){ep.add(ur)}};function Tme(){ai.point=_me}function Nme(){g_(p_,m_)}function _me(t,e){ai.point=g_,p_=t,m_=e,t*=Oe,e*=Oe,zb=t,Pb=Ae(e=e/2+Yd),Bb=$e(e)}function g_(t,e){t*=Oe,e*=Oe,e=e/2+Yd;var n=t-zb,r=n>=0?1:-1,s=r*n,i=Ae(e),o=$e(e),a=Bb*o,l=Pb*i+a*Ae(s),u=a*r*$e(s);Qd.add(cr(u,l)),zb=t,Pb=i,Bb=o}function Ame(t){return ep=new bn,vs(t,ai),ep*2}function tp(t){return[cr(t[1],t[0]),hr(t[2])]}function qa(t){var e=t[0],n=t[1],r=Ae(n);return[r*Ae(e),r*$e(e),$e(n)]}function vf(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function mu(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Jg(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function wf(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function np(t){var e=Sn(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Ft,wr,Bt,Er,oa,b_,x_,Gl,Dc,oo,Pi,Ci={point:Vb,lineStart:X6,lineEnd:j6,polygonStart:function(){Ci.point=v_,Ci.lineStart=Eme,Ci.lineEnd=Rme,Dc=new bn,ai.polygonStart()},polygonEnd:function(){ai.polygonEnd(),Ci.point=Vb,Ci.lineStart=X6,Ci.lineEnd=j6,Qd<0?(Ft=-(Bt=180),wr=-(Er=90)):Dc>Pe?Er=90:Dc<-1e-6&&(wr=-90),Pi[0]=Ft,Pi[1]=Bt},sphere:function(){Ft=-(Bt=180),wr=-(Er=90)}};function Vb(t,e){oo.push(Pi=[Ft=t,Bt=t]),e<wr&&(wr=e),e>Er&&(Er=e)}function y_(t,e){var n=qa([t*Oe,e*Oe]);if(Gl){var r=mu(Gl,n),s=[r[1],-r[0],0],i=mu(s,r);np(i),i=tp(i);var o=t-oa,a=o>0?1:-1,l=i[0]*wt*a,u,c=rt(o)>180;c^(a*oa<l&&l<a*t)?(u=i[1]*wt,u>Er&&(Er=u)):(l=(l+360)%360-180,c^(a*oa<l&&l<a*t)?(u=-i[1]*wt,u<wr&&(wr=u)):(e<wr&&(wr=e),e>Er&&(Er=e))),c?t<oa?Nr(Ft,t)>Nr(Ft,Bt)&&(Bt=t):Nr(t,Bt)>Nr(Ft,Bt)&&(Ft=t):Bt>=Ft?(t<Ft&&(Ft=t),t>Bt&&(Bt=t)):t>oa?Nr(Ft,t)>Nr(Ft,Bt)&&(Bt=t):Nr(t,Bt)>Nr(Ft,Bt)&&(Ft=t)}else oo.push(Pi=[Ft=t,Bt=t]);e<wr&&(wr=e),e>Er&&(Er=e),Gl=n,oa=t}function X6(){Ci.point=y_}function j6(){Pi[0]=Ft,Pi[1]=Bt,Ci.point=Vb,Gl=null}function v_(t,e){if(Gl){var n=t-oa;Dc.add(rt(n)>180?n+(n>0?360:-360):n)}else b_=t,x_=e;ai.point(t,e),y_(t,e)}function Eme(){ai.lineStart()}function Rme(){v_(b_,x_),ai.lineEnd(),rt(Dc)>Pe&&(Ft=-(Bt=180)),Pi[0]=Ft,Pi[1]=Bt,Gl=null}function Nr(t,e){return(e-=t)<0?e+360:e}function Dme(t,e){return t[0]-e[0]}function K6(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}function Mme(t){var e,n,r,s,i,o,a;if(Er=Bt=-(Ft=wr=1/0),oo=[],vs(t,Ci),n=oo.length){for(oo.sort(Dme),e=1,r=oo[0],i=[r];e<n;++e)s=oo[e],K6(r,s[0])||K6(r,s[1])?(Nr(r[0],s[1])>Nr(r[0],r[1])&&(r[1]=s[1]),Nr(s[0],r[1])>Nr(r[0],r[1])&&(r[0]=s[0])):i.push(r=s);for(o=-1/0,n=i.length-1,e=0,r=i[n];e<=n;r=s,++e)s=i[e],(a=Nr(r[1],s[0]))>o&&(o=a,Ft=s[0],Bt=r[1])}return oo=Pi=null,Ft===1/0||wr===1/0?[[NaN,NaN],[NaN,NaN]]:[[Ft,wr],[Bt,Er]]}var vc,rp,sp,ip,op,ap,lp,up,Wb,Ub,Gb,w_,k_,Jn,Qn,er,ws={sphere:Lt,point:Vv,lineStart:Y6,lineEnd:Z6,polygonStart:function(){ws.lineStart=Lme,ws.lineEnd=zme},polygonEnd:function(){ws.lineStart=Y6,ws.lineEnd=Z6}};function Vv(t,e){t*=Oe,e*=Oe;var n=Ae(e);z0(n*Ae(t),n*$e(t),$e(e))}function z0(t,e,n){++vc,sp+=(t-sp)/vc,ip+=(e-ip)/vc,op+=(n-op)/vc}function Y6(){ws.point=Fme}function Fme(t,e){t*=Oe,e*=Oe;var n=Ae(e);Jn=n*Ae(t),Qn=n*$e(t),er=$e(e),ws.point=Ome,z0(Jn,Qn,er)}function Ome(t,e){t*=Oe,e*=Oe;var n=Ae(e),r=n*Ae(t),s=n*$e(t),i=$e(e),o=cr(Sn((o=Qn*i-er*s)*o+(o=er*r-Jn*i)*o+(o=Jn*s-Qn*r)*o),Jn*r+Qn*s+er*i);rp+=o,ap+=o*(Jn+(Jn=r)),lp+=o*(Qn+(Qn=s)),up+=o*(er+(er=i)),z0(Jn,Qn,er)}function Z6(){ws.point=Vv}function Lme(){ws.point=Pme}function zme(){S_(w_,k_),ws.point=Vv}function Pme(t,e){w_=t,k_=e,t*=Oe,e*=Oe,ws.point=S_;var n=Ae(e);Jn=n*Ae(t),Qn=n*$e(t),er=$e(e),z0(Jn,Qn,er)}function S_(t,e){t*=Oe,e*=Oe;var n=Ae(e),r=n*Ae(t),s=n*$e(t),i=$e(e),o=Qn*i-er*s,a=er*r-Jn*i,l=Jn*s-Qn*r,u=Ob(o,a,l),c=hr(u),h=u&&-c/u;Wb.add(h*o),Ub.add(h*a),Gb.add(h*l),rp+=c,ap+=c*(Jn+(Jn=r)),lp+=c*(Qn+(Qn=s)),up+=c*(er+(er=i)),z0(Jn,Qn,er)}function Bme(t){vc=rp=sp=ip=op=ap=lp=up=0,Wb=new bn,Ub=new bn,Gb=new bn,vs(t,ws);var e=+Wb,n=+Ub,r=+Gb,s=Ob(e,n,r);return s<Kd&&(e=ap,n=lp,r=up,rp<Pe&&(e=sp,n=ip,r=op),s=Ob(e,n,r),s<Kd)?[NaN,NaN]:[cr(n,e)*wt,hr(r/s)*wt]}function Tl(t){return function(){return t}}function Hb(t,e){function n(r,s){return r=t(r,s),e(r[0],r[1])}return t.invert&&e.invert&&(n.invert=function(r,s){return r=e.invert(r,s),r&&t.invert(r[0],r[1])}),n}function qb(t,e){return rt(t)>nt&&(t-=Math.round(t/ur)*ur),[t,e]}qb.invert=qb;function Wv(t,e,n){return(t%=ur)?e||n?Hb(Q6(t),e7(e,n)):Q6(t):e||n?e7(e,n):qb}function J6(t){return function(e,n){return e+=t,rt(e)>nt&&(e-=Math.round(e/ur)*ur),[e,n]}}function Q6(t){var e=J6(t);return e.invert=J6(-t),e}function e7(t,e){var n=Ae(t),r=$e(t),s=Ae(e),i=$e(e);function o(a,l){var u=Ae(l),c=Ae(a)*u,h=$e(a)*u,f=$e(l),d=f*n+c*r;return[cr(h*s-d*i,c*n-f*r),hr(d*s+h*i)]}return o.invert=function(a,l){var u=Ae(l),c=Ae(a)*u,h=$e(a)*u,f=$e(l),d=f*s-h*i;return[cr(h*s+f*i,c*n+d*r),hr(d*n-c*r)]},o}function C_(t){t=Wv(t[0]*Oe,t[1]*Oe,t.length>2?t[2]*Oe:0);function e(n){return n=t(n[0]*Oe,n[1]*Oe),n[0]*=wt,n[1]*=wt,n}return e.invert=function(n){return n=t.invert(n[0]*Oe,n[1]*Oe),n[0]*=wt,n[1]*=wt,n},e}function $_(t,e,n,r,s,i){if(n){var o=Ae(e),a=$e(e),l=r*n;s==null?(s=e+r*ur,i=e-l/2):(s=t7(o,s),i=t7(o,i),(r>0?s<i:s>i)&&(s+=r*ur));for(var u,c=s;r>0?c>i:c<i;c-=l)u=tp([o,-a*Ae(c),-a*$e(c)]),t.point(u[0],u[1])}}function t7(t,e){e=qa(e),e[0]-=t,np(e);var n=d_(-e[1]);return((-e[2]<0?-n:n)+ur-Pe)%ur}function Vme(){var t=Tl([0,0]),e=Tl(90),n=Tl(2),r,s,i={point:o};function o(l,u){r.push(l=s(l,u)),l[0]*=wt,l[1]*=wt}function a(){var l=t.apply(this,arguments),u=e.apply(this,arguments)*Oe,c=n.apply(this,arguments)*Oe;return r=[],s=Wv(-l[0]*Oe,-l[1]*Oe,0).invert,$_(i,u,c,1),l={type:"Polygon",coordinates:[r]},r=s=null,l}return a.center=function(l){return arguments.length?(t=typeof l=="function"?l:Tl([+l[0],+l[1]]),a):t},a.radius=function(l){return arguments.length?(e=typeof l=="function"?l:Tl(+l),a):e},a.precision=function(l){return arguments.length?(n=typeof l=="function"?l:Tl(+l),a):n},a}function I_(){var t=[],e;return{point:function(n,r,s){e.push([n,r,s])},lineStart:function(){t.push(e=[])},lineEnd:Lt,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function td(t,e){return rt(t[0]-e[0])<Pe&&rt(t[1]-e[1])<Pe}function kf(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function T_(t,e,n,r,s){var i=[],o=[],a,l;if(t.forEach(function(p){if(!((g=p.length-1)<=0)){var g,m=p[0],b=p[g],x;if(td(m,b)){if(!m[2]&&!b[2]){for(s.lineStart(),a=0;a<g;++a)s.point((m=p[a])[0],m[1]);s.lineEnd();return}b[0]+=2*Pe}i.push(x=new kf(m,p,null,!0)),o.push(x.o=new kf(m,null,x,!1)),i.push(x=new kf(b,p,null,!1)),o.push(x.o=new kf(b,null,x,!0))}}),!!i.length){for(o.sort(e),n7(i),n7(o),a=0,l=o.length;a<l;++a)o[a].e=n=!n;for(var u=i[0],c,h;;){for(var f=u,d=!0;f.v;)if((f=f.n)===u)return;c=f.z,s.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(a=0,l=c.length;a<l;++a)s.point((h=c[a])[0],h[1]);else r(f.x,f.n.x,1,s);f=f.n}else{if(d)for(c=f.p.z,a=c.length-1;a>=0;--a)s.point((h=c[a])[0],h[1]);else r(f.x,f.p.x,-1,s);f=f.p}f=f.o,c=f.z,d=!d}while(!f.v);s.lineEnd()}}}function n7(t){if(e=t.length){for(var e,n=0,r=t[0],s;++n<e;)r.n=s=t[n],s.p=r,r=s;r.n=s=t[0],s.p=r}}function Qg(t){return rt(t[0])<=nt?t[0]:ts(t[0])*((rt(t[0])+nt)%ur-nt)}function N_(t,e){var n=Qg(e),r=e[1],s=$e(r),i=[$e(n),-Ae(n),0],o=0,a=0,l=new bn;s===1?r=Ut+Pe:s===-1&&(r=-Ut-Pe);for(var u=0,c=t.length;u<c;++u)if(f=(h=t[u]).length)for(var h,f,d=h[f-1],p=Qg(d),g=d[1]/2+Yd,m=$e(g),b=Ae(g),x=0;x<f;++x,p=y,m=C,b=T,d=v){var v=h[x],y=Qg(v),w=v[1]/2+Yd,C=$e(w),T=Ae(w),N=y-p,$=N>=0?1:-1,_=$*N,S=_>nt,M=m*C;if(l.add(cr(M*$*$e(_),b*T+M*Ae(_))),o+=S?N+$*ur:N,S^p>=n^y>=n){var F=mu(qa(d),qa(v));np(F);var A=mu(i,F);np(A);var E=(S^N>=0?-1:1)*hr(A[2]);(r>E||r===E&&(F[0]||F[1]))&&(a+=S^N>=0?1:-1)}}return(o<-1e-6||o<Pe&&l<-1e-12)^a&1}function __(t,e,n,r){return function(s){var i=e(s),o=I_(),a=e(o),l=!1,u,c,h,f={point:d,lineStart:g,lineEnd:m,polygonStart:function(){f.point=b,f.lineStart=x,f.lineEnd=v,c=[],u=[]},polygonEnd:function(){f.point=d,f.lineStart=g,f.lineEnd=m,c=gv(c);var y=N_(u,r);c.length?(l||(s.polygonStart(),l=!0),T_(c,Ume,y,n,s)):y&&(l||(s.polygonStart(),l=!0),s.lineStart(),n(null,null,1,s),s.lineEnd()),l&&(s.polygonEnd(),l=!1),c=u=null},sphere:function(){s.polygonStart(),s.lineStart(),n(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function d(y,w){t(y,w)&&s.point(y,w)}function p(y,w){i.point(y,w)}function g(){f.point=p,i.lineStart()}function m(){f.point=d,i.lineEnd()}function b(y,w){h.push([y,w]),a.point(y,w)}function x(){a.lineStart(),h=[]}function v(){b(h[0][0],h[0][1]),a.lineEnd();var y=a.clean(),w=o.result(),C,T=w.length,N,$,_;if(h.pop(),u.push(h),h=null,!!T){if(y&1){if($=w[0],(N=$.length-1)>0){for(l||(s.polygonStart(),l=!0),s.lineStart(),C=0;C<N;++C)s.point((_=$[C])[0],_[1]);s.lineEnd()}return}T>1&&y&2&&w.push(w.pop().concat(w.shift())),c.push(w.filter(Wme))}}return f}}function Wme(t){return t.length>1}function Ume(t,e){return((t=t.x)[0]<0?t[1]-Ut-Pe:Ut-t[1])-((e=e.x)[0]<0?e[1]-Ut-Pe:Ut-e[1])}const Xb=__(function(){return!0},Gme,qme,[-nt,-Ut]);function Gme(t){var e=NaN,n=NaN,r=NaN,s;return{lineStart:function(){t.lineStart(),s=1},point:function(i,o){var a=i>0?nt:-nt,l=rt(i-e);rt(l-nt)<Pe?(t.point(e,n=(n+o)/2>0?Ut:-Ut),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(a,n),t.point(i,n),s=0):r!==a&&l>=nt&&(rt(e-r)<Pe&&(e-=r*Pe),rt(i-a)<Pe&&(i-=a*Pe),n=Hme(e,n,i,o),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(a,n),s=0),t.point(e=i,n=o),r=a},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-s}}}function Hme(t,e,n,r){var s,i,o=$e(t-n);return rt(o)>Pe?qu(($e(e)*(i=Ae(r))*$e(n)-$e(r)*(s=Ae(e))*$e(t))/(s*i*o)):(e+r)/2}function qme(t,e,n,r){var s;if(t==null)s=n*Ut,r.point(-nt,s),r.point(0,s),r.point(nt,s),r.point(nt,0),r.point(nt,-s),r.point(0,-s),r.point(-nt,-s),r.point(-nt,0),r.point(-nt,s);else if(rt(t[0]-e[0])>Pe){var i=t[0]<e[0]?nt:-nt;s=n*i/2,r.point(-i,s),r.point(0,s),r.point(i,s)}else r.point(e[0],e[1])}function A_(t){var e=Ae(t),n=2*Oe,r=e>0,s=rt(e)>Pe;function i(c,h,f,d){$_(d,t,n,f,c,h)}function o(c,h){return Ae(c)*Ae(h)>e}function a(c){var h,f,d,p,g;return{lineStart:function(){p=d=!1,g=1},point:function(m,b){var x=[m,b],v,y=o(m,b),w=r?y?0:u(m,b):y?u(m+(m<0?nt:-nt),b):0;if(!h&&(p=d=y)&&c.lineStart(),y!==d&&(v=l(h,x),(!v||td(h,v)||td(x,v))&&(x[2]=1)),y!==d)g=0,y?(c.lineStart(),v=l(x,h),c.point(v[0],v[1])):(v=l(h,x),c.point(v[0],v[1],2),c.lineEnd()),h=v;else if(s&&h&&r^y){var C;!(w&f)&&(C=l(x,h,!0))&&(g=0,r?(c.lineStart(),c.point(C[0][0],C[0][1]),c.point(C[1][0],C[1][1]),c.lineEnd()):(c.point(C[1][0],C[1][1]),c.lineEnd(),c.lineStart(),c.point(C[0][0],C[0][1],3)))}y&&(!h||!td(h,x))&&c.point(x[0],x[1]),h=x,d=y,f=w},lineEnd:function(){d&&c.lineEnd(),h=null},clean:function(){return g|(p&&d)<<1}}}function l(c,h,f){var d=qa(c),p=qa(h),g=[1,0,0],m=mu(d,p),b=vf(m,m),x=m[0],v=b-x*x;if(!v)return!f&&c;var y=e*b/v,w=-e*x/v,C=mu(g,m),T=wf(g,y),N=wf(m,w);Jg(T,N);var $=C,_=vf(T,$),S=vf($,$),M=_*_-S*(vf(T,T)-1);if(!(M<0)){var F=Sn(M),A=wf($,(-_-F)/S);if(Jg(A,T),A=tp(A),!f)return A;var E=c[0],D=h[0],P=c[1],z=h[1],B;D<E&&(B=E,E=D,D=B);var G=D-E,j=rt(G-nt)<Pe,Z=j||G<Pe;if(!j&&z<P&&(B=P,P=z,z=B),Z?j?P+z>0^A[1]<(rt(A[0]-E)<Pe?P:z):P<=A[1]&&A[1]<=z:G>nt^(E<=A[0]&&A[0]<=D)){var ne=wf($,(-_+F)/S);return Jg(ne,T),[A,tp(ne)]}}}function u(c,h){var f=r?t:nt-t,d=0;return c<-f?d|=1:c>f&&(d|=2),h<-f?d|=4:h>f&&(d|=8),d}return __(o,a,i,r?[0,-t]:[-nt,t-nt])}function Xme(t,e,n,r,s,i){var o=t[0],a=t[1],l=e[0],u=e[1],c=0,h=1,f=l-o,d=u-a,p;if(p=n-o,!(!f&&p>0)){if(p/=f,f<0){if(p<c)return;p<h&&(h=p)}else if(f>0){if(p>h)return;p>c&&(c=p)}if(p=s-o,!(!f&&p<0)){if(p/=f,f<0){if(p>h)return;p>c&&(c=p)}else if(f>0){if(p<c)return;p<h&&(h=p)}if(p=r-a,!(!d&&p>0)){if(p/=d,d<0){if(p<c)return;p<h&&(h=p)}else if(d>0){if(p>h)return;p>c&&(c=p)}if(p=i-a,!(!d&&p<0)){if(p/=d,d<0){if(p>h)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<h&&(h=p)}return c>0&&(t[0]=o+c*f,t[1]=a+c*d),h<1&&(e[0]=o+h*f,e[1]=a+h*d),!0}}}}}var Sf=1e9,Cf=-1e9;function _m(t,e,n,r){function s(u,c){return t<=u&&u<=n&&e<=c&&c<=r}function i(u,c,h,f){var d=0,p=0;if(u==null||(d=o(u,h))!==(p=o(c,h))||l(u,c)<0^h>0)do f.point(d===0||d===3?t:n,d>1?r:e);while((d=(d+h+4)%4)!==p);else f.point(c[0],c[1])}function o(u,c){return rt(u[0]-t)<Pe?c>0?0:3:rt(u[0]-n)<Pe?c>0?2:1:rt(u[1]-e)<Pe?c>0?1:0:c>0?3:2}function a(u,c){return l(u.x,c.x)}function l(u,c){var h=o(u,1),f=o(c,1);return h!==f?h-f:h===0?c[1]-u[1]:h===1?u[0]-c[0]:h===2?u[1]-c[1]:c[0]-u[0]}return function(u){var c=u,h=I_(),f,d,p,g,m,b,x,v,y,w,C,T={point:N,lineStart:M,lineEnd:F,polygonStart:_,polygonEnd:S};function N(E,D){s(E,D)&&c.point(E,D)}function $(){for(var E=0,D=0,P=d.length;D<P;++D)for(var z=d[D],B=1,G=z.length,j=z[0],Z,ne,le=j[0],oe=j[1];B<G;++B)Z=le,ne=oe,j=z[B],le=j[0],oe=j[1],ne<=r?oe>r&&(le-Z)*(r-ne)>(oe-ne)*(t-Z)&&++E:oe<=r&&(le-Z)*(r-ne)<(oe-ne)*(t-Z)&&--E;return E}function _(){c=h,f=[],d=[],C=!0}function S(){var E=$(),D=C&&E,P=(f=gv(f)).length;(D||P)&&(u.polygonStart(),D&&(u.lineStart(),i(null,null,1,u),u.lineEnd()),P&&T_(f,a,E,i,u),u.polygonEnd()),c=u,f=d=p=null}function M(){T.point=A,d&&d.push(p=[]),w=!0,y=!1,x=v=NaN}function F(){f&&(A(g,m),b&&y&&h.rejoin(),f.push(h.result())),T.point=N,y&&c.lineEnd()}function A(E,D){var P=s(E,D);if(d&&p.push([E,D]),w)g=E,m=D,b=P,w=!1,P&&(c.lineStart(),c.point(E,D));else if(P&&y)c.point(E,D);else{var z=[x=Math.max(Cf,Math.min(Sf,x)),v=Math.max(Cf,Math.min(Sf,v))],B=[E=Math.max(Cf,Math.min(Sf,E)),D=Math.max(Cf,Math.min(Sf,D))];Xme(z,B,t,e,n,r)?(y||(c.lineStart(),c.point(z[0],z[1])),c.point(B[0],B[1]),P||c.lineEnd(),C=!1):P&&(c.lineStart(),c.point(E,D),C=!1)}x=E,v=D,y=P}return T}}function jme(){var t=0,e=0,n=960,r=500,s,i,o;return o={stream:function(a){return s&&i===a?s:s=_m(t,e,n,r)(i=a)},extent:function(a){return arguments.length?(t=+a[0][0],e=+a[0][1],n=+a[1][0],r=+a[1][1],s=i=null,o):[[t,e],[n,r]]}}}var jb,Kb,nd,rd,gu={sphere:Lt,point:Lt,lineStart:Kme,lineEnd:Lt,polygonStart:Lt,polygonEnd:Lt};function Kme(){gu.point=Zme,gu.lineEnd=Yme}function Yme(){gu.point=gu.lineEnd=Lt}function Zme(t,e){t*=Oe,e*=Oe,Kb=t,nd=$e(e),rd=Ae(e),gu.point=Jme}function Jme(t,e){t*=Oe,e*=Oe;var n=$e(e),r=Ae(e),s=rt(t-Kb),i=Ae(s),o=$e(s),a=r*o,l=rd*n-nd*r*i,u=nd*n+rd*r*i;jb.add(cr(Sn(a*a+l*l),u)),Kb=t,nd=n,rd=r}function E_(t){return jb=new bn,vs(t,gu),+jb}var Yb=[null,null],Qme={type:"LineString",coordinates:Yb};function cp(t,e){return Yb[0]=t,Yb[1]=e,E_(Qme)}var r7={Feature:function(t,e){return hp(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,s=n.length;++r<s;)if(hp(n[r].geometry,e))return!0;return!1}},s7={Sphere:function(){return!0},Point:function(t,e){return i7(t.coordinates,e)},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,s=n.length;++r<s;)if(i7(n[r],e))return!0;return!1},LineString:function(t,e){return o7(t.coordinates,e)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,s=n.length;++r<s;)if(o7(n[r],e))return!0;return!1},Polygon:function(t,e){return a7(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,s=n.length;++r<s;)if(a7(n[r],e))return!0;return!1},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,s=n.length;++r<s;)if(hp(n[r],e))return!0;return!1}};function hp(t,e){return t&&s7.hasOwnProperty(t.type)?s7[t.type](t,e):!1}function i7(t,e){return cp(t,e)===0}function o7(t,e){for(var n,r,s,i=0,o=t.length;i<o;i++){if(r=cp(t[i],e),r===0||i>0&&(s=cp(t[i],t[i-1]),s>0&&n<=s&&r<=s&&(n+r-s)*(1-Math.pow((n-r)/s,2))<Kd*s))return!0;n=r}return!1}function a7(t,e){return!!N_(t.map(ege),R_(e))}function ege(t){return t=t.map(R_),t.pop(),t}function R_(t){return[t[0]*Oe,t[1]*Oe]}function tge(t,e){return(t&&r7.hasOwnProperty(t.type)?r7[t.type]:hp)(t,e)}function l7(t,e,n){var r=co(t,e-Pe,n).concat(e);return function(s){return r.map(function(i){return[s,i]})}}function u7(t,e,n){var r=co(t,e-Pe,n).concat(e);return function(s){return r.map(function(i){return[i,s]})}}function D_(){var t,e,n,r,s,i,o,a,l=10,u=l,c=90,h=360,f,d,p,g,m=2.5;function b(){return{type:"MultiLineString",coordinates:x()}}function x(){return co(yf(r/c)*c,n,c).map(p).concat(co(yf(a/h)*h,o,h).map(g)).concat(co(yf(e/l)*l,t,l).filter(function(v){return rt(v%c)>Pe}).map(f)).concat(co(yf(i/u)*u,s,u).filter(function(v){return rt(v%h)>Pe}).map(d))}return b.lines=function(){return x().map(function(v){return{type:"LineString",coordinates:v}})},b.outline=function(){return{type:"Polygon",coordinates:[p(r).concat(g(o).slice(1),p(n).reverse().slice(1),g(a).reverse().slice(1))]}},b.extent=function(v){return arguments.length?b.extentMajor(v).extentMinor(v):b.extentMinor()},b.extentMajor=function(v){return arguments.length?(r=+v[0][0],n=+v[1][0],a=+v[0][1],o=+v[1][1],r>n&&(v=r,r=n,n=v),a>o&&(v=a,a=o,o=v),b.precision(m)):[[r,a],[n,o]]},b.extentMinor=function(v){return arguments.length?(e=+v[0][0],t=+v[1][0],i=+v[0][1],s=+v[1][1],e>t&&(v=e,e=t,t=v),i>s&&(v=i,i=s,s=v),b.precision(m)):[[e,i],[t,s]]},b.step=function(v){return arguments.length?b.stepMajor(v).stepMinor(v):b.stepMinor()},b.stepMajor=function(v){return arguments.length?(c=+v[0],h=+v[1],b):[c,h]},b.stepMinor=function(v){return arguments.length?(l=+v[0],u=+v[1],b):[l,u]},b.precision=function(v){return arguments.length?(m=+v,f=l7(i,s,90),d=u7(e,t,m),p=l7(a,o,90),g=u7(r,n,m),b):m},b.extentMajor([[-180,-90+Pe],[180,90-Pe]]).extentMinor([[-180,-80-Pe],[180,80+Pe]])}function nge(){return D_()()}function rge(t,e){var n=t[0]*Oe,r=t[1]*Oe,s=e[0]*Oe,i=e[1]*Oe,o=Ae(r),a=$e(r),l=Ae(i),u=$e(i),c=o*Ae(n),h=o*$e(n),f=l*Ae(s),d=l*$e(s),p=2*hr(Sn(U6(i-r)+o*l*U6(s-n))),g=$e(p),m=p?function(b){var x=$e(b*=p)/g,v=$e(p-b)/g,y=v*c+x*f,w=v*h+x*d,C=v*a+x*u;return[cr(w,y)*wt,cr(C,Sn(y*y+w*w))*wt]}:function(){return[n*wt,r*wt]};return m.distance=p,m}const lh=t=>t;var e2=new bn,Zb=new bn,M_,F_,Jb,Qb,Ii={point:Lt,lineStart:Lt,lineEnd:Lt,polygonStart:function(){Ii.lineStart=sge,Ii.lineEnd=oge},polygonEnd:function(){Ii.lineStart=Ii.lineEnd=Ii.point=Lt,e2.add(rt(Zb)),Zb=new bn},result:function(){var t=e2/2;return e2=new bn,t}};function sge(){Ii.point=ige}function ige(t,e){Ii.point=O_,M_=Jb=t,F_=Qb=e}function O_(t,e){Zb.add(Qb*t-Jb*e),Jb=t,Qb=e}function oge(){O_(M_,F_)}var bu=1/0,fp=bu,uh=-bu,dp=uh,pp={point:age,lineStart:Lt,lineEnd:Lt,polygonStart:Lt,polygonEnd:Lt,result:function(){var t=[[bu,fp],[uh,dp]];return uh=dp=-(fp=bu=1/0),t}};function age(t,e){t<bu&&(bu=t),t>uh&&(uh=t),e<fp&&(fp=e),e>dp&&(dp=e)}var e4=0,t4=0,wc=0,mp=0,gp=0,Fl=0,n4=0,r4=0,kc=0,L_,z_,Vs,Ws,Zr={point:Xa,lineStart:c7,lineEnd:h7,polygonStart:function(){Zr.lineStart=cge,Zr.lineEnd=hge},polygonEnd:function(){Zr.point=Xa,Zr.lineStart=c7,Zr.lineEnd=h7},result:function(){var t=kc?[n4/kc,r4/kc]:Fl?[mp/Fl,gp/Fl]:wc?[e4/wc,t4/wc]:[NaN,NaN];return e4=t4=wc=mp=gp=Fl=n4=r4=kc=0,t}};function Xa(t,e){e4+=t,t4+=e,++wc}function c7(){Zr.point=lge}function lge(t,e){Zr.point=uge,Xa(Vs=t,Ws=e)}function uge(t,e){var n=t-Vs,r=e-Ws,s=Sn(n*n+r*r);mp+=s*(Vs+t)/2,gp+=s*(Ws+e)/2,Fl+=s,Xa(Vs=t,Ws=e)}function h7(){Zr.point=Xa}function cge(){Zr.point=fge}function hge(){P_(L_,z_)}function fge(t,e){Zr.point=P_,Xa(L_=Vs=t,z_=Ws=e)}function P_(t,e){var n=t-Vs,r=e-Ws,s=Sn(n*n+r*r);mp+=s*(Vs+t)/2,gp+=s*(Ws+e)/2,Fl+=s,s=Ws*t-Vs*e,n4+=s*(Vs+t),r4+=s*(Ws+e),kc+=s*3,Xa(Vs=t,Ws=e)}function B_(t){this._context=t}B_.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:{this._context.moveTo(t,e),this._point=1;break}case 1:{this._context.lineTo(t,e);break}default:{this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,ur);break}}},result:Lt};var s4=new bn,t2,V_,W_,Sc,Cc,ch={point:Lt,lineStart:function(){ch.point=dge},lineEnd:function(){t2&&U_(V_,W_),ch.point=Lt},polygonStart:function(){t2=!0},polygonEnd:function(){t2=null},result:function(){var t=+s4;return s4=new bn,t}};function dge(t,e){ch.point=U_,V_=Sc=t,W_=Cc=e}function U_(t,e){Sc-=t,Cc-=e,s4.add(Sn(Sc*Sc+Cc*Cc)),Sc=t,Cc=e}let f7,bp,d7,p7;class m7{constructor(e){this._append=e==null?G_:pge(e),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(e,n){switch(this._point){case 0:{this._append`M${e},${n}`,this._point=1;break}case 1:{this._append`L${e},${n}`;break}default:{if(this._append`M${e},${n}`,this._radius!==d7||this._append!==bp){const r=this._radius,s=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,d7=r,bp=this._append,p7=this._,this._=s}this._+=p7;break}}}result(){const e=this._;return this._="",e.length?e:null}}function G_(t){let e=1;this._+=t[0];for(const n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function pge(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return G_;if(e!==f7){const n=10**e;f7=e,bp=function(s){let i=1;this._+=s[0];for(const o=s.length;i<o;++i)this._+=Math.round(arguments[i]*n)/n+s[i]}}return bp}function H_(t,e){let n=3,r=4.5,s,i;function o(a){return a&&(typeof r=="function"&&i.pointRadius(+r.apply(this,arguments)),vs(a,s(i))),i.result()}return o.area=function(a){return vs(a,s(Ii)),Ii.result()},o.measure=function(a){return vs(a,s(ch)),ch.result()},o.bounds=function(a){return vs(a,s(pp)),pp.result()},o.centroid=function(a){return vs(a,s(Zr)),Zr.result()},o.projection=function(a){return arguments.length?(s=a==null?(t=null,lh):(t=a).stream,o):t},o.context=function(a){return arguments.length?(i=a==null?(e=null,new m7(n)):new B_(e=a),typeof r!="function"&&i.pointRadius(r),o):e},o.pointRadius=function(a){return arguments.length?(r=typeof a=="function"?a:(i.pointRadius(+a),+a),o):r},o.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);n=l}return e===null&&(i=new m7(n)),o},o.projection(t).digits(n).context(e)}function mge(t){return{stream:P0(t)}}function P0(t){return function(e){var n=new i4;for(var r in t)n[r]=t[r];return n.stream=e,n}}function i4(){}i4.prototype={constructor:i4,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Uv(t,e,n){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),r!=null&&t.clipExtent(null),vs(n,t.stream(pp)),e(pp.result()),r!=null&&t.clipExtent(r),t}function Am(t,e,n){return Uv(t,function(r){var s=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=Math.min(s/(r[1][0]-r[0][0]),i/(r[1][1]-r[0][1])),a=+e[0][0]+(s-o*(r[1][0]+r[0][0]))/2,l=+e[0][1]+(i-o*(r[1][1]+r[0][1]))/2;t.scale(150*o).translate([a,l])},n)}function Gv(t,e,n){return Am(t,[[0,0],e],n)}function Hv(t,e,n){return Uv(t,function(r){var s=+e,i=s/(r[1][0]-r[0][0]),o=(s-i*(r[1][0]+r[0][0]))/2,a=-i*r[0][1];t.scale(150*i).translate([o,a])},n)}function qv(t,e,n){return Uv(t,function(r){var s=+e,i=s/(r[1][1]-r[0][1]),o=-i*r[0][0],a=(s-i*(r[1][1]+r[0][1]))/2;t.scale(150*i).translate([o,a])},n)}var g7=16,gge=Ae(30*Oe);function b7(t,e){return+e?xge(t,e):bge(t)}function bge(t){return P0({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function xge(t,e){function n(r,s,i,o,a,l,u,c,h,f,d,p,g,m){var b=u-r,x=c-s,v=b*b+x*x;if(v>4*e&&g--){var y=o+f,w=a+d,C=l+p,T=Sn(y*y+w*w+C*C),N=hr(C/=T),$=rt(rt(C)-1)<Pe||rt(i-h)<Pe?(i+h)/2:cr(w,y),_=t($,N),S=_[0],M=_[1],F=S-r,A=M-s,E=x*F-b*A;(E*E/v>e||rt((b*F+x*A)/v-.5)>.3||o*f+a*d+l*p<gge)&&(n(r,s,i,o,a,l,S,M,$,y/=T,w/=T,C,g,m),m.point(S,M),n(S,M,$,y,w,C,u,c,h,f,d,p,g,m))}}return function(r){var s,i,o,a,l,u,c,h,f,d,p,g,m={point:b,lineStart:x,lineEnd:y,polygonStart:function(){r.polygonStart(),m.lineStart=w},polygonEnd:function(){r.polygonEnd(),m.lineStart=x}};function b(N,$){N=t(N,$),r.point(N[0],N[1])}function x(){h=NaN,m.point=v,r.lineStart()}function v(N,$){var _=qa([N,$]),S=t(N,$);n(h,f,c,d,p,g,h=S[0],f=S[1],c=N,d=_[0],p=_[1],g=_[2],g7,r),r.point(h,f)}function y(){m.point=b,r.lineEnd()}function w(){x(),m.point=C,m.lineEnd=T}function C(N,$){v(s=N,$),i=h,o=f,a=d,l=p,u=g,m.point=v}function T(){n(h,f,c,d,p,g,i,o,s,a,l,u,g7,r),m.lineEnd=y,y()}return m}}var yge=P0({point:function(t,e){this.stream.point(t*Oe,e*Oe)}});function vge(t){return P0({point:function(e,n){var r=t(e,n);return this.stream.point(r[0],r[1])}})}function wge(t,e,n,r,s){function i(o,a){return o*=r,a*=s,[e+t*o,n-t*a]}return i.invert=function(o,a){return[(o-e)/t*r,(n-a)/t*s]},i}function x7(t,e,n,r,s,i){if(!i)return wge(t,e,n,r,s);var o=Ae(i),a=$e(i),l=o*t,u=a*t,c=o/t,h=a/t,f=(a*n-o*e)/t,d=(a*e+o*n)/t;function p(g,m){return g*=r,m*=s,[l*g-u*m+e,n-u*g-l*m]}return p.invert=function(g,m){return[r*(c*g-h*m+f),s*(d-h*g-c*m)]},p}function di(t){return Xv(function(){return t})()}function Xv(t){var e,n=150,r=480,s=250,i=0,o=0,a=0,l=0,u=0,c,h=0,f=1,d=1,p=null,g=Xb,m=null,b,x,v,y=lh,w=.5,C,T,N,$,_;function S(E){return N(E[0]*Oe,E[1]*Oe)}function M(E){return E=N.invert(E[0],E[1]),E&&[E[0]*wt,E[1]*wt]}S.stream=function(E){return $&&_===E?$:$=yge(vge(c)(g(C(y(_=E)))))},S.preclip=function(E){return arguments.length?(g=E,p=void 0,A()):g},S.postclip=function(E){return arguments.length?(y=E,m=b=x=v=null,A()):y},S.clipAngle=function(E){return arguments.length?(g=+E?A_(p=E*Oe):(p=null,Xb),A()):p*wt},S.clipExtent=function(E){return arguments.length?(y=E==null?(m=b=x=v=null,lh):_m(m=+E[0][0],b=+E[0][1],x=+E[1][0],v=+E[1][1]),A()):m==null?null:[[m,b],[x,v]]},S.scale=function(E){return arguments.length?(n=+E,F()):n},S.translate=function(E){return arguments.length?(r=+E[0],s=+E[1],F()):[r,s]},S.center=function(E){return arguments.length?(i=E[0]%360*Oe,o=E[1]%360*Oe,F()):[i*wt,o*wt]},S.rotate=function(E){return arguments.length?(a=E[0]%360*Oe,l=E[1]%360*Oe,u=E.length>2?E[2]%360*Oe:0,F()):[a*wt,l*wt,u*wt]},S.angle=function(E){return arguments.length?(h=E%360*Oe,F()):h*wt},S.reflectX=function(E){return arguments.length?(f=E?-1:1,F()):f<0},S.reflectY=function(E){return arguments.length?(d=E?-1:1,F()):d<0},S.precision=function(E){return arguments.length?(C=b7(T,w=E*E),A()):Sn(w)},S.fitExtent=function(E,D){return Am(S,E,D)},S.fitSize=function(E,D){return Gv(S,E,D)},S.fitWidth=function(E,D){return Hv(S,E,D)},S.fitHeight=function(E,D){return qv(S,E,D)};function F(){var E=x7(n,0,0,f,d,h).apply(null,e(i,o)),D=x7(n,r-E[0],s-E[1],f,d,h);return c=Wv(a,l,u),T=Hb(e,D),N=Hb(c,T),C=b7(T,w),A()}function A(){return $=_=null,S}return function(){return e=t.apply(this,arguments),S.invert=e.invert&&M,F()}}function jv(t){var e=0,n=nt/3,r=Xv(t),s=r(e,n);return s.parallels=function(i){return arguments.length?r(e=i[0]*Oe,n=i[1]*Oe):[e*wt,n*wt]},s}function kge(t){var e=Ae(t);function n(r,s){return[r*e,$e(s)/e]}return n.invert=function(r,s){return[r/e,hr(s*e)]},n}function q_(t,e){var n=$e(t),r=(n+$e(e))/2;if(rt(r)<Pe)return kge(t);var s=1+n*(2*r-n),i=Sn(s)/r;function o(a,l){var u=Sn(s-2*r*$e(l))/r;return[u*$e(a*=r),i-u*Ae(a)]}return o.invert=function(a,l){var u=i-l,c=cr(a,rt(u))*ts(u);return u*r<0&&(c-=nt*ts(a)*ts(u)),[c/r,hr((s-(a*a+u*u)*r*r)/(2*r))]},o}function xp(){return jv(q_).scale(155.424).center([0,33.6442])}function X_(){return xp().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Sge(t){var e=t.length;return{point:function(n,r){for(var s=-1;++s<e;)t[s].point(n,r)},sphere:function(){for(var n=-1;++n<e;)t[n].sphere()},lineStart:function(){for(var n=-1;++n<e;)t[n].lineStart()},lineEnd:function(){for(var n=-1;++n<e;)t[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<e;)t[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<e;)t[n].polygonEnd()}}}function Cge(){var t,e,n=X_(),r,s=xp().rotate([154,0]).center([-2,58.5]).parallels([55,65]),i,o=xp().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,l,u={point:function(f,d){l=[f,d]}};function c(f){var d=f[0],p=f[1];return l=null,r.point(d,p),l||(i.point(d,p),l)||(a.point(d,p),l)}c.invert=function(f){var d=n.scale(),p=n.translate(),g=(f[0]-p[0])/d,m=(f[1]-p[1])/d;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?s:m>=.166&&m<.234&&g>=-.214&&g<-.115?o:n).invert(f)},c.stream=function(f){return t&&e===f?t:t=Sge([n.stream(e=f),s.stream(f),o.stream(f)])},c.precision=function(f){return arguments.length?(n.precision(f),s.precision(f),o.precision(f),h()):n.precision()},c.scale=function(f){return arguments.length?(n.scale(f),s.scale(f*.35),o.scale(f),c.translate(n.translate())):n.scale()},c.translate=function(f){if(!arguments.length)return n.translate();var d=n.scale(),p=+f[0],g=+f[1];return r=n.translate(f).clipExtent([[p-.455*d,g-.238*d],[p+.455*d,g+.238*d]]).stream(u),i=s.translate([p-.307*d,g+.201*d]).clipExtent([[p-.425*d+Pe,g+.12*d+Pe],[p-.214*d-Pe,g+.234*d-Pe]]).stream(u),a=o.translate([p-.205*d,g+.212*d]).clipExtent([[p-.214*d+Pe,g+.166*d+Pe],[p-.115*d-Pe,g+.234*d-Pe]]).stream(u),h()},c.fitExtent=function(f,d){return Am(c,f,d)},c.fitSize=function(f,d){return Gv(c,f,d)},c.fitWidth=function(f,d){return Hv(c,f,d)},c.fitHeight=function(f,d){return qv(c,f,d)};function h(){return t=e=null,c}return c.scale(1070)}function j_(t){return function(e,n){var r=Ae(e),s=Ae(n),i=t(r*s);return i===1/0?[2,0]:[i*s*$e(e),i*$e(n)]}}function B0(t){return function(e,n){var r=Sn(e*e+n*n),s=t(r),i=$e(s),o=Ae(s);return[cr(e*i,r*o),hr(r&&n*i/r)]}}var Kv=j_(function(t){return Sn(2/(1+t))});Kv.invert=B0(function(t){return 2*hr(t/2)});function $ge(){return di(Kv).scale(124.75).clipAngle(180-.001)}var Yv=j_(function(t){return(t=d_(t))&&t/$e(t)});Yv.invert=B0(function(t){return t});function Ige(){return di(Yv).scale(79.4188).clipAngle(180-.001)}function V0(t,e){return[t,Zd(Bv((Ut+e)/2))]}V0.invert=function(t,e){return[t,2*qu(f_(e))-Ut]};function Tge(){return K_(V0).scale(961/ur)}function K_(t){var e=di(t),n=e.center,r=e.scale,s=e.translate,i=e.clipExtent,o=null,a,l,u;e.scale=function(h){return arguments.length?(r(h),c()):r()},e.translate=function(h){return arguments.length?(s(h),c()):s()},e.center=function(h){return arguments.length?(n(h),c()):n()},e.clipExtent=function(h){return arguments.length?(h==null?o=a=l=u=null:(o=+h[0][0],a=+h[0][1],l=+h[1][0],u=+h[1][1]),c()):o==null?null:[[o,a],[l,u]]};function c(){var h=nt*r(),f=e(C_(e.rotate()).invert([0,0]));return i(o==null?[[f[0]-h,f[1]-h],[f[0]+h,f[1]+h]]:t===V0?[[Math.max(f[0]-h,o),a],[Math.min(f[0]+h,l),u]]:[[o,Math.max(f[1]-h,a)],[l,Math.min(f[1]+h,u)]])}return c()}function $f(t){return Bv((Ut+t)/2)}function Y_(t,e){var n=Ae(t),r=t===e?$e(t):Zd(n/Ae(e))/Zd($f(e)/$f(t)),s=n*Zg($f(t),r)/r;if(!r)return V0;function i(o,a){s>0?a<-Ut+Pe&&(a=-Ut+Pe):a>Ut-Pe&&(a=Ut-Pe);var l=s/Zg($f(a),r);return[l*$e(r*o),s-l*Ae(r*o)]}return i.invert=function(o,a){var l=s-a,u=ts(r)*Sn(o*o+l*l),c=cr(o,rt(l))*ts(l);return l*r<0&&(c-=nt*ts(o)*ts(l)),[c/r,2*qu(Zg(s/u,1/r))-Ut]},i}function Nge(){return jv(Y_).scale(109.5).parallels([30,30])}function hh(t,e){return[t,e]}hh.invert=hh;function _ge(){return di(hh).scale(152.63)}function Z_(t,e){var n=Ae(t),r=t===e?$e(t):(n-Ae(e))/(e-t),s=n/r+t;if(rt(r)<Pe)return hh;function i(o,a){var l=s-a,u=r*o;return[l*$e(u),s-l*Ae(u)]}return i.invert=function(o,a){var l=s-a,u=cr(o,rt(l))*ts(l);return l*r<0&&(u-=nt*ts(o)*ts(l)),[u/r,s-ts(r)*Sn(o*o+l*l)]},i}function Age(){return jv(Z_).scale(131.154).center([0,13.9389])}var Mc=1.340264,Fc=-.081106,Oc=893e-6,Lc=.003796,yp=Sn(3)/2,Ege=12;function Zv(t,e){var n=hr(yp*$e(e)),r=n*n,s=r*r*r;return[t*Ae(n)/(yp*(Mc+3*Fc*r+s*(7*Oc+9*Lc*r))),n*(Mc+Fc*r+s*(Oc+Lc*r))]}Zv.invert=function(t,e){for(var n=e,r=n*n,s=r*r*r,i=0,o,a,l;i<Ege&&(a=n*(Mc+Fc*r+s*(Oc+Lc*r))-e,l=Mc+3*Fc*r+s*(7*Oc+9*Lc*r),n-=o=a/l,r=n*n,s=r*r*r,!(rt(o)<Kd));++i);return[yp*t*(Mc+3*Fc*r+s*(7*Oc+9*Lc*r))/Ae(n),hr($e(n)/yp)]};function Rge(){return di(Zv).scale(177.158)}function Jv(t,e){var n=Ae(e),r=Ae(t)*n;return[n*$e(t)/r,$e(e)/r]}Jv.invert=B0(qu);function Dge(){return di(Jv).scale(144.049).clipAngle(60)}function Mge(){var t=1,e=0,n=0,r=1,s=1,i=0,o,a,l=null,u,c,h,f=1,d=1,p=P0({point:function(y,w){var C=v([y,w]);this.stream.point(C[0],C[1])}}),g=lh,m,b;function x(){return f=t*r,d=t*s,m=b=null,v}function v(y){var w=y[0]*f,C=y[1]*d;if(i){var T=C*o-w*a;w=w*o+C*a,C=T}return[w+e,C+n]}return v.invert=function(y){var w=y[0]-e,C=y[1]-n;if(i){var T=C*o+w*a;w=w*o-C*a,C=T}return[w/f,C/d]},v.stream=function(y){return m&&b===y?m:m=p(g(b=y))},v.postclip=function(y){return arguments.length?(g=y,l=u=c=h=null,x()):g},v.clipExtent=function(y){return arguments.length?(g=y==null?(l=u=c=h=null,lh):_m(l=+y[0][0],u=+y[0][1],c=+y[1][0],h=+y[1][1]),x()):l==null?null:[[l,u],[c,h]]},v.scale=function(y){return arguments.length?(t=+y,x()):t},v.translate=function(y){return arguments.length?(e=+y[0],n=+y[1],x()):[e,n]},v.angle=function(y){return arguments.length?(i=y%360*Oe,a=$e(i),o=Ae(i),x()):i*wt},v.reflectX=function(y){return arguments.length?(r=y?-1:1,x()):r<0},v.reflectY=function(y){return arguments.length?(s=y?-1:1,x()):s<0},v.fitExtent=function(y,w){return Am(v,y,w)},v.fitSize=function(y,w){return Gv(v,y,w)},v.fitWidth=function(y,w){return Hv(v,y,w)},v.fitHeight=function(y,w){return qv(v,y,w)},v}function Qv(t,e){var n=e*e,r=n*n;return[t*(.8707-.131979*n+r*(-.013791+r*(.003971*n-.001529*r))),e*(1.007226+n*(.015085+r*(-.044475+.028874*n-.005916*r)))]}Qv.invert=function(t,e){var n=e,r=25,s;do{var i=n*n,o=i*i;n-=s=(n*(1.007226+i*(.015085+o*(-.044475+.028874*i-.005916*o)))-e)/(1.007226+i*(.015085*3+o*(-.044475*7+.028874*9*i-.005916*11*o)))}while(rt(s)>Pe&&--r>0);return[t/(.8707+(i=n*n)*(-.131979+i*(-.013791+i*i*i*(.003971-.001529*i)))),n]};function Fge(){return di(Qv).scale(175.295)}function e3(t,e){return[Ae(e)*$e(t),$e(e)]}e3.invert=B0(hr);function Oge(){return di(e3).scale(249.5).clipAngle(90+Pe)}function t3(t,e){var n=Ae(e),r=1+Ae(t)*n;return[n*$e(t)/r,$e(e)/r]}t3.invert=B0(function(t){return 2*qu(t)});function Lge(){return di(t3).scale(250).clipAngle(142)}function n3(t,e){return[Zd(Bv((Ut+e)/2)),-t]}n3.invert=function(t,e){return[-e,2*qu(f_(t))-Ut]};function zge(){var t=K_(n3),e=t.center,n=t.rotate;return t.center=function(r){return arguments.length?e([-r[1],r[0]]):(r=e(),[r[1],-r[0]])},t.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}function Pge(t,e){return t.parent===e.parent?1:2}function Bge(t){return t.reduce(Vge,0)/t.length}function Vge(t,e){return t+e.x}function Wge(t){return 1+t.reduce(Uge,0)}function Uge(t,e){return Math.max(t,e.y)}function Gge(t){for(var e;e=t.children;)t=e[0];return t}function Hge(t){for(var e;e=t.children;)t=e[e.length-1];return t}function qge(){var t=Pge,e=1,n=1,r=!1;function s(i){var o,a=0;i.eachAfter(function(f){var d=f.children;d?(f.x=Bge(d),f.y=Wge(d)):(f.x=o?a+=t(f,o):0,f.y=0,o=f)});var l=Gge(i),u=Hge(i),c=l.x-t(l,u)/2,h=u.x+t(u,l)/2;return i.eachAfter(r?function(f){f.x=(f.x-i.x)*e,f.y=(i.y-f.y)*n}:function(f){f.x=(f.x-c)/(h-c)*e,f.y=(1-(i.y?f.y/i.y:1))*n})}return s.separation=function(i){return arguments.length?(t=i,s):t},s.size=function(i){return arguments.length?(r=!1,e=+i[0],n=+i[1],s):r?null:[e,n]},s.nodeSize=function(i){return arguments.length?(r=!0,e=+i[0],n=+i[1],s):r?[e,n]:null},s}function Xge(t){var e=0,n=t.children,r=n&&n.length;if(!r)e=1;else for(;--r>=0;)e+=n[r].value;t.value=e}function jge(){return this.eachAfter(Xge)}function Kge(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this}function Yge(t,e){for(var n=this,r=[n],s,i,o=-1;n=r.pop();)if(t.call(e,n,++o,this),s=n.children)for(i=s.length-1;i>=0;--i)r.push(s[i]);return this}function Zge(t,e){for(var n=this,r=[n],s=[],i,o,a,l=-1;n=r.pop();)if(s.push(n),i=n.children)for(o=0,a=i.length;o<a;++o)r.push(i[o]);for(;n=s.pop();)t.call(e,n,++l,this);return this}function Jge(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r}function Qge(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,r=e.children,s=r&&r.length;--s>=0;)n+=r[s].value;e.value=n})}function e2e(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function t2e(t){for(var e=this,n=n2e(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var s=r.length;t!==n;)r.splice(s,0,t),t=t.parent;return r}function n2e(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),s=null;for(t=n.pop(),e=r.pop();t===e;)s=t,t=n.pop(),e=r.pop();return s}function r2e(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function s2e(){return Array.from(this)}function i2e(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function o2e(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e}function*a2e(){var t=this,e,n=[t],r,s,i;do for(e=n.reverse(),n=[];t=e.pop();)if(yield t,r=t.children)for(s=0,i=r.length;s<i;++s)n.push(r[s]);while(n.length)}function r3(t,e){t instanceof Map?(t=[void 0,t],e===void 0&&(e=c2e)):e===void 0&&(e=u2e);for(var n=new ja(t),r,s=[n],i,o,a,l;r=s.pop();)if((o=e(r.data))&&(l=(o=Array.from(o)).length))for(r.children=o,a=l-1;a>=0;--a)s.push(i=o[a]=new ja(o[a])),i.parent=r,i.depth=r.depth+1;return n.eachBefore(J_)}function l2e(){return r3(this).eachBefore(h2e)}function u2e(t){return t.children}function c2e(t){return Array.isArray(t)?t[1]:null}function h2e(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function J_(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function ja(t){this.data=t,this.depth=this.height=0,this.parent=null}ja.prototype=r3.prototype={constructor:ja,count:jge,each:Kge,eachAfter:Zge,eachBefore:Yge,find:Jge,sum:Qge,sort:e2e,path:t2e,ancestors:r2e,descendants:s2e,leaves:i2e,links:o2e,copy:l2e,[Symbol.iterator]:a2e};function sd(t){return t==null?null:Q_(t)}function Q_(t){if(typeof t!="function")throw new Error;return t}function ca(){return 0}function Dl(t){return function(){return t}}const f2e=1664525,d2e=1013904223,y7=4294967296;function s3(){let t=1;return()=>(t=(f2e*t+d2e)%y7)/y7}function p2e(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function m2e(t,e){let n=t.length,r,s;for(;n;)s=e()*n--|0,r=t[n],t[n]=t[s],t[s]=r;return t}function g2e(t){return eA(t,s3())}function eA(t,e){for(var n=0,r=(t=m2e(Array.from(t),e)).length,s=[],i,o;n<r;)i=t[n],o&&tA(o,i)?++n:(o=x2e(s=b2e(s,i)),n=0);return o}function b2e(t,e){var n,r;if(n2(e,t))return[e];for(n=0;n<t.length;++n)if(If(e,t[n])&&n2($c(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(r=n+1;r<t.length;++r)if(If($c(t[n],t[r]),e)&&If($c(t[n],e),t[r])&&If($c(t[r],e),t[n])&&n2(nA(t[n],t[r],e),t))return[t[n],t[r],e];throw new Error}function If(t,e){var n=t.r-e.r,r=e.x-t.x,s=e.y-t.y;return n<0||n*n<r*r+s*s}function tA(t,e){var n=t.r-e.r+Math.max(t.r,e.r,1)*1e-9,r=e.x-t.x,s=e.y-t.y;return n>0&&n*n>r*r+s*s}function n2(t,e){for(var n=0;n<e.length;++n)if(!tA(t,e[n]))return!1;return!0}function x2e(t){switch(t.length){case 1:return y2e(t[0]);case 2:return $c(t[0],t[1]);case 3:return nA(t[0],t[1],t[2])}}function y2e(t){return{x:t.x,y:t.y,r:t.r}}function $c(t,e){var n=t.x,r=t.y,s=t.r,i=e.x,o=e.y,a=e.r,l=i-n,u=o-r,c=a-s,h=Math.sqrt(l*l+u*u);return{x:(n+i+l/h*c)/2,y:(r+o+u/h*c)/2,r:(h+s+a)/2}}function nA(t,e,n){var r=t.x,s=t.y,i=t.r,o=e.x,a=e.y,l=e.r,u=n.x,c=n.y,h=n.r,f=r-o,d=r-u,p=s-a,g=s-c,m=l-i,b=h-i,x=r*r+s*s-i*i,v=x-o*o-a*a+l*l,y=x-u*u-c*c+h*h,w=d*p-f*g,C=(p*y-g*v)/(w*2)-r,T=(g*m-p*b)/w,N=(d*v-f*y)/(w*2)-s,$=(f*b-d*m)/w,_=T*T+$*$-1,S=2*(i+C*T+N*$),M=C*C+N*N-i*i,F=-(Math.abs(_)>1e-6?(S+Math.sqrt(S*S-4*_*M))/(2*_):M/S);return{x:r+C+T*F,y:s+N+$*F,r:F}}function v7(t,e,n){var r=t.x-e.x,s,i,o=t.y-e.y,a,l,u=r*r+o*o;u?(i=e.r+n.r,i*=i,l=t.r+n.r,l*=l,i>l?(s=(u+l-i)/(2*u),a=Math.sqrt(Math.max(0,l/u-s*s)),n.x=t.x-s*r-a*o,n.y=t.y-s*o+a*r):(s=(u+i-l)/(2*u),a=Math.sqrt(Math.max(0,i/u-s*s)),n.x=e.x+s*r-a*o,n.y=e.y+s*o+a*r)):(n.x=e.x+n.r,n.y=e.y)}function w7(t,e){var n=t.r+e.r-1e-6,r=e.x-t.x,s=e.y-t.y;return n>0&&n*n>r*r+s*s}function k7(t){var e=t._,n=t.next._,r=e.r+n.r,s=(e.x*n.r+n.x*e.r)/r,i=(e.y*n.r+n.y*e.r)/r;return s*s+i*i}function Tf(t){this._=t,this.next=null,this.previous=null}function rA(t,e){if(!(i=(t=p2e(t)).length))return 0;var n,r,s,i,o,a,l,u,c,h,f;if(n=t[0],n.x=0,n.y=0,!(i>1))return n.r;if(r=t[1],n.x=-r.r,r.x=n.r,r.y=0,!(i>2))return n.r+r.r;v7(r,n,s=t[2]),n=new Tf(n),r=new Tf(r),s=new Tf(s),n.next=s.previous=r,r.next=n.previous=s,s.next=r.previous=n;e:for(l=3;l<i;++l){v7(n._,r._,s=t[l]),s=new Tf(s),u=r.next,c=n.previous,h=r._.r,f=n._.r;do if(h<=f){if(w7(u._,s._)){r=u,n.next=r,r.previous=n,--l;continue e}h+=u._.r,u=u.next}else{if(w7(c._,s._)){n=c,n.next=r,r.previous=n,--l;continue e}f+=c._.r,c=c.previous}while(u!==c.next);for(s.previous=n,s.next=r,n.next=r.previous=r=s,o=k7(n);(s=s.next)!==r;)(a=k7(s))<o&&(n=s,o=a);r=n.next}for(n=[r._],s=r;(s=s.next)!==r;)n.push(s._);for(s=eA(n,e),l=0;l<i;++l)n=t[l],n.x-=s.x,n.y-=s.y;return s.r}function v2e(t){return rA(t,s3()),t}function w2e(t){return Math.sqrt(t.value)}function k2e(){var t=null,e=1,n=1,r=ca;function s(i){const o=s3();return i.x=e/2,i.y=n/2,t?i.eachBefore(S7(t)).eachAfter(r2(r,.5,o)).eachBefore(C7(1)):i.eachBefore(S7(w2e)).eachAfter(r2(ca,1,o)).eachAfter(r2(r,i.r/Math.min(e,n),o)).eachBefore(C7(Math.min(e,n)/(2*i.r))),i}return s.radius=function(i){return arguments.length?(t=sd(i),s):t},s.size=function(i){return arguments.length?(e=+i[0],n=+i[1],s):[e,n]},s.padding=function(i){return arguments.length?(r=typeof i=="function"?i:Dl(+i),s):r},s}function S7(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function r2(t,e,n){return function(r){if(s=r.children){var s,i,o=s.length,a=t(r)*e||0,l;if(a)for(i=0;i<o;++i)s[i].r+=a;if(l=rA(s,n),a)for(i=0;i<o;++i)s[i].r-=a;r.r=l+a}}}function C7(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}function sA(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function W0(t,e,n,r,s){for(var i=t.children,o,a=-1,l=i.length,u=t.value&&(r-e)/t.value;++a<l;)o=i[a],o.y0=n,o.y1=s,o.x0=e,o.x1=e+=o.value*u}function S2e(){var t=1,e=1,n=0,r=!1;function s(o){var a=o.height+1;return o.x0=o.y0=n,o.x1=t,o.y1=e/a,o.eachBefore(i(e,a)),r&&o.eachBefore(sA),o}function i(o,a){return function(l){l.children&&W0(l,l.x0,o*(l.depth+1)/a,l.x1,o*(l.depth+2)/a);var u=l.x0,c=l.y0,h=l.x1-n,f=l.y1-n;h<u&&(u=h=(u+h)/2),f<c&&(c=f=(c+f)/2),l.x0=u,l.y0=c,l.x1=h,l.y1=f}}return s.round=function(o){return arguments.length?(r=!!o,s):r},s.size=function(o){return arguments.length?(t=+o[0],e=+o[1],s):[t,e]},s.padding=function(o){return arguments.length?(n=+o,s):n},s}var C2e={depth:-1},$7={},s2={};function $2e(t){return t.id}function I2e(t){return t.parentId}function T2e(){var t=$2e,e=I2e,n;function r(s){var i=Array.from(s),o=t,a=e,l,u,c,h,f,d,p,g,m=new Map;if(n!=null){const b=i.map((y,w)=>N2e(n(y,w,s))),x=b.map(I7),v=new Set(b).add("");for(const y of x)v.has(y)||(v.add(y),b.push(y),x.push(I7(y)),i.push(s2));o=(y,w)=>b[w],a=(y,w)=>x[w]}for(c=0,l=i.length;c<l;++c)u=i[c],d=i[c]=new ja(u),(p=o(u,c,s))!=null&&(p+="")&&(g=d.id=p,m.set(g,m.has(g)?$7:d)),(p=a(u,c,s))!=null&&(p+="")&&(d.parent=p);for(c=0;c<l;++c)if(d=i[c],p=d.parent){if(f=m.get(p),!f)throw new Error("missing: "+p);if(f===$7)throw new Error("ambiguous: "+p);f.children?f.children.push(d):f.children=[d],d.parent=f}else{if(h)throw new Error("multiple roots");h=d}if(!h)throw new Error("no root");if(n!=null){for(;h.data===s2&&h.children.length===1;)h=h.children[0],--l;for(let b=i.length-1;b>=0&&(d=i[b],d.data===s2);--b)d.data=null}if(h.parent=C2e,h.eachBefore(function(b){b.depth=b.parent.depth+1,--l}).eachBefore(J_),h.parent=null,l>0)throw new Error("cycle");return h}return r.id=function(s){return arguments.length?(t=sd(s),r):t},r.parentId=function(s){return arguments.length?(e=sd(s),r):e},r.path=function(s){return arguments.length?(n=sd(s),r):n},r}function N2e(t){t=`${t}`;let e=t.length;return o4(t,e-1)&&!o4(t,e-2)&&(t=t.slice(0,-1)),t[0]==="/"?t:`/${t}`}function I7(t){let e=t.length;if(e<2)return"";for(;--e>1&&!o4(t,e););return t.slice(0,e)}function o4(t,e){if(t[e]==="/"){let n=0;for(;e>0&&t[--e]==="\\";)++n;if((n&1)===0)return!0}return!1}function _2e(t,e){return t.parent===e.parent?1:2}function i2(t){var e=t.children;return e?e[0]:t.t}function o2(t){var e=t.children;return e?e[e.length-1]:t.t}function A2e(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function E2e(t){for(var e=0,n=0,r=t.children,s=r.length,i;--s>=0;)i=r[s],i.z+=e,i.m+=e,e+=i.s+(n+=i.c)}function R2e(t,e,n){return t.a.parent===e.parent?t.a:n}function id(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}id.prototype=Object.create(ja.prototype);function D2e(t){for(var e=new id(t,0),n,r=[e],s,i,o,a;n=r.pop();)if(i=n._.children)for(n.children=new Array(a=i.length),o=a-1;o>=0;--o)r.push(s=n.children[o]=new id(i[o],o)),s.parent=n;return(e.parent=new id(null,0)).children=[e],e}function M2e(){var t=_2e,e=1,n=1,r=null;function s(u){var c=D2e(u);if(c.eachAfter(i),c.parent.m=-c.z,c.eachBefore(o),r)u.eachBefore(l);else{var h=u,f=u,d=u;u.eachBefore(function(x){x.x<h.x&&(h=x),x.x>f.x&&(f=x),x.depth>d.depth&&(d=x)});var p=h===f?1:t(h,f)/2,g=p-h.x,m=e/(f.x+p+g),b=n/(d.depth||1);u.eachBefore(function(x){x.x=(x.x+g)*m,x.y=x.depth*b})}return u}function i(u){var c=u.children,h=u.parent.children,f=u.i?h[u.i-1]:null;if(c){E2e(u);var d=(c[0].z+c[c.length-1].z)/2;f?(u.z=f.z+t(u._,f._),u.m=u.z-d):u.z=d}else f&&(u.z=f.z+t(u._,f._));u.parent.A=a(u,f,u.parent.A||h[0])}function o(u){u._.x=u.z+u.parent.m,u.m+=u.parent.m}function a(u,c,h){if(c){for(var f=u,d=u,p=c,g=f.parent.children[0],m=f.m,b=d.m,x=p.m,v=g.m,y;p=o2(p),f=i2(f),p&&f;)g=i2(g),d=o2(d),d.a=u,y=p.z+x-f.z-m+t(p._,f._),y>0&&(A2e(R2e(p,u,h),u,y),m+=y,b+=y),x+=p.m,m+=f.m,v+=g.m,b+=d.m;p&&!o2(d)&&(d.t=p,d.m+=x-b),f&&!i2(g)&&(g.t=f,g.m+=m-v,h=u)}return h}function l(u){u.x*=e,u.y=u.depth*n}return s.separation=function(u){return arguments.length?(t=u,s):t},s.size=function(u){return arguments.length?(r=!1,e=+u[0],n=+u[1],s):r?null:[e,n]},s.nodeSize=function(u){return arguments.length?(r=!0,e=+u[0],n=+u[1],s):r?[e,n]:null},s}function Em(t,e,n,r,s){for(var i=t.children,o,a=-1,l=i.length,u=t.value&&(s-n)/t.value;++a<l;)o=i[a],o.x0=e,o.x1=r,o.y0=n,o.y1=n+=o.value*u}var iA=(1+Math.sqrt(5))/2;function oA(t,e,n,r,s,i){for(var o=[],a=e.children,l,u,c=0,h=0,f=a.length,d,p,g=e.value,m,b,x,v,y,w,C;c<f;){d=s-n,p=i-r;do m=a[h++].value;while(!m&&h<f);for(b=x=m,w=Math.max(p/d,d/p)/(g*t),C=m*m*w,y=Math.max(x/C,C/b);h<f;++h){if(m+=u=a[h].value,u<b&&(b=u),u>x&&(x=u),C=m*m*w,v=Math.max(x/C,C/b),v>y){m-=u;break}y=v}o.push(l={value:m,dice:d<p,children:a.slice(c,h)}),l.dice?W0(l,n,r,s,g?r+=p*m/g:i):Em(l,n,r,g?n+=d*m/g:s,i),g-=m,c=h}return o}const aA=function t(e){function n(r,s,i,o,a){oA(e,r,s,i,o,a)}return n.ratio=function(r){return t((r=+r)>1?r:1)},n}(iA);function F2e(){var t=aA,e=!1,n=1,r=1,s=[0],i=ca,o=ca,a=ca,l=ca,u=ca;function c(f){return f.x0=f.y0=0,f.x1=n,f.y1=r,f.eachBefore(h),s=[0],e&&f.eachBefore(sA),f}function h(f){var d=s[f.depth],p=f.x0+d,g=f.y0+d,m=f.x1-d,b=f.y1-d;m<p&&(p=m=(p+m)/2),b<g&&(g=b=(g+b)/2),f.x0=p,f.y0=g,f.x1=m,f.y1=b,f.children&&(d=s[f.depth+1]=i(f)/2,p+=u(f)-d,g+=o(f)-d,m-=a(f)-d,b-=l(f)-d,m<p&&(p=m=(p+m)/2),b<g&&(g=b=(g+b)/2),t(f,p,g,m,b))}return c.round=function(f){return arguments.length?(e=!!f,c):e},c.size=function(f){return arguments.length?(n=+f[0],r=+f[1],c):[n,r]},c.tile=function(f){return arguments.length?(t=Q_(f),c):t},c.padding=function(f){return arguments.length?c.paddingInner(f).paddingOuter(f):c.paddingInner()},c.paddingInner=function(f){return arguments.length?(i=typeof f=="function"?f:Dl(+f),c):i},c.paddingOuter=function(f){return arguments.length?c.paddingTop(f).paddingRight(f).paddingBottom(f).paddingLeft(f):c.paddingTop()},c.paddingTop=function(f){return arguments.length?(o=typeof f=="function"?f:Dl(+f),c):o},c.paddingRight=function(f){return arguments.length?(a=typeof f=="function"?f:Dl(+f),c):a},c.paddingBottom=function(f){return arguments.length?(l=typeof f=="function"?f:Dl(+f),c):l},c.paddingLeft=function(f){return arguments.length?(u=typeof f=="function"?f:Dl(+f),c):u},c}function O2e(t,e,n,r,s){var i=t.children,o,a=i.length,l,u=new Array(a+1);for(u[0]=l=o=0;o<a;++o)u[o+1]=l+=i[o].value;c(0,a,t.value,e,n,r,s);function c(h,f,d,p,g,m,b){if(h>=f-1){var x=i[h];x.x0=p,x.y0=g,x.x1=m,x.y1=b;return}for(var v=u[h],y=d/2+v,w=h+1,C=f-1;w<C;){var T=w+C>>>1;u[T]<y?w=T+1:C=T}y-u[w-1]<u[w]-y&&h+1<w&&--w;var N=u[w]-v,$=d-N;if(m-p>b-g){var _=d?(p*$+m*N)/d:m;c(h,w,N,p,g,_,b),c(w,f,$,_,g,m,b)}else{var S=d?(g*$+b*N)/d:b;c(h,w,N,p,g,m,S),c(w,f,$,p,S,m,b)}}}function L2e(t,e,n,r,s){(t.depth&1?Em:W0)(t,e,n,r,s)}const z2e=function t(e){function n(r,s,i,o,a){if((l=r._squarify)&&l.ratio===e)for(var l,u,c,h,f=-1,d,p=l.length,g=r.value;++f<p;){for(u=l[f],c=u.children,h=u.value=0,d=c.length;h<d;++h)u.value+=c[h].value;u.dice?W0(u,s,i,o,g?i+=(a-i)*u.value/g:a):Em(u,s,i,g?s+=(o-s)*u.value/g:o,a),g-=u.value}else r._squarify=l=oA(e,r,s,i,o,a),l.ratio=e}return n.ratio=function(r){return t((r=+r)>1?r:1)},n}(iA);function P2e(t){for(var e=-1,n=t.length,r,s=t[n-1],i=0;++e<n;)r=s,s=t[e],i+=r[1]*s[0]-r[0]*s[1];return i/2}function B2e(t){for(var e=-1,n=t.length,r=0,s=0,i,o=t[n-1],a,l=0;++e<n;)i=o,o=t[e],l+=a=i[0]*o[1]-o[0]*i[1],r+=(i[0]+o[0])*a,s+=(i[1]+o[1])*a;return l*=3,[r/l,s/l]}function V2e(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function W2e(t,e){return t[0]-e[0]||t[1]-e[1]}function T7(t){const e=t.length,n=[0,1];let r=2,s;for(s=2;s<e;++s){for(;r>1&&V2e(t[n[r-2]],t[n[r-1]],t[s])<=0;)--r;n[r++]=s}return n.slice(0,r)}function U2e(t){if((n=t.length)<3)return null;var e,n,r=new Array(n),s=new Array(n);for(e=0;e<n;++e)r[e]=[+t[e][0],+t[e][1],e];for(r.sort(W2e),e=0;e<n;++e)s[e]=[r[e][0],-r[e][1]];var i=T7(r),o=T7(s),a=o[0]===i[0],l=o[o.length-1]===i[i.length-1],u=[];for(e=i.length-1;e>=0;--e)u.push(t[r[i[e]][2]]);for(e=+a;e<o.length-l;++e)u.push(t[r[o[e]][2]]);return u}function G2e(t,e){for(var n=t.length,r=t[n-1],s=e[0],i=e[1],o=r[0],a=r[1],l,u,c=!1,h=0;h<n;++h)r=t[h],l=r[0],u=r[1],u>i!=a>i&&s<(o-l)*(i-u)/(a-u)+l&&(c=!c),o=l,a=u;return c}function H2e(t){for(var e=-1,n=t.length,r=t[n-1],s,i,o=r[0],a=r[1],l=0;++e<n;)s=o,i=a,r=t[e],o=r[0],a=r[1],s-=o,i-=a,l+=Math.hypot(s,i);return l}const Fn=Math.random,q2e=function t(e){function n(r,s){return r=r==null?0:+r,s=s==null?1:+s,arguments.length===1?(s=r,r=0):s-=r,function(){return e()*s+r}}return n.source=t,n}(Fn),X2e=function t(e){function n(r,s){return arguments.length<2&&(s=r,r=0),r=Math.floor(r),s=Math.floor(s)-r,function(){return Math.floor(e()*s+r)}}return n.source=t,n}(Fn),i3=function t(e){function n(r,s){var i,o;return r=r==null?0:+r,s=s==null?1:+s,function(){var a;if(i!=null)a=i,i=null;else do i=e()*2-1,a=e()*2-1,o=i*i+a*a;while(!o||o>1);return r+s*a*Math.sqrt(-2*Math.log(o)/o)}}return n.source=t,n}(Fn),j2e=function t(e){var n=i3.source(e);function r(){var s=n.apply(this,arguments);return function(){return Math.exp(s())}}return r.source=t,r}(Fn),lA=function t(e){function n(r){return(r=+r)<=0?()=>0:function(){for(var s=0,i=r;i>1;--i)s+=e();return s+i*e()}}return n.source=t,n}(Fn),K2e=function t(e){var n=lA.source(e);function r(s){if((s=+s)==0)return e;var i=n(s);return function(){return i()/s}}return r.source=t,r}(Fn),Y2e=function t(e){function n(r){return function(){return-Math.log1p(-e())/r}}return n.source=t,n}(Fn),Z2e=function t(e){function n(r){if((r=+r)<0)throw new RangeError("invalid alpha");return r=1/-r,function(){return Math.pow(1-e(),r)}}return n.source=t,n}(Fn),J2e=function t(e){function n(r){if((r=+r)<0||r>1)throw new RangeError("invalid p");return function(){return Math.floor(e()+r)}}return n.source=t,n}(Fn),uA=function t(e){function n(r){if((r=+r)<0||r>1)throw new RangeError("invalid p");return r===0?()=>1/0:r===1?()=>1:(r=Math.log1p(-r),function(){return 1+Math.floor(Math.log1p(-e())/r)})}return n.source=t,n}(Fn),o3=function t(e){var n=i3.source(e)();function r(s,i){if((s=+s)<0)throw new RangeError("invalid k");if(s===0)return()=>0;if(i=i==null?1:+i,s===1)return()=>-Math.log1p(-e())*i;var o=(s<1?s+1:s)-1/3,a=1/(3*Math.sqrt(o)),l=s<1?()=>Math.pow(e(),1/s):()=>1;return function(){do{do var u=n(),c=1+a*u;while(c<=0);c*=c*c;var h=1-e()}while(h>=1-.0331*u*u*u*u&&Math.log(h)>=.5*u*u+o*(1-c+Math.log(c)));return o*c*l()*i}}return r.source=t,r}(Fn),cA=function t(e){var n=o3.source(e);function r(s,i){var o=n(s),a=n(i);return function(){var l=o();return l===0?0:l/(l+a())}}return r.source=t,r}(Fn),hA=function t(e){var n=uA.source(e),r=cA.source(e);function s(i,o){return i=+i,(o=+o)>=1?()=>i:o<=0?()=>0:function(){for(var a=0,l=i,u=o;l*u>16&&l*(1-u)>16;){var c=Math.floor((l+1)*u),h=r(c,l-c+1)();h<=u?(a+=c,l-=c,u=(u-h)/(1-h)):(l=c-1,u/=h)}for(var f=u<.5,d=f?u:1-u,p=n(d),g=p(),m=0;g<=l;++m)g+=p();return a+(f?m:l-m)}}return s.source=t,s}(Fn),Q2e=function t(e){function n(r,s,i){var o;return(r=+r)==0?o=a=>-Math.log(a):(r=1/r,o=a=>Math.pow(a,r)),s=s==null?0:+s,i=i==null?1:+i,function(){return s+i*o(-Math.log1p(-e()))}}return n.source=t,n}(Fn),ebe=function t(e){function n(r,s){return r=r==null?0:+r,s=s==null?1:+s,function(){return r+s*Math.tan(Math.PI*e())}}return n.source=t,n}(Fn),tbe=function t(e){function n(r,s){return r=r==null?0:+r,s=s==null?1:+s,function(){var i=e();return r+s*Math.log(i/(1-i))}}return n.source=t,n}(Fn),nbe=function t(e){var n=o3.source(e),r=hA.source(e);function s(i){return function(){for(var o=0,a=i;a>16;){var l=Math.floor(.875*a),u=n(l)();if(u>a)return o+r(l-1,a/u)();o+=l,a-=u}for(var c=-Math.log1p(-e()),h=0;c<=a;++h)c-=Math.log1p(-e());return o+h}}return s.source=t,s}(Fn),rbe=1664525,sbe=1013904223,N7=1/4294967296;function ibe(t=Math.random()){let e=(0<=t&&t<1?t/N7:Math.abs(t))|0;return()=>(e=rbe*e+sbe|0,N7*(e>>>0))}function fs(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Ki(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const a4=Symbol("implicit");function a3(){var t=new Jc,e=[],n=[],r=a4;function s(i){let o=t.get(i);if(o===void 0){if(r!==a4)return r;t.set(i,o=e.push(i)-1)}return n[o%n.length]}return s.domain=function(i){if(!arguments.length)return e.slice();e=[],t=new Jc;for(const o of i)t.has(o)||t.set(o,e.push(o)-1);return s},s.range=function(i){return arguments.length?(n=Array.from(i),s):n.slice()},s.unknown=function(i){return arguments.length?(r=i,s):r},s.copy=function(){return a3(e,n).unknown(r)},fs.apply(s,arguments),s}function l3(){var t=a3().unknown(void 0),e=t.domain,n=t.range,r=0,s=1,i,o,a=!1,l=0,u=0,c=.5;delete t.unknown;function h(){var f=e().length,d=s<r,p=d?s:r,g=d?r:s;i=(g-p)/Math.max(1,f-l+u*2),a&&(i=Math.floor(i)),p+=(g-p-i*(f-l))*c,o=i*(1-l),a&&(p=Math.round(p),o=Math.round(o));var m=co(f).map(function(b){return p+i*b});return n(d?m.reverse():m)}return t.domain=function(f){return arguments.length?(e(f),h()):e()},t.range=function(f){return arguments.length?([r,s]=f,r=+r,s=+s,h()):[r,s]},t.rangeRound=function(f){return[r,s]=f,r=+r,s=+s,a=!0,h()},t.bandwidth=function(){return o},t.step=function(){return i},t.round=function(f){return arguments.length?(a=!!f,h()):a},t.padding=function(f){return arguments.length?(l=Math.min(1,u=+f),h()):l},t.paddingInner=function(f){return arguments.length?(l=Math.min(1,f),h()):l},t.paddingOuter=function(f){return arguments.length?(u=+f,h()):u},t.align=function(f){return arguments.length?(c=Math.max(0,Math.min(1,f)),h()):c},t.copy=function(){return l3(e(),[r,s]).round(a).paddingInner(l).paddingOuter(u).align(c)},fs.apply(h(),arguments)}function fA(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return fA(e())},t}function obe(){return fA(l3.apply(null,arguments).paddingInner(1))}function abe(t){return function(){return t}}function vp(t){return+t}var _7=[0,1];function rr(t){return t}function l4(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:abe(isNaN(e)?NaN:.5)}function lbe(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function ube(t,e,n){var r=t[0],s=t[1],i=e[0],o=e[1];return s<r?(r=l4(s,r),i=n(o,i)):(r=l4(r,s),i=n(i,o)),function(a){return i(r(a))}}function cbe(t,e,n){var r=Math.min(t.length,e.length)-1,s=new Array(r),i=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)s[o]=l4(t[o],t[o+1]),i[o]=n(e[o],e[o+1]);return function(a){var l=Io(t,a,1,r)-1;return i[l](s[l](a))}}function U0(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Rm(){var t=_7,e=_7,n=qo,r,s,i,o=rr,a,l,u;function c(){var f=Math.min(t.length,e.length);return o!==rr&&(o=lbe(t[0],t[f-1])),a=f>2?cbe:ube,l=u=null,h}function h(f){return f==null||isNaN(f=+f)?i:(l||(l=a(t.map(r),e,n)))(r(o(f)))}return h.invert=function(f){return o(s((u||(u=a(e,t.map(r),Kr)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,vp),c()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),c()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),n=ym,c()},h.clamp=function(f){return arguments.length?(o=f?!0:rr,c()):o!==rr},h.interpolate=function(f){return arguments.length?(n=f,c()):n},h.unknown=function(f){return arguments.length?(i=f,h):i},function(f,d){return r=f,s=d,c()}}function u3(){return Rm()(rr,rr)}function dA(t,e,n,r){var s=zd(t,e,n),i;switch(r=pu(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(i=c_(s,o))&&(r.precision=i),Pv(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(i=h_(s,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=i-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(i=u_(s))&&(r.precision=i-(r.type==="%")*2);break}}return Nm(r)}function Xo(t){var e=t.domain;return t.ticks=function(n){var r=e();return Va(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var s=e();return dA(s[0],s[s.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),s=0,i=r.length-1,o=r[s],a=r[i],l,u,c=10;for(a<o&&(u=o,o=a,a=u,u=s,s=i,i=u);c-- >0;){if(u=Wa(o,a,n),u===l)return r[s]=o,r[i]=a,e(r);if(u>0)o=Math.floor(o/u)*u,a=Math.ceil(a/u)*u;else if(u<0)o=Math.ceil(o*u)/u,a=Math.floor(a*u)/u;else break;l=u}return t},t}function xu(){var t=u3();return t.copy=function(){return U0(t,xu())},fs.apply(t,arguments),Xo(t)}function pA(t){var e;function n(r){return r==null||isNaN(r=+r)?e:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(t=Array.from(r,vp),n):t.slice()},n.unknown=function(r){return arguments.length?(e=r,n):e},n.copy=function(){return pA(t).unknown(e)},t=arguments.length?Array.from(t,vp):[0,1],Xo(n)}function mA(t,e){t=t.slice();var n=0,r=t.length-1,s=t[n],i=t[r],o;return i<s&&(o=n,n=r,r=o,o=s,s=i,i=o),t[n]=e.floor(s),t[r]=e.ceil(i),t}function A7(t){return Math.log(t)}function E7(t){return Math.exp(t)}function hbe(t){return-Math.log(-t)}function fbe(t){return-Math.exp(-t)}function dbe(t){return isFinite(t)?+("1e"+t):t<0?0:t}function pbe(t){return t===10?dbe:t===Math.E?Math.exp:e=>Math.pow(t,e)}function mbe(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function R7(t){return(e,n)=>-t(-e,n)}function c3(t){const e=t(A7,E7),n=e.domain;let r=10,s,i;function o(){return s=mbe(r),i=pbe(r),n()[0]<0?(s=R7(s),i=R7(i),t(hbe,fbe)):t(A7,E7),e}return e.base=function(a){return arguments.length?(r=+a,o()):r},e.domain=function(a){return arguments.length?(n(a),o()):n()},e.ticks=a=>{const l=n();let u=l[0],c=l[l.length-1];const h=c<u;h&&([u,c]=[c,u]);let f=s(u),d=s(c),p,g;const m=a==null?10:+a;let b=[];if(!(r%1)&&d-f<m){if(f=Math.floor(f),d=Math.ceil(d),u>0){for(;f<=d;++f)for(p=1;p<r;++p)if(g=f<0?p/i(-f):p*i(f),!(g<u)){if(g>c)break;b.push(g)}}else for(;f<=d;++f)for(p=r-1;p>=1;--p)if(g=f>0?p/i(-f):p*i(f),!(g<u)){if(g>c)break;b.push(g)}b.length*2<m&&(b=Va(u,c,m))}else b=Va(f,d,Math.min(d-f,m)).map(i);return h?b.reverse():b},e.tickFormat=(a,l)=>{if(a==null&&(a=10),l==null&&(l=r===10?"s":","),typeof l!="function"&&(!(r%1)&&(l=pu(l)).precision==null&&(l.trim=!0),l=Nm(l)),a===1/0)return l;const u=Math.max(1,r*a/e.ticks().length);return c=>{let h=c/i(Math.round(s(c)));return h*r<r-.5&&(h*=r),h<=u?l(c):""}},e.nice=()=>n(mA(n(),{floor:a=>i(Math.floor(s(a))),ceil:a=>i(Math.ceil(s(a)))})),e}function gA(){const t=c3(Rm()).domain([1,10]);return t.copy=()=>U0(t,gA()).base(t.base()),fs.apply(t,arguments),t}function D7(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function M7(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function h3(t){var e=1,n=t(D7(e),M7(e));return n.constant=function(r){return arguments.length?t(D7(e=+r),M7(e)):e},Xo(n)}function bA(){var t=h3(Rm());return t.copy=function(){return U0(t,bA()).constant(t.constant())},fs.apply(t,arguments)}function F7(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function gbe(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function bbe(t){return t<0?-t*t:t*t}function f3(t){var e=t(rr,rr),n=1;function r(){return n===1?t(rr,rr):n===.5?t(gbe,bbe):t(F7(n),F7(1/n))}return e.exponent=function(s){return arguments.length?(n=+s,r()):n},Xo(e)}function d3(){var t=f3(Rm());return t.copy=function(){return U0(t,d3()).exponent(t.exponent())},fs.apply(t,arguments),t}function xbe(){return d3.apply(null,arguments).exponent(.5)}function O7(t){return Math.sign(t)*t*t}function ybe(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function xA(){var t=u3(),e=[0,1],n=!1,r;function s(i){var o=ybe(t(i));return isNaN(o)?r:n?Math.round(o):o}return s.invert=function(i){return t.invert(O7(i))},s.domain=function(i){return arguments.length?(t.domain(i),s):t.domain()},s.range=function(i){return arguments.length?(t.range((e=Array.from(i,vp)).map(O7)),s):e.slice()},s.rangeRound=function(i){return s.range(i).round(!0)},s.round=function(i){return arguments.length?(n=!!i,s):n},s.clamp=function(i){return arguments.length?(t.clamp(i),s):t.clamp()},s.unknown=function(i){return arguments.length?(r=i,s):r},s.copy=function(){return xA(t.domain(),e).round(n).clamp(t.clamp()).unknown(r)},fs.apply(s,arguments),Xo(s)}function yA(){var t=[],e=[],n=[],r;function s(){var o=0,a=Math.max(1,e.length);for(n=new Array(a-1);++o<a;)n[o-1]=qT(t,o/a);return i}function i(o){return o==null||isNaN(o=+o)?r:e[Io(n,o)]}return i.invertExtent=function(o){var a=e.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:t[0],a<n.length?n[a]:t[t.length-1]]},i.domain=function(o){if(!arguments.length)return t.slice();t=[];for(let a of o)a!=null&&!isNaN(a=+a)&&t.push(a);return t.sort(zt),s()},i.range=function(o){return arguments.length?(e=Array.from(o),s()):e.slice()},i.unknown=function(o){return arguments.length?(r=o,i):r},i.quantiles=function(){return n.slice()},i.copy=function(){return yA().domain(t).range(e).unknown(r)},fs.apply(i,arguments)}function vA(){var t=0,e=1,n=1,r=[.5],s=[0,1],i;function o(l){return l!=null&&l<=l?s[Io(r,l,0,n)]:i}function a(){var l=-1;for(r=new Array(n);++l<n;)r[l]=((l+1)*e-(l-n)*t)/(n+1);return o}return o.domain=function(l){return arguments.length?([t,e]=l,t=+t,e=+e,a()):[t,e]},o.range=function(l){return arguments.length?(n=(s=Array.from(l)).length-1,a()):s.slice()},o.invertExtent=function(l){var u=s.indexOf(l);return u<0?[NaN,NaN]:u<1?[t,r[0]]:u>=n?[r[n-1],e]:[r[u-1],r[u]]},o.unknown=function(l){return arguments.length&&(i=l),o},o.thresholds=function(){return r.slice()},o.copy=function(){return vA().domain([t,e]).range(s).unknown(i)},fs.apply(Xo(o),arguments)}function wA(){var t=[.5],e=[0,1],n,r=1;function s(i){return i!=null&&i<=i?e[Io(t,i,0,r)]:n}return s.domain=function(i){return arguments.length?(t=Array.from(i),r=Math.min(t.length,e.length-1),s):t.slice()},s.range=function(i){return arguments.length?(e=Array.from(i),r=Math.min(t.length,e.length-1),s):e.slice()},s.invertExtent=function(i){var o=e.indexOf(i);return[t[o-1],t[o]]},s.unknown=function(i){return arguments.length?(n=i,s):n},s.copy=function(){return wA().domain(t).range(e).unknown(n)},fs.apply(s,arguments)}const a2=new Date,l2=new Date;function cn(t,e,n,r){function s(i){return t(i=arguments.length===0?new Date:new Date(+i)),i}return s.floor=i=>(t(i=new Date(+i)),i),s.ceil=i=>(t(i=new Date(i-1)),e(i,1),t(i),i),s.round=i=>{const o=s(i),a=s.ceil(i);return i-o<a-i?o:a},s.offset=(i,o)=>(e(i=new Date(+i),o==null?1:Math.floor(o)),i),s.range=(i,o,a)=>{const l=[];if(i=s.ceil(i),a=a==null?1:Math.floor(a),!(i<o)||!(a>0))return l;let u;do l.push(u=new Date(+i)),e(i,a),t(i);while(u<i&&i<o);return l},s.filter=i=>cn(o=>{if(o>=o)for(;t(o),!i(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;e(o,-1),!i(o););else for(;--a>=0;)for(;e(o,1),!i(o););}),n&&(s.count=(i,o)=>(a2.setTime(+i),l2.setTime(+o),t(a2),t(l2),Math.floor(n(a2,l2))),s.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?s.filter(r?o=>r(o)%i===0:o=>s.count(0,o)%i===0):s)),s}const yu=cn(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);yu.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?cn(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):yu);const L7=yu.range,Ni=1e3,ns=Ni*60,_i=ns*60,Bi=_i*24,p3=Bi*7,z7=Bi*30,u2=Bi*365,Ai=cn(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*Ni)},(t,e)=>(e-t)/Ni,t=>t.getUTCSeconds()),P7=Ai.range,Dm=cn(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Ni)},(t,e)=>{t.setTime(+t+e*ns)},(t,e)=>(e-t)/ns,t=>t.getMinutes()),vbe=Dm.range,Mm=cn(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*ns)},(t,e)=>(e-t)/ns,t=>t.getUTCMinutes()),wbe=Mm.range,Fm=cn(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Ni-t.getMinutes()*ns)},(t,e)=>{t.setTime(+t+e*_i)},(t,e)=>(e-t)/_i,t=>t.getHours()),kbe=Fm.range,Om=cn(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*_i)},(t,e)=>(e-t)/_i,t=>t.getUTCHours()),Sbe=Om.range,Xu=cn(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*ns)/Bi,t=>t.getDate()-1),Cbe=Xu.range,G0=cn(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Bi,t=>t.getUTCDate()-1),$be=G0.range,m3=cn(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Bi,t=>Math.floor(t/Bi)),Ibe=m3.range;function pl(t){return cn(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*ns)/p3)}const vu=pl(0),fh=pl(1),kA=pl(2),SA=pl(3),Ka=pl(4),CA=pl(5),$A=pl(6),B7=vu.range,Tbe=fh.range,Nbe=kA.range,_be=SA.range,Abe=Ka.range,Ebe=CA.range,Rbe=$A.range;function ml(t){return cn(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/p3)}const wu=ml(0),dh=ml(1),IA=ml(2),TA=ml(3),Ya=ml(4),NA=ml(5),_A=ml(6),V7=wu.range,Dbe=dh.range,Mbe=IA.range,Fbe=TA.range,Obe=Ya.range,Lbe=NA.range,zbe=_A.range,Lm=cn(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth()),Pbe=Lm.range,zm=cn(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth()),Bbe=zm.range,li=cn(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());li.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:cn(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});const Vbe=li.range,ui=cn(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());ui.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:cn(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});const Wbe=ui.range;function AA(t,e,n,r,s,i){const o=[[Ai,1,Ni],[Ai,5,5*Ni],[Ai,15,15*Ni],[Ai,30,30*Ni],[i,1,ns],[i,5,5*ns],[i,15,15*ns],[i,30,30*ns],[s,1,_i],[s,3,3*_i],[s,6,6*_i],[s,12,12*_i],[r,1,Bi],[r,2,2*Bi],[n,1,p3],[e,1,z7],[e,3,3*z7],[t,1,u2]];function a(u,c,h){const f=c<u;f&&([u,c]=[c,u]);const d=h&&typeof h.range=="function"?h:l(u,c,h),p=d?d.range(u,+c+1):[];return f?p.reverse():p}function l(u,c,h){const f=Math.abs(c-u)/h,d=lm(([,,m])=>m).right(o,f);if(d===o.length)return t.every(zd(u/u2,c/u2,h));if(d===0)return yu.every(Math.max(zd(u,c,h),1));const[p,g]=o[f/o[d-1][2]<o[d][2]/f?d-1:d];return p.every(g)}return[a,l]}const[EA,RA]=AA(ui,zm,wu,m3,Om,Mm),[DA,MA]=AA(li,Lm,vu,Xu,Fm,Dm);function c2(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function h2(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function ac(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function FA(t){var e=t.dateTime,n=t.date,r=t.time,s=t.periods,i=t.days,o=t.shortDays,a=t.months,l=t.shortMonths,u=lc(s),c=uc(s),h=lc(i),f=uc(i),d=lc(o),p=uc(o),g=lc(a),m=uc(a),b=lc(l),x=uc(l),v={a:P,A:z,b:B,B:G,c:null,d:X7,e:X7,f:h4e,g:w4e,G:S4e,H:l4e,I:u4e,j:c4e,L:OA,m:f4e,M:d4e,p:j,q:Z,Q:Y7,s:Z7,S:p4e,u:m4e,U:g4e,V:b4e,w:x4e,W:y4e,x:null,X:null,y:v4e,Y:k4e,Z:C4e,"%":K7},y={a:ne,A:le,b:oe,B:de,c:null,d:j7,e:j7,f:N4e,g:z4e,G:B4e,H:$4e,I:I4e,j:T4e,L:zA,m:_4e,M:A4e,p:fe,q:xe,Q:Y7,s:Z7,S:E4e,u:R4e,U:D4e,V:M4e,w:F4e,W:O4e,x:null,X:null,y:L4e,Y:P4e,Z:V4e,"%":K7},w={a:_,A:S,b:M,B:F,c:A,d:H7,e:H7,f:s4e,g:G7,G:U7,H:q7,I:q7,j:e4e,L:r4e,m:Qbe,M:t4e,p:$,q:Jbe,Q:o4e,s:a4e,S:n4e,u:Xbe,U:jbe,V:Kbe,w:qbe,W:Ybe,x:E,X:D,y:G7,Y:U7,Z:Zbe,"%":i4e};v.x=C(n,v),v.X=C(r,v),v.c=C(e,v),y.x=C(n,y),y.X=C(r,y),y.c=C(e,y);function C(ie,pe){return function(ge){var ae=[],Le=-1,De=0,qe=ie.length,Ue,ve,Fe;for(ge instanceof Date||(ge=new Date(+ge));++Le<qe;)ie.charCodeAt(Le)===37&&(ae.push(ie.slice(De,Le)),(ve=W7[Ue=ie.charAt(++Le)])!=null?Ue=ie.charAt(++Le):ve=Ue==="e"?" ":"0",(Fe=pe[Ue])&&(Ue=Fe(ge,ve)),ae.push(Ue),De=Le+1);return ae.push(ie.slice(De,Le)),ae.join("")}}function T(ie,pe){return function(ge){var ae=ac(1900,void 0,1),Le=N(ae,ie,ge+="",0),De,qe;if(Le!=ge.length)return null;if("Q"in ae)return new Date(ae.Q);if("s"in ae)return new Date(ae.s*1e3+("L"in ae?ae.L:0));if(pe&&!("Z"in ae)&&(ae.Z=0),"p"in ae&&(ae.H=ae.H%12+ae.p*12),ae.m===void 0&&(ae.m="q"in ae?ae.q:0),"V"in ae){if(ae.V<1||ae.V>53)return null;"w"in ae||(ae.w=1),"Z"in ae?(De=h2(ac(ae.y,0,1)),qe=De.getUTCDay(),De=qe>4||qe===0?dh.ceil(De):dh(De),De=G0.offset(De,(ae.V-1)*7),ae.y=De.getUTCFullYear(),ae.m=De.getUTCMonth(),ae.d=De.getUTCDate()+(ae.w+6)%7):(De=c2(ac(ae.y,0,1)),qe=De.getDay(),De=qe>4||qe===0?fh.ceil(De):fh(De),De=Xu.offset(De,(ae.V-1)*7),ae.y=De.getFullYear(),ae.m=De.getMonth(),ae.d=De.getDate()+(ae.w+6)%7)}else("W"in ae||"U"in ae)&&("w"in ae||(ae.w="u"in ae?ae.u%7:"W"in ae?1:0),qe="Z"in ae?h2(ac(ae.y,0,1)).getUTCDay():c2(ac(ae.y,0,1)).getDay(),ae.m=0,ae.d="W"in ae?(ae.w+6)%7+ae.W*7-(qe+5)%7:ae.w+ae.U*7-(qe+6)%7);return"Z"in ae?(ae.H+=ae.Z/100|0,ae.M+=ae.Z%100,h2(ae)):c2(ae)}}function N(ie,pe,ge,ae){for(var Le=0,De=pe.length,qe=ge.length,Ue,ve;Le<De;){if(ae>=qe)return-1;if(Ue=pe.charCodeAt(Le++),Ue===37){if(Ue=pe.charAt(Le++),ve=w[Ue in W7?pe.charAt(Le++):Ue],!ve||(ae=ve(ie,ge,ae))<0)return-1}else if(Ue!=ge.charCodeAt(ae++))return-1}return ae}function $(ie,pe,ge){var ae=u.exec(pe.slice(ge));return ae?(ie.p=c.get(ae[0].toLowerCase()),ge+ae[0].length):-1}function _(ie,pe,ge){var ae=d.exec(pe.slice(ge));return ae?(ie.w=p.get(ae[0].toLowerCase()),ge+ae[0].length):-1}function S(ie,pe,ge){var ae=h.exec(pe.slice(ge));return ae?(ie.w=f.get(ae[0].toLowerCase()),ge+ae[0].length):-1}function M(ie,pe,ge){var ae=b.exec(pe.slice(ge));return ae?(ie.m=x.get(ae[0].toLowerCase()),ge+ae[0].length):-1}function F(ie,pe,ge){var ae=g.exec(pe.slice(ge));return ae?(ie.m=m.get(ae[0].toLowerCase()),ge+ae[0].length):-1}function A(ie,pe,ge){return N(ie,e,pe,ge)}function E(ie,pe,ge){return N(ie,n,pe,ge)}function D(ie,pe,ge){return N(ie,r,pe,ge)}function P(ie){return o[ie.getDay()]}function z(ie){return i[ie.getDay()]}function B(ie){return l[ie.getMonth()]}function G(ie){return a[ie.getMonth()]}function j(ie){return s[+(ie.getHours()>=12)]}function Z(ie){return 1+~~(ie.getMonth()/3)}function ne(ie){return o[ie.getUTCDay()]}function le(ie){return i[ie.getUTCDay()]}function oe(ie){return l[ie.getUTCMonth()]}function de(ie){return a[ie.getUTCMonth()]}function fe(ie){return s[+(ie.getUTCHours()>=12)]}function xe(ie){return 1+~~(ie.getUTCMonth()/3)}return{format:function(ie){var pe=C(ie+="",v);return pe.toString=function(){return ie},pe},parse:function(ie){var pe=T(ie+="",!1);return pe.toString=function(){return ie},pe},utcFormat:function(ie){var pe=C(ie+="",y);return pe.toString=function(){return ie},pe},utcParse:function(ie){var pe=T(ie+="",!0);return pe.toString=function(){return ie},pe}}}var W7={"-":"",_:" ",0:"0"},Tn=/^\s*\d+/,Ube=/^%/,Gbe=/[\\^$*+?|[\]().{}]/g;function dt(t,e,n){var r=t<0?"-":"",s=(r?-t:t)+"",i=s.length;return r+(i<n?new Array(n-i+1).join(e)+s:s)}function Hbe(t){return t.replace(Gbe,"\\$&")}function lc(t){return new RegExp("^(?:"+t.map(Hbe).join("|")+")","i")}function uc(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function qbe(t,e,n){var r=Tn.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Xbe(t,e,n){var r=Tn.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function jbe(t,e,n){var r=Tn.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function Kbe(t,e,n){var r=Tn.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function Ybe(t,e,n){var r=Tn.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function U7(t,e,n){var r=Tn.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function G7(t,e,n){var r=Tn.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Zbe(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Jbe(t,e,n){var r=Tn.exec(e.slice(n,n+1));return r?(t.q=r[0]*3-3,n+r[0].length):-1}function Qbe(t,e,n){var r=Tn.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function H7(t,e,n){var r=Tn.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function e4e(t,e,n){var r=Tn.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function q7(t,e,n){var r=Tn.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function t4e(t,e,n){var r=Tn.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function n4e(t,e,n){var r=Tn.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function r4e(t,e,n){var r=Tn.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function s4e(t,e,n){var r=Tn.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function i4e(t,e,n){var r=Ube.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function o4e(t,e,n){var r=Tn.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function a4e(t,e,n){var r=Tn.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function X7(t,e){return dt(t.getDate(),e,2)}function l4e(t,e){return dt(t.getHours(),e,2)}function u4e(t,e){return dt(t.getHours()%12||12,e,2)}function c4e(t,e){return dt(1+Xu.count(li(t),t),e,3)}function OA(t,e){return dt(t.getMilliseconds(),e,3)}function h4e(t,e){return OA(t,e)+"000"}function f4e(t,e){return dt(t.getMonth()+1,e,2)}function d4e(t,e){return dt(t.getMinutes(),e,2)}function p4e(t,e){return dt(t.getSeconds(),e,2)}function m4e(t){var e=t.getDay();return e===0?7:e}function g4e(t,e){return dt(vu.count(li(t)-1,t),e,2)}function LA(t){var e=t.getDay();return e>=4||e===0?Ka(t):Ka.ceil(t)}function b4e(t,e){return t=LA(t),dt(Ka.count(li(t),t)+(li(t).getDay()===4),e,2)}function x4e(t){return t.getDay()}function y4e(t,e){return dt(fh.count(li(t)-1,t),e,2)}function v4e(t,e){return dt(t.getFullYear()%100,e,2)}function w4e(t,e){return t=LA(t),dt(t.getFullYear()%100,e,2)}function k4e(t,e){return dt(t.getFullYear()%1e4,e,4)}function S4e(t,e){var n=t.getDay();return t=n>=4||n===0?Ka(t):Ka.ceil(t),dt(t.getFullYear()%1e4,e,4)}function C4e(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+dt(e/60|0,"0",2)+dt(e%60,"0",2)}function j7(t,e){return dt(t.getUTCDate(),e,2)}function $4e(t,e){return dt(t.getUTCHours(),e,2)}function I4e(t,e){return dt(t.getUTCHours()%12||12,e,2)}function T4e(t,e){return dt(1+G0.count(ui(t),t),e,3)}function zA(t,e){return dt(t.getUTCMilliseconds(),e,3)}function N4e(t,e){return zA(t,e)+"000"}function _4e(t,e){return dt(t.getUTCMonth()+1,e,2)}function A4e(t,e){return dt(t.getUTCMinutes(),e,2)}function E4e(t,e){return dt(t.getUTCSeconds(),e,2)}function R4e(t){var e=t.getUTCDay();return e===0?7:e}function D4e(t,e){return dt(wu.count(ui(t)-1,t),e,2)}function PA(t){var e=t.getUTCDay();return e>=4||e===0?Ya(t):Ya.ceil(t)}function M4e(t,e){return t=PA(t),dt(Ya.count(ui(t),t)+(ui(t).getUTCDay()===4),e,2)}function F4e(t){return t.getUTCDay()}function O4e(t,e){return dt(dh.count(ui(t)-1,t),e,2)}function L4e(t,e){return dt(t.getUTCFullYear()%100,e,2)}function z4e(t,e){return t=PA(t),dt(t.getUTCFullYear()%100,e,2)}function P4e(t,e){return dt(t.getUTCFullYear()%1e4,e,4)}function B4e(t,e){var n=t.getUTCDay();return t=n>=4||n===0?Ya(t):Ya.ceil(t),dt(t.getUTCFullYear()%1e4,e,4)}function V4e(){return"+0000"}function K7(){return"%"}function Y7(t){return+t}function Z7(t){return Math.floor(+t/1e3)}var Nl,g3,BA,Pm,b3;VA({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function VA(t){return Nl=FA(t),g3=Nl.format,BA=Nl.parse,Pm=Nl.utcFormat,b3=Nl.utcParse,Nl}var WA="%Y-%m-%dT%H:%M:%S.%LZ";function W4e(t){return t.toISOString()}var U4e=Date.prototype.toISOString?W4e:Pm(WA);function G4e(t){var e=new Date(t);return isNaN(e)?null:e}var H4e=+new Date("2000-01-01T00:00:00.000Z")?G4e:b3(WA);function q4e(t){return new Date(t)}function X4e(t){return t instanceof Date?+t:+new Date(+t)}function x3(t,e,n,r,s,i,o,a,l,u){var c=u3(),h=c.invert,f=c.domain,d=u(".%L"),p=u(":%S"),g=u("%I:%M"),m=u("%I %p"),b=u("%a %d"),x=u("%b %d"),v=u("%B"),y=u("%Y");function w(C){return(l(C)<C?d:a(C)<C?p:o(C)<C?g:i(C)<C?m:r(C)<C?s(C)<C?b:x:n(C)<C?v:y)(C)}return c.invert=function(C){return new Date(h(C))},c.domain=function(C){return arguments.length?f(Array.from(C,X4e)):f().map(q4e)},c.ticks=function(C){var T=f();return t(T[0],T[T.length-1],C??10)},c.tickFormat=function(C,T){return T==null?w:u(T)},c.nice=function(C){var T=f();return(!C||typeof C.range!="function")&&(C=e(T[0],T[T.length-1],C??10)),C?f(mA(T,C)):c},c.copy=function(){return U0(c,x3(t,e,n,r,s,i,o,a,l,u))},c}function j4e(){return fs.apply(x3(DA,MA,li,Lm,vu,Xu,Fm,Dm,Ai,g3).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function K4e(){return fs.apply(x3(EA,RA,ui,zm,wu,G0,Om,Mm,Ai,Pm).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Bm(){var t=0,e=1,n,r,s,i,o=rr,a=!1,l;function u(h){return h==null||isNaN(h=+h)?l:o(s===0?.5:(h=(i(h)-n)*s,a?Math.max(0,Math.min(1,h)):h))}u.domain=function(h){return arguments.length?([t,e]=h,n=i(t=+t),r=i(e=+e),s=n===r?0:1/(r-n),u):[t,e]},u.clamp=function(h){return arguments.length?(a=!!h,u):a},u.interpolator=function(h){return arguments.length?(o=h,u):o};function c(h){return function(f){var d,p;return arguments.length?([d,p]=f,o=h(d,p),u):[o(0),o(1)]}}return u.range=c(qo),u.rangeRound=c(ym),u.unknown=function(h){return arguments.length?(l=h,u):l},function(h){return i=h,n=h(t),r=h(e),s=n===r?0:1/(r-n),u}}function jo(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function UA(){var t=Xo(Bm()(rr));return t.copy=function(){return jo(t,UA())},Ki.apply(t,arguments)}function GA(){var t=c3(Bm()).domain([1,10]);return t.copy=function(){return jo(t,GA()).base(t.base())},Ki.apply(t,arguments)}function HA(){var t=h3(Bm());return t.copy=function(){return jo(t,HA()).constant(t.constant())},Ki.apply(t,arguments)}function y3(){var t=f3(Bm());return t.copy=function(){return jo(t,y3()).exponent(t.exponent())},Ki.apply(t,arguments)}function Y4e(){return y3.apply(null,arguments).exponent(.5)}function qA(){var t=[],e=rr;function n(r){if(r!=null&&!isNaN(r=+r))return e((Io(t,r,1)-1)/(t.length-1))}return n.domain=function(r){if(!arguments.length)return t.slice();t=[];for(let s of r)s!=null&&!isNaN(s=+s)&&t.push(s);return t.sort(zt),n},n.interpolator=function(r){return arguments.length?(e=r,n):e},n.range=function(){return t.map((r,s)=>e(s/(t.length-1)))},n.quantiles=function(r){return Array.from({length:r+1},(s,i)=>Qc(t,i/r))},n.copy=function(){return qA(e).domain(t)},Ki.apply(n,arguments)}function Vm(){var t=0,e=.5,n=1,r=1,s,i,o,a,l,u=rr,c,h=!1,f;function d(g){return isNaN(g=+g)?f:(g=.5+((g=+c(g))-i)*(r*g<r*i?a:l),u(h?Math.max(0,Math.min(1,g)):g))}d.domain=function(g){return arguments.length?([t,e,n]=g,s=c(t=+t),i=c(e=+e),o=c(n=+n),a=s===i?0:.5/(i-s),l=i===o?0:.5/(o-i),r=i<s?-1:1,d):[t,e,n]},d.clamp=function(g){return arguments.length?(h=!!g,d):h},d.interpolator=function(g){return arguments.length?(u=g,d):u};function p(g){return function(m){var b,x,v;return arguments.length?([b,x,v]=m,u=zN(g,[b,x,v]),d):[u(0),u(.5),u(1)]}}return d.range=p(qo),d.rangeRound=p(ym),d.unknown=function(g){return arguments.length?(f=g,d):f},function(g){return c=g,s=g(t),i=g(e),o=g(n),a=s===i?0:.5/(i-s),l=i===o?0:.5/(o-i),r=i<s?-1:1,d}}function XA(){var t=Xo(Vm()(rr));return t.copy=function(){return jo(t,XA())},Ki.apply(t,arguments)}function jA(){var t=c3(Vm()).domain([.1,1,10]);return t.copy=function(){return jo(t,jA()).base(t.base())},Ki.apply(t,arguments)}function KA(){var t=h3(Vm());return t.copy=function(){return jo(t,KA()).constant(t.constant())},Ki.apply(t,arguments)}function v3(){var t=f3(Vm());return t.copy=function(){return jo(t,v3()).exponent(t.exponent())},Ki.apply(t,arguments)}function Z4e(){return v3.apply(null,arguments).exponent(.5)}function Ye(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}const J4e=Ye("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Q4e=Ye("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),exe=Ye("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),txe=Ye("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0"),nxe=Ye("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),rxe=Ye("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),sxe=Ye("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),ixe=Ye("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),oxe=Ye("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),axe=Ye("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),lxe=Ye("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),$t=t=>$N(t[t.length-1]);var YA=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(Ye);const uxe=$t(YA);var ZA=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(Ye);const cxe=$t(ZA);var JA=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(Ye);const hxe=$t(JA);var QA=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(Ye);const fxe=$t(QA);var eE=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Ye);const dxe=$t(eE);var tE=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(Ye);const pxe=$t(tE);var nE=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(Ye);const mxe=$t(nE);var rE=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Ye);const gxe=$t(rE);var sE=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(Ye);const bxe=$t(sE);var iE=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Ye);const xxe=$t(iE);var oE=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Ye);const yxe=$t(oE);var aE=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Ye);const vxe=$t(aE);var lE=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Ye);const wxe=$t(lE);var uE=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Ye);const kxe=$t(uE);var cE=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Ye);const Sxe=$t(cE);var hE=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Ye);const Cxe=$t(hE);var fE=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Ye);const $xe=$t(fE);var dE=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Ye);const Ixe=$t(dE);var pE=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Ye);const Txe=$t(pE);var mE=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Ye);const Nxe=$t(mE);var gE=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Ye);const _xe=$t(gE);var bE=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Ye);const Axe=$t(bE);var xE=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Ye);const Exe=$t(xE);var yE=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Ye);const Rxe=$t(yE);var vE=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Ye);const Dxe=$t(vE);var wE=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Ye);const Mxe=$t(wE);var kE=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Ye);const Fxe=$t(kE);function Oxe(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-t*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-t*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-t*2475.67)))))))+")"}const Lxe=vm(As(300,.5,0),As(-240,.5,1));var zxe=vm(As(-100,.75,.35),As(80,1.5,.8)),Pxe=vm(As(260,.75,.35),As(80,1.5,.8)),Nf=As();function Bxe(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return Nf.h=360*t-100,Nf.s=1.5-1.5*e,Nf.l=.8-.9*e,Nf+""}var _f=cu(),Vxe=Math.PI/3,Wxe=Math.PI*2/3;function Uxe(t){var e;return t=(.5-t)*Math.PI,_f.r=255*(e=Math.sin(t))*e,_f.g=255*(e=Math.sin(t+Vxe))*e,_f.b=255*(e=Math.sin(t+Wxe))*e,_f+""}function Gxe(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-t*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+t*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-t*6838.66)))))))+")"}function Wm(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}const Hxe=Wm(Ye("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var qxe=Wm(Ye("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),Xxe=Wm(Ye("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),jxe=Wm(Ye("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function je(t){return function(){return t}}const J7=Math.abs,Pn=Math.atan2,ki=Math.cos,Kxe=Math.max,Hl=Math.min,br=Math.sin,Tt=Math.sqrt,Bn=1e-12,No=Math.PI,wp=No/2,xo=2*No;function Yxe(t){return t>1?0:t<-1?No:Math.acos(t)}function Q7(t){return t>=1?wp:t<=-1?-wp:Math.asin(t)}function H0(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new O0(e)}function Zxe(t){return t.innerRadius}function Jxe(t){return t.outerRadius}function Qxe(t){return t.startAngle}function eye(t){return t.endAngle}function tye(t){return t&&t.padAngle}function nye(t,e,n,r,s,i,o,a){var l=n-t,u=r-e,c=o-s,h=a-i,f=h*l-c*u;if(!(f*f<Bn))return f=(c*(e-i)-h*(t-s))/f,[t+f*l,e+f*u]}function Af(t,e,n,r,s,i,o){var a=t-n,l=e-r,u=(o?i:-i)/Tt(a*a+l*l),c=u*l,h=-u*a,f=t+c,d=e+h,p=n+c,g=r+h,m=(f+p)/2,b=(d+g)/2,x=p-f,v=g-d,y=x*x+v*v,w=s-i,C=f*g-p*d,T=(v<0?-1:1)*Tt(Kxe(0,w*w*y-C*C)),N=(C*v-x*T)/y,$=(-C*x-v*T)/y,_=(C*v+x*T)/y,S=(-C*x+v*T)/y,M=N-m,F=$-b,A=_-m,E=S-b;return M*M+F*F>A*A+E*E&&(N=_,$=S),{cx:N,cy:$,x01:-c,y01:-h,x11:N*(s/w-1),y11:$*(s/w-1)}}function rye(){var t=Zxe,e=Jxe,n=je(0),r=null,s=Qxe,i=eye,o=tye,a=null,l=H0(u);function u(){var c,h,f=+t.apply(this,arguments),d=+e.apply(this,arguments),p=s.apply(this,arguments)-wp,g=i.apply(this,arguments)-wp,m=J7(g-p),b=g>p;if(a||(a=c=l()),d<f&&(h=d,d=f,f=h),!(d>Bn))a.moveTo(0,0);else if(m>xo-Bn)a.moveTo(d*ki(p),d*br(p)),a.arc(0,0,d,p,g,!b),f>Bn&&(a.moveTo(f*ki(g),f*br(g)),a.arc(0,0,f,g,p,b));else{var x=p,v=g,y=p,w=g,C=m,T=m,N=o.apply(this,arguments)/2,$=N>Bn&&(r?+r.apply(this,arguments):Tt(f*f+d*d)),_=Hl(J7(d-f)/2,+n.apply(this,arguments)),S=_,M=_,F,A;if($>Bn){var E=Q7($/f*br(N)),D=Q7($/d*br(N));(C-=E*2)>Bn?(E*=b?1:-1,y+=E,w-=E):(C=0,y=w=(p+g)/2),(T-=D*2)>Bn?(D*=b?1:-1,x+=D,v-=D):(T=0,x=v=(p+g)/2)}var P=d*ki(x),z=d*br(x),B=f*ki(w),G=f*br(w);if(_>Bn){var j=d*ki(v),Z=d*br(v),ne=f*ki(y),le=f*br(y),oe;if(m<No)if(oe=nye(P,z,ne,le,j,Z,B,G)){var de=P-oe[0],fe=z-oe[1],xe=j-oe[0],ie=Z-oe[1],pe=1/br(Yxe((de*xe+fe*ie)/(Tt(de*de+fe*fe)*Tt(xe*xe+ie*ie)))/2),ge=Tt(oe[0]*oe[0]+oe[1]*oe[1]);S=Hl(_,(f-ge)/(pe-1)),M=Hl(_,(d-ge)/(pe+1))}else S=M=0}T>Bn?M>Bn?(F=Af(ne,le,P,z,d,M,b),A=Af(j,Z,B,G,d,M,b),a.moveTo(F.cx+F.x01,F.cy+F.y01),M<_?a.arc(F.cx,F.cy,M,Pn(F.y01,F.x01),Pn(A.y01,A.x01),!b):(a.arc(F.cx,F.cy,M,Pn(F.y01,F.x01),Pn(F.y11,F.x11),!b),a.arc(0,0,d,Pn(F.cy+F.y11,F.cx+F.x11),Pn(A.cy+A.y11,A.cx+A.x11),!b),a.arc(A.cx,A.cy,M,Pn(A.y11,A.x11),Pn(A.y01,A.x01),!b))):(a.moveTo(P,z),a.arc(0,0,d,x,v,!b)):a.moveTo(P,z),!(f>Bn)||!(C>Bn)?a.lineTo(B,G):S>Bn?(F=Af(B,G,j,Z,f,-S,b),A=Af(P,z,ne,le,f,-S,b),a.lineTo(F.cx+F.x01,F.cy+F.y01),S<_?a.arc(F.cx,F.cy,S,Pn(F.y01,F.x01),Pn(A.y01,A.x01),!b):(a.arc(F.cx,F.cy,S,Pn(F.y01,F.x01),Pn(F.y11,F.x11),!b),a.arc(0,0,f,Pn(F.cy+F.y11,F.cx+F.x11),Pn(A.cy+A.y11,A.cx+A.x11),b),a.arc(A.cx,A.cy,S,Pn(A.y11,A.x11),Pn(A.y01,A.x01),!b))):a.arc(0,0,f,w,y,b)}if(a.closePath(),c)return a=null,c+""||null}return u.centroid=function(){var c=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,h=(+s.apply(this,arguments)+ +i.apply(this,arguments))/2-No/2;return[ki(h)*c,br(h)*c]},u.innerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:je(+c),u):t},u.outerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:je(+c),u):e},u.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:je(+c),u):n},u.padRadius=function(c){return arguments.length?(r=c==null?null:typeof c=="function"?c:je(+c),u):r},u.startAngle=function(c){return arguments.length?(s=typeof c=="function"?c:je(+c),u):s},u.endAngle=function(c){return arguments.length?(i=typeof c=="function"?c:je(+c),u):i},u.padAngle=function(c){return arguments.length?(o=typeof c=="function"?c:je(+c),u):o},u.context=function(c){return arguments.length?(a=c??null,u):a},u}var sye=Array.prototype.slice;function Um(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function SE(t){this._context=t}SE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function Gm(t){return new SE(t)}function w3(t){return t[0]}function k3(t){return t[1]}function S3(t,e){var n=je(!0),r=null,s=Gm,i=null,o=H0(a);t=typeof t=="function"?t:t===void 0?w3:je(t),e=typeof e=="function"?e:e===void 0?k3:je(e);function a(l){var u,c=(l=Um(l)).length,h,f=!1,d;for(r==null&&(i=s(d=o())),u=0;u<=c;++u)!(u<c&&n(h=l[u],u,l))===f&&((f=!f)?i.lineStart():i.lineEnd()),f&&i.point(+t(h,u,l),+e(h,u,l));if(d)return i=null,d+""||null}return a.x=function(l){return arguments.length?(t=typeof l=="function"?l:je(+l),a):t},a.y=function(l){return arguments.length?(e=typeof l=="function"?l:je(+l),a):e},a.defined=function(l){return arguments.length?(n=typeof l=="function"?l:je(!!l),a):n},a.curve=function(l){return arguments.length?(s=l,r!=null&&(i=s(r)),a):s},a.context=function(l){return arguments.length?(l==null?r=i=null:i=s(r=l),a):r},a}function CE(t,e,n){var r=null,s=je(!0),i=null,o=Gm,a=null,l=H0(u);t=typeof t=="function"?t:t===void 0?w3:je(+t),e=typeof e=="function"?e:je(e===void 0?0:+e),n=typeof n=="function"?n:n===void 0?k3:je(+n);function u(h){var f,d,p,g=(h=Um(h)).length,m,b=!1,x,v=new Array(g),y=new Array(g);for(i==null&&(a=o(x=l())),f=0;f<=g;++f){if(!(f<g&&s(m=h[f],f,h))===b)if(b=!b)d=f,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),p=f-1;p>=d;--p)a.point(v[p],y[p]);a.lineEnd(),a.areaEnd()}b&&(v[f]=+t(m,f,h),y[f]=+e(m,f,h),a.point(r?+r(m,f,h):v[f],n?+n(m,f,h):y[f]))}if(x)return a=null,x+""||null}function c(){return S3().defined(s).curve(o).context(i)}return u.x=function(h){return arguments.length?(t=typeof h=="function"?h:je(+h),r=null,u):t},u.x0=function(h){return arguments.length?(t=typeof h=="function"?h:je(+h),u):t},u.x1=function(h){return arguments.length?(r=h==null?null:typeof h=="function"?h:je(+h),u):r},u.y=function(h){return arguments.length?(e=typeof h=="function"?h:je(+h),n=null,u):e},u.y0=function(h){return arguments.length?(e=typeof h=="function"?h:je(+h),u):e},u.y1=function(h){return arguments.length?(n=h==null?null:typeof h=="function"?h:je(+h),u):n},u.lineX0=u.lineY0=function(){return c().x(t).y(e)},u.lineY1=function(){return c().x(t).y(n)},u.lineX1=function(){return c().x(r).y(e)},u.defined=function(h){return arguments.length?(s=typeof h=="function"?h:je(!!h),u):s},u.curve=function(h){return arguments.length?(o=h,i!=null&&(a=o(i)),u):o},u.context=function(h){return arguments.length?(h==null?i=a=null:a=o(i=h),u):i},u}function iye(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function oye(t){return t}function aye(){var t=oye,e=iye,n=null,r=je(0),s=je(xo),i=je(0);function o(a){var l,u=(a=Um(a)).length,c,h,f=0,d=new Array(u),p=new Array(u),g=+r.apply(this,arguments),m=Math.min(xo,Math.max(-xo,s.apply(this,arguments)-g)),b,x=Math.min(Math.abs(m)/u,i.apply(this,arguments)),v=x*(m<0?-1:1),y;for(l=0;l<u;++l)(y=p[d[l]=l]=+t(a[l],l,a))>0&&(f+=y);for(e!=null?d.sort(function(w,C){return e(p[w],p[C])}):n!=null&&d.sort(function(w,C){return n(a[w],a[C])}),l=0,h=f?(m-u*v)/f:0;l<u;++l,g=b)c=d[l],y=p[c],b=g+(y>0?y*h:0)+v,p[c]={data:a[c],index:l,value:y,startAngle:g,endAngle:b,padAngle:x};return p}return o.value=function(a){return arguments.length?(t=typeof a=="function"?a:je(+a),o):t},o.sortValues=function(a){return arguments.length?(e=a,n=null,o):e},o.sort=function(a){return arguments.length?(n=a,e=null,o):n},o.startAngle=function(a){return arguments.length?(r=typeof a=="function"?a:je(+a),o):r},o.endAngle=function(a){return arguments.length?(s=typeof a=="function"?a:je(+a),o):s},o.padAngle=function(a){return arguments.length?(i=typeof a=="function"?a:je(+a),o):i},o}var $E=C3(Gm);function IE(t){this._curve=t}IE.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};function C3(t){function e(n){return new IE(t(n))}return e._curve=t,e}function Ic(t){var e=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(n){return arguments.length?e(C3(n)):e()._curve},t}function e8(){return Ic(S3().curve($E))}function t8(){var t=CE().curve($E),e=t.curve,n=t.lineX0,r=t.lineX1,s=t.lineY0,i=t.lineY1;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.lineStartAngle=function(){return Ic(n())},delete t.lineX0,t.lineEndAngle=function(){return Ic(r())},delete t.lineX1,t.lineInnerRadius=function(){return Ic(s())},delete t.lineY0,t.lineOuterRadius=function(){return Ic(i())},delete t.lineY1,t.curve=function(o){return arguments.length?e(C3(o)):e()._curve},t}function Tc(t,e){return[(e=+e)*Math.cos(t-=Math.PI/2),e*Math.sin(t)]}class TE{constructor(e,n){this._context=e,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,n){switch(e=+e,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,n,e,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,e,this._y0,e,n);break}}this._x0=e,this._y0=n}}class lye{constructor(e){this._context=e}lineStart(){this._point=0}lineEnd(){}point(e,n){if(e=+e,n=+n,this._point===0)this._point=1;else{const r=Tc(this._x0,this._y0),s=Tc(this._x0,this._y0=(this._y0+n)/2),i=Tc(e,this._y0),o=Tc(e,n);this._context.moveTo(...r),this._context.bezierCurveTo(...s,...i,...o)}this._x0=e,this._y0=n}}function NE(t){return new TE(t,!0)}function _E(t){return new TE(t,!1)}function uye(t){return new lye(t)}function cye(t){return t.source}function hye(t){return t.target}function Hm(t){let e=cye,n=hye,r=w3,s=k3,i=null,o=null,a=H0(l);function l(){let u;const c=sye.call(arguments),h=e.apply(this,c),f=n.apply(this,c);if(i==null&&(o=t(u=a())),o.lineStart(),c[0]=h,o.point(+r.apply(this,c),+s.apply(this,c)),c[0]=f,o.point(+r.apply(this,c),+s.apply(this,c)),o.lineEnd(),u)return o=null,u+""||null}return l.source=function(u){return arguments.length?(e=u,l):e},l.target=function(u){return arguments.length?(n=u,l):n},l.x=function(u){return arguments.length?(r=typeof u=="function"?u:je(+u),l):r},l.y=function(u){return arguments.length?(s=typeof u=="function"?u:je(+u),l):s},l.context=function(u){return arguments.length?(u==null?i=o=null:o=t(i=u),l):i},l}function fye(){return Hm(NE)}function dye(){return Hm(_E)}function pye(){const t=Hm(uye);return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t}const mye=Tt(3),AE={draw(t,e){const n=Tt(e+Hl(e/28,.75))*.59436,r=n/2,s=r*mye;t.moveTo(0,n),t.lineTo(0,-n),t.moveTo(-s,-r),t.lineTo(s,r),t.moveTo(-s,r),t.lineTo(s,-r)}},qm={draw(t,e){const n=Tt(e/No);t.moveTo(n,0),t.arc(0,0,n,0,xo)}},EE={draw(t,e){const n=Tt(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},RE=Tt(1/3),gye=RE*2,DE={draw(t,e){const n=Tt(e/gye),r=n*RE;t.moveTo(0,-n),t.lineTo(r,0),t.lineTo(0,n),t.lineTo(-r,0),t.closePath()}},ME={draw(t,e){const n=Tt(e)*.62625;t.moveTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.lineTo(-n,0),t.closePath()}},FE={draw(t,e){const n=Tt(e-Hl(e/7,2))*.87559;t.moveTo(-n,0),t.lineTo(n,0),t.moveTo(0,n),t.lineTo(0,-n)}},OE={draw(t,e){const n=Tt(e),r=-n/2;t.rect(r,r,n,n)}},LE={draw(t,e){const n=Tt(e)*.4431;t.moveTo(n,n),t.lineTo(n,-n),t.lineTo(-n,-n),t.lineTo(-n,n),t.closePath()}},bye=.8908130915292852,zE=br(No/10)/br(7*No/10),xye=br(xo/10)*zE,yye=-ki(xo/10)*zE,PE={draw(t,e){const n=Tt(e*bye),r=xye*n,s=yye*n;t.moveTo(0,-n),t.lineTo(r,s);for(let i=1;i<5;++i){const o=xo*i/5,a=ki(o),l=br(o);t.lineTo(l*n,-a*n),t.lineTo(a*r-l*s,l*r+a*s)}t.closePath()}},f2=Tt(3),BE={draw(t,e){const n=-Tt(e/(f2*3));t.moveTo(0,n*2),t.lineTo(-f2*n,-n),t.lineTo(f2*n,-n),t.closePath()}},vye=Tt(3),VE={draw(t,e){const n=Tt(e)*.6824,r=n/2,s=n*vye/2;t.moveTo(0,-n),t.lineTo(s,r),t.lineTo(-s,r),t.closePath()}},Hr=-.5,qr=Tt(3)/2,u4=1/Tt(12),wye=(u4/2+1)*3,WE={draw(t,e){const n=Tt(e/wye),r=n/2,s=n*u4,i=r,o=n*u4+n,a=-i,l=o;t.moveTo(r,s),t.lineTo(i,o),t.lineTo(a,l),t.lineTo(Hr*r-qr*s,qr*r+Hr*s),t.lineTo(Hr*i-qr*o,qr*i+Hr*o),t.lineTo(Hr*a-qr*l,qr*a+Hr*l),t.lineTo(Hr*r+qr*s,Hr*s-qr*r),t.lineTo(Hr*i+qr*o,Hr*o-qr*i),t.lineTo(Hr*a+qr*l,Hr*l-qr*a),t.closePath()}},c4={draw(t,e){const n=Tt(e-Hl(e/6,1.7))*.6189;t.moveTo(-n,-n),t.lineTo(n,n),t.moveTo(-n,n),t.lineTo(n,-n)}},n8=[qm,EE,DE,OE,PE,BE,WE],kye=[qm,FE,c4,VE,AE,LE,ME];function Sye(t,e){let n=null,r=H0(s);t=typeof t=="function"?t:je(t||qm),e=typeof e=="function"?e:je(e===void 0?64:+e);function s(){let i;if(n||(n=i=r()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),i)return n=null,i+""||null}return s.type=function(i){return arguments.length?(t=typeof i=="function"?i:je(i),s):t},s.size=function(i){return arguments.length?(e=typeof i=="function"?i:je(+i),s):e},s.context=function(i){return arguments.length?(n=i??null,s):n},s}function _o(){}function kp(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function Xm(t){this._context=t}Xm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:kp(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:kp(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Cye(t){return new Xm(t)}function UE(t){this._context=t}UE.prototype={areaStart:_o,areaEnd:_o,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:kp(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function $ye(t){return new UE(t)}function GE(t){this._context=t}GE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:kp(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Iye(t){return new GE(t)}function HE(t,e){this._basis=new Xm(t),this._beta=e}HE.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r=t[0],s=e[0],i=t[n]-r,o=e[n]-s,a=-1,l;++a<=n;)l=a/n,this._basis.point(this._beta*t[a]+(1-this._beta)*(r+l*i),this._beta*e[a]+(1-this._beta)*(s+l*o));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};const Tye=function t(e){function n(r){return e===1?new Xm(r):new HE(r,e)}return n.beta=function(r){return t(+r)},n}(.85);function Sp(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function $3(t,e){this._context=t,this._k=(1-e)/6}$3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Sp(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Sp(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Nye=function t(e){function n(r){return new $3(r,e)}return n.tension=function(r){return t(+r)},n}(0);function I3(t,e){this._context=t,this._k=(1-e)/6}I3.prototype={areaStart:_o,areaEnd:_o,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Sp(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const _ye=function t(e){function n(r){return new I3(r,e)}return n.tension=function(r){return t(+r)},n}(0);function T3(t,e){this._context=t,this._k=(1-e)/6}T3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Sp(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Aye=function t(e){function n(r){return new T3(r,e)}return n.tension=function(r){return t(+r)},n}(0);function N3(t,e,n){var r=t._x1,s=t._y1,i=t._x2,o=t._y2;if(t._l01_a>Bn){var a=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,l=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*a-t._x0*t._l12_2a+t._x2*t._l01_2a)/l,s=(s*a-t._y0*t._l12_2a+t._y2*t._l01_2a)/l}if(t._l23_a>Bn){var u=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);i=(i*u+t._x1*t._l23_2a-e*t._l12_2a)/c,o=(o*u+t._y1*t._l23_2a-n*t._l12_2a)/c}t._context.bezierCurveTo(r,s,i,o,t._x2,t._y2)}function qE(t,e){this._context=t,this._alpha=e}qE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:N3(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Eye=function t(e){function n(r){return e?new qE(r,e):new $3(r,0)}return n.alpha=function(r){return t(+r)},n}(.5);function XE(t,e){this._context=t,this._alpha=e}XE.prototype={areaStart:_o,areaEnd:_o,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:N3(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Rye=function t(e){function n(r){return e?new XE(r,e):new I3(r,0)}return n.alpha=function(r){return t(+r)},n}(.5);function jE(t,e){this._context=t,this._alpha=e}jE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:N3(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Dye=function t(e){function n(r){return e?new jE(r,e):new T3(r,0)}return n.alpha=function(r){return t(+r)},n}(.5);function KE(t){this._context=t}KE.prototype={areaStart:_o,areaEnd:_o,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function Mye(t){return new KE(t)}function r8(t){return t<0?-1:1}function s8(t,e,n){var r=t._x1-t._x0,s=e-t._x1,i=(t._y1-t._y0)/(r||s<0&&-0),o=(n-t._y1)/(s||r<0&&-0),a=(i*s+o*r)/(r+s);return(r8(i)+r8(o))*Math.min(Math.abs(i),Math.abs(o),.5*Math.abs(a))||0}function i8(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function d2(t,e,n){var r=t._x0,s=t._y0,i=t._x1,o=t._y1,a=(i-r)/3;t._context.bezierCurveTo(r+a,s+a*e,i-a,o-a*n,i,o)}function Cp(t){this._context=t}Cp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:d2(this,this._t0,i8(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,d2(this,i8(this,n=s8(this,t,e)),n);break;default:d2(this,this._t0,n=s8(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};function YE(t){this._context=new ZE(t)}(YE.prototype=Object.create(Cp.prototype)).point=function(t,e){Cp.prototype.point.call(this,e,t)};function ZE(t){this._context=t}ZE.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,s,i){this._context.bezierCurveTo(e,t,r,n,i,s)}};function Fye(t){return new Cp(t)}function Oye(t){return new YE(t)}function JE(t){this._context=t}JE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),n===2)this._context.lineTo(t[1],e[1]);else for(var r=o8(t),s=o8(e),i=0,o=1;o<n;++i,++o)this._context.bezierCurveTo(r[0][i],s[0][i],r[1][i],s[1][i],t[o],e[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function o8(t){var e,n=t.length-1,r,s=new Array(n),i=new Array(n),o=new Array(n);for(s[0]=0,i[0]=2,o[0]=t[0]+2*t[1],e=1;e<n-1;++e)s[e]=1,i[e]=4,o[e]=4*t[e]+2*t[e+1];for(s[n-1]=2,i[n-1]=7,o[n-1]=8*t[n-1]+t[n],e=1;e<n;++e)r=s[e]/i[e-1],i[e]-=r,o[e]-=r*o[e-1];for(s[n-1]=o[n-1]/i[n-1],e=n-2;e>=0;--e)s[e]=(o[e]-s[e+1])/i[e];for(i[n-1]=(t[n]+s[n-1])/2,e=0;e<n-1;++e)i[e]=2*t[e+1]-s[e+1];return[s,i]}function Lye(t){return new JE(t)}function jm(t,e){this._context=t,this._t=e}jm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}break}}this._x=t,this._y=e}};function zye(t){return new jm(t,.5)}function Pye(t){return new jm(t,0)}function Bye(t){return new jm(t,1)}function ku(t,e){if((o=t.length)>1)for(var n=1,r,s,i=t[e[0]],o,a=i.length;n<o;++n)for(s=i,i=t[e[n]],r=0;r<a;++r)i[r][1]+=i[r][0]=isNaN(s[r][1])?s[r][0]:s[r][1]}function Su(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function Vye(t,e){return t[e]}function Wye(t){const e=[];return e.key=t,e}function Uye(){var t=je([]),e=Su,n=ku,r=Vye;function s(i){var o=Array.from(t.apply(this,arguments),Wye),a,l=o.length,u=-1,c;for(const h of i)for(a=0,++u;a<l;++a)(o[a][u]=[0,+r(h,o[a].key,u,i)]).data=h;for(a=0,c=Um(e(o));a<l;++a)o[c[a]].index=a;return n(o,c),o}return s.keys=function(i){return arguments.length?(t=typeof i=="function"?i:je(Array.from(i)),s):t},s.value=function(i){return arguments.length?(r=typeof i=="function"?i:je(+i),s):r},s.order=function(i){return arguments.length?(e=i==null?Su:typeof i=="function"?i:je(Array.from(i)),s):e},s.offset=function(i){return arguments.length?(n=i??ku,s):n},s}function Gye(t,e){if((r=t.length)>0){for(var n,r,s=0,i=t[0].length,o;s<i;++s){for(o=n=0;n<r;++n)o+=t[n][s][1]||0;if(o)for(n=0;n<r;++n)t[n][s][1]/=o}ku(t,e)}}function Hye(t,e){if((l=t.length)>0)for(var n,r=0,s,i,o,a,l,u=t[e[0]].length;r<u;++r)for(o=a=0,n=0;n<l;++n)(i=(s=t[e[n]][r])[1]-s[0])>0?(s[0]=o,s[1]=o+=i):i<0?(s[1]=a,s[0]=a+=i):(s[0]=0,s[1]=i)}function qye(t,e){if((s=t.length)>0){for(var n=0,r=t[e[0]],s,i=r.length;n<i;++n){for(var o=0,a=0;o<s;++o)a+=t[o][n][1]||0;r[n][1]+=r[n][0]=-a/2}ku(t,e)}}function Xye(t,e){if(!(!((o=t.length)>0)||!((i=(s=t[e[0]]).length)>0))){for(var n=0,r=1,s,i,o;r<i;++r){for(var a=0,l=0,u=0;a<o;++a){for(var c=t[e[a]],h=c[r][1]||0,f=c[r-1][1]||0,d=(h-f)/2,p=0;p<a;++p){var g=t[e[p]],m=g[r][1]||0,b=g[r-1][1]||0;d+=m-b}l+=h,u+=d*h}s[r-1][1]+=s[r-1][0]=n,l&&(n-=u/l)}s[r-1][1]+=s[r-1][0]=n,ku(t,e)}}function QE(t){var e=t.map(jye);return Su(t).sort(function(n,r){return e[n]-e[r]})}function jye(t){for(var e=-1,n=0,r=t.length,s,i=-1/0;++e<r;)(s=+t[e][1])>i&&(i=s,n=e);return n}function eR(t){var e=t.map(tR);return Su(t).sort(function(n,r){return e[n]-e[r]})}function tR(t){for(var e=0,n=-1,r=t.length,s;++n<r;)(s=+t[n][1])&&(e+=s);return e}function Kye(t){return eR(t).reverse()}function Yye(t){var e=t.length,n,r,s=t.map(tR),i=QE(t),o=0,a=0,l=[],u=[];for(n=0;n<e;++n)r=i[n],o<a?(o+=s[r],l.push(r)):(a+=s[r],u.push(r));return u.reverse().concat(l)}function Zye(t){return Su(t).reverse()}const Ef=t=>()=>t;function Jye(t,{sourceEvent:e,target:n,transform:r,dispatch:s}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:s}})}function Hs(t,e,n){this.k=t,this.x=e,this.y=n}Hs.prototype={constructor:Hs,scale:function(t){return t===1?this:new Hs(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Hs(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Km=new Hs(1,0,0);nR.prototype=Hs.prototype;function nR(t){for(;!t.__zoom;)if(!(t=t.parentNode))return Km;return t.__zoom}function p2(t){t.stopImmediatePropagation()}function cc(t){t.preventDefault(),t.stopImmediatePropagation()}function Qye(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function eve(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function a8(){return this.__zoom||Km}function tve(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function nve(){return navigator.maxTouchPoints||"ontouchstart"in this}function rve(t,e,n){var r=t.invertX(e[0][0])-n[0][0],s=t.invertX(e[1][0])-n[1][0],i=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function sve(){var t=Qye,e=eve,n=rve,r=tve,s=nve,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=MN,u=cl("start","zoom","end"),c,h,f,d=500,p=150,g=0,m=10;function b(A){A.property("__zoom",a8).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",$).on("dblclick.zoom",_).filter(s).on("touchstart.zoom",S).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",F).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}b.transform=function(A,E,D,P){var z=A.selection?A.selection():A;z.property("__zoom",a8),A!==z?w(A,E,D,P):z.interrupt().each(function(){C(this,arguments).event(P).start().zoom(null,typeof E=="function"?E.apply(this,arguments):E).end()})},b.scaleBy=function(A,E,D,P){b.scaleTo(A,function(){var z=this.__zoom.k,B=typeof E=="function"?E.apply(this,arguments):E;return z*B},D,P)},b.scaleTo=function(A,E,D,P){b.transform(A,function(){var z=e.apply(this,arguments),B=this.__zoom,G=D==null?y(z):typeof D=="function"?D.apply(this,arguments):D,j=B.invert(G),Z=typeof E=="function"?E.apply(this,arguments):E;return n(v(x(B,Z),G,j),z,o)},D,P)},b.translateBy=function(A,E,D,P){b.transform(A,function(){return n(this.__zoom.translate(typeof E=="function"?E.apply(this,arguments):E,typeof D=="function"?D.apply(this,arguments):D),e.apply(this,arguments),o)},null,P)},b.translateTo=function(A,E,D,P,z){b.transform(A,function(){var B=e.apply(this,arguments),G=this.__zoom,j=P==null?y(B):typeof P=="function"?P.apply(this,arguments):P;return n(Km.translate(j[0],j[1]).scale(G.k).translate(typeof E=="function"?-E.apply(this,arguments):-E,typeof D=="function"?-D.apply(this,arguments):-D),B,o)},P,z)};function x(A,E){return E=Math.max(i[0],Math.min(i[1],E)),E===A.k?A:new Hs(E,A.x,A.y)}function v(A,E,D){var P=E[0]-D[0]*A.k,z=E[1]-D[1]*A.k;return P===A.x&&z===A.y?A:new Hs(A.k,P,z)}function y(A){return[(+A[0][0]+ +A[1][0])/2,(+A[0][1]+ +A[1][1])/2]}function w(A,E,D,P){A.on("start.zoom",function(){C(this,arguments).event(P).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(P).end()}).tween("zoom",function(){var z=this,B=arguments,G=C(z,B).event(P),j=e.apply(z,B),Z=D==null?y(j):typeof D=="function"?D.apply(z,B):D,ne=Math.max(j[1][0]-j[0][0],j[1][1]-j[0][1]),le=z.__zoom,oe=typeof E=="function"?E.apply(z,B):E,de=l(le.invert(Z).concat(ne/le.k),oe.invert(Z).concat(ne/oe.k));return function(fe){if(fe===1)fe=oe;else{var xe=de(fe),ie=ne/xe[2];fe=new Hs(ie,Z[0]-xe[0]*ie,Z[1]-xe[1]*ie)}G.zoom(null,fe)}})}function C(A,E,D){return!D&&A.__zooming||new T(A,E)}function T(A,E){this.that=A,this.args=E,this.active=0,this.sourceEvent=null,this.extent=e.apply(A,E),this.taps=0}T.prototype={event:function(A){return A&&(this.sourceEvent=A),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(A,E){return this.mouse&&A!=="mouse"&&(this.mouse[1]=E.invert(this.mouse[0])),this.touch0&&A!=="touch"&&(this.touch0[1]=E.invert(this.touch0[0])),this.touch1&&A!=="touch"&&(this.touch1[1]=E.invert(this.touch1[0])),this.that.__zoom=E,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(A){var E=nn(this.that).datum();u.call(A,this.that,new Jye(A,{sourceEvent:this.sourceEvent,target:b,transform:this.that.__zoom,dispatch:u}),E)}};function N(A,...E){if(!t.apply(this,arguments))return;var D=C(this,E).event(A),P=this.__zoom,z=Math.max(i[0],Math.min(i[1],P.k*Math.pow(2,r.apply(this,arguments)))),B=Ar(A);if(D.wheel)(D.mouse[0][0]!==B[0]||D.mouse[0][1]!==B[1])&&(D.mouse[1]=P.invert(D.mouse[0]=B)),clearTimeout(D.wheel);else{if(P.k===z)return;D.mouse=[B,P.invert(B)],wa(this),D.start()}cc(A),D.wheel=setTimeout(G,p),D.zoom("mouse",n(v(x(P,z),D.mouse[0],D.mouse[1]),D.extent,o));function G(){D.wheel=null,D.end()}}function $(A,...E){if(f||!t.apply(this,arguments))return;var D=A.currentTarget,P=C(this,E,!0).event(A),z=nn(A.view).on("mousemove.zoom",Z,!0).on("mouseup.zoom",ne,!0),B=Ar(A,D),G=A.clientX,j=A.clientY;pm(A.view),p2(A),P.mouse=[B,this.__zoom.invert(B)],wa(this),P.start();function Z(le){if(cc(le),!P.moved){var oe=le.clientX-G,de=le.clientY-j;P.moved=oe*oe+de*de>g}P.event(le).zoom("mouse",n(v(P.that.__zoom,P.mouse[0]=Ar(le,D),P.mouse[1]),P.extent,o))}function ne(le){z.on("mousemove.zoom mouseup.zoom",null),mm(le.view,P.moved),cc(le),P.event(le).end()}}function _(A,...E){if(t.apply(this,arguments)){var D=this.__zoom,P=Ar(A.changedTouches?A.changedTouches[0]:A,this),z=D.invert(P),B=D.k*(A.shiftKey?.5:2),G=n(v(x(D,B),P,z),e.apply(this,E),o);cc(A),a>0?nn(this).transition().duration(a).call(w,G,P,A):nn(this).call(b.transform,G,P,A)}}function S(A,...E){if(t.apply(this,arguments)){var D=A.touches,P=D.length,z=C(this,E,A.changedTouches.length===P).event(A),B,G,j,Z;for(p2(A),G=0;G<P;++G)j=D[G],Z=Ar(j,this),Z=[Z,this.__zoom.invert(Z),j.identifier],z.touch0?!z.touch1&&z.touch0[2]!==Z[2]&&(z.touch1=Z,z.taps=0):(z.touch0=Z,B=!0,z.taps=1+!!c);c&&(c=clearTimeout(c)),B&&(z.taps<2&&(h=Z[0],c=setTimeout(function(){c=null},d)),wa(this),z.start())}}function M(A,...E){if(this.__zooming){var D=C(this,E).event(A),P=A.changedTouches,z=P.length,B,G,j,Z;for(cc(A),B=0;B<z;++B)G=P[B],j=Ar(G,this),D.touch0&&D.touch0[2]===G.identifier?D.touch0[0]=j:D.touch1&&D.touch1[2]===G.identifier&&(D.touch1[0]=j);if(G=D.that.__zoom,D.touch1){var ne=D.touch0[0],le=D.touch0[1],oe=D.touch1[0],de=D.touch1[1],fe=(fe=oe[0]-ne[0])*fe+(fe=oe[1]-ne[1])*fe,xe=(xe=de[0]-le[0])*xe+(xe=de[1]-le[1])*xe;G=x(G,Math.sqrt(fe/xe)),j=[(ne[0]+oe[0])/2,(ne[1]+oe[1])/2],Z=[(le[0]+de[0])/2,(le[1]+de[1])/2]}else if(D.touch0)j=D.touch0[0],Z=D.touch0[1];else return;D.zoom("touch",n(v(G,j,Z),D.extent,o))}}function F(A,...E){if(this.__zooming){var D=C(this,E).event(A),P=A.changedTouches,z=P.length,B,G;for(p2(A),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),B=0;B<z;++B)G=P[B],D.touch0&&D.touch0[2]===G.identifier?delete D.touch0:D.touch1&&D.touch1[2]===G.identifier&&delete D.touch1;if(D.touch1&&!D.touch0&&(D.touch0=D.touch1,delete D.touch1),D.touch0)D.touch0[1]=this.__zoom.invert(D.touch0[0]);else if(D.end(),D.taps===2&&(G=Ar(G,this),Math.hypot(h[0]-G[0],h[1]-G[1])<m)){var j=nn(this).on("dblclick.zoom");j&&j.apply(this,arguments)}}}return b.wheelDelta=function(A){return arguments.length?(r=typeof A=="function"?A:Ef(+A),b):r},b.filter=function(A){return arguments.length?(t=typeof A=="function"?A:Ef(!!A),b):t},b.touchable=function(A){return arguments.length?(s=typeof A=="function"?A:Ef(!!A),b):s},b.extent=function(A){return arguments.length?(e=typeof A=="function"?A:Ef([[+A[0][0],+A[0][1]],[+A[1][0],+A[1][1]]]),b):e},b.scaleExtent=function(A){return arguments.length?(i[0]=+A[0],i[1]=+A[1],b):[i[0],i[1]]},b.translateExtent=function(A){return arguments.length?(o[0][0]=+A[0][0],o[1][0]=+A[1][0],o[0][1]=+A[0][1],o[1][1]=+A[1][1],b):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},b.constrain=function(A){return arguments.length?(n=A,b):n},b.duration=function(A){return arguments.length?(a=+A,b):a},b.interpolate=function(A){return arguments.length?(l=A,b):l},b.on=function(){var A=u.on.apply(u,arguments);return A===u?b:A},b.clickDistance=function(A){return arguments.length?(g=(A=+A)*A,b):Math.sqrt(g)},b.tapDistance=function(A){return arguments.length?(m=+A,b):m},b}const rR=Object.freeze(Object.defineProperty({__proto__:null,Adder:bn,Delaunay:Ov,FormatSpecifier:Tm,InternMap:Jc,InternSet:Ba,Node:ja,Path:O0,Voronoi:e_,ZoomTransform:Hs,active:npe,arc:rye,area:CE,areaRadial:t8,ascending:zt,autoType:$1e,axisBottom:qce,axisLeft:Xce,axisRight:Hce,axisTop:Gce,bin:q5,bisect:Io,bisectCenter:Bue,bisectLeft:Pue,bisectRight:Io,bisector:lm,blob:N1e,blur:Vue,blur2:ET,blurImage:Wue,brush:mpe,brushSelection:fpe,brushX:dpe,brushY:ppe,buffer:A1e,chord:bpe,chordDirected:ype,chordTranspose:xpe,cluster:qge,color:zi,contourDensity:QN,contours:Mb,count:um,create:N0e,creator:fm,cross:Kue,csv:D1e,csvFormat:p1e,csvFormatBody:m1e,csvFormatRow:b1e,csvFormatRows:g1e,csvFormatValue:x1e,csvParse:n_,csvParseRows:d1e,cubehelix:As,cumsum:Yue,curveBasis:Cye,curveBasisClosed:$ye,curveBasisOpen:Iye,curveBumpX:NE,curveBumpY:_E,curveBundle:Tye,curveCardinal:Nye,curveCardinalClosed:_ye,curveCardinalOpen:Aye,curveCatmullRom:Eye,curveCatmullRomClosed:Rye,curveCatmullRomOpen:Dye,curveLinear:Gm,curveLinearClosed:Mye,curveMonotoneX:Fye,curveMonotoneY:Oye,curveNatural:Lye,curveStep:zye,curveStepAfter:Bye,curveStepBefore:Pye,descending:_T,deviation:MT,difference:Rce,disjoint:Dce,dispatch:cl,drag:L0e,dragDisable:pm,dragEnable:mm,dsv:R1e,dsvFormat:Cm,easeBack:g6,easeBackIn:jde,easeBackInOut:g6,easeBackOut:Kde,easeBounce:oh,easeBounceIn:qde,easeBounceInOut:Xde,easeBounceOut:oh,easeCircle:m6,easeCircleIn:Ode,easeCircleInOut:m6,easeCircleOut:Lde,easeCubic:_b,easeCubicIn:Nde,easeCubicInOut:_b,easeCubicOut:_de,easeElastic:b6,easeElasticIn:Yde,easeElasticInOut:Zde,easeElasticOut:b6,easeExp:p6,easeExpIn:Mde,easeExpInOut:p6,easeExpOut:Fde,easeLinear:$de,easePoly:f6,easePolyIn:Ade,easePolyInOut:f6,easePolyOut:Ede,easeQuad:h6,easeQuadIn:Ide,easeQuadInOut:h6,easeQuadOut:Tde,easeSin:d6,easeSinIn:Rde,easeSinInOut:d6,easeSinOut:Dde,every:Ice,extent:Rc,fcumsum:Jue,filter:Nce,flatGroup:Que,flatRollup:ece,forceCenter:V1e,forceCollide:ome,forceLink:lme,forceManyBody:bme,forceRadial:xme,forceSimulation:gme,forceX:yme,forceY:vme,get format(){return Nm},formatDefaultLocale:l_,formatLocale:a_,get formatPrefix(){return Pv},formatSpecifier:pu,fsum:Zue,geoAlbers:X_,geoAlbersUsa:Cge,geoArea:Ame,geoAzimuthalEqualArea:$ge,geoAzimuthalEqualAreaRaw:Kv,geoAzimuthalEquidistant:Ige,geoAzimuthalEquidistantRaw:Yv,geoBounds:Mme,geoCentroid:Bme,geoCircle:Vme,geoClipAntimeridian:Xb,geoClipCircle:A_,geoClipExtent:jme,geoClipRectangle:_m,geoConicConformal:Nge,geoConicConformalRaw:Y_,geoConicEqualArea:xp,geoConicEqualAreaRaw:q_,geoConicEquidistant:Age,geoConicEquidistantRaw:Z_,geoContains:tge,geoDistance:cp,geoEqualEarth:Rge,geoEqualEarthRaw:Zv,geoEquirectangular:_ge,geoEquirectangularRaw:hh,geoGnomonic:Dge,geoGnomonicRaw:Jv,geoGraticule:D_,geoGraticule10:nge,geoIdentity:Mge,geoInterpolate:rge,geoLength:E_,geoMercator:Tge,geoMercatorRaw:V0,geoNaturalEarth1:Fge,geoNaturalEarth1Raw:Qv,geoOrthographic:Oge,geoOrthographicRaw:e3,geoPath:H_,geoProjection:di,geoProjectionMutator:Xv,geoRotation:C_,geoStereographic:Lge,geoStereographicRaw:t3,geoStream:vs,geoTransform:mge,geoTransverseMercator:zge,geoTransverseMercatorRaw:n3,gray:K0e,greatest:HT,greatestIndex:vce,group:zT,groupSort:rce,groups:PT,hcl:Gd,hierarchy:r3,histogram:q5,hsl:Vd,html:P1e,image:F1e,index:tce,indexes:nce,interpolate:qo,interpolateArray:tfe,interpolateBasis:wN,interpolateBasisClosed:kN,interpolateBlues:Axe,interpolateBrBG:uxe,interpolateBuGn:xxe,interpolateBuPu:yxe,interpolateCividis:Oxe,interpolateCool:Pxe,interpolateCubehelix:gfe,interpolateCubehelixDefault:Lxe,interpolateCubehelixLong:vm,interpolateDate:NN,interpolateDiscrete:sfe,interpolateGnBu:vxe,interpolateGreens:Exe,interpolateGreys:Rxe,interpolateHcl:pfe,interpolateHclLong:mfe,interpolateHsl:hfe,interpolateHslLong:ffe,interpolateHue:ife,interpolateInferno:Xxe,interpolateLab:dfe,interpolateMagma:qxe,interpolateNumber:Kr,interpolateNumberArray:$v,interpolateObject:_N,interpolateOrRd:wxe,interpolateOranges:Fxe,interpolatePRGn:cxe,interpolatePiYG:hxe,interpolatePlasma:jxe,interpolatePuBu:Sxe,interpolatePuBuGn:kxe,interpolatePuOr:fxe,interpolatePuRd:Cxe,interpolatePurples:Dxe,interpolateRainbow:Bxe,interpolateRdBu:dxe,interpolateRdGy:pxe,interpolateRdPu:$xe,interpolateRdYlBu:mxe,interpolateRdYlGn:gxe,interpolateReds:Mxe,interpolateRgb:rh,interpolateRgbBasis:$N,interpolateRgbBasisClosed:efe,interpolateRound:ym,interpolateSinebow:Uxe,interpolateSpectral:bxe,interpolateString:Iv,interpolateTransformCss:RN,interpolateTransformSvg:DN,interpolateTurbo:Gxe,interpolateViridis:Hxe,interpolateWarm:zxe,interpolateYlGn:Txe,interpolateYlGnBu:Ixe,interpolateYlOrBr:Nxe,interpolateYlOrRd:_xe,interpolateZoom:MN,interrupt:wa,intersection:Mce,interval:wfe,isoFormat:U4e,isoParse:H4e,json:L1e,lab:Ud,lch:Y0e,least:yce,leastIndex:jT,line:S3,lineRadial:e8,link:Hm,linkHorizontal:fye,linkRadial:pye,linkVertical:dye,local:oN,map:_ce,matcher:xv,max:_s,maxIndex:pv,mean:hce,median:fce,medianIndex:dce,merge:gv,min:ii,minIndex:mv,mode:mce,namespace:D0,namespaces:yb,nice:fv,now:F0,pack:k2e,packEnclose:g2e,packSiblings:v2e,pairs:gce,partition:S2e,path:Fv,pathRound:kpe,permute:GT,pie:aye,piecewise:zN,pointRadial:Tc,pointer:Ar,pointers:A0e,polygonArea:P2e,polygonCentroid:B2e,polygonContains:G2e,polygonHull:U2e,polygonLength:H2e,precisionFixed:u_,precisionPrefix:c_,precisionRound:h_,quadtree:Im,quantile:Qc,quantileIndex:XT,quantileSorted:qT,quantize:bfe,quickselect:cm,radialArea:t8,radialLine:e8,randomBates:K2e,randomBernoulli:J2e,randomBeta:cA,randomBinomial:hA,randomCauchy:ebe,randomExponential:Y2e,randomGamma:o3,randomGeometric:uA,randomInt:X2e,randomIrwinHall:lA,randomLcg:ibe,randomLogNormal:j2e,randomLogistic:tbe,randomNormal:i3,randomPareto:Z2e,randomPoisson:nbe,randomUniform:q2e,randomWeibull:Q2e,range:co,rank:xce,reduce:Ace,reverse:Ece,rgb:cu,ribbon:Ape,ribbonArrow:Epe,rollup:VT,rollups:WT,scaleBand:l3,scaleDiverging:XA,scaleDivergingLog:jA,scaleDivergingPow:v3,scaleDivergingSqrt:Z4e,scaleDivergingSymlog:KA,scaleIdentity:pA,scaleImplicit:a4,scaleLinear:xu,scaleLog:gA,scaleOrdinal:a3,scalePoint:obe,scalePow:d3,scaleQuantile:yA,scaleQuantize:vA,scaleRadial:xA,scaleSequential:UA,scaleSequentialLog:GA,scaleSequentialPow:y3,scaleSequentialQuantile:qA,scaleSequentialSqrt:Y4e,scaleSequentialSymlog:HA,scaleSqrt:xbe,scaleSymlog:bA,scaleThreshold:wA,scaleTime:j4e,scaleUtc:K4e,scan:wce,schemeAccent:Q4e,schemeBlues:bE,schemeBrBG:YA,schemeBuGn:iE,schemeBuPu:oE,schemeCategory10:J4e,schemeDark2:exe,schemeGnBu:aE,schemeGreens:xE,schemeGreys:yE,schemeObservable10:txe,schemeOrRd:lE,schemeOranges:kE,schemePRGn:ZA,schemePaired:nxe,schemePastel1:rxe,schemePastel2:sxe,schemePiYG:JA,schemePuBu:cE,schemePuBuGn:uE,schemePuOr:QA,schemePuRd:hE,schemePurples:vE,schemeRdBu:eE,schemeRdGy:tE,schemeRdPu:fE,schemeRdYlBu:nE,schemeRdYlGn:rE,schemeReds:wE,schemeSet1:ixe,schemeSet2:oxe,schemeSet3:axe,schemeSpectral:sE,schemeTableau10:lxe,schemeYlGn:pE,schemeYlGnBu:dE,schemeYlOrBr:mE,schemeYlOrRd:gE,select:nn,selectAll:E0e,selection:hl,selector:dm,selectorAll:bv,shuffle:kce,shuffler:KT,some:Tce,sort:gb,stack:Uye,stackOffsetDiverging:Hye,stackOffsetExpand:Gye,stackOffsetNone:ku,stackOffsetSilhouette:qye,stackOffsetWiggle:Xye,stackOrderAppearance:QE,stackOrderAscending:eR,stackOrderDescending:Kye,stackOrderInsideOut:Yye,stackOrderNone:Su,stackOrderReverse:Zye,stratify:T2e,style:Ua,subset:Oce,sum:Sce,superset:ZT,svg:B1e,symbol:Sye,symbolAsterisk:AE,symbolCircle:qm,symbolCross:EE,symbolDiamond:DE,symbolDiamond2:ME,symbolPlus:FE,symbolSquare:OE,symbolSquare2:LE,symbolStar:PE,symbolTimes:c4,symbolTriangle:BE,symbolTriangle2:VE,symbolWye:WE,symbolX:c4,symbols:n8,symbolsFill:n8,symbolsStroke:kye,text:$m,thresholdFreedmanDiaconis:uce,thresholdScott:cce,thresholdSturges:dv,tickFormat:dA,tickIncrement:Wa,tickStep:zd,ticks:Va,timeDay:Xu,timeDays:Cbe,get timeFormat(){return g3},timeFormatDefaultLocale:VA,timeFormatLocale:FA,timeFriday:CA,timeFridays:Ebe,timeHour:Fm,timeHours:kbe,timeInterval:cn,timeMillisecond:yu,timeMilliseconds:L7,timeMinute:Dm,timeMinutes:vbe,timeMonday:fh,timeMondays:Tbe,timeMonth:Lm,timeMonths:Pbe,get timeParse(){return BA},timeSaturday:$A,timeSaturdays:Rbe,timeSecond:Ai,timeSeconds:P7,timeSunday:vu,timeSundays:B7,timeThursday:Ka,timeThursdays:Abe,timeTickInterval:MA,timeTicks:DA,timeTuesday:kA,timeTuesdays:Nbe,timeWednesday:SA,timeWednesdays:_be,timeWeek:vu,timeWeeks:B7,timeYear:li,timeYears:Vbe,timeout:$b,timer:km,timerFlush:VN,transition:HN,transpose:YT,tree:M2e,treemap:F2e,treemapBinary:O2e,treemapDice:W0,treemapResquarify:z2e,treemapSlice:Em,treemapSliceDice:L2e,treemapSquarify:aA,tsv:M1e,tsvFormat:v1e,tsvFormatBody:w1e,tsvFormatRow:S1e,tsvFormatRows:k1e,tsvFormatValue:C1e,tsvParse:r_,tsvParseRows:y1e,union:Lce,unixDay:m3,unixDays:Ibe,utcDay:G0,utcDays:$be,get utcFormat(){return Pm},utcFriday:NA,utcFridays:Lbe,utcHour:Om,utcHours:Sbe,utcMillisecond:yu,utcMilliseconds:L7,utcMinute:Mm,utcMinutes:wbe,utcMonday:dh,utcMondays:Dbe,utcMonth:zm,utcMonths:Bbe,get utcParse(){return b3},utcSaturday:_A,utcSaturdays:zbe,utcSecond:Ai,utcSeconds:P7,utcSunday:wu,utcSundays:V7,utcThursday:Ya,utcThursdays:Obe,utcTickInterval:RA,utcTicks:EA,utcTuesday:IA,utcTuesdays:Mbe,utcWednesday:TA,utcWednesdays:Fbe,utcWeek:wu,utcWeeks:V7,utcYear:ui,utcYears:Wbe,variance:DT,window:yv,xml:z1e,zip:$ce,zoom:sve,zoomIdentity:Km,zoomTransform:nR},Symbol.toStringTag,{value:"Module"}));class _3{constructor(e=2,n=64){ig(this,"model");ig(this,"dim");if(new.target===_3)throw new Error("Cannot instantiate abstract class Model directly.");this.dim=e,this.model=eH(),this.model.add(ef({inputShape:[e+1],units:n,activation:"elu"})),this.model.add(ef({units:n,activation:"elu"})),this.model.add(ef({units:n,activation:"elu"})),this.model.add(ef({units:e}))}setModel(e){this.model=e}async download(){await this.model.save("downloads://model")}train(e,n=1e4,r=32){throw new Error("Method 'train()' not implemented.")}forward(e,n){throw new Error("Method 'forward()' not implemented.")}step(e,n,r){throw new Error("Method 'step()' not implemented.")}sample(e,n=100){throw new Error("Method 'sample()' not implemented.")}}class ive extends _3{constructor(e=2,n=64){super(e,n)}async train(e,n=1e4,r=32){const s=(o,a)=>KB.meanSquaredError(a,o),i=sa.adam(.01);for(let o=0;o<n;o++)Q(()=>{const a=Da([r],0,e.shape[0],"int32"),l=B1(e,a),u=Da([r,1]),c=Y2([r,this.dim]),h=c.mul(Ie(1,u)).add(l.mul(u)),f=l.sub(c);i.minimize(()=>{const d=this.forward(h,u);return s(d,f)})})}forward(e,n){return Q(()=>{const r=n.reshape([e.shape[0],1]),s=Un([e,r],1);return this.model.predict(s)})}step(e,n,r){return Q(()=>{const s=n.reshape([e.shape[0],1]),o=r.reshape([e.shape[0],1]).sub(s),a=this.forward(e,s).mul(o).div(2),l=e.add(a),u=s.add(o.div(2)),c=this.forward(l,u).mul(o);return e.add(c)})}sample(e,n=100){return Q(()=>{const r=Y2([e,this.dim]),s=DL(0,1,n+1);let i=[],o=r;for(let a=0;a<n;a++){const l=s.slice([a],[1]),u=Dr(l,[e]),c=s.slice([a+1],[1]),h=Dr(c,[e]);o=this.step(o,u,h),i.push(o)}return ni(i)})}}const sR={"Training Objective":{name:"Training Objective",options:["Flow Matching"],default:"Flow Matching"},Sampler:{name:"Sampler",options:["Euler"],default:"Euler"}},l8={"Flow Matching":{"Three Modes":jl+"/models/flow_matching_three_modes/model.json","Smiley Face":jl+"/models/flow_matching_smiley_face/model.json"}},ove={"Flow Matching":ive},Rf={"Flow Matching":{dim:2,hidden:64},Diffusion:{dim:2,hidden:64}},ave={"Smiley Face":jl+"/datasets/smiley_face.json","Three Modes":jl+"/datasets/three_modes.json"},At={distributionWidth:500,distributionHeight:500,mainAreaHeight:640,miniDistributionWidth:75,displayAreaWidth:1100,displayAreaHeight:500,pointColor:"#4594e3"},ha=Rs({modelType:sR["Training Objective"].default,numberOfSteps:100,numSamples:500}),h4=Rs("Smiley Face"),f4=Rs(void 0),iR=Rs(void 0),zc=Rs(void 0),A3=Rs(void 0),lve=Rs(null),Cu=Rs(0),ql=Rs(!1),uve=Rs(30),cve=Rs({xMin:-3.5,xMax:3.5,yMin:-3.5,yMax:3.5});var hve=x4('<svg viewBox="0 0 24 24" class="svelte-iwxx8j"><rect x="6" y="5" width="4" height="14"></rect><rect x="14" y="5" width="4" height="14"></rect></svg>'),fve=x4('<svg viewBox="0 0 24 24" class="svelte-iwxx8j"><polygon points="5,3 19,12 5,21"></polygon></svg>'),dve=Es('<button aria-label="Play/Pause" class="svelte-iwxx8j"><!></button>');function pve(t,e){Do(e,!1);const[n,r]=Tu(),s=()=>vr(ql,"$isPlaying",n),i=()=>vr(Cu,"$currentTime",n),o=()=>vr(ha,"$UIState",n),a=()=>vr(uve,"$playbackSpeed",n);let l=yo();function u(){ql.update(p=>!p)}q8(()=>{clearInterval(at(l))}),Ja(()=>(s(),at(l),i(),o(),a()),()=>{s()&&(clearInterval(at(l)),ka(l,setInterval(()=>{if(s()){let p=i()+1/o().numberOfSteps;p>1&&(p=1),Cu.update(()=>p)}else clearInterval(at(l))},1e3/a())))}),Qa(),el();var c=dve(),h=Qt(c);{var f=p=>{var g=hve();ir(p,g)},d=p=>{var g=fve();ir(p,g)};E2(h,p=>{s()?p(f):p(d,!1)})}Vt(c),H8("click",c,u),ir(t,c),Mo(),r()}var mve=Es('<div class="time-slider-container svelte-1bfk0p8"><div class="play-button-container svelte-1bfk0p8"><!></div> <div class="time-slider svelte-1bfk0p8"><input type="range" min="0" max="1" step="0.001" list="ticks" class="slider svelte-1bfk0p8"> <div class="tick-container svelte-1bfk0p8"><div class="tick svelte-1bfk0p8" style="left: 1%;"></div> <div class="tick-label svelte-1bfk0p8" style="left: 1%;">t=0</div> <div class="tick svelte-1bfk0p8" style="left: 99%;"></div> <div class="tick-label svelte-1bfk0p8" style="left: 99%;">t=1</div></div></div></div>');function gve(t,e){Do(e,!1);const[n,r]=Tu(),s=()=>vr(Cu,"$currentTime",n);let i=yo();Ja(()=>s(),()=>{const h=s()*100;ka(i,`background: linear-gradient(to right, #4594e3 ${h}%, #d3d3d3 ${h}%)`)}),Qa();var o=mve(),a=Qt(o),l=Qt(a);pve(l,{}),Vt(a);var u=_r(a,2),c=Qt(u);VD(c),A2(2),Vt(u),Vt(o),fo(()=>Ap(c,at(i))),GD(c,s,h=>ND(Cu,h)),ir(t,o),Mo(),r()}var bve=Es("<option> </option>"),xve=Es('<div class="control svelte-bqg00i"><label class="svelte-bqg00i"> </label> <div class="select svelte-bqg00i"><select class="svelte-bqg00i"></select></div></div>');function yve(t,e){Do(e,!1);let n=ut(e,"entry",12);el();var r=xve(),s=Qt(r),i=Qt(s,!0);Vt(s);var o=_r(s,2),a=Qt(o);fo(()=>{n(),$D(()=>{})}),S4(a,5,()=>n().options,k4,(l,u)=>{var c=bve(),h={},f=Qt(c,!0);Vt(c),fo(()=>{h!==(h=at(u))&&(c.value=(c.__value=at(u))??""),Q3(f,at(u))}),ir(l,c)}),Vt(a),Vt(o),Vt(r),fo(()=>{Fr(s,"for",n().name),Q3(i,n().name),Fr(a,"id",n().name)}),qD(a,()=>n().current,l=>n(n().current=l,!0)),ir(t,r),Mo()}var vve=Es('<div class="training-bar svelte-rf1qr6"><div class="training-bar-inner-container svelte-rf1qr6"><img id="beta-logo" alt="Beta Logo" class="svelte-rf1qr6"> <p class="title svelte-rf1qr6"><b>Diffusion</b>Lab</p> <div class="hyperparameter-menu svelte-rf1qr6"></div></div></div>');function wve(t){var e=vve(),n=Qt(e),r=Qt(n);Fr(r,"src",`${jl??""}/BetaLogo.svg`);var s=_r(r,4);S4(s,5,()=>Object.entries(sR),k4,(i,o)=>{let a=()=>at(o)[1];yve(i,{get entry(){return a()}})}),Vt(s),Vt(n),Vt(e),ir(t,e)}class E3{constructor(e,n,r){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=n,this.end=r}static range(e,n){return n?!e||!e.loc||!n.loc||e.loc.lexer!==n.loc.lexer?null:new E3(e.loc.lexer,e.loc.start,n.loc.end):e&&e.loc}}class R3{constructor(e,n){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=n}range(e,n){return new R3(n,E3.range(this,e))}}class Me{constructor(e,n){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var r="KaTeX parse error: "+e,s,i,o=n&&n.loc;if(o&&o.start<=o.end){var a=o.lexer.input;s=o.start,i=o.end,s===a.length?r+=" at end of input: ":r+=" at position "+(s+1)+": ";var l=a.slice(s,i).replace(/[^]/g,"$&"),u;s>15?u=""+a.slice(s-15,s):u=a.slice(0,s);var c;i+15<a.length?c=a.slice(i,i+15)+"":c=a.slice(i),r+=u+l+c}var h=new Error(r);return h.name="ParseError",h.__proto__=Me.prototype,h.position=s,s!=null&&i!=null&&(h.length=i-s),h.rawMessage=e,h}}Me.prototype.__proto__=Error.prototype;var kve=function(e,n){return e.indexOf(n)!==-1},Sve=function(e,n){return e===void 0?n:e},Cve=/([A-Z])/g,$ve=function(e){return e.replace(Cve,"-$1").toLowerCase()},Ive={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},Tve=/[&><"']/g;function Nve(t){return String(t).replace(Tve,e=>Ive[e])}var oR=function t(e){return e.type==="ordgroup"||e.type==="color"?e.body.length===1?t(e.body[0]):e:e.type==="font"?t(e.body):e},_ve=function(e){var n=oR(e);return n.type==="mathord"||n.type==="textord"||n.type==="atom"},Ave=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e},Eve=function(e){var n=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return n?n[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(n[1])?null:n[1].toLowerCase():"_relative"},Be={contains:kve,deflt:Sve,escape:Nve,hyphenate:$ve,getBaseElem:oR,isCharacterBox:_ve,protocolFromUrl:Eve};class to{constructor(e,n,r){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=n,this.cramped=r}sup(){return Bs[Rve[this.id]]}sub(){return Bs[Dve[this.id]]}fracNum(){return Bs[Mve[this.id]]}fracDen(){return Bs[Fve[this.id]]}cramp(){return Bs[Ove[this.id]]}text(){return Bs[Lve[this.id]]}isTight(){return this.size>=2}}var D3=0,$p=1,Xl=2,Di=3,ph=4,rs=5,$u=6,sr=7,Bs=[new to(D3,0,!1),new to($p,0,!0),new to(Xl,1,!1),new to(Di,1,!0),new to(ph,2,!1),new to(rs,2,!0),new to($u,3,!1),new to(sr,3,!0)],Rve=[ph,rs,ph,rs,$u,sr,$u,sr],Dve=[rs,rs,rs,rs,sr,sr,sr,sr],Mve=[Xl,Di,ph,rs,$u,sr,$u,sr],Fve=[Di,Di,rs,rs,sr,sr,sr,sr],Ove=[$p,$p,Di,Di,rs,rs,sr,sr],Lve=[D3,$p,Xl,Di,Xl,Di,Xl,Di],Ve={DISPLAY:Bs[D3],TEXT:Bs[Xl],SCRIPT:Bs[ph],SCRIPTSCRIPT:Bs[$u]},d4=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function zve(t){for(var e=0;e<d4.length;e++)for(var n=d4[e],r=0;r<n.blocks.length;r++){var s=n.blocks[r];if(t>=s[0]&&t<=s[1])return n.name}return null}var od=[];d4.forEach(t=>t.blocks.forEach(e=>od.push(...e)));function Pve(t){for(var e=0;e<od.length;e+=2)if(t>=od[e]&&t<=od[e+1])return!0;return!1}var _l=80,Bve=function(e,n){return"M95,"+(622+e+n)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+e/2.075+" -"+e+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+e)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},Vve=function(e,n){return"M263,"+(601+e+n)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+e/2.084+" -"+e+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+e)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},Wve=function(e,n){return"M983 "+(10+e+n)+`
l`+e/3.13+" -"+e+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+e)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},Uve=function(e,n){return"M424,"+(2398+e+n)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+e/4.223+" -"+e+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+e)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+e)+" "+n+`
h400000v`+(40+e)+"h-400000z"},Gve=function(e,n){return"M473,"+(2713+e+n)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+e/5.298+" -"+e+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+e)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+e)+" "+n+"h400000v"+(40+e)+"H1017.7z"},Hve=function(e){var n=e/2;return"M400000 "+e+" H0 L"+n+" 0 l65 45 L145 "+(e-80)+" H400000z"},qve=function(e,n,r){var s=r-54-n-e;return"M702 "+(e+n)+"H400000"+(40+e)+`
H742v`+s+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+n+"H400000v"+(40+e)+"H742z"},Xve=function(e,n,r){n=1e3*n;var s="";switch(e){case"sqrtMain":s=Bve(n,_l);break;case"sqrtSize1":s=Vve(n,_l);break;case"sqrtSize2":s=Wve(n,_l);break;case"sqrtSize3":s=Uve(n,_l);break;case"sqrtSize4":s=Gve(n,_l);break;case"sqrtTall":s=qve(n,_l,r)}return s},jve=function(e,n){switch(e){case"":return"M291 0 H417 V"+n+" H291z M291 0 H417 V"+n+" H291z";case"":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z";case"":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z"+("M367 0 H410 V"+n+" H367z M367 0 H410 V"+n+" H367z");case"":return"M457 0 H583 V"+n+" H457z M457 0 H583 V"+n+" H457z";case"":return"M319 0 H403 V"+n+" H319z M319 0 H403 V"+n+" H319z";case"":return"M263 0 H347 V"+n+" H263z M263 0 H347 V"+n+" H263z";case"":return"M384 0 H504 V"+n+" H384z M384 0 H504 V"+n+" H384z";case"":return"M312 0 H355 V"+n+" H312z M312 0 H355 V"+n+" H312z";case"":return"M257 0 H300 V"+n+" H257z M257 0 H300 V"+n+" H257z"+("M478 0 H521 V"+n+" H478z M478 0 H521 V"+n+" H478z");default:return""}},u8={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},Kve=function(e,n){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+n+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+n+" v1759 h84z";case"vert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+" v585 h43z";case"doublevert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+` v585 h43z
M367 15 v585 v`+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+n+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+n+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+n+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v602 h84z
M403 1759 V0 H319 V1759 v`+n+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v602 h84z
M347 1759 V0 h-84 V1759 v`+n+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(n+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(n+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(n+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(n+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class q0{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return Be.contains(this.classes,e)}toNode(){for(var e=document.createDocumentFragment(),n=0;n<this.children.length;n++)e.appendChild(this.children[n].toNode());return e}toMarkup(){for(var e="",n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e}toText(){var e=n=>n.toText();return this.children.map(e).join("")}}var Ei={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},c8={:"A",:"D",:"o",:"a",:"d",:"o",:"A",:"B",:"B",:"F",:"A",:"E",:"K",:"3",:"N",:"N",:"K",:"N",:"M",:"H",:"O",:"N",:"P",:"C",:"T",:"y",:"O",:"X",:"U",:"h",:"W",:"W",:"B",:"X",:"B",:"3",:"X",:"R",:"a",:"b",:"a",:"r",:"y",:"e",:"m",:"e",:"n",:"n",:"n",:"n",:"m",:"n",:"o",:"n",:"p",:"c",:"o",:"y",:"b",:"x",:"n",:"n",:"w",:"w",:"a",:"m",:"a",:"e",:"m",:"r"};function M3(t,e,n){if(!Ei[e])throw new Error("Font metrics not found for font: "+e+".");var r=t.charCodeAt(0),s=Ei[e][r];if(!s&&t[0]in c8&&(r=c8[t[0]].charCodeAt(0),s=Ei[e][r]),!s&&n==="text"&&Pve(r)&&(s=Ei[e][77]),s)return{depth:s[0],height:s[1],italic:s[2],skew:s[3],width:s[4]}}var p4={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},Yve={ex:!0,em:!0,mu:!0},Zve=function(e){return typeof e!="string"&&(e=e.unit),e in p4||e in Yve||e==="ex"},Ot=function(e,n){var r;if(e.unit in p4)r=p4[e.unit]/n.fontMetrics().ptPerEm/n.sizeMultiplier;else if(e.unit==="mu")r=n.fontMetrics().cssEmPerMu;else{var s;if(n.style.isTight()?s=n.havingStyle(n.style.text()):s=n,e.unit==="ex")r=s.fontMetrics().xHeight;else if(e.unit==="em")r=s.fontMetrics().quad;else throw new Me("Invalid unit: '"+e.unit+"'");s!==n&&(r*=s.sizeMultiplier/n.sizeMultiplier)}return Math.min(e.number*r,n.maxSize)},ye=function(e){return+e.toFixed(4)+"em"},Ao=function(e){return e.filter(n=>n).join(" ")},aR=function(e,n,r){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=r||{},n){n.style.isTight()&&this.classes.push("mtight");var s=n.getColor();s&&(this.style.color=s)}},lR=function(e){var n=document.createElement(e);n.className=Ao(this.classes);for(var r in this.style)this.style.hasOwnProperty(r)&&(n.style[r]=this.style[r]);for(var s in this.attributes)this.attributes.hasOwnProperty(s)&&n.setAttribute(s,this.attributes[s]);for(var i=0;i<this.children.length;i++)n.appendChild(this.children[i].toNode());return n},Jve=/[\s"'>/=\x00-\x1f]/,uR=function(e){var n="<"+e;this.classes.length&&(n+=' class="'+Be.escape(Ao(this.classes))+'"');var r="";for(var s in this.style)this.style.hasOwnProperty(s)&&(r+=Be.hyphenate(s)+":"+this.style[s]+";");r&&(n+=' style="'+Be.escape(r)+'"');for(var i in this.attributes)if(this.attributes.hasOwnProperty(i)){if(Jve.test(i))throw new Me("Invalid attribute name '"+i+"'");n+=" "+i+'="'+Be.escape(this.attributes[i])+'"'}n+=">";for(var o=0;o<this.children.length;o++)n+=this.children[o].toMarkup();return n+="</"+e+">",n};class Ym{constructor(e,n,r,s){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,aR.call(this,e,r,s),this.children=n||[]}setAttribute(e,n){this.attributes[e]=n}hasClass(e){return Be.contains(this.classes,e)}toNode(){return lR.call(this,"span")}toMarkup(){return uR.call(this,"span")}}class cR{constructor(e,n,r,s){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,aR.call(this,n,s),this.children=r||[],this.setAttribute("href",e)}setAttribute(e,n){this.attributes[e]=n}hasClass(e){return Be.contains(this.classes,e)}toNode(){return lR.call(this,"a")}toMarkup(){return uR.call(this,"a")}}class Qve{constructor(e,n,r){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=n,this.src=e,this.classes=["mord"],this.style=r}hasClass(e){return Be.contains(this.classes,e)}toNode(){var e=document.createElement("img");e.src=this.src,e.alt=this.alt,e.className="mord";for(var n in this.style)this.style.hasOwnProperty(n)&&(e.style[n]=this.style[n]);return e}toMarkup(){var e='<img src="'+Be.escape(this.src)+'"'+(' alt="'+Be.escape(this.alt)+'"'),n="";for(var r in this.style)this.style.hasOwnProperty(r)&&(n+=Be.hyphenate(r)+":"+this.style[r]+";");return n&&(e+=' style="'+Be.escape(n)+'"'),e+="'/>",e}}var e3e={:"",:"",:"",:""};class ci{constructor(e,n,r,s,i,o,a,l){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=n||0,this.depth=r||0,this.italic=s||0,this.skew=i||0,this.width=o||0,this.classes=a||[],this.style=l||{},this.maxFontSize=0;var u=zve(this.text.charCodeAt(0));u&&this.classes.push(u+"_fallback"),/[]/.test(this.text)&&(this.text=e3e[this.text])}hasClass(e){return Be.contains(this.classes,e)}toNode(){var e=document.createTextNode(this.text),n=null;this.italic>0&&(n=document.createElement("span"),n.style.marginRight=ye(this.italic)),this.classes.length>0&&(n=n||document.createElement("span"),n.className=Ao(this.classes));for(var r in this.style)this.style.hasOwnProperty(r)&&(n=n||document.createElement("span"),n.style[r]=this.style[r]);return n?(n.appendChild(e),n):e}toMarkup(){var e=!1,n="<span";this.classes.length&&(e=!0,n+=' class="',n+=Be.escape(Ao(this.classes)),n+='"');var r="";this.italic>0&&(r+="margin-right:"+this.italic+"em;");for(var s in this.style)this.style.hasOwnProperty(s)&&(r+=Be.hyphenate(s)+":"+this.style[s]+";");r&&(e=!0,n+=' style="'+Be.escape(r)+'"');var i=Be.escape(this.text);return e?(n+=">",n+=i,n+="</span>",n):i}}class Eo{constructor(e,n){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=n||{}}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&n.setAttribute(r,this.attributes[r]);for(var s=0;s<this.children.length;s++)n.appendChild(this.children[s].toNode());return n}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="'+Be.escape(this.attributes[n])+'"');e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</svg>",e}}class Za{constructor(e,n){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=n}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"path");return this.alternate?n.setAttribute("d",this.alternate):n.setAttribute("d",u8[this.pathName]),n}toMarkup(){return this.alternate?'<path d="'+Be.escape(this.alternate)+'"/>':'<path d="'+Be.escape(u8[this.pathName])+'"/>'}}class h8{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"line");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&n.setAttribute(r,this.attributes[r]);return n}toMarkup(){var e="<line";for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="'+Be.escape(this.attributes[n])+'"');return e+="/>",e}}function f8(t){if(t instanceof ci)return t;throw new Error("Expected symbolNode but got "+String(t)+".")}function t3e(t){if(t instanceof Ym)return t;throw new Error("Expected span<HtmlDomNode> but got "+String(t)+".")}var n3e={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},Zt={math:{},text:{}};function k(t,e,n,r,s,i){Zt[t][s]={font:e,group:n,replace:r},i&&r&&(Zt[t][r]=Zt[t][s])}var I="math",ce="text",R="main",W="ams",Dt="accent-token",Ce="bin",pr="close",ju="inner",ze="mathord",hn="op-token",Vr="open",Zm="punct",U="rel",Yi="spacing",X="textord";k(I,R,U,"","\\equiv",!0);k(I,R,U,"","\\prec",!0);k(I,R,U,"","\\succ",!0);k(I,R,U,"","\\sim",!0);k(I,R,U,"","\\perp");k(I,R,U,"","\\preceq",!0);k(I,R,U,"","\\succeq",!0);k(I,R,U,"","\\simeq",!0);k(I,R,U,"","\\mid",!0);k(I,R,U,"","\\ll",!0);k(I,R,U,"","\\gg",!0);k(I,R,U,"","\\asymp",!0);k(I,R,U,"","\\parallel");k(I,R,U,"","\\bowtie",!0);k(I,R,U,"","\\smile",!0);k(I,R,U,"","\\sqsubseteq",!0);k(I,R,U,"","\\sqsupseteq",!0);k(I,R,U,"","\\doteq",!0);k(I,R,U,"","\\frown",!0);k(I,R,U,"","\\ni",!0);k(I,R,U,"","\\propto",!0);k(I,R,U,"","\\vdash",!0);k(I,R,U,"","\\dashv",!0);k(I,R,U,"","\\owns");k(I,R,Zm,".","\\ldotp");k(I,R,Zm,"","\\cdotp");k(I,R,X,"#","\\#");k(ce,R,X,"#","\\#");k(I,R,X,"&","\\&");k(ce,R,X,"&","\\&");k(I,R,X,"","\\aleph",!0);k(I,R,X,"","\\forall",!0);k(I,R,X,"","\\hbar",!0);k(I,R,X,"","\\exists",!0);k(I,R,X,"","\\nabla",!0);k(I,R,X,"","\\flat",!0);k(I,R,X,"","\\ell",!0);k(I,R,X,"","\\natural",!0);k(I,R,X,"","\\clubsuit",!0);k(I,R,X,"","\\wp",!0);k(I,R,X,"","\\sharp",!0);k(I,R,X,"","\\diamondsuit",!0);k(I,R,X,"","\\Re",!0);k(I,R,X,"","\\heartsuit",!0);k(I,R,X,"","\\Im",!0);k(I,R,X,"","\\spadesuit",!0);k(I,R,X,"","\\S",!0);k(ce,R,X,"","\\S");k(I,R,X,"","\\P",!0);k(ce,R,X,"","\\P");k(I,R,X,"","\\dag");k(ce,R,X,"","\\dag");k(ce,R,X,"","\\textdagger");k(I,R,X,"","\\ddag");k(ce,R,X,"","\\ddag");k(ce,R,X,"","\\textdaggerdbl");k(I,R,pr,"","\\rmoustache",!0);k(I,R,Vr,"","\\lmoustache",!0);k(I,R,pr,"","\\rgroup",!0);k(I,R,Vr,"","\\lgroup",!0);k(I,R,Ce,"","\\mp",!0);k(I,R,Ce,"","\\ominus",!0);k(I,R,Ce,"","\\uplus",!0);k(I,R,Ce,"","\\sqcap",!0);k(I,R,Ce,"","\\ast");k(I,R,Ce,"","\\sqcup",!0);k(I,R,Ce,"","\\bigcirc",!0);k(I,R,Ce,"","\\bullet",!0);k(I,R,Ce,"","\\ddagger");k(I,R,Ce,"","\\wr",!0);k(I,R,Ce,"","\\amalg");k(I,R,Ce,"&","\\And");k(I,R,U,"","\\longleftarrow",!0);k(I,R,U,"","\\Leftarrow",!0);k(I,R,U,"","\\Longleftarrow",!0);k(I,R,U,"","\\longrightarrow",!0);k(I,R,U,"","\\Rightarrow",!0);k(I,R,U,"","\\Longrightarrow",!0);k(I,R,U,"","\\leftrightarrow",!0);k(I,R,U,"","\\longleftrightarrow",!0);k(I,R,U,"","\\Leftrightarrow",!0);k(I,R,U,"","\\Longleftrightarrow",!0);k(I,R,U,"","\\mapsto",!0);k(I,R,U,"","\\longmapsto",!0);k(I,R,U,"","\\nearrow",!0);k(I,R,U,"","\\hookleftarrow",!0);k(I,R,U,"","\\hookrightarrow",!0);k(I,R,U,"","\\searrow",!0);k(I,R,U,"","\\leftharpoonup",!0);k(I,R,U,"","\\rightharpoonup",!0);k(I,R,U,"","\\swarrow",!0);k(I,R,U,"","\\leftharpoondown",!0);k(I,R,U,"","\\rightharpoondown",!0);k(I,R,U,"","\\nwarrow",!0);k(I,R,U,"","\\rightleftharpoons",!0);k(I,W,U,"","\\nless",!0);k(I,W,U,"","\\@nleqslant");k(I,W,U,"","\\@nleqq");k(I,W,U,"","\\lneq",!0);k(I,W,U,"","\\lneqq",!0);k(I,W,U,"","\\@lvertneqq");k(I,W,U,"","\\lnsim",!0);k(I,W,U,"","\\lnapprox",!0);k(I,W,U,"","\\nprec",!0);k(I,W,U,"","\\npreceq",!0);k(I,W,U,"","\\precnsim",!0);k(I,W,U,"","\\precnapprox",!0);k(I,W,U,"","\\nsim",!0);k(I,W,U,"","\\@nshortmid");k(I,W,U,"","\\nmid",!0);k(I,W,U,"","\\nvdash",!0);k(I,W,U,"","\\nvDash",!0);k(I,W,U,"","\\ntriangleleft");k(I,W,U,"","\\ntrianglelefteq",!0);k(I,W,U,"","\\subsetneq",!0);k(I,W,U,"","\\@varsubsetneq");k(I,W,U,"","\\subsetneqq",!0);k(I,W,U,"","\\@varsubsetneqq");k(I,W,U,"","\\ngtr",!0);k(I,W,U,"","\\@ngeqslant");k(I,W,U,"","\\@ngeqq");k(I,W,U,"","\\gneq",!0);k(I,W,U,"","\\gneqq",!0);k(I,W,U,"","\\@gvertneqq");k(I,W,U,"","\\gnsim",!0);k(I,W,U,"","\\gnapprox",!0);k(I,W,U,"","\\nsucc",!0);k(I,W,U,"","\\nsucceq",!0);k(I,W,U,"","\\succnsim",!0);k(I,W,U,"","\\succnapprox",!0);k(I,W,U,"","\\ncong",!0);k(I,W,U,"","\\@nshortparallel");k(I,W,U,"","\\nparallel",!0);k(I,W,U,"","\\nVDash",!0);k(I,W,U,"","\\ntriangleright");k(I,W,U,"","\\ntrianglerighteq",!0);k(I,W,U,"","\\@nsupseteqq");k(I,W,U,"","\\supsetneq",!0);k(I,W,U,"","\\@varsupsetneq");k(I,W,U,"","\\supsetneqq",!0);k(I,W,U,"","\\@varsupsetneqq");k(I,W,U,"","\\nVdash",!0);k(I,W,U,"","\\precneqq",!0);k(I,W,U,"","\\succneqq",!0);k(I,W,U,"","\\@nsubseteqq");k(I,W,Ce,"","\\unlhd");k(I,W,Ce,"","\\unrhd");k(I,W,U,"","\\nleftarrow",!0);k(I,W,U,"","\\nrightarrow",!0);k(I,W,U,"","\\nLeftarrow",!0);k(I,W,U,"","\\nRightarrow",!0);k(I,W,U,"","\\nleftrightarrow",!0);k(I,W,U,"","\\nLeftrightarrow",!0);k(I,W,U,"","\\vartriangle");k(I,W,X,"","\\hslash");k(I,W,X,"","\\triangledown");k(I,W,X,"","\\lozenge");k(I,W,X,"","\\circledS");k(I,W,X,"","\\circledR");k(ce,W,X,"","\\circledR");k(I,W,X,"","\\measuredangle",!0);k(I,W,X,"","\\nexists");k(I,W,X,"","\\mho");k(I,W,X,"","\\Finv",!0);k(I,W,X,"","\\Game",!0);k(I,W,X,"","\\backprime");k(I,W,X,"","\\blacktriangle");k(I,W,X,"","\\blacktriangledown");k(I,W,X,"","\\blacksquare");k(I,W,X,"","\\blacklozenge");k(I,W,X,"","\\bigstar");k(I,W,X,"","\\sphericalangle",!0);k(I,W,X,"","\\complement",!0);k(I,W,X,"","\\eth",!0);k(ce,R,X,"","");k(I,W,X,"","\\diagup");k(I,W,X,"","\\diagdown");k(I,W,X,"","\\square");k(I,W,X,"","\\Box");k(I,W,X,"","\\Diamond");k(I,W,X,"","\\yen",!0);k(ce,W,X,"","\\yen",!0);k(I,W,X,"","\\checkmark",!0);k(ce,W,X,"","\\checkmark");k(I,W,X,"","\\beth",!0);k(I,W,X,"","\\daleth",!0);k(I,W,X,"","\\gimel",!0);k(I,W,X,"","\\digamma",!0);k(I,W,X,"","\\varkappa");k(I,W,Vr,"","\\@ulcorner",!0);k(I,W,pr,"","\\@urcorner",!0);k(I,W,Vr,"","\\@llcorner",!0);k(I,W,pr,"","\\@lrcorner",!0);k(I,W,U,"","\\leqq",!0);k(I,W,U,"","\\leqslant",!0);k(I,W,U,"","\\eqslantless",!0);k(I,W,U,"","\\lesssim",!0);k(I,W,U,"","\\lessapprox",!0);k(I,W,U,"","\\approxeq",!0);k(I,W,Ce,"","\\lessdot");k(I,W,U,"","\\lll",!0);k(I,W,U,"","\\lessgtr",!0);k(I,W,U,"","\\lesseqgtr",!0);k(I,W,U,"","\\lesseqqgtr",!0);k(I,W,U,"","\\doteqdot");k(I,W,U,"","\\risingdotseq",!0);k(I,W,U,"","\\fallingdotseq",!0);k(I,W,U,"","\\backsim",!0);k(I,W,U,"","\\backsimeq",!0);k(I,W,U,"","\\subseteqq",!0);k(I,W,U,"","\\Subset",!0);k(I,W,U,"","\\sqsubset",!0);k(I,W,U,"","\\preccurlyeq",!0);k(I,W,U,"","\\curlyeqprec",!0);k(I,W,U,"","\\precsim",!0);k(I,W,U,"","\\precapprox",!0);k(I,W,U,"","\\vartriangleleft");k(I,W,U,"","\\trianglelefteq");k(I,W,U,"","\\vDash",!0);k(I,W,U,"","\\Vvdash",!0);k(I,W,U,"","\\smallsmile");k(I,W,U,"","\\smallfrown");k(I,W,U,"","\\bumpeq",!0);k(I,W,U,"","\\Bumpeq",!0);k(I,W,U,"","\\geqq",!0);k(I,W,U,"","\\geqslant",!0);k(I,W,U,"","\\eqslantgtr",!0);k(I,W,U,"","\\gtrsim",!0);k(I,W,U,"","\\gtrapprox",!0);k(I,W,Ce,"","\\gtrdot");k(I,W,U,"","\\ggg",!0);k(I,W,U,"","\\gtrless",!0);k(I,W,U,"","\\gtreqless",!0);k(I,W,U,"","\\gtreqqless",!0);k(I,W,U,"","\\eqcirc",!0);k(I,W,U,"","\\circeq",!0);k(I,W,U,"","\\triangleq",!0);k(I,W,U,"","\\thicksim");k(I,W,U,"","\\thickapprox");k(I,W,U,"","\\supseteqq",!0);k(I,W,U,"","\\Supset",!0);k(I,W,U,"","\\sqsupset",!0);k(I,W,U,"","\\succcurlyeq",!0);k(I,W,U,"","\\curlyeqsucc",!0);k(I,W,U,"","\\succsim",!0);k(I,W,U,"","\\succapprox",!0);k(I,W,U,"","\\vartriangleright");k(I,W,U,"","\\trianglerighteq");k(I,W,U,"","\\Vdash",!0);k(I,W,U,"","\\shortmid");k(I,W,U,"","\\shortparallel");k(I,W,U,"","\\between",!0);k(I,W,U,"","\\pitchfork",!0);k(I,W,U,"","\\varpropto");k(I,W,U,"","\\blacktriangleleft");k(I,W,U,"","\\therefore",!0);k(I,W,U,"","\\backepsilon");k(I,W,U,"","\\blacktriangleright");k(I,W,U,"","\\because",!0);k(I,W,U,"","\\llless");k(I,W,U,"","\\gggtr");k(I,W,Ce,"","\\lhd");k(I,W,Ce,"","\\rhd");k(I,W,U,"","\\eqsim",!0);k(I,R,U,"","\\Join");k(I,W,U,"","\\Doteq",!0);k(I,W,Ce,"","\\dotplus",!0);k(I,W,Ce,"","\\smallsetminus");k(I,W,Ce,"","\\Cap",!0);k(I,W,Ce,"","\\Cup",!0);k(I,W,Ce,"","\\doublebarwedge",!0);k(I,W,Ce,"","\\boxminus",!0);k(I,W,Ce,"","\\boxplus",!0);k(I,W,Ce,"","\\divideontimes",!0);k(I,W,Ce,"","\\ltimes",!0);k(I,W,Ce,"","\\rtimes",!0);k(I,W,Ce,"","\\leftthreetimes",!0);k(I,W,Ce,"","\\rightthreetimes",!0);k(I,W,Ce,"","\\curlywedge",!0);k(I,W,Ce,"","\\curlyvee",!0);k(I,W,Ce,"","\\circleddash",!0);k(I,W,Ce,"","\\circledast",!0);k(I,W,Ce,"","\\centerdot");k(I,W,Ce,"","\\intercal",!0);k(I,W,Ce,"","\\doublecap");k(I,W,Ce,"","\\doublecup");k(I,W,Ce,"","\\boxtimes",!0);k(I,W,U,"","\\dashrightarrow",!0);k(I,W,U,"","\\dashleftarrow",!0);k(I,W,U,"","\\leftleftarrows",!0);k(I,W,U,"","\\leftrightarrows",!0);k(I,W,U,"","\\Lleftarrow",!0);k(I,W,U,"","\\twoheadleftarrow",!0);k(I,W,U,"","\\leftarrowtail",!0);k(I,W,U,"","\\looparrowleft",!0);k(I,W,U,"","\\leftrightharpoons",!0);k(I,W,U,"","\\curvearrowleft",!0);k(I,W,U,"","\\circlearrowleft",!0);k(I,W,U,"","\\Lsh",!0);k(I,W,U,"","\\upuparrows",!0);k(I,W,U,"","\\upharpoonleft",!0);k(I,W,U,"","\\downharpoonleft",!0);k(I,R,U,"","\\origof",!0);k(I,R,U,"","\\imageof",!0);k(I,W,U,"","\\multimap",!0);k(I,W,U,"","\\leftrightsquigarrow",!0);k(I,W,U,"","\\rightrightarrows",!0);k(I,W,U,"","\\rightleftarrows",!0);k(I,W,U,"","\\twoheadrightarrow",!0);k(I,W,U,"","\\rightarrowtail",!0);k(I,W,U,"","\\looparrowright",!0);k(I,W,U,"","\\curvearrowright",!0);k(I,W,U,"","\\circlearrowright",!0);k(I,W,U,"","\\Rsh",!0);k(I,W,U,"","\\downdownarrows",!0);k(I,W,U,"","\\upharpoonright",!0);k(I,W,U,"","\\downharpoonright",!0);k(I,W,U,"","\\rightsquigarrow",!0);k(I,W,U,"","\\leadsto");k(I,W,U,"","\\Rrightarrow",!0);k(I,W,U,"","\\restriction");k(I,R,X,"","`");k(I,R,X,"$","\\$");k(ce,R,X,"$","\\$");k(ce,R,X,"$","\\textdollar");k(I,R,X,"%","\\%");k(ce,R,X,"%","\\%");k(I,R,X,"_","\\_");k(ce,R,X,"_","\\_");k(ce,R,X,"_","\\textunderscore");k(I,R,X,"","\\angle",!0);k(I,R,X,"","\\infty",!0);k(I,R,X,"","\\prime");k(I,R,X,"","\\triangle");k(I,R,X,"","\\Gamma",!0);k(I,R,X,"","\\Delta",!0);k(I,R,X,"","\\Theta",!0);k(I,R,X,"","\\Lambda",!0);k(I,R,X,"","\\Xi",!0);k(I,R,X,"","\\Pi",!0);k(I,R,X,"","\\Sigma",!0);k(I,R,X,"","\\Upsilon",!0);k(I,R,X,"","\\Phi",!0);k(I,R,X,"","\\Psi",!0);k(I,R,X,"","\\Omega",!0);k(I,R,X,"A","");k(I,R,X,"B","");k(I,R,X,"E","");k(I,R,X,"Z","");k(I,R,X,"H","");k(I,R,X,"I","");k(I,R,X,"K","");k(I,R,X,"M","");k(I,R,X,"N","");k(I,R,X,"O","");k(I,R,X,"P","");k(I,R,X,"T","");k(I,R,X,"X","");k(I,R,X,"","\\neg",!0);k(I,R,X,"","\\lnot");k(I,R,X,"","\\top");k(I,R,X,"","\\bot");k(I,R,X,"","\\emptyset");k(I,W,X,"","\\varnothing");k(I,R,ze,"","\\alpha",!0);k(I,R,ze,"","\\beta",!0);k(I,R,ze,"","\\gamma",!0);k(I,R,ze,"","\\delta",!0);k(I,R,ze,"","\\epsilon",!0);k(I,R,ze,"","\\zeta",!0);k(I,R,ze,"","\\eta",!0);k(I,R,ze,"","\\theta",!0);k(I,R,ze,"","\\iota",!0);k(I,R,ze,"","\\kappa",!0);k(I,R,ze,"","\\lambda",!0);k(I,R,ze,"","\\mu",!0);k(I,R,ze,"","\\nu",!0);k(I,R,ze,"","\\xi",!0);k(I,R,ze,"","\\omicron",!0);k(I,R,ze,"","\\pi",!0);k(I,R,ze,"","\\rho",!0);k(I,R,ze,"","\\sigma",!0);k(I,R,ze,"","\\tau",!0);k(I,R,ze,"","\\upsilon",!0);k(I,R,ze,"","\\phi",!0);k(I,R,ze,"","\\chi",!0);k(I,R,ze,"","\\psi",!0);k(I,R,ze,"","\\omega",!0);k(I,R,ze,"","\\varepsilon",!0);k(I,R,ze,"","\\vartheta",!0);k(I,R,ze,"","\\varpi",!0);k(I,R,ze,"","\\varrho",!0);k(I,R,ze,"","\\varsigma",!0);k(I,R,ze,"","\\varphi",!0);k(I,R,Ce,"","*",!0);k(I,R,Ce,"+","+");k(I,R,Ce,"","-",!0);k(I,R,Ce,"","\\cdot",!0);k(I,R,Ce,"","\\circ",!0);k(I,R,Ce,"","\\div",!0);k(I,R,Ce,"","\\pm",!0);k(I,R,Ce,"","\\times",!0);k(I,R,Ce,"","\\cap",!0);k(I,R,Ce,"","\\cup",!0);k(I,R,Ce,"","\\setminus",!0);k(I,R,Ce,"","\\land");k(I,R,Ce,"","\\lor");k(I,R,Ce,"","\\wedge",!0);k(I,R,Ce,"","\\vee",!0);k(I,R,X,"","\\surd");k(I,R,Vr,"","\\langle",!0);k(I,R,Vr,"","\\lvert");k(I,R,Vr,"","\\lVert");k(I,R,pr,"?","?");k(I,R,pr,"!","!");k(I,R,pr,"","\\rangle",!0);k(I,R,pr,"","\\rvert");k(I,R,pr,"","\\rVert");k(I,R,U,"=","=");k(I,R,U,":",":");k(I,R,U,"","\\approx",!0);k(I,R,U,"","\\cong",!0);k(I,R,U,"","\\ge");k(I,R,U,"","\\geq",!0);k(I,R,U,"","\\gets");k(I,R,U,">","\\gt",!0);k(I,R,U,"","\\in",!0);k(I,R,U,"","\\@not");k(I,R,U,"","\\subset",!0);k(I,R,U,"","\\supset",!0);k(I,R,U,"","\\subseteq",!0);k(I,R,U,"","\\supseteq",!0);k(I,W,U,"","\\nsubseteq",!0);k(I,W,U,"","\\nsupseteq",!0);k(I,R,U,"","\\models");k(I,R,U,"","\\leftarrow",!0);k(I,R,U,"","\\le");k(I,R,U,"","\\leq",!0);k(I,R,U,"<","\\lt",!0);k(I,R,U,"","\\rightarrow",!0);k(I,R,U,"","\\to");k(I,W,U,"","\\ngeq",!0);k(I,W,U,"","\\nleq",!0);k(I,R,Yi,"","\\ ");k(I,R,Yi,"","\\space");k(I,R,Yi,"","\\nobreakspace");k(ce,R,Yi,"","\\ ");k(ce,R,Yi,""," ");k(ce,R,Yi,"","\\space");k(ce,R,Yi,"","\\nobreakspace");k(I,R,Yi,null,"\\nobreak");k(I,R,Yi,null,"\\allowbreak");k(I,R,Zm,",",",");k(I,R,Zm,";",";");k(I,W,Ce,"","\\barwedge",!0);k(I,W,Ce,"","\\veebar",!0);k(I,R,Ce,"","\\odot",!0);k(I,R,Ce,"","\\oplus",!0);k(I,R,Ce,"","\\otimes",!0);k(I,R,X,"","\\partial",!0);k(I,R,Ce,"","\\oslash",!0);k(I,W,Ce,"","\\circledcirc",!0);k(I,W,Ce,"","\\boxdot",!0);k(I,R,Ce,"","\\bigtriangleup");k(I,R,Ce,"","\\bigtriangledown");k(I,R,Ce,"","\\dagger");k(I,R,Ce,"","\\diamond");k(I,R,Ce,"","\\star");k(I,R,Ce,"","\\triangleleft");k(I,R,Ce,"","\\triangleright");k(I,R,Vr,"{","\\{");k(ce,R,X,"{","\\{");k(ce,R,X,"{","\\textbraceleft");k(I,R,pr,"}","\\}");k(ce,R,X,"}","\\}");k(ce,R,X,"}","\\textbraceright");k(I,R,Vr,"{","\\lbrace");k(I,R,pr,"}","\\rbrace");k(I,R,Vr,"[","\\lbrack",!0);k(ce,R,X,"[","\\lbrack",!0);k(I,R,pr,"]","\\rbrack",!0);k(ce,R,X,"]","\\rbrack",!0);k(I,R,Vr,"(","\\lparen",!0);k(I,R,pr,")","\\rparen",!0);k(ce,R,X,"<","\\textless",!0);k(ce,R,X,">","\\textgreater",!0);k(I,R,Vr,"","\\lfloor",!0);k(I,R,pr,"","\\rfloor",!0);k(I,R,Vr,"","\\lceil",!0);k(I,R,pr,"","\\rceil",!0);k(I,R,X,"\\","\\backslash");k(I,R,X,"","|");k(I,R,X,"","\\vert");k(ce,R,X,"|","\\textbar",!0);k(I,R,X,"","\\|");k(I,R,X,"","\\Vert");k(ce,R,X,"","\\textbardbl");k(ce,R,X,"~","\\textasciitilde");k(ce,R,X,"\\","\\textbackslash");k(ce,R,X,"^","\\textasciicircum");k(I,R,U,"","\\uparrow",!0);k(I,R,U,"","\\Uparrow",!0);k(I,R,U,"","\\downarrow",!0);k(I,R,U,"","\\Downarrow",!0);k(I,R,U,"","\\updownarrow",!0);k(I,R,U,"","\\Updownarrow",!0);k(I,R,hn,"","\\coprod");k(I,R,hn,"","\\bigvee");k(I,R,hn,"","\\bigwedge");k(I,R,hn,"","\\biguplus");k(I,R,hn,"","\\bigcap");k(I,R,hn,"","\\bigcup");k(I,R,hn,"","\\int");k(I,R,hn,"","\\intop");k(I,R,hn,"","\\iint");k(I,R,hn,"","\\iiint");k(I,R,hn,"","\\prod");k(I,R,hn,"","\\sum");k(I,R,hn,"","\\bigotimes");k(I,R,hn,"","\\bigoplus");k(I,R,hn,"","\\bigodot");k(I,R,hn,"","\\oint");k(I,R,hn,"","\\oiint");k(I,R,hn,"","\\oiiint");k(I,R,hn,"","\\bigsqcup");k(I,R,hn,"","\\smallint");k(ce,R,ju,"","\\textellipsis");k(I,R,ju,"","\\mathellipsis");k(ce,R,ju,"","\\ldots",!0);k(I,R,ju,"","\\ldots",!0);k(I,R,ju,"","\\@cdots",!0);k(I,R,ju,"","\\ddots",!0);k(I,R,X,"","\\varvdots");k(ce,R,X,"","\\varvdots");k(I,R,Dt,"","\\acute");k(I,R,Dt,"","\\grave");k(I,R,Dt,"","\\ddot");k(I,R,Dt,"~","\\tilde");k(I,R,Dt,"","\\bar");k(I,R,Dt,"","\\breve");k(I,R,Dt,"","\\check");k(I,R,Dt,"^","\\hat");k(I,R,Dt,"","\\vec");k(I,R,Dt,"","\\dot");k(I,R,Dt,"","\\mathring");k(I,R,ze,"","\\@imath");k(I,R,ze,"","\\@jmath");k(I,R,X,"","");k(I,R,X,"","");k(ce,R,X,"","\\i",!0);k(ce,R,X,"","\\j",!0);k(ce,R,X,"","\\ss",!0);k(ce,R,X,"","\\ae",!0);k(ce,R,X,"","\\oe",!0);k(ce,R,X,"","\\o",!0);k(ce,R,X,"","\\AE",!0);k(ce,R,X,"","\\OE",!0);k(ce,R,X,"","\\O",!0);k(ce,R,Dt,"","\\'");k(ce,R,Dt,"","\\`");k(ce,R,Dt,"","\\^");k(ce,R,Dt,"","\\~");k(ce,R,Dt,"","\\=");k(ce,R,Dt,"","\\u");k(ce,R,Dt,"","\\.");k(ce,R,Dt,"","\\c");k(ce,R,Dt,"","\\r");k(ce,R,Dt,"","\\v");k(ce,R,Dt,"",'\\"');k(ce,R,Dt,"","\\H");k(ce,R,Dt,"","\\textcircled");var hR={"--":!0,"---":!0,"``":!0,"''":!0};k(ce,R,X,"","--",!0);k(ce,R,X,"","\\textendash");k(ce,R,X,"","---",!0);k(ce,R,X,"","\\textemdash");k(ce,R,X,"","`",!0);k(ce,R,X,"","\\textquoteleft");k(ce,R,X,"","'",!0);k(ce,R,X,"","\\textquoteright");k(ce,R,X,"","``",!0);k(ce,R,X,"","\\textquotedblleft");k(ce,R,X,"","''",!0);k(ce,R,X,"","\\textquotedblright");k(I,R,X,"","\\degree",!0);k(ce,R,X,"","\\degree");k(ce,R,X,"","\\textdegree",!0);k(I,R,X,"","\\pounds");k(I,R,X,"","\\mathsterling",!0);k(ce,R,X,"","\\pounds");k(ce,R,X,"","\\textsterling",!0);k(I,W,X,"","\\maltese");k(ce,W,X,"","\\maltese");var d8='0123456789/@."';for(var m2=0;m2<d8.length;m2++){var p8=d8.charAt(m2);k(I,R,X,p8,p8)}var m8='0123456789!@*()-=+";:?/.,';for(var g2=0;g2<m8.length;g2++){var g8=m8.charAt(g2);k(ce,R,X,g8,g8)}var Ip="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var b2=0;b2<Ip.length;b2++){var Df=Ip.charAt(b2);k(I,R,ze,Df,Df),k(ce,R,X,Df,Df)}k(I,W,X,"C","");k(ce,W,X,"C","");k(I,W,X,"H","");k(ce,W,X,"H","");k(I,W,X,"N","");k(ce,W,X,"N","");k(I,W,X,"P","");k(ce,W,X,"P","");k(I,W,X,"Q","");k(ce,W,X,"Q","");k(I,W,X,"R","");k(ce,W,X,"R","");k(I,W,X,"Z","");k(ce,W,X,"Z","");k(I,R,ze,"h","");k(ce,R,ze,"h","");var Ge="";for(var jn=0;jn<Ip.length;jn++){var Pt=Ip.charAt(jn);Ge=String.fromCharCode(55349,56320+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge),Ge=String.fromCharCode(55349,56372+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge),Ge=String.fromCharCode(55349,56424+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge),Ge=String.fromCharCode(55349,56580+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge),Ge=String.fromCharCode(55349,56684+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge),Ge=String.fromCharCode(55349,56736+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge),Ge=String.fromCharCode(55349,56788+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge),Ge=String.fromCharCode(55349,56840+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge),Ge=String.fromCharCode(55349,56944+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge),jn<26&&(Ge=String.fromCharCode(55349,56632+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge),Ge=String.fromCharCode(55349,56476+jn),k(I,R,ze,Pt,Ge),k(ce,R,X,Pt,Ge))}Ge="";k(I,R,ze,"k",Ge);k(ce,R,X,"k",Ge);for(var ta=0;ta<10;ta++){var no=ta.toString();Ge=String.fromCharCode(55349,57294+ta),k(I,R,ze,no,Ge),k(ce,R,X,no,Ge),Ge=String.fromCharCode(55349,57314+ta),k(I,R,ze,no,Ge),k(ce,R,X,no,Ge),Ge=String.fromCharCode(55349,57324+ta),k(I,R,ze,no,Ge),k(ce,R,X,no,Ge),Ge=String.fromCharCode(55349,57334+ta),k(I,R,ze,no,Ge),k(ce,R,X,no,Ge)}var b8="";for(var x2=0;x2<b8.length;x2++){var Mf=b8.charAt(x2);k(I,R,ze,Mf,Mf),k(ce,R,X,Mf,Mf)}var Ff=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],x8=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],r3e=function(e,n){var r=e.charCodeAt(0),s=e.charCodeAt(1),i=(r-55296)*1024+(s-56320)+65536,o=n==="math"?0:1;if(119808<=i&&i<120484){var a=Math.floor((i-119808)/26);return[Ff[a][2],Ff[a][o]]}else if(120782<=i&&i<=120831){var l=Math.floor((i-120782)/10);return[x8[l][2],x8[l][o]]}else{if(i===120485||i===120486)return[Ff[0][2],Ff[0][o]];if(120486<i&&i<120782)return["",""];throw new Me("Unsupported character: "+e)}},Jm=function(e,n,r){return Zt[r][e]&&Zt[r][e].replace&&(e=Zt[r][e].replace),{value:e,metrics:M3(e,n,r)}},gs=function(e,n,r,s,i){var o=Jm(e,n,r),a=o.metrics;e=o.value;var l;if(a){var u=a.italic;(r==="text"||s&&s.font==="mathit")&&(u=0),l=new ci(e,a.height,a.depth,u,a.skew,a.width,i)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+e+"' in style '"+n+"' and mode '"+r+"'")),l=new ci(e,0,0,0,0,0,i);if(s){l.maxFontSize=s.sizeMultiplier,s.style.isTight()&&l.classes.push("mtight");var c=s.getColor();c&&(l.style.color=c)}return l},s3e=function(e,n,r,s){return s===void 0&&(s=[]),r.font==="boldsymbol"&&Jm(e,"Main-Bold",n).metrics?gs(e,"Main-Bold",n,r,s.concat(["mathbf"])):e==="\\"||Zt[n][e].font==="main"?gs(e,"Main-Regular",n,r,s):gs(e,"AMS-Regular",n,r,s.concat(["amsrm"]))},i3e=function(e,n,r,s,i){return i!=="textord"&&Jm(e,"Math-BoldItalic",n).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},o3e=function(e,n,r){var s=e.mode,i=e.text,o=["mord"],a=s==="math"||s==="text"&&n.font,l=a?n.font:n.fontFamily,u="",c="";if(i.charCodeAt(0)===55349&&([u,c]=r3e(i,s)),u.length>0)return gs(i,u,s,n,o.concat(c));if(l){var h,f;if(l==="boldsymbol"){var d=i3e(i,s,n,o,r);h=d.fontName,f=[d.fontClass]}else a?(h=pR[l].fontName,f=[l]):(h=Of(l,n.fontWeight,n.fontShape),f=[l,n.fontWeight,n.fontShape]);if(Jm(i,h,s).metrics)return gs(i,h,s,n,o.concat(f));if(hR.hasOwnProperty(i)&&h.slice(0,10)==="Typewriter"){for(var p=[],g=0;g<i.length;g++)p.push(gs(i[g],h,s,n,o.concat(f)));return dR(p)}}if(r==="mathord")return gs(i,"Math-Italic",s,n,o.concat(["mathnormal"]));if(r==="textord"){var m=Zt[s][i]&&Zt[s][i].font;if(m==="ams"){var b=Of("amsrm",n.fontWeight,n.fontShape);return gs(i,b,s,n,o.concat("amsrm",n.fontWeight,n.fontShape))}else if(m==="main"||!m){var x=Of("textrm",n.fontWeight,n.fontShape);return gs(i,x,s,n,o.concat(n.fontWeight,n.fontShape))}else{var v=Of(m,n.fontWeight,n.fontShape);return gs(i,v,s,n,o.concat(v,n.fontWeight,n.fontShape))}}else throw new Error("unexpected type: "+r+" in makeOrd")},a3e=(t,e)=>{if(Ao(t.classes)!==Ao(e.classes)||t.skew!==e.skew||t.maxFontSize!==e.maxFontSize)return!1;if(t.classes.length===1){var n=t.classes[0];if(n==="mbin"||n==="mord")return!1}for(var r in t.style)if(t.style.hasOwnProperty(r)&&t.style[r]!==e.style[r])return!1;for(var s in e.style)if(e.style.hasOwnProperty(s)&&t.style[s]!==e.style[s])return!1;return!0},l3e=t=>{for(var e=0;e<t.length-1;e++){var n=t[e],r=t[e+1];n instanceof ci&&r instanceof ci&&a3e(n,r)&&(n.text+=r.text,n.height=Math.max(n.height,r.height),n.depth=Math.max(n.depth,r.depth),n.italic=r.italic,t.splice(e+1,1),e--)}return t},F3=function(e){for(var n=0,r=0,s=0,i=0;i<e.children.length;i++){var o=e.children[i];o.height>n&&(n=o.height),o.depth>r&&(r=o.depth),o.maxFontSize>s&&(s=o.maxFontSize)}e.height=n,e.depth=r,e.maxFontSize=s},xr=function(e,n,r,s){var i=new Ym(e,n,r,s);return F3(i),i},fR=(t,e,n,r)=>new Ym(t,e,n,r),u3e=function(e,n,r){var s=xr([e],[],n);return s.height=Math.max(r||n.fontMetrics().defaultRuleThickness,n.minRuleThickness),s.style.borderBottomWidth=ye(s.height),s.maxFontSize=1,s},c3e=function(e,n,r,s){var i=new cR(e,n,r,s);return F3(i),i},dR=function(e){var n=new q0(e);return F3(n),n},h3e=function(e,n){return e instanceof q0?xr([],[e],n):e},f3e=function(e){if(e.positionType==="individualShift"){for(var n=e.children,r=[n[0]],s=-n[0].shift-n[0].elem.depth,i=s,o=1;o<n.length;o++){var a=-n[o].shift-i-n[o].elem.depth,l=a-(n[o-1].elem.height+n[o-1].elem.depth);i=i+a,r.push({type:"kern",size:l}),r.push(n[o])}return{children:r,depth:s}}var u;if(e.positionType==="top"){for(var c=e.positionData,h=0;h<e.children.length;h++){var f=e.children[h];c-=f.type==="kern"?f.size:f.elem.height+f.elem.depth}u=c}else if(e.positionType==="bottom")u=-e.positionData;else{var d=e.children[0];if(d.type!=="elem")throw new Error('First child must have type "elem".');if(e.positionType==="shift")u=-d.elem.depth-e.positionData;else if(e.positionType==="firstBaseline")u=-d.elem.depth;else throw new Error("Invalid positionType "+e.positionType+".")}return{children:e.children,depth:u}},d3e=function(e,n){for(var{children:r,depth:s}=f3e(e),i=0,o=0;o<r.length;o++){var a=r[o];if(a.type==="elem"){var l=a.elem;i=Math.max(i,l.maxFontSize,l.height)}}i+=2;var u=xr(["pstrut"],[]);u.style.height=ye(i);for(var c=[],h=s,f=s,d=s,p=0;p<r.length;p++){var g=r[p];if(g.type==="kern")d+=g.size;else{var m=g.elem,b=g.wrapperClasses||[],x=g.wrapperStyle||{},v=xr(b,[u,m],void 0,x);v.style.top=ye(-i-d-m.depth),g.marginLeft&&(v.style.marginLeft=g.marginLeft),g.marginRight&&(v.style.marginRight=g.marginRight),c.push(v),d+=m.height+m.depth}h=Math.min(h,d),f=Math.max(f,d)}var y=xr(["vlist"],c);y.style.height=ye(f);var w;if(h<0){var C=xr([],[]),T=xr(["vlist"],[C]);T.style.height=ye(-h);var N=xr(["vlist-s"],[new ci("")]);w=[xr(["vlist-r"],[y,N]),xr(["vlist-r"],[T])]}else w=[xr(["vlist-r"],[y])];var $=xr(["vlist-t"],w);return w.length===2&&$.classes.push("vlist-t2"),$.height=f,$.depth=-h,$},p3e=(t,e)=>{var n=xr(["mspace"],[],e),r=Ot(t,e);return n.style.marginRight=ye(r),n},Of=function(e,n,r){var s="";switch(e){case"amsrm":s="AMS";break;case"textrm":s="Main";break;case"textsf":s="SansSerif";break;case"texttt":s="Typewriter";break;default:s=e}var i;return n==="textbf"&&r==="textit"?i="BoldItalic":n==="textbf"?i="Bold":n==="textit"?i="Italic":i="Regular",s+"-"+i},pR={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},mR={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},m3e=function(e,n){var[r,s,i]=mR[e],o=new Za(r),a=new Eo([o],{width:ye(s),height:ye(i),style:"width:"+ye(s),viewBox:"0 0 "+1e3*s+" "+1e3*i,preserveAspectRatio:"xMinYMin"}),l=fR(["overlay"],[a],n);return l.height=i,l.style.height=ye(i),l.style.width=ye(s),l},te={fontMap:pR,makeSymbol:gs,mathsym:s3e,makeSpan:xr,makeSvgSpan:fR,makeLineSpan:u3e,makeAnchor:c3e,makeFragment:dR,wrapFragment:h3e,makeVList:d3e,makeOrd:o3e,makeGlue:p3e,staticSvg:m3e,svgData:mR,tryCombineChars:l3e},Mt={number:3,unit:"mu"},na={number:4,unit:"mu"},wi={number:5,unit:"mu"},g3e={mord:{mop:Mt,mbin:na,mrel:wi,minner:Mt},mop:{mord:Mt,mop:Mt,mrel:wi,minner:Mt},mbin:{mord:na,mop:na,mopen:na,minner:na},mrel:{mord:wi,mop:wi,mopen:wi,minner:wi},mopen:{},mclose:{mop:Mt,mbin:na,mrel:wi,minner:Mt},mpunct:{mord:Mt,mop:Mt,mrel:wi,mopen:Mt,mclose:Mt,mpunct:Mt,minner:Mt},minner:{mord:Mt,mop:Mt,mbin:na,mrel:wi,mopen:Mt,mpunct:Mt,minner:Mt}},b3e={mord:{mop:Mt},mop:{mord:Mt,mop:Mt},mbin:{},mrel:{},mopen:{},mclose:{mop:Mt},mpunct:{},minner:{mop:Mt}},gR={},Tp={},Np={};function Se(t){for(var{type:e,names:n,props:r,handler:s,htmlBuilder:i,mathmlBuilder:o}=t,a={type:e,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:r.allowedInMath===void 0?!0:r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:s},l=0;l<n.length;++l)gR[n[l]]=a;e&&(i&&(Tp[e]=i),o&&(Np[e]=o))}function gl(t){var{type:e,htmlBuilder:n,mathmlBuilder:r}=t;Se({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:n,mathmlBuilder:r})}var _p=function(e){return e.type==="ordgroup"&&e.body.length===1?e.body[0]:e},Yt=function(e){return e.type==="ordgroup"?e.body:[e]},Iu=te.makeSpan,x3e=["leftmost","mbin","mopen","mrel","mop","mpunct"],y3e=["rightmost","mrel","mclose","mpunct"],v3e={display:Ve.DISPLAY,text:Ve.TEXT,script:Ve.SCRIPT,scriptscript:Ve.SCRIPTSCRIPT},w3e={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},En=function(e,n,r,s){s===void 0&&(s=[null,null]);for(var i=[],o=0;o<e.length;o++){var a=ct(e[o],n);if(a instanceof q0){var l=a.children;i.push(...l)}else i.push(a)}if(te.tryCombineChars(i),!r)return i;var u=n;if(e.length===1){var c=e[0];c.type==="sizing"?u=n.havingSize(c.size):c.type==="styling"&&(u=n.havingStyle(v3e[c.style]))}var h=Iu([s[0]||"leftmost"],[],n),f=Iu([s[1]||"rightmost"],[],n),d=r==="root";return y8(i,(p,g)=>{var m=g.classes[0],b=p.classes[0];m==="mbin"&&Be.contains(y3e,b)?g.classes[0]="mord":b==="mbin"&&Be.contains(x3e,m)&&(p.classes[0]="mord")},{node:h},f,d),y8(i,(p,g)=>{var m=m4(g),b=m4(p),x=m&&b?p.hasClass("mtight")?b3e[m][b]:g3e[m][b]:null;if(x)return te.makeGlue(x,u)},{node:h},f,d),i},y8=function t(e,n,r,s,i){s&&e.push(s);for(var o=0;o<e.length;o++){var a=e[o],l=bR(a);if(l){t(l.children,n,r,null,i);continue}var u=!a.hasClass("mspace");if(u){var c=n(a,r.node);c&&(r.insertAfter?r.insertAfter(c):(e.unshift(c),o++))}u?r.node=a:i&&a.hasClass("newline")&&(r.node=Iu(["leftmost"])),r.insertAfter=(h=>f=>{e.splice(h+1,0,f),o++})(o)}s&&e.pop()},bR=function(e){return e instanceof q0||e instanceof cR||e instanceof Ym&&e.hasClass("enclosing")?e:null},k3e=function t(e,n){var r=bR(e);if(r){var s=r.children;if(s.length){if(n==="right")return t(s[s.length-1],"right");if(n==="left")return t(s[0],"left")}}return e},m4=function(e,n){return e?(n&&(e=k3e(e,n)),w3e[e.classes[0]]||null):null},mh=function(e,n){var r=["nulldelimiter"].concat(e.baseSizingClasses());return Iu(n.concat(r))},ct=function(e,n,r){if(!e)return Iu();if(Tp[e.type]){var s=Tp[e.type](e,n);if(r&&n.size!==r.size){s=Iu(n.sizingClasses(r),[s],n);var i=n.sizeMultiplier/r.sizeMultiplier;s.height*=i,s.depth*=i}return s}else throw new Me("Got group of unknown type: '"+e.type+"'")};function xR(t){return new q0(t)}class Jr{constructor(e,n,r){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=n||[],this.classes=r||[]}setAttribute(e,n){this.attributes[e]=n}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&e.setAttribute(n,this.attributes[n]);this.classes.length>0&&(e.className=Ao(this.classes));for(var r=0;r<this.children.length;r++)if(this.children[r]instanceof qs&&this.children[r+1]instanceof qs){for(var s=this.children[r].toText()+this.children[++r].toText();this.children[r+1]instanceof qs;)s+=this.children[++r].toText();e.appendChild(new qs(s).toNode())}else e.appendChild(this.children[r].toNode());return e}toMarkup(){var e="<"+this.type;for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="',e+=Be.escape(this.attributes[n]),e+='"');this.classes.length>0&&(e+=' class ="'+Be.escape(Ao(this.classes))+'"'),e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</"+this.type+">",e}toText(){return this.children.map(e=>e.toText()).join("")}}class qs{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return Be.escape(this.toText())}toText(){return this.text}}class S3e{constructor(e){this.width=void 0,this.character=void 0,this.width=e,e>=.05555&&e<=.05556?this.character="":e>=.1666&&e<=.1667?this.character="":e>=.2222&&e<=.2223?this.character="":e>=.2777&&e<=.2778?this.character="":e>=-.05556&&e<=-.05555?this.character="":e>=-.1667&&e<=-.1666?this.character="":e>=-.2223&&e<=-.2222?this.character="":e>=-.2778&&e<=-.2777?this.character="":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",ye(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+ye(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var me={MathNode:Jr,TextNode:qs,SpaceNode:S3e,newDocumentFragment:xR},as=function(e,n,r){return Zt[n][e]&&Zt[n][e].replace&&e.charCodeAt(0)!==55349&&!(hR.hasOwnProperty(e)&&r&&(r.fontFamily&&r.fontFamily.slice(4,6)==="tt"||r.font&&r.font.slice(4,6)==="tt"))&&(e=Zt[n][e].replace),new me.TextNode(e)},O3=function(e){return e.length===1?e[0]:new me.MathNode("mrow",e)},L3=function(e,n){if(n.fontFamily==="texttt")return"monospace";if(n.fontFamily==="textsf")return n.fontShape==="textit"&&n.fontWeight==="textbf"?"sans-serif-bold-italic":n.fontShape==="textit"?"sans-serif-italic":n.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(n.fontShape==="textit"&&n.fontWeight==="textbf")return"bold-italic";if(n.fontShape==="textit")return"italic";if(n.fontWeight==="textbf")return"bold";var r=n.font;if(!r||r==="mathnormal")return null;var s=e.mode;if(r==="mathit")return"italic";if(r==="boldsymbol")return e.type==="textord"?"bold":"bold-italic";if(r==="mathbf")return"bold";if(r==="mathbb")return"double-struck";if(r==="mathsfit")return"sans-serif-italic";if(r==="mathfrak")return"fraktur";if(r==="mathscr"||r==="mathcal")return"script";if(r==="mathsf")return"sans-serif";if(r==="mathtt")return"monospace";var i=e.text;if(Be.contains(["\\imath","\\jmath"],i))return null;Zt[s][i]&&Zt[s][i].replace&&(i=Zt[s][i].replace);var o=te.fontMap[r].fontName;return M3(i,o,s)?te.fontMap[r].variant:null};function y2(t){if(!t)return!1;if(t.type==="mi"&&t.children.length===1){var e=t.children[0];return e instanceof qs&&e.text==="."}else if(t.type==="mo"&&t.children.length===1&&t.getAttribute("separator")==="true"&&t.getAttribute("lspace")==="0em"&&t.getAttribute("rspace")==="0em"){var n=t.children[0];return n instanceof qs&&n.text===","}else return!1}var Wr=function(e,n,r){if(e.length===1){var s=St(e[0],n);return r&&s instanceof Jr&&s.type==="mo"&&(s.setAttribute("lspace","0em"),s.setAttribute("rspace","0em")),[s]}for(var i=[],o,a=0;a<e.length;a++){var l=St(e[a],n);if(l instanceof Jr&&o instanceof Jr){if(l.type==="mtext"&&o.type==="mtext"&&l.getAttribute("mathvariant")===o.getAttribute("mathvariant")){o.children.push(...l.children);continue}else if(l.type==="mn"&&o.type==="mn"){o.children.push(...l.children);continue}else if(y2(l)&&o.type==="mn"){o.children.push(...l.children);continue}else if(l.type==="mn"&&y2(o))l.children=[...o.children,...l.children],i.pop();else if((l.type==="msup"||l.type==="msub")&&l.children.length>=1&&(o.type==="mn"||y2(o))){var u=l.children[0];u instanceof Jr&&u.type==="mn"&&(u.children=[...o.children,...u.children],i.pop())}else if(o.type==="mi"&&o.children.length===1){var c=o.children[0];if(c instanceof qs&&c.text===""&&(l.type==="mo"||l.type==="mi"||l.type==="mn")){var h=l.children[0];h instanceof qs&&h.text.length>0&&(h.text=h.text.slice(0,1)+""+h.text.slice(1),i.pop())}}}i.push(l),o=l}return i},Ro=function(e,n,r){return O3(Wr(e,n,r))},St=function(e,n){if(!e)return new me.MathNode("mrow");if(Np[e.type]){var r=Np[e.type](e,n);return r}else throw new Me("Got group of unknown type: '"+e.type+"'")},C3e={widehat:"^",widecheck:"",widetilde:"~",utilde:"~",overleftarrow:"",underleftarrow:"",xleftarrow:"",overrightarrow:"",underrightarrow:"",xrightarrow:"",underbrace:"",overbrace:"",overgroup:"",undergroup:"",overleftrightarrow:"",underleftrightarrow:"",xleftrightarrow:"",Overrightarrow:"",xRightarrow:"",overleftharpoon:"",xleftharpoonup:"",overrightharpoon:"",xrightharpoonup:"",xLeftarrow:"",xLeftrightarrow:"",xhookleftarrow:"",xhookrightarrow:"",xmapsto:"",xrightharpoondown:"",xleftharpoondown:"",xrightleftharpoons:"",xleftrightharpoons:"",xtwoheadleftarrow:"",xtwoheadrightarrow:"",xlongequal:"=",xtofrom:"",xrightleftarrows:"",xrightequilibrium:"",xleftequilibrium:"","\\cdrightarrow":"","\\cdleftarrow":"","\\cdlongequal":"="},$3e=function(e){var n=new me.MathNode("mo",[new me.TextNode(C3e[e.replace(/^\\/,"")])]);return n.setAttribute("stretchy","true"),n},I3e={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},T3e=function(e){return e.type==="ordgroup"?e.body.length:1},N3e=function(e,n){function r(){var a=4e5,l=e.label.slice(1);if(Be.contains(["widehat","widecheck","widetilde","utilde"],l)){var u=e,c=T3e(u.base),h,f,d;if(c>5)l==="widehat"||l==="widecheck"?(h=420,a=2364,d=.42,f=l+"4"):(h=312,a=2340,d=.34,f="tilde4");else{var p=[1,1,2,2,3,3][c];l==="widehat"||l==="widecheck"?(a=[0,1062,2364,2364,2364][p],h=[0,239,300,360,420][p],d=[0,.24,.3,.3,.36,.42][p],f=l+p):(a=[0,600,1033,2339,2340][p],h=[0,260,286,306,312][p],d=[0,.26,.286,.3,.306,.34][p],f="tilde"+p)}var g=new Za(f),m=new Eo([g],{width:"100%",height:ye(d),viewBox:"0 0 "+a+" "+h,preserveAspectRatio:"none"});return{span:te.makeSvgSpan([],[m],n),minWidth:0,height:d}}else{var b=[],x=I3e[l],[v,y,w]=x,C=w/1e3,T=v.length,N,$;if(T===1){var _=x[3];N=["hide-tail"],$=[_]}else if(T===2)N=["halfarrow-left","halfarrow-right"],$=["xMinYMin","xMaxYMin"];else if(T===3)N=["brace-left","brace-center","brace-right"],$=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+T+" children.");for(var S=0;S<T;S++){var M=new Za(v[S]),F=new Eo([M],{width:"400em",height:ye(C),viewBox:"0 0 "+a+" "+w,preserveAspectRatio:$[S]+" slice"}),A=te.makeSvgSpan([N[S]],[F],n);if(T===1)return{span:A,minWidth:y,height:C};A.style.height=ye(C),b.push(A)}return{span:te.makeSpan(["stretchy"],b,n),minWidth:y,height:C}}}var{span:s,minWidth:i,height:o}=r();return s.height=o,s.style.height=ye(o),i>0&&(s.style.minWidth=ye(i)),s},_3e=function(e,n,r,s,i){var o,a=e.height+e.depth+r+s;if(/fbox|color|angl/.test(n)){if(o=te.makeSpan(["stretchy",n],[],i),n==="fbox"){var l=i.color&&i.getColor();l&&(o.style.borderColor=l)}}else{var u=[];/^[bx]cancel$/.test(n)&&u.push(new h8({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(n)&&u.push(new h8({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var c=new Eo(u,{width:"100%",height:ye(a)});o=te.makeSvgSpan([],[c],i)}return o.height=a,o.style.height=ye(a),o},Vi={encloseSpan:_3e,mathMLnode:$3e,svgSpan:N3e};function Je(t,e){if(!t||t.type!==e)throw new Error("Expected node of type "+e+", but got "+(t?"node of type "+t.type:String(t)));return t}function z3(t){var e=Qm(t);if(!e)throw new Error("Expected node of symbol group type, but got "+(t?"node of type "+t.type:String(t)));return e}function Qm(t){return t&&(t.type==="atom"||n3e.hasOwnProperty(t.type))?t:null}var P3=(t,e)=>{var n,r,s;t&&t.type==="supsub"?(r=Je(t.base,"accent"),n=r.base,t.base=n,s=t3e(ct(t,e)),t.base=r):(r=Je(t,"accent"),n=r.base);var i=ct(n,e.havingCrampedStyle()),o=r.isShifty&&Be.isCharacterBox(n),a=0;if(o){var l=Be.getBaseElem(n),u=ct(l,e.havingCrampedStyle());a=f8(u).skew}var c=r.label==="\\c",h=c?i.height+i.depth:Math.min(i.height,e.fontMetrics().xHeight),f;if(r.isStretchy)f=Vi.svgSpan(r,e),f=te.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:i},{type:"elem",elem:f,wrapperClasses:["svg-align"],wrapperStyle:a>0?{width:"calc(100% - "+ye(2*a)+")",marginLeft:ye(2*a)}:void 0}]},e);else{var d,p;r.label==="\\vec"?(d=te.staticSvg("vec",e),p=te.svgData.vec[1]):(d=te.makeOrd({mode:r.mode,text:r.label},e,"textord"),d=f8(d),d.italic=0,p=d.width,c&&(h+=d.depth)),f=te.makeSpan(["accent-body"],[d]);var g=r.label==="\\textcircled";g&&(f.classes.push("accent-full"),h=i.height);var m=a;g||(m-=p/2),f.style.left=ye(m),r.label==="\\textcircled"&&(f.style.top=".2em"),f=te.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:i},{type:"kern",size:-h},{type:"elem",elem:f}]},e)}var b=te.makeSpan(["mord","accent"],[f],e);return s?(s.children[0]=b,s.height=Math.max(b.height,s.height),s.classes[0]="mord",s):b},yR=(t,e)=>{var n=t.isStretchy?Vi.mathMLnode(t.label):new me.MathNode("mo",[as(t.label,t.mode)]),r=new me.MathNode("mover",[St(t.base,e),n]);return r.setAttribute("accent","true"),r},A3e=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(t=>"\\"+t).join("|"));Se({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(t,e)=>{var n=_p(e[0]),r=!A3e.test(t.funcName),s=!r||t.funcName==="\\widehat"||t.funcName==="\\widetilde"||t.funcName==="\\widecheck";return{type:"accent",mode:t.parser.mode,label:t.funcName,isStretchy:r,isShifty:s,base:n}},htmlBuilder:P3,mathmlBuilder:yR});Se({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(t,e)=>{var n=e[0],r=t.parser.mode;return r==="math"&&(t.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+t.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:t.funcName,isStretchy:!1,isShifty:!0,base:n}},htmlBuilder:P3,mathmlBuilder:yR});Se({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0];return{type:"accentUnder",mode:n.mode,label:r,base:s}},htmlBuilder:(t,e)=>{var n=ct(t.base,e),r=Vi.svgSpan(t,e),s=t.label==="\\utilde"?.12:0,i=te.makeVList({positionType:"top",positionData:n.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:s},{type:"elem",elem:n}]},e);return te.makeSpan(["mord","accentunder"],[i],e)},mathmlBuilder:(t,e)=>{var n=Vi.mathMLnode(t.label),r=new me.MathNode("munder",[St(t.base,e),n]);return r.setAttribute("accentunder","true"),r}});var Lf=t=>{var e=new me.MathNode("mpadded",t?[t]:[]);return e.setAttribute("width","+0.6em"),e.setAttribute("lspace","0.3em"),e};Se({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(t,e,n){var{parser:r,funcName:s}=t;return{type:"xArrow",mode:r.mode,label:s,body:e[0],below:n[0]}},htmlBuilder(t,e){var n=e.style,r=e.havingStyle(n.sup()),s=te.wrapFragment(ct(t.body,r,e),e),i=t.label.slice(0,2)==="\\x"?"x":"cd";s.classes.push(i+"-arrow-pad");var o;t.below&&(r=e.havingStyle(n.sub()),o=te.wrapFragment(ct(t.below,r,e),e),o.classes.push(i+"-arrow-pad"));var a=Vi.svgSpan(t,e),l=-e.fontMetrics().axisHeight+.5*a.height,u=-e.fontMetrics().axisHeight-.5*a.height-.111;(s.depth>.25||t.label==="\\xleftequilibrium")&&(u-=s.depth);var c;if(o){var h=-e.fontMetrics().axisHeight+o.height+.5*a.height+.111;c=te.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:u},{type:"elem",elem:a,shift:l},{type:"elem",elem:o,shift:h}]},e)}else c=te.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:u},{type:"elem",elem:a,shift:l}]},e);return c.children[0].children[0].children[1].classes.push("svg-align"),te.makeSpan(["mrel","x-arrow"],[c],e)},mathmlBuilder(t,e){var n=Vi.mathMLnode(t.label);n.setAttribute("minsize",t.label.charAt(0)==="x"?"1.75em":"3.0em");var r;if(t.body){var s=Lf(St(t.body,e));if(t.below){var i=Lf(St(t.below,e));r=new me.MathNode("munderover",[n,i,s])}else r=new me.MathNode("mover",[n,s])}else if(t.below){var o=Lf(St(t.below,e));r=new me.MathNode("munder",[n,o])}else r=Lf(),r=new me.MathNode("mover",[n,r]);return r}});var E3e=te.makeSpan;function vR(t,e){var n=En(t.body,e,!0);return E3e([t.mclass],n,e)}function wR(t,e){var n,r=Wr(t.body,e);return t.mclass==="minner"?n=new me.MathNode("mpadded",r):t.mclass==="mord"?t.isCharacterBox?(n=r[0],n.type="mi"):n=new me.MathNode("mi",r):(t.isCharacterBox?(n=r[0],n.type="mo"):n=new me.MathNode("mo",r),t.mclass==="mbin"?(n.attributes.lspace="0.22em",n.attributes.rspace="0.22em"):t.mclass==="mpunct"?(n.attributes.lspace="0em",n.attributes.rspace="0.17em"):t.mclass==="mopen"||t.mclass==="mclose"?(n.attributes.lspace="0em",n.attributes.rspace="0em"):t.mclass==="minner"&&(n.attributes.lspace="0.0556em",n.attributes.width="+0.1111em")),n}Se({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(t,e){var{parser:n,funcName:r}=t,s=e[0];return{type:"mclass",mode:n.mode,mclass:"m"+r.slice(5),body:Yt(s),isCharacterBox:Be.isCharacterBox(s)}},htmlBuilder:vR,mathmlBuilder:wR});var eg=t=>{var e=t.type==="ordgroup"&&t.body.length?t.body[0]:t;return e.type==="atom"&&(e.family==="bin"||e.family==="rel")?"m"+e.family:"mord"};Se({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(t,e){var{parser:n}=t;return{type:"mclass",mode:n.mode,mclass:eg(e[0]),body:Yt(e[1]),isCharacterBox:Be.isCharacterBox(e[1])}}});Se({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(t,e){var{parser:n,funcName:r}=t,s=e[1],i=e[0],o;r!=="\\stackrel"?o=eg(s):o="mrel";var a={type:"op",mode:s.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:r!=="\\stackrel",body:Yt(s)},l={type:"supsub",mode:i.mode,base:a,sup:r==="\\underset"?null:i,sub:r==="\\underset"?i:null};return{type:"mclass",mode:n.mode,mclass:o,body:[l],isCharacterBox:Be.isCharacterBox(l)}},htmlBuilder:vR,mathmlBuilder:wR});Se({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(t,e){var{parser:n}=t;return{type:"pmb",mode:n.mode,mclass:eg(e[0]),body:Yt(e[0])}},htmlBuilder(t,e){var n=En(t.body,e,!0),r=te.makeSpan([t.mclass],n,e);return r.style.textShadow="0.02em 0.01em 0.04px",r},mathmlBuilder(t,e){var n=Wr(t.body,e),r=new me.MathNode("mstyle",n);return r.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),r}});var R3e={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},v8=()=>({type:"styling",body:[],mode:"math",style:"display"}),w8=t=>t.type==="textord"&&t.text==="@",D3e=(t,e)=>(t.type==="mathord"||t.type==="atom")&&t.text===e;function M3e(t,e,n){var r=R3e[t];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return n.callFunction(r,[e[0]],[e[1]]);case"\\uparrow":case"\\downarrow":{var s=n.callFunction("\\\\cdleft",[e[0]],[]),i={type:"atom",text:r,mode:"math",family:"rel"},o=n.callFunction("\\Big",[i],[]),a=n.callFunction("\\\\cdright",[e[1]],[]),l={type:"ordgroup",mode:"math",body:[s,o,a]};return n.callFunction("\\\\cdparent",[l],[])}case"\\\\cdlongequal":return n.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var u={type:"textord",text:"\\Vert",mode:"math"};return n.callFunction("\\Big",[u],[])}default:return{type:"textord",text:" ",mode:"math"}}}function F3e(t){var e=[];for(t.gullet.beginGroup(),t.gullet.macros.set("\\cr","\\\\\\relax"),t.gullet.beginGroup();;){e.push(t.parseExpression(!1,"\\\\")),t.gullet.endGroup(),t.gullet.beginGroup();var n=t.fetch().text;if(n==="&"||n==="\\\\")t.consume();else if(n==="\\end"){e[e.length-1].length===0&&e.pop();break}else throw new Me("Expected \\\\ or \\cr or \\end",t.nextToken)}for(var r=[],s=[r],i=0;i<e.length;i++){for(var o=e[i],a=v8(),l=0;l<o.length;l++)if(!w8(o[l]))a.body.push(o[l]);else{r.push(a),l+=1;var u=z3(o[l]).text,c=new Array(2);if(c[0]={type:"ordgroup",mode:"math",body:[]},c[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(u)>-1))if("<>AV".indexOf(u)>-1)for(var h=0;h<2;h++){for(var f=!0,d=l+1;d<o.length;d++){if(D3e(o[d],u)){f=!1,l=d;break}if(w8(o[d]))throw new Me("Missing a "+u+" character to complete a CD arrow.",o[d]);c[h].body.push(o[d])}if(f)throw new Me("Missing a "+u+" character to complete a CD arrow.",o[l])}else throw new Me('Expected one of "<>AV=|." after @',o[l]);var p=M3e(u,c,t),g={type:"styling",body:[p],mode:"math",style:"display"};r.push(g),a=v8()}i%2===0?r.push(a):r.shift(),r=[],s.push(r)}t.gullet.endGroup(),t.gullet.endGroup();var m=new Array(s[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:s,arraystretch:1,addJot:!0,rowGaps:[null],cols:m,colSeparationType:"CD",hLinesBeforeRow:new Array(s.length+1).fill([])}}Se({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(t,e){var{parser:n,funcName:r}=t;return{type:"cdlabel",mode:n.mode,side:r.slice(4),label:e[0]}},htmlBuilder(t,e){var n=e.havingStyle(e.style.sup()),r=te.wrapFragment(ct(t.label,n,e),e);return r.classes.push("cd-label-"+t.side),r.style.bottom=ye(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(t,e){var n=new me.MathNode("mrow",[St(t.label,e)]);return n=new me.MathNode("mpadded",[n]),n.setAttribute("width","0"),t.side==="left"&&n.setAttribute("lspace","-1width"),n.setAttribute("voffset","0.7em"),n=new me.MathNode("mstyle",[n]),n.setAttribute("displaystyle","false"),n.setAttribute("scriptlevel","1"),n}});Se({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(t,e){var{parser:n}=t;return{type:"cdlabelparent",mode:n.mode,fragment:e[0]}},htmlBuilder(t,e){var n=te.wrapFragment(ct(t.fragment,e),e);return n.classes.push("cd-vert-arrow"),n},mathmlBuilder(t,e){return new me.MathNode("mrow",[St(t.fragment,e)])}});Se({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(t,e){for(var{parser:n}=t,r=Je(e[0],"ordgroup"),s=r.body,i="",o=0;o<s.length;o++){var a=Je(s[o],"textord");i+=a.text}var l=parseInt(i),u;if(isNaN(l))throw new Me("\\@char has non-numeric argument "+i);if(l<0||l>=1114111)throw new Me("\\@char with invalid code point "+i);return l<=65535?u=String.fromCharCode(l):(l-=65536,u=String.fromCharCode((l>>10)+55296,(l&1023)+56320)),{type:"textord",mode:n.mode,text:u}}});var kR=(t,e)=>{var n=En(t.body,e.withColor(t.color),!1);return te.makeFragment(n)},SR=(t,e)=>{var n=Wr(t.body,e.withColor(t.color)),r=new me.MathNode("mstyle",n);return r.setAttribute("mathcolor",t.color),r};Se({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(t,e){var{parser:n}=t,r=Je(e[0],"color-token").color,s=e[1];return{type:"color",mode:n.mode,color:r,body:Yt(s)}},htmlBuilder:kR,mathmlBuilder:SR});Se({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(t,e){var{parser:n,breakOnTokenText:r}=t,s=Je(e[0],"color-token").color;n.gullet.macros.set("\\current@color",s);var i=n.parseExpression(!0,r);return{type:"color",mode:n.mode,color:s,body:i}},htmlBuilder:kR,mathmlBuilder:SR});Se({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(t,e,n){var{parser:r}=t,s=r.gullet.future().text==="["?r.parseSizeGroup(!0):null,i=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:i,size:s&&Je(s,"size").value}},htmlBuilder(t,e){var n=te.makeSpan(["mspace"],[],e);return t.newLine&&(n.classes.push("newline"),t.size&&(n.style.marginTop=ye(Ot(t.size,e)))),n},mathmlBuilder(t,e){var n=new me.MathNode("mspace");return t.newLine&&(n.setAttribute("linebreak","newline"),t.size&&n.setAttribute("height",ye(Ot(t.size,e)))),n}});var g4={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},CR=t=>{var e=t.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(e))throw new Me("Expected a control sequence",t);return e},O3e=t=>{var e=t.gullet.popToken();return e.text==="="&&(e=t.gullet.popToken(),e.text===" "&&(e=t.gullet.popToken())),e},$R=(t,e,n,r)=>{var s=t.gullet.macros.get(n.text);s==null&&(n.noexpand=!0,s={tokens:[n],numArgs:0,unexpandable:!t.gullet.isExpandable(n.text)}),t.gullet.macros.set(e,s,r)};Se({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(t){var{parser:e,funcName:n}=t;e.consumeSpaces();var r=e.fetch();if(g4[r.text])return(n==="\\global"||n==="\\\\globallong")&&(r.text=g4[r.text]),Je(e.parseFunction(),"internal");throw new Me("Invalid token after macro prefix",r)}});Se({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t){var{parser:e,funcName:n}=t,r=e.gullet.popToken(),s=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(s))throw new Me("Expected a control sequence",r);for(var i=0,o,a=[[]];e.gullet.future().text!=="{";)if(r=e.gullet.popToken(),r.text==="#"){if(e.gullet.future().text==="{"){o=e.gullet.future(),a[i].push("{");break}if(r=e.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new Me('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==i+1)throw new Me('Argument number "'+r.text+'" out of order');i++,a.push([])}else{if(r.text==="EOF")throw new Me("Expected a macro definition");a[i].push(r.text)}var{tokens:l}=e.gullet.consumeArg();return o&&l.unshift(o),(n==="\\edef"||n==="\\xdef")&&(l=e.gullet.expandTokens(l),l.reverse()),e.gullet.macros.set(s,{tokens:l,numArgs:i,delimiters:a},n===g4[n]),{type:"internal",mode:e.mode}}});Se({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t){var{parser:e,funcName:n}=t,r=CR(e.gullet.popToken());e.gullet.consumeSpaces();var s=O3e(e);return $R(e,r,s,n==="\\\\globallet"),{type:"internal",mode:e.mode}}});Se({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t){var{parser:e,funcName:n}=t,r=CR(e.gullet.popToken()),s=e.gullet.popToken(),i=e.gullet.popToken();return $R(e,r,i,n==="\\\\globalfuture"),e.gullet.pushToken(i),e.gullet.pushToken(s),{type:"internal",mode:e.mode}}});var Nc=function(e,n,r){var s=Zt.math[e]&&Zt.math[e].replace,i=M3(s||e,n,r);if(!i)throw new Error("Unsupported symbol "+e+" and font size "+n+".");return i},B3=function(e,n,r,s){var i=r.havingBaseStyle(n),o=te.makeSpan(s.concat(i.sizingClasses(r)),[e],r),a=i.sizeMultiplier/r.sizeMultiplier;return o.height*=a,o.depth*=a,o.maxFontSize=i.sizeMultiplier,o},IR=function(e,n,r){var s=n.havingBaseStyle(r),i=(1-n.sizeMultiplier/s.sizeMultiplier)*n.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=ye(i),e.height-=i,e.depth+=i},L3e=function(e,n,r,s,i,o){var a=te.makeSymbol(e,"Main-Regular",i,s),l=B3(a,n,s,o);return r&&IR(l,s,n),l},z3e=function(e,n,r,s){return te.makeSymbol(e,"Size"+n+"-Regular",r,s)},TR=function(e,n,r,s,i,o){var a=z3e(e,n,i,s),l=B3(te.makeSpan(["delimsizing","size"+n],[a],s),Ve.TEXT,s,o);return r&&IR(l,s,Ve.TEXT),l},v2=function(e,n,r){var s;n==="Size1-Regular"?s="delim-size1":s="delim-size4";var i=te.makeSpan(["delimsizinginner",s],[te.makeSpan([],[te.makeSymbol(e,n,r)])]);return{type:"elem",elem:i}},w2=function(e,n,r){var s=Ei["Size4-Regular"][e.charCodeAt(0)]?Ei["Size4-Regular"][e.charCodeAt(0)][4]:Ei["Size1-Regular"][e.charCodeAt(0)][4],i=new Za("inner",jve(e,Math.round(1e3*n))),o=new Eo([i],{width:ye(s),height:ye(n),style:"width:"+ye(s),viewBox:"0 0 "+1e3*s+" "+Math.round(1e3*n),preserveAspectRatio:"xMinYMin"}),a=te.makeSvgSpan([],[o],r);return a.height=n,a.style.height=ye(n),a.style.width=ye(s),{type:"elem",elem:a}},b4=.008,zf={type:"kern",size:-1*b4},P3e=["|","\\lvert","\\rvert","\\vert"],B3e=["\\|","\\lVert","\\rVert","\\Vert"],NR=function(e,n,r,s,i,o){var a,l,u,c,h="",f=0;a=u=c=e,l=null;var d="Size1-Regular";e==="\\uparrow"?u=c="":e==="\\Uparrow"?u=c="":e==="\\downarrow"?a=u="":e==="\\Downarrow"?a=u="":e==="\\updownarrow"?(a="\\uparrow",u="",c="\\downarrow"):e==="\\Updownarrow"?(a="\\Uparrow",u="",c="\\Downarrow"):Be.contains(P3e,e)?(u="",h="vert",f=333):Be.contains(B3e,e)?(u="",h="doublevert",f=556):e==="["||e==="\\lbrack"?(a="",u="",c="",d="Size4-Regular",h="lbrack",f=667):e==="]"||e==="\\rbrack"?(a="",u="",c="",d="Size4-Regular",h="rbrack",f=667):e==="\\lfloor"||e===""?(u=a="",c="",d="Size4-Regular",h="lfloor",f=667):e==="\\lceil"||e===""?(a="",u=c="",d="Size4-Regular",h="lceil",f=667):e==="\\rfloor"||e===""?(u=a="",c="",d="Size4-Regular",h="rfloor",f=667):e==="\\rceil"||e===""?(a="",u=c="",d="Size4-Regular",h="rceil",f=667):e==="("||e==="\\lparen"?(a="",u="",c="",d="Size4-Regular",h="lparen",f=875):e===")"||e==="\\rparen"?(a="",u="",c="",d="Size4-Regular",h="rparen",f=875):e==="\\{"||e==="\\lbrace"?(a="",l="",c="",u="",d="Size4-Regular"):e==="\\}"||e==="\\rbrace"?(a="",l="",c="",u="",d="Size4-Regular"):e==="\\lgroup"||e===""?(a="",c="",u="",d="Size4-Regular"):e==="\\rgroup"||e===""?(a="",c="",u="",d="Size4-Regular"):e==="\\lmoustache"||e===""?(a="",c="",u="",d="Size4-Regular"):(e==="\\rmoustache"||e==="")&&(a="",c="",u="",d="Size4-Regular");var p=Nc(a,d,i),g=p.height+p.depth,m=Nc(u,d,i),b=m.height+m.depth,x=Nc(c,d,i),v=x.height+x.depth,y=0,w=1;if(l!==null){var C=Nc(l,d,i);y=C.height+C.depth,w=2}var T=g+v+y,N=Math.max(0,Math.ceil((n-T)/(w*b))),$=T+N*w*b,_=s.fontMetrics().axisHeight;r&&(_*=s.sizeMultiplier);var S=$/2-_,M=[];if(h.length>0){var F=$-g-v,A=Math.round($*1e3),E=Kve(h,Math.round(F*1e3)),D=new Za(h,E),P=(f/1e3).toFixed(3)+"em",z=(A/1e3).toFixed(3)+"em",B=new Eo([D],{width:P,height:z,viewBox:"0 0 "+f+" "+A}),G=te.makeSvgSpan([],[B],s);G.height=A/1e3,G.style.width=P,G.style.height=z,M.push({type:"elem",elem:G})}else{if(M.push(v2(c,d,i)),M.push(zf),l===null){var j=$-g-v+2*b4;M.push(w2(u,j,s))}else{var Z=($-g-v-y)/2+2*b4;M.push(w2(u,Z,s)),M.push(zf),M.push(v2(l,d,i)),M.push(zf),M.push(w2(u,Z,s))}M.push(zf),M.push(v2(a,d,i))}var ne=s.havingBaseStyle(Ve.TEXT),le=te.makeVList({positionType:"bottom",positionData:S,children:M},ne);return B3(te.makeSpan(["delimsizing","mult"],[le],ne),Ve.TEXT,s,o)},k2=80,S2=.08,C2=function(e,n,r,s,i){var o=Xve(e,s,r),a=new Za(e,o),l=new Eo([a],{width:"400em",height:ye(n),viewBox:"0 0 400000 "+r,preserveAspectRatio:"xMinYMin slice"});return te.makeSvgSpan(["hide-tail"],[l],i)},V3e=function(e,n){var r=n.havingBaseSizing(),s=RR("\\surd",e*r.sizeMultiplier,ER,r),i=r.sizeMultiplier,o=Math.max(0,n.minRuleThickness-n.fontMetrics().sqrtRuleThickness),a,l=0,u=0,c=0,h;return s.type==="small"?(c=1e3+1e3*o+k2,e<1?i=1:e<1.4&&(i=.7),l=(1+o+S2)/i,u=(1+o)/i,a=C2("sqrtMain",l,c,o,n),a.style.minWidth="0.853em",h=.833/i):s.type==="large"?(c=(1e3+k2)*Pc[s.size],u=(Pc[s.size]+o)/i,l=(Pc[s.size]+o+S2)/i,a=C2("sqrtSize"+s.size,l,c,o,n),a.style.minWidth="1.02em",h=1/i):(l=e+o+S2,u=e+o,c=Math.floor(1e3*e+o)+k2,a=C2("sqrtTall",l,c,o,n),a.style.minWidth="0.742em",h=1.056),a.height=u,a.style.height=ye(l),{span:a,advanceWidth:h,ruleWidth:(n.fontMetrics().sqrtRuleThickness+o)*i}},_R=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","\\surd"],W3e=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","",""],AR=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],Pc=[0,1.2,1.8,2.4,3],U3e=function(e,n,r,s,i){if(e==="<"||e==="\\lt"||e===""?e="\\langle":(e===">"||e==="\\gt"||e==="")&&(e="\\rangle"),Be.contains(_R,e)||Be.contains(AR,e))return TR(e,n,!1,r,s,i);if(Be.contains(W3e,e))return NR(e,Pc[n],!1,r,s,i);throw new Me("Illegal delimiter: '"+e+"'")},G3e=[{type:"small",style:Ve.SCRIPTSCRIPT},{type:"small",style:Ve.SCRIPT},{type:"small",style:Ve.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],H3e=[{type:"small",style:Ve.SCRIPTSCRIPT},{type:"small",style:Ve.SCRIPT},{type:"small",style:Ve.TEXT},{type:"stack"}],ER=[{type:"small",style:Ve.SCRIPTSCRIPT},{type:"small",style:Ve.SCRIPT},{type:"small",style:Ve.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],q3e=function(e){if(e.type==="small")return"Main-Regular";if(e.type==="large")return"Size"+e.size+"-Regular";if(e.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},RR=function(e,n,r,s){for(var i=Math.min(2,3-s.style.size),o=i;o<r.length&&r[o].type!=="stack";o++){var a=Nc(e,q3e(r[o]),"math"),l=a.height+a.depth;if(r[o].type==="small"){var u=s.havingBaseStyle(r[o].style);l*=u.sizeMultiplier}if(l>n)return r[o]}return r[r.length-1]},DR=function(e,n,r,s,i,o){e==="<"||e==="\\lt"||e===""?e="\\langle":(e===">"||e==="\\gt"||e==="")&&(e="\\rangle");var a;Be.contains(AR,e)?a=G3e:Be.contains(_R,e)?a=ER:a=H3e;var l=RR(e,n,a,s);return l.type==="small"?L3e(e,l.style,r,s,i,o):l.type==="large"?TR(e,l.size,r,s,i,o):NR(e,n,r,s,i,o)},X3e=function(e,n,r,s,i,o){var a=s.fontMetrics().axisHeight*s.sizeMultiplier,l=901,u=5/s.fontMetrics().ptPerEm,c=Math.max(n-a,r+a),h=Math.max(c/500*l,2*c-u);return DR(e,h,!0,s,i,o)},Mi={sqrtImage:V3e,sizedDelim:U3e,sizeToMaxHeight:Pc,customSizedDelim:DR,leftRightDelim:X3e},k8={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},j3e=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","<",">","\\langle","","\\rangle","","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","","","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function tg(t,e){var n=Qm(t);if(n&&Be.contains(j3e,n.text))return n;throw n?new Me("Invalid delimiter '"+n.text+"' after '"+e.funcName+"'",t):new Me("Invalid delimiter type '"+t.type+"'",t)}Se({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(t,e)=>{var n=tg(e[0],t);return{type:"delimsizing",mode:t.parser.mode,size:k8[t.funcName].size,mclass:k8[t.funcName].mclass,delim:n.text}},htmlBuilder:(t,e)=>t.delim==="."?te.makeSpan([t.mclass]):Mi.sizedDelim(t.delim,t.size,e,t.mode,[t.mclass]),mathmlBuilder:t=>{var e=[];t.delim!=="."&&e.push(as(t.delim,t.mode));var n=new me.MathNode("mo",e);t.mclass==="mopen"||t.mclass==="mclose"?n.setAttribute("fence","true"):n.setAttribute("fence","false"),n.setAttribute("stretchy","true");var r=ye(Mi.sizeToMaxHeight[t.size]);return n.setAttribute("minsize",r),n.setAttribute("maxsize",r),n}});function S8(t){if(!t.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}Se({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var n=t.parser.gullet.macros.get("\\current@color");if(n&&typeof n!="string")throw new Me("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:t.parser.mode,delim:tg(e[0],t).text,color:n}}});Se({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var n=tg(e[0],t),r=t.parser;++r.leftrightDepth;var s=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var i=Je(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:s,left:n.text,right:i.delim,rightColor:i.color}},htmlBuilder:(t,e)=>{S8(t);for(var n=En(t.body,e,!0,["mopen","mclose"]),r=0,s=0,i=!1,o=0;o<n.length;o++)n[o].isMiddle?i=!0:(r=Math.max(n[o].height,r),s=Math.max(n[o].depth,s));r*=e.sizeMultiplier,s*=e.sizeMultiplier;var a;if(t.left==="."?a=mh(e,["mopen"]):a=Mi.leftRightDelim(t.left,r,s,e,t.mode,["mopen"]),n.unshift(a),i)for(var l=1;l<n.length;l++){var u=n[l],c=u.isMiddle;c&&(n[l]=Mi.leftRightDelim(c.delim,r,s,c.options,t.mode,[]))}var h;if(t.right===".")h=mh(e,["mclose"]);else{var f=t.rightColor?e.withColor(t.rightColor):e;h=Mi.leftRightDelim(t.right,r,s,f,t.mode,["mclose"])}return n.push(h),te.makeSpan(["minner"],n,e)},mathmlBuilder:(t,e)=>{S8(t);var n=Wr(t.body,e);if(t.left!=="."){var r=new me.MathNode("mo",[as(t.left,t.mode)]);r.setAttribute("fence","true"),n.unshift(r)}if(t.right!=="."){var s=new me.MathNode("mo",[as(t.right,t.mode)]);s.setAttribute("fence","true"),t.rightColor&&s.setAttribute("mathcolor",t.rightColor),n.push(s)}return O3(n)}});Se({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var n=tg(e[0],t);if(!t.parser.leftrightDepth)throw new Me("\\middle without preceding \\left",n);return{type:"middle",mode:t.parser.mode,delim:n.text}},htmlBuilder:(t,e)=>{var n;if(t.delim===".")n=mh(e,[]);else{n=Mi.sizedDelim(t.delim,1,e,t.mode,[]);var r={delim:t.delim,options:e};n.isMiddle=r}return n},mathmlBuilder:(t,e)=>{var n=t.delim==="\\vert"||t.delim==="|"?as("|","text"):as(t.delim,t.mode),r=new me.MathNode("mo",[n]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var V3=(t,e)=>{var n=te.wrapFragment(ct(t.body,e),e),r=t.label.slice(1),s=e.sizeMultiplier,i,o=0,a=Be.isCharacterBox(t.body);if(r==="sout")i=te.makeSpan(["stretchy","sout"]),i.height=e.fontMetrics().defaultRuleThickness/s,o=-.5*e.fontMetrics().xHeight;else if(r==="phase"){var l=Ot({number:.6,unit:"pt"},e),u=Ot({number:.35,unit:"ex"},e),c=e.havingBaseSizing();s=s/c.sizeMultiplier;var h=n.height+n.depth+l+u;n.style.paddingLeft=ye(h/2+l);var f=Math.floor(1e3*h*s),d=Hve(f),p=new Eo([new Za("phase",d)],{width:"400em",height:ye(f/1e3),viewBox:"0 0 400000 "+f,preserveAspectRatio:"xMinYMin slice"});i=te.makeSvgSpan(["hide-tail"],[p],e),i.style.height=ye(h),o=n.depth+l+u}else{/cancel/.test(r)?a||n.classes.push("cancel-pad"):r==="angl"?n.classes.push("anglpad"):n.classes.push("boxpad");var g=0,m=0,b=0;/box/.test(r)?(b=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness),g=e.fontMetrics().fboxsep+(r==="colorbox"?0:b),m=g):r==="angl"?(b=Math.max(e.fontMetrics().defaultRuleThickness,e.minRuleThickness),g=4*b,m=Math.max(0,.25-n.depth)):(g=a?.2:0,m=g),i=Vi.encloseSpan(n,r,g,m,e),/fbox|boxed|fcolorbox/.test(r)?(i.style.borderStyle="solid",i.style.borderWidth=ye(b)):r==="angl"&&b!==.049&&(i.style.borderTopWidth=ye(b),i.style.borderRightWidth=ye(b)),o=n.depth+m,t.backgroundColor&&(i.style.backgroundColor=t.backgroundColor,t.borderColor&&(i.style.borderColor=t.borderColor))}var x;if(t.backgroundColor)x=te.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:o},{type:"elem",elem:n,shift:0}]},e);else{var v=/cancel|phase/.test(r)?["svg-align"]:[];x=te.makeVList({positionType:"individualShift",children:[{type:"elem",elem:n,shift:0},{type:"elem",elem:i,shift:o,wrapperClasses:v}]},e)}return/cancel/.test(r)&&(x.height=n.height,x.depth=n.depth),/cancel/.test(r)&&!a?te.makeSpan(["mord","cancel-lap"],[x],e):te.makeSpan(["mord"],[x],e)},W3=(t,e)=>{var n=0,r=new me.MathNode(t.label.indexOf("colorbox")>-1?"mpadded":"menclose",[St(t.body,e)]);switch(t.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(n=e.fontMetrics().fboxsep*e.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*n+"pt"),r.setAttribute("height","+"+2*n+"pt"),r.setAttribute("lspace",n+"pt"),r.setAttribute("voffset",n+"pt"),t.label==="\\fcolorbox"){var s=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness);r.setAttribute("style","border: "+s+"em solid "+String(t.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return t.backgroundColor&&r.setAttribute("mathbackground",t.backgroundColor),r};Se({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(t,e,n){var{parser:r,funcName:s}=t,i=Je(e[0],"color-token").color,o=e[1];return{type:"enclose",mode:r.mode,label:s,backgroundColor:i,body:o}},htmlBuilder:V3,mathmlBuilder:W3});Se({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(t,e,n){var{parser:r,funcName:s}=t,i=Je(e[0],"color-token").color,o=Je(e[1],"color-token").color,a=e[2];return{type:"enclose",mode:r.mode,label:s,backgroundColor:o,borderColor:i,body:a}},htmlBuilder:V3,mathmlBuilder:W3});Se({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(t,e){var{parser:n}=t;return{type:"enclose",mode:n.mode,label:"\\fbox",body:e[0]}}});Se({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(t,e){var{parser:n,funcName:r}=t,s=e[0];return{type:"enclose",mode:n.mode,label:r,body:s}},htmlBuilder:V3,mathmlBuilder:W3});Se({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(t,e){var{parser:n}=t;return{type:"enclose",mode:n.mode,label:"\\angl",body:e[0]}}});var MR={};function pi(t){for(var{type:e,names:n,props:r,handler:s,htmlBuilder:i,mathmlBuilder:o}=t,a={type:e,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:s},l=0;l<n.length;++l)MR[n[l]]=a;i&&(Tp[e]=i),o&&(Np[e]=o)}var K3e={};function O(t,e){K3e[t]=e}function C8(t){var e=[];t.consumeSpaces();var n=t.fetch().text;for(n==="\\relax"&&(t.consume(),t.consumeSpaces(),n=t.fetch().text);n==="\\hline"||n==="\\hdashline";)t.consume(),e.push(n==="\\hdashline"),t.consumeSpaces(),n=t.fetch().text;return e}var ng=t=>{var e=t.parser.settings;if(!e.displayMode)throw new Me("{"+t.envName+"} can be used only in display mode.")};function U3(t){if(t.indexOf("ed")===-1)return t.indexOf("*")===-1}function Ko(t,e,n){var{hskipBeforeAndAfter:r,addJot:s,cols:i,arraystretch:o,colSeparationType:a,autoTag:l,singleRow:u,emptySingleRow:c,maxNumCols:h,leqno:f}=e;if(t.gullet.beginGroup(),u||t.gullet.macros.set("\\cr","\\\\\\relax"),!o){var d=t.gullet.expandMacroAsText("\\arraystretch");if(d==null)o=1;else if(o=parseFloat(d),!o||o<0)throw new Me("Invalid \\arraystretch: "+d)}t.gullet.beginGroup();var p=[],g=[p],m=[],b=[],x=l!=null?[]:void 0;function v(){l&&t.gullet.macros.set("\\@eqnsw","1",!0)}function y(){x&&(t.gullet.macros.get("\\df@tag")?(x.push(t.subparse([new R3("\\df@tag")])),t.gullet.macros.set("\\df@tag",void 0,!0)):x.push(!!l&&t.gullet.macros.get("\\@eqnsw")==="1"))}for(v(),b.push(C8(t));;){var w=t.parseExpression(!1,u?"\\end":"\\\\");t.gullet.endGroup(),t.gullet.beginGroup(),w={type:"ordgroup",mode:t.mode,body:w},n&&(w={type:"styling",mode:t.mode,style:n,body:[w]}),p.push(w);var C=t.fetch().text;if(C==="&"){if(h&&p.length===h){if(u||a)throw new Me("Too many tab characters: &",t.nextToken);t.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}t.consume()}else if(C==="\\end"){y(),p.length===1&&w.type==="styling"&&w.body[0].body.length===0&&(g.length>1||!c)&&g.pop(),b.length<g.length+1&&b.push([]);break}else if(C==="\\\\"){t.consume();var T=void 0;t.gullet.future().text!==" "&&(T=t.parseSizeGroup(!0)),m.push(T?T.value:null),y(),b.push(C8(t)),p=[],g.push(p),v()}else throw new Me("Expected & or \\\\ or \\cr or \\end",t.nextToken)}return t.gullet.endGroup(),t.gullet.endGroup(),{type:"array",mode:t.mode,addJot:s,arraystretch:o,body:g,cols:i,rowGaps:m,hskipBeforeAndAfter:r,hLinesBeforeRow:b,colSeparationType:a,tags:x,leqno:f}}function G3(t){return t.slice(0,1)==="d"?"display":"text"}var mi=function(e,n){var r,s,i=e.body.length,o=e.hLinesBeforeRow,a=0,l=new Array(i),u=[],c=Math.max(n.fontMetrics().arrayRuleWidth,n.minRuleThickness),h=1/n.fontMetrics().ptPerEm,f=5*h;if(e.colSeparationType&&e.colSeparationType==="small"){var d=n.havingStyle(Ve.SCRIPT).sizeMultiplier;f=.2778*(d/n.sizeMultiplier)}var p=e.colSeparationType==="CD"?Ot({number:3,unit:"ex"},n):12*h,g=3*h,m=e.arraystretch*p,b=.7*m,x=.3*m,v=0;function y(Fe){for(var Jt=0;Jt<Fe.length;++Jt)Jt>0&&(v+=.25),u.push({pos:v,isDashed:Fe[Jt]})}for(y(o[0]),r=0;r<e.body.length;++r){var w=e.body[r],C=b,T=x;a<w.length&&(a=w.length);var N=new Array(w.length);for(s=0;s<w.length;++s){var $=ct(w[s],n);T<$.depth&&(T=$.depth),C<$.height&&(C=$.height),N[s]=$}var _=e.rowGaps[r],S=0;_&&(S=Ot(_,n),S>0&&(S+=x,T<S&&(T=S),S=0)),e.addJot&&(T+=g),N.height=C,N.depth=T,v+=C,N.pos=v,v+=T+S,l[r]=N,y(o[r+1])}var M=v/2+n.fontMetrics().axisHeight,F=e.cols||[],A=[],E,D,P=[];if(e.tags&&e.tags.some(Fe=>Fe))for(r=0;r<i;++r){var z=l[r],B=z.pos-M,G=e.tags[r],j=void 0;G===!0?j=te.makeSpan(["eqn-num"],[],n):G===!1?j=te.makeSpan([],[],n):j=te.makeSpan([],En(G,n,!0),n),j.depth=z.depth,j.height=z.height,P.push({type:"elem",elem:j,shift:B})}for(s=0,D=0;s<a||D<F.length;++s,++D){for(var Z=F[D]||{},ne=!0;Z.type==="separator";){if(ne||(E=te.makeSpan(["arraycolsep"],[]),E.style.width=ye(n.fontMetrics().doubleRuleSep),A.push(E)),Z.separator==="|"||Z.separator===":"){var le=Z.separator==="|"?"solid":"dashed",oe=te.makeSpan(["vertical-separator"],[],n);oe.style.height=ye(v),oe.style.borderRightWidth=ye(c),oe.style.borderRightStyle=le,oe.style.margin="0 "+ye(-c/2);var de=v-M;de&&(oe.style.verticalAlign=ye(-de)),A.push(oe)}else throw new Me("Invalid separator type: "+Z.separator);D++,Z=F[D]||{},ne=!1}if(!(s>=a)){var fe=void 0;(s>0||e.hskipBeforeAndAfter)&&(fe=Be.deflt(Z.pregap,f),fe!==0&&(E=te.makeSpan(["arraycolsep"],[]),E.style.width=ye(fe),A.push(E)));var xe=[];for(r=0;r<i;++r){var ie=l[r],pe=ie[s];if(pe){var ge=ie.pos-M;pe.depth=ie.depth,pe.height=ie.height,xe.push({type:"elem",elem:pe,shift:ge})}}xe=te.makeVList({positionType:"individualShift",children:xe},n),xe=te.makeSpan(["col-align-"+(Z.align||"c")],[xe]),A.push(xe),(s<a-1||e.hskipBeforeAndAfter)&&(fe=Be.deflt(Z.postgap,f),fe!==0&&(E=te.makeSpan(["arraycolsep"],[]),E.style.width=ye(fe),A.push(E)))}}if(l=te.makeSpan(["mtable"],A),u.length>0){for(var ae=te.makeLineSpan("hline",n,c),Le=te.makeLineSpan("hdashline",n,c),De=[{type:"elem",elem:l,shift:0}];u.length>0;){var qe=u.pop(),Ue=qe.pos-M;qe.isDashed?De.push({type:"elem",elem:Le,shift:Ue}):De.push({type:"elem",elem:ae,shift:Ue})}l=te.makeVList({positionType:"individualShift",children:De},n)}if(P.length===0)return te.makeSpan(["mord"],[l],n);var ve=te.makeVList({positionType:"individualShift",children:P},n);return ve=te.makeSpan(["tag"],[ve],n),te.makeFragment([l,ve])},Y3e={c:"center ",l:"left ",r:"right "},gi=function(e,n){for(var r=[],s=new me.MathNode("mtd",[],["mtr-glue"]),i=new me.MathNode("mtd",[],["mml-eqn-num"]),o=0;o<e.body.length;o++){for(var a=e.body[o],l=[],u=0;u<a.length;u++)l.push(new me.MathNode("mtd",[St(a[u],n)]));e.tags&&e.tags[o]&&(l.unshift(s),l.push(s),e.leqno?l.unshift(i):l.push(i)),r.push(new me.MathNode("mtr",l))}var c=new me.MathNode("mtable",r),h=e.arraystretch===.5?.1:.16+e.arraystretch-1+(e.addJot?.09:0);c.setAttribute("rowspacing",ye(h));var f="",d="";if(e.cols&&e.cols.length>0){var p=e.cols,g="",m=!1,b=0,x=p.length;p[0].type==="separator"&&(f+="top ",b=1),p[p.length-1].type==="separator"&&(f+="bottom ",x-=1);for(var v=b;v<x;v++)p[v].type==="align"?(d+=Y3e[p[v].align],m&&(g+="none "),m=!0):p[v].type==="separator"&&m&&(g+=p[v].separator==="|"?"solid ":"dashed ",m=!1);c.setAttribute("columnalign",d.trim()),/[sd]/.test(g)&&c.setAttribute("columnlines",g.trim())}if(e.colSeparationType==="align"){for(var y=e.cols||[],w="",C=1;C<y.length;C++)w+=C%2?"0em ":"1em ";c.setAttribute("columnspacing",w.trim())}else e.colSeparationType==="alignat"||e.colSeparationType==="gather"?c.setAttribute("columnspacing","0em"):e.colSeparationType==="small"?c.setAttribute("columnspacing","0.2778em"):e.colSeparationType==="CD"?c.setAttribute("columnspacing","0.5em"):c.setAttribute("columnspacing","1em");var T="",N=e.hLinesBeforeRow;f+=N[0].length>0?"left ":"",f+=N[N.length-1].length>0?"right ":"";for(var $=1;$<N.length-1;$++)T+=N[$].length===0?"none ":N[$][0]?"dashed ":"solid ";return/[sd]/.test(T)&&c.setAttribute("rowlines",T.trim()),f!==""&&(c=new me.MathNode("menclose",[c]),c.setAttribute("notation",f.trim())),e.arraystretch&&e.arraystretch<1&&(c=new me.MathNode("mstyle",[c]),c.setAttribute("scriptlevel","1")),c},FR=function(e,n){e.envName.indexOf("ed")===-1&&ng(e);var r=[],s=e.envName.indexOf("at")>-1?"alignat":"align",i=e.envName==="split",o=Ko(e.parser,{cols:r,addJot:!0,autoTag:i?void 0:U3(e.envName),emptySingleRow:!0,colSeparationType:s,maxNumCols:i?2:void 0,leqno:e.parser.settings.leqno},"display"),a,l=0,u={type:"ordgroup",mode:e.mode,body:[]};if(n[0]&&n[0].type==="ordgroup"){for(var c="",h=0;h<n[0].body.length;h++){var f=Je(n[0].body[h],"textord");c+=f.text}a=Number(c),l=a*2}var d=!l;o.body.forEach(function(b){for(var x=1;x<b.length;x+=2){var v=Je(b[x],"styling"),y=Je(v.body[0],"ordgroup");y.body.unshift(u)}if(d)l<b.length&&(l=b.length);else{var w=b.length/2;if(a<w)throw new Me("Too many math in a row: "+("expected "+a+", but got "+w),b[0])}});for(var p=0;p<l;++p){var g="r",m=0;p%2===1?g="l":p>0&&d&&(m=1),r[p]={type:"align",align:g,pregap:m,postgap:0}}return o.colSeparationType=d?"align":"alignat",o};pi({type:"array",names:["array","darray"],props:{numArgs:1},handler(t,e){var n=Qm(e[0]),r=n?[e[0]]:Je(e[0],"ordgroup").body,s=r.map(function(o){var a=z3(o),l=a.text;if("lcr".indexOf(l)!==-1)return{type:"align",align:l};if(l==="|")return{type:"separator",separator:"|"};if(l===":")return{type:"separator",separator:":"};throw new Me("Unknown column alignment: "+l,o)}),i={cols:s,hskipBeforeAndAfter:!0,maxNumCols:s.length};return Ko(t.parser,i,G3(t.envName))},htmlBuilder:mi,mathmlBuilder:gi});pi({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(t){var e={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[t.envName.replace("*","")],n="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:n}]};if(t.envName.charAt(t.envName.length-1)==="*"){var s=t.parser;if(s.consumeSpaces(),s.fetch().text==="["){if(s.consume(),s.consumeSpaces(),n=s.fetch().text,"lcr".indexOf(n)===-1)throw new Me("Expected l or c or r",s.nextToken);s.consume(),s.consumeSpaces(),s.expect("]"),s.consume(),r.cols=[{type:"align",align:n}]}}var i=Ko(t.parser,r,G3(t.envName)),o=Math.max(0,...i.body.map(a=>a.length));return i.cols=new Array(o).fill({type:"align",align:n}),e?{type:"leftright",mode:t.mode,body:[i],left:e[0],right:e[1],rightColor:void 0}:i},htmlBuilder:mi,mathmlBuilder:gi});pi({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(t){var e={arraystretch:.5},n=Ko(t.parser,e,"script");return n.colSeparationType="small",n},htmlBuilder:mi,mathmlBuilder:gi});pi({type:"array",names:["subarray"],props:{numArgs:1},handler(t,e){var n=Qm(e[0]),r=n?[e[0]]:Je(e[0],"ordgroup").body,s=r.map(function(o){var a=z3(o),l=a.text;if("lc".indexOf(l)!==-1)return{type:"align",align:l};throw new Me("Unknown column alignment: "+l,o)});if(s.length>1)throw new Me("{subarray} can contain only one column");var i={cols:s,hskipBeforeAndAfter:!1,arraystretch:.5};if(i=Ko(t.parser,i,"script"),i.body.length>0&&i.body[0].length>1)throw new Me("{subarray} can contain only one column");return i},htmlBuilder:mi,mathmlBuilder:gi});pi({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(t){var e={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},n=Ko(t.parser,e,G3(t.envName));return{type:"leftright",mode:t.mode,body:[n],left:t.envName.indexOf("r")>-1?".":"\\{",right:t.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:mi,mathmlBuilder:gi});pi({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:FR,htmlBuilder:mi,mathmlBuilder:gi});pi({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(t){Be.contains(["gather","gather*"],t.envName)&&ng(t);var e={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:U3(t.envName),emptySingleRow:!0,leqno:t.parser.settings.leqno};return Ko(t.parser,e,"display")},htmlBuilder:mi,mathmlBuilder:gi});pi({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:FR,htmlBuilder:mi,mathmlBuilder:gi});pi({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(t){ng(t);var e={autoTag:U3(t.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:t.parser.settings.leqno};return Ko(t.parser,e,"display")},htmlBuilder:mi,mathmlBuilder:gi});pi({type:"array",names:["CD"],props:{numArgs:0},handler(t){return ng(t),F3e(t.parser)},htmlBuilder:mi,mathmlBuilder:gi});O("\\nonumber","\\gdef\\@eqnsw{0}");O("\\notag","\\nonumber");Se({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(t,e){throw new Me(t.funcName+" valid only within array environment")}});var $8=MR;Se({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(t,e){var{parser:n,funcName:r}=t,s=e[0];if(s.type!=="ordgroup")throw new Me("Invalid environment name",s);for(var i="",o=0;o<s.body.length;++o)i+=Je(s.body[o],"textord").text;if(r==="\\begin"){if(!$8.hasOwnProperty(i))throw new Me("No such environment: "+i,s);var a=$8[i],{args:l,optArgs:u}=n.parseArguments("\\begin{"+i+"}",a),c={mode:n.mode,envName:i,parser:n},h=a.handler(c,l,u);n.expect("\\end",!1);var f=n.nextToken,d=Je(n.parseFunction(),"environment");if(d.name!==i)throw new Me("Mismatch: \\begin{"+i+"} matched by \\end{"+d.name+"}",f);return h}return{type:"environment",mode:n.mode,name:i,nameGroup:s}}});var OR=(t,e)=>{var n=t.font,r=e.withFont(n);return ct(t.body,r)},LR=(t,e)=>{var n=t.font,r=e.withFont(n);return St(t.body,r)},I8={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};Se({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=_p(e[0]),i=r;return i in I8&&(i=I8[i]),{type:"font",mode:n.mode,font:i.slice(1),body:s}},htmlBuilder:OR,mathmlBuilder:LR});Se({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(t,e)=>{var{parser:n}=t,r=e[0],s=Be.isCharacterBox(r);return{type:"mclass",mode:n.mode,mclass:eg(r),body:[{type:"font",mode:n.mode,font:"boldsymbol",body:r}],isCharacterBox:s}}});Se({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(t,e)=>{var{parser:n,funcName:r,breakOnTokenText:s}=t,{mode:i}=n,o=n.parseExpression(!0,s),a="math"+r.slice(1);return{type:"font",mode:i,font:a,body:{type:"ordgroup",mode:n.mode,body:o}}},htmlBuilder:OR,mathmlBuilder:LR});var zR=(t,e)=>{var n=e;return t==="display"?n=n.id>=Ve.SCRIPT.id?n.text():Ve.DISPLAY:t==="text"&&n.size===Ve.DISPLAY.size?n=Ve.TEXT:t==="script"?n=Ve.SCRIPT:t==="scriptscript"&&(n=Ve.SCRIPTSCRIPT),n},H3=(t,e)=>{var n=zR(t.size,e.style),r=n.fracNum(),s=n.fracDen(),i;i=e.havingStyle(r);var o=ct(t.numer,i,e);if(t.continued){var a=8.5/e.fontMetrics().ptPerEm,l=3.5/e.fontMetrics().ptPerEm;o.height=o.height<a?a:o.height,o.depth=o.depth<l?l:o.depth}i=e.havingStyle(s);var u=ct(t.denom,i,e),c,h,f;t.hasBarLine?(t.barSize?(h=Ot(t.barSize,e),c=te.makeLineSpan("frac-line",e,h)):c=te.makeLineSpan("frac-line",e),h=c.height,f=c.height):(c=null,h=0,f=e.fontMetrics().defaultRuleThickness);var d,p,g;n.size===Ve.DISPLAY.size||t.size==="display"?(d=e.fontMetrics().num1,h>0?p=3*f:p=7*f,g=e.fontMetrics().denom1):(h>0?(d=e.fontMetrics().num2,p=f):(d=e.fontMetrics().num3,p=3*f),g=e.fontMetrics().denom2);var m;if(c){var x=e.fontMetrics().axisHeight;d-o.depth-(x+.5*h)<p&&(d+=p-(d-o.depth-(x+.5*h))),x-.5*h-(u.height-g)<p&&(g+=p-(x-.5*h-(u.height-g)));var v=-(x-.5*h);m=te.makeVList({positionType:"individualShift",children:[{type:"elem",elem:u,shift:g},{type:"elem",elem:c,shift:v},{type:"elem",elem:o,shift:-d}]},e)}else{var b=d-o.depth-(u.height-g);b<p&&(d+=.5*(p-b),g+=.5*(p-b)),m=te.makeVList({positionType:"individualShift",children:[{type:"elem",elem:u,shift:g},{type:"elem",elem:o,shift:-d}]},e)}i=e.havingStyle(n),m.height*=i.sizeMultiplier/e.sizeMultiplier,m.depth*=i.sizeMultiplier/e.sizeMultiplier;var y;n.size===Ve.DISPLAY.size?y=e.fontMetrics().delim1:n.size===Ve.SCRIPTSCRIPT.size?y=e.havingStyle(Ve.SCRIPT).fontMetrics().delim2:y=e.fontMetrics().delim2;var w,C;return t.leftDelim==null?w=mh(e,["mopen"]):w=Mi.customSizedDelim(t.leftDelim,y,!0,e.havingStyle(n),t.mode,["mopen"]),t.continued?C=te.makeSpan([]):t.rightDelim==null?C=mh(e,["mclose"]):C=Mi.customSizedDelim(t.rightDelim,y,!0,e.havingStyle(n),t.mode,["mclose"]),te.makeSpan(["mord"].concat(i.sizingClasses(e)),[w,te.makeSpan(["mfrac"],[m]),C],e)},q3=(t,e)=>{var n=new me.MathNode("mfrac",[St(t.numer,e),St(t.denom,e)]);if(!t.hasBarLine)n.setAttribute("linethickness","0px");else if(t.barSize){var r=Ot(t.barSize,e);n.setAttribute("linethickness",ye(r))}var s=zR(t.size,e.style);if(s.size!==e.style.size){n=new me.MathNode("mstyle",[n]);var i=s.size===Ve.DISPLAY.size?"true":"false";n.setAttribute("displaystyle",i),n.setAttribute("scriptlevel","0")}if(t.leftDelim!=null||t.rightDelim!=null){var o=[];if(t.leftDelim!=null){var a=new me.MathNode("mo",[new me.TextNode(t.leftDelim.replace("\\",""))]);a.setAttribute("fence","true"),o.push(a)}if(o.push(n),t.rightDelim!=null){var l=new me.MathNode("mo",[new me.TextNode(t.rightDelim.replace("\\",""))]);l.setAttribute("fence","true"),o.push(l)}return O3(o)}return n};Se({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0],i=e[1],o,a=null,l=null,u="auto";switch(r){case"\\dfrac":case"\\frac":case"\\tfrac":o=!0;break;case"\\\\atopfrac":o=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":o=!1,a="(",l=")";break;case"\\\\bracefrac":o=!1,a="\\{",l="\\}";break;case"\\\\brackfrac":o=!1,a="[",l="]";break;default:throw new Error("Unrecognized genfrac command")}switch(r){case"\\dfrac":case"\\dbinom":u="display";break;case"\\tfrac":case"\\tbinom":u="text";break}return{type:"genfrac",mode:n.mode,continued:!1,numer:s,denom:i,hasBarLine:o,leftDelim:a,rightDelim:l,size:u,barSize:null}},htmlBuilder:H3,mathmlBuilder:q3});Se({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0],i=e[1];return{type:"genfrac",mode:n.mode,continued:!0,numer:s,denom:i,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});Se({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(t){var{parser:e,funcName:n,token:r}=t,s;switch(n){case"\\over":s="\\frac";break;case"\\choose":s="\\binom";break;case"\\atop":s="\\\\atopfrac";break;case"\\brace":s="\\\\bracefrac";break;case"\\brack":s="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:s,token:r}}});var T8=["display","text","script","scriptscript"],N8=function(e){var n=null;return e.length>0&&(n=e,n=n==="."?null:n),n};Se({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(t,e){var{parser:n}=t,r=e[4],s=e[5],i=_p(e[0]),o=i.type==="atom"&&i.family==="open"?N8(i.text):null,a=_p(e[1]),l=a.type==="atom"&&a.family==="close"?N8(a.text):null,u=Je(e[2],"size"),c,h=null;u.isBlank?c=!0:(h=u.value,c=h.number>0);var f="auto",d=e[3];if(d.type==="ordgroup"){if(d.body.length>0){var p=Je(d.body[0],"textord");f=T8[Number(p.text)]}}else d=Je(d,"textord"),f=T8[Number(d.text)];return{type:"genfrac",mode:n.mode,numer:r,denom:s,continued:!1,hasBarLine:c,barSize:h,leftDelim:o,rightDelim:l,size:f}},htmlBuilder:H3,mathmlBuilder:q3});Se({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(t,e){var{parser:n,funcName:r,token:s}=t;return{type:"infix",mode:n.mode,replaceWith:"\\\\abovefrac",size:Je(e[0],"size").value,token:s}}});Se({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0],i=Ave(Je(e[1],"infix").size),o=e[2],a=i.number>0;return{type:"genfrac",mode:n.mode,numer:s,denom:o,continued:!1,hasBarLine:a,barSize:i,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:H3,mathmlBuilder:q3});var PR=(t,e)=>{var n=e.style,r,s;t.type==="supsub"?(r=t.sup?ct(t.sup,e.havingStyle(n.sup()),e):ct(t.sub,e.havingStyle(n.sub()),e),s=Je(t.base,"horizBrace")):s=Je(t,"horizBrace");var i=ct(s.base,e.havingBaseStyle(Ve.DISPLAY)),o=Vi.svgSpan(s,e),a;if(s.isOver?(a=te.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:i},{type:"kern",size:.1},{type:"elem",elem:o}]},e),a.children[0].children[0].children[1].classes.push("svg-align")):(a=te.makeVList({positionType:"bottom",positionData:i.depth+.1+o.height,children:[{type:"elem",elem:o},{type:"kern",size:.1},{type:"elem",elem:i}]},e),a.children[0].children[0].children[0].classes.push("svg-align")),r){var l=te.makeSpan(["mord",s.isOver?"mover":"munder"],[a],e);s.isOver?a=te.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:.2},{type:"elem",elem:r}]},e):a=te.makeVList({positionType:"bottom",positionData:l.depth+.2+r.height+r.depth,children:[{type:"elem",elem:r},{type:"kern",size:.2},{type:"elem",elem:l}]},e)}return te.makeSpan(["mord",s.isOver?"mover":"munder"],[a],e)},Z3e=(t,e)=>{var n=Vi.mathMLnode(t.label);return new me.MathNode(t.isOver?"mover":"munder",[St(t.base,e),n])};Se({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(t,e){var{parser:n,funcName:r}=t;return{type:"horizBrace",mode:n.mode,label:r,isOver:/^\\over/.test(r),base:e[0]}},htmlBuilder:PR,mathmlBuilder:Z3e});Se({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[1],s=Je(e[0],"url").url;return n.settings.isTrusted({command:"\\href",url:s})?{type:"href",mode:n.mode,href:s,body:Yt(r)}:n.formatUnsupportedCmd("\\href")},htmlBuilder:(t,e)=>{var n=En(t.body,e,!1);return te.makeAnchor(t.href,[],n,e)},mathmlBuilder:(t,e)=>{var n=Ro(t.body,e);return n instanceof Jr||(n=new Jr("mrow",[n])),n.setAttribute("href",t.href),n}});Se({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=Je(e[0],"url").url;if(!n.settings.isTrusted({command:"\\url",url:r}))return n.formatUnsupportedCmd("\\url");for(var s=[],i=0;i<r.length;i++){var o=r[i];o==="~"&&(o="\\textasciitilde"),s.push({type:"textord",mode:"text",text:o})}var a={type:"text",mode:n.mode,font:"\\texttt",body:s};return{type:"href",mode:n.mode,href:r,body:Yt(a)}}});Se({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(t,e){var{parser:n}=t;return{type:"hbox",mode:n.mode,body:Yt(e[0])}},htmlBuilder(t,e){var n=En(t.body,e,!1);return te.makeFragment(n)},mathmlBuilder(t,e){return new me.MathNode("mrow",Wr(t.body,e))}});Se({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(t,e)=>{var{parser:n,funcName:r,token:s}=t,i=Je(e[0],"raw").string,o=e[1];n.settings.strict&&n.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var a,l={};switch(r){case"\\htmlClass":l.class=i,a={command:"\\htmlClass",class:i};break;case"\\htmlId":l.id=i,a={command:"\\htmlId",id:i};break;case"\\htmlStyle":l.style=i,a={command:"\\htmlStyle",style:i};break;case"\\htmlData":{for(var u=i.split(","),c=0;c<u.length;c++){var h=u[c].split("=");if(h.length!==2)throw new Me("Error parsing key-value for \\htmlData");l["data-"+h[0].trim()]=h[1].trim()}a={command:"\\htmlData",attributes:l};break}default:throw new Error("Unrecognized html command")}return n.settings.isTrusted(a)?{type:"html",mode:n.mode,attributes:l,body:Yt(o)}:n.formatUnsupportedCmd(r)},htmlBuilder:(t,e)=>{var n=En(t.body,e,!1),r=["enclosing"];t.attributes.class&&r.push(...t.attributes.class.trim().split(/\s+/));var s=te.makeSpan(r,n,e);for(var i in t.attributes)i!=="class"&&t.attributes.hasOwnProperty(i)&&s.setAttribute(i,t.attributes[i]);return s},mathmlBuilder:(t,e)=>Ro(t.body,e)});Se({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t;return{type:"htmlmathml",mode:n.mode,html:Yt(e[0]),mathml:Yt(e[1])}},htmlBuilder:(t,e)=>{var n=En(t.html,e,!1);return te.makeFragment(n)},mathmlBuilder:(t,e)=>Ro(t.mathml,e)});var $2=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var n=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!n)throw new Me("Invalid size: '"+e+"' in \\includegraphics");var r={number:+(n[1]+n[2]),unit:n[3]};if(!Zve(r))throw new Me("Invalid unit: '"+r.unit+"' in \\includegraphics.");return r};Se({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(t,e,n)=>{var{parser:r}=t,s={number:0,unit:"em"},i={number:.9,unit:"em"},o={number:0,unit:"em"},a="";if(n[0])for(var l=Je(n[0],"raw").string,u=l.split(","),c=0;c<u.length;c++){var h=u[c].split("=");if(h.length===2){var f=h[1].trim();switch(h[0].trim()){case"alt":a=f;break;case"width":s=$2(f);break;case"height":i=$2(f);break;case"totalheight":o=$2(f);break;default:throw new Me("Invalid key: '"+h[0]+"' in \\includegraphics.")}}}var d=Je(e[0],"url").url;return a===""&&(a=d,a=a.replace(/^.*[\\/]/,""),a=a.substring(0,a.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:d})?{type:"includegraphics",mode:r.mode,alt:a,width:s,height:i,totalheight:o,src:d}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(t,e)=>{var n=Ot(t.height,e),r=0;t.totalheight.number>0&&(r=Ot(t.totalheight,e)-n);var s=0;t.width.number>0&&(s=Ot(t.width,e));var i={height:ye(n+r)};s>0&&(i.width=ye(s)),r>0&&(i.verticalAlign=ye(-r));var o=new Qve(t.src,t.alt,i);return o.height=n,o.depth=r,o},mathmlBuilder:(t,e)=>{var n=new me.MathNode("mglyph",[]);n.setAttribute("alt",t.alt);var r=Ot(t.height,e),s=0;if(t.totalheight.number>0&&(s=Ot(t.totalheight,e)-r,n.setAttribute("valign",ye(-s))),n.setAttribute("height",ye(r+s)),t.width.number>0){var i=Ot(t.width,e);n.setAttribute("width",ye(i))}return n.setAttribute("src",t.src),n}});Se({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(t,e){var{parser:n,funcName:r}=t,s=Je(e[0],"size");if(n.settings.strict){var i=r[1]==="m",o=s.value.unit==="mu";i?(o||n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, "+("not "+s.value.unit+" units")),n.mode!=="math"&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):o&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:n.mode,dimension:s.value}},htmlBuilder(t,e){return te.makeGlue(t.dimension,e)},mathmlBuilder(t,e){var n=Ot(t.dimension,e);return new me.SpaceNode(n)}});Se({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0];return{type:"lap",mode:n.mode,alignment:r.slice(5),body:s}},htmlBuilder:(t,e)=>{var n;t.alignment==="clap"?(n=te.makeSpan([],[ct(t.body,e)]),n=te.makeSpan(["inner"],[n],e)):n=te.makeSpan(["inner"],[ct(t.body,e)]);var r=te.makeSpan(["fix"],[]),s=te.makeSpan([t.alignment],[n,r],e),i=te.makeSpan(["strut"]);return i.style.height=ye(s.height+s.depth),s.depth&&(i.style.verticalAlign=ye(-s.depth)),s.children.unshift(i),s=te.makeSpan(["thinbox"],[s],e),te.makeSpan(["mord","vbox"],[s],e)},mathmlBuilder:(t,e)=>{var n=new me.MathNode("mpadded",[St(t.body,e)]);if(t.alignment!=="rlap"){var r=t.alignment==="llap"?"-1":"-0.5";n.setAttribute("lspace",r+"width")}return n.setAttribute("width","0px"),n}});Se({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(t,e){var{funcName:n,parser:r}=t,s=r.mode;r.switchMode("math");var i=n==="\\("?"\\)":"$",o=r.parseExpression(!1,i);return r.expect(i),r.switchMode(s),{type:"styling",mode:r.mode,style:"text",body:o}}});Se({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(t,e){throw new Me("Mismatched "+t.funcName)}});var _8=(t,e)=>{switch(e.style.size){case Ve.DISPLAY.size:return t.display;case Ve.TEXT.size:return t.text;case Ve.SCRIPT.size:return t.script;case Ve.SCRIPTSCRIPT.size:return t.scriptscript;default:return t.text}};Se({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(t,e)=>{var{parser:n}=t;return{type:"mathchoice",mode:n.mode,display:Yt(e[0]),text:Yt(e[1]),script:Yt(e[2]),scriptscript:Yt(e[3])}},htmlBuilder:(t,e)=>{var n=_8(t,e),r=En(n,e,!1);return te.makeFragment(r)},mathmlBuilder:(t,e)=>{var n=_8(t,e);return Ro(n,e)}});var BR=(t,e,n,r,s,i,o)=>{t=te.makeSpan([],[t]);var a=n&&Be.isCharacterBox(n),l,u;if(e){var c=ct(e,r.havingStyle(s.sup()),r);u={elem:c,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-c.depth)}}if(n){var h=ct(n,r.havingStyle(s.sub()),r);l={elem:h,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-h.height)}}var f;if(u&&l){var d=r.fontMetrics().bigOpSpacing5+l.elem.height+l.elem.depth+l.kern+t.depth+o;f=te.makeVList({positionType:"bottom",positionData:d,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:l.elem,marginLeft:ye(-i)},{type:"kern",size:l.kern},{type:"elem",elem:t},{type:"kern",size:u.kern},{type:"elem",elem:u.elem,marginLeft:ye(i)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(l){var p=t.height-o;f=te.makeVList({positionType:"top",positionData:p,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:l.elem,marginLeft:ye(-i)},{type:"kern",size:l.kern},{type:"elem",elem:t}]},r)}else if(u){var g=t.depth+o;f=te.makeVList({positionType:"bottom",positionData:g,children:[{type:"elem",elem:t},{type:"kern",size:u.kern},{type:"elem",elem:u.elem,marginLeft:ye(i)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else return t;var m=[f];if(l&&i!==0&&!a){var b=te.makeSpan(["mspace"],[],r);b.style.marginRight=ye(i),m.unshift(b)}return te.makeSpan(["mop","op-limits"],m,r)},VR=["\\smallint"],Ku=(t,e)=>{var n,r,s=!1,i;t.type==="supsub"?(n=t.sup,r=t.sub,i=Je(t.base,"op"),s=!0):i=Je(t,"op");var o=e.style,a=!1;o.size===Ve.DISPLAY.size&&i.symbol&&!Be.contains(VR,i.name)&&(a=!0);var l;if(i.symbol){var u=a?"Size2-Regular":"Size1-Regular",c="";if((i.name==="\\oiint"||i.name==="\\oiiint")&&(c=i.name.slice(1),i.name=c==="oiint"?"\\iint":"\\iiint"),l=te.makeSymbol(i.name,u,"math",e,["mop","op-symbol",a?"large-op":"small-op"]),c.length>0){var h=l.italic,f=te.staticSvg(c+"Size"+(a?"2":"1"),e);l=te.makeVList({positionType:"individualShift",children:[{type:"elem",elem:l,shift:0},{type:"elem",elem:f,shift:a?.08:0}]},e),i.name="\\"+c,l.classes.unshift("mop"),l.italic=h}}else if(i.body){var d=En(i.body,e,!0);d.length===1&&d[0]instanceof ci?(l=d[0],l.classes[0]="mop"):l=te.makeSpan(["mop"],d,e)}else{for(var p=[],g=1;g<i.name.length;g++)p.push(te.mathsym(i.name[g],i.mode,e));l=te.makeSpan(["mop"],p,e)}var m=0,b=0;return(l instanceof ci||i.name==="\\oiint"||i.name==="\\oiiint")&&!i.suppressBaseShift&&(m=(l.height-l.depth)/2-e.fontMetrics().axisHeight,b=l.italic),s?BR(l,n,r,e,o,b,m):(m&&(l.style.position="relative",l.style.top=ye(m)),l)},X0=(t,e)=>{var n;if(t.symbol)n=new Jr("mo",[as(t.name,t.mode)]),Be.contains(VR,t.name)&&n.setAttribute("largeop","false");else if(t.body)n=new Jr("mo",Wr(t.body,e));else{n=new Jr("mi",[new qs(t.name.slice(1))]);var r=new Jr("mo",[as("","text")]);t.parentIsSupSub?n=new Jr("mrow",[n,r]):n=xR([n,r])}return n},J3e={"":"\\prod","":"\\coprod","":"\\sum","":"\\bigwedge","":"\\bigvee","":"\\bigcap","":"\\bigcup","":"\\bigodot","":"\\bigoplus","":"\\bigotimes","":"\\biguplus","":"\\bigsqcup"};Se({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","","","","","","","","","","","",""],props:{numArgs:0},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=r;return s.length===1&&(s=J3e[s]),{type:"op",mode:n.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:s}},htmlBuilder:Ku,mathmlBuilder:X0});Se({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"op",mode:n.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:Yt(r)}},htmlBuilder:Ku,mathmlBuilder:X0});var Q3e={"":"\\int","":"\\iint","":"\\iiint","":"\\oint","":"\\oiint","":"\\oiiint"};Se({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(t){var{parser:e,funcName:n}=t;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:Ku,mathmlBuilder:X0});Se({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(t){var{parser:e,funcName:n}=t;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:Ku,mathmlBuilder:X0});Se({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","","","","","",""],props:{numArgs:0},handler(t){var{parser:e,funcName:n}=t,r=n;return r.length===1&&(r=Q3e[r]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:Ku,mathmlBuilder:X0});var WR=(t,e)=>{var n,r,s=!1,i;t.type==="supsub"?(n=t.sup,r=t.sub,i=Je(t.base,"operatorname"),s=!0):i=Je(t,"operatorname");var o;if(i.body.length>0){for(var a=i.body.map(h=>{var f=h.text;return typeof f=="string"?{type:"textord",mode:h.mode,text:f}:h}),l=En(a,e.withFont("mathrm"),!0),u=0;u<l.length;u++){var c=l[u];c instanceof ci&&(c.text=c.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}o=te.makeSpan(["mop"],l,e)}else o=te.makeSpan(["mop"],[],e);return s?BR(o,n,r,e,e.style,0,0):o},ewe=(t,e)=>{for(var n=Wr(t.body,e.withFont("mathrm")),r=!0,s=0;s<n.length;s++){var i=n[s];if(!(i instanceof me.SpaceNode))if(i instanceof me.MathNode)switch(i.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var o=i.children[0];i.children.length===1&&o instanceof me.TextNode?o.text=o.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break}default:r=!1}else r=!1}if(r){var a=n.map(c=>c.toText()).join("");n=[new me.TextNode(a)]}var l=new me.MathNode("mi",n);l.setAttribute("mathvariant","normal");var u=new me.MathNode("mo",[as("","text")]);return t.parentIsSupSub?new me.MathNode("mrow",[l,u]):me.newDocumentFragment([l,u])};Se({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0];return{type:"operatorname",mode:n.mode,body:Yt(s),alwaysHandleSupSub:r==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:WR,mathmlBuilder:ewe});O("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");gl({type:"ordgroup",htmlBuilder(t,e){return t.semisimple?te.makeFragment(En(t.body,e,!1)):te.makeSpan(["mord"],En(t.body,e,!0),e)},mathmlBuilder(t,e){return Ro(t.body,e,!0)}});Se({type:"overline",names:["\\overline"],props:{numArgs:1},handler(t,e){var{parser:n}=t,r=e[0];return{type:"overline",mode:n.mode,body:r}},htmlBuilder(t,e){var n=ct(t.body,e.havingCrampedStyle()),r=te.makeLineSpan("overline-line",e),s=e.fontMetrics().defaultRuleThickness,i=te.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n},{type:"kern",size:3*s},{type:"elem",elem:r},{type:"kern",size:s}]},e);return te.makeSpan(["mord","overline"],[i],e)},mathmlBuilder(t,e){var n=new me.MathNode("mo",[new me.TextNode("")]);n.setAttribute("stretchy","true");var r=new me.MathNode("mover",[St(t.body,e),n]);return r.setAttribute("accent","true"),r}});Se({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"phantom",mode:n.mode,body:Yt(r)}},htmlBuilder:(t,e)=>{var n=En(t.body,e.withPhantom(),!1);return te.makeFragment(n)},mathmlBuilder:(t,e)=>{var n=Wr(t.body,e);return new me.MathNode("mphantom",n)}});Se({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"hphantom",mode:n.mode,body:r}},htmlBuilder:(t,e)=>{var n=te.makeSpan([],[ct(t.body,e.withPhantom())]);if(n.height=0,n.depth=0,n.children)for(var r=0;r<n.children.length;r++)n.children[r].height=0,n.children[r].depth=0;return n=te.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},e),te.makeSpan(["mord"],[n],e)},mathmlBuilder:(t,e)=>{var n=Wr(Yt(t.body),e),r=new me.MathNode("mphantom",n),s=new me.MathNode("mpadded",[r]);return s.setAttribute("height","0px"),s.setAttribute("depth","0px"),s}});Se({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"vphantom",mode:n.mode,body:r}},htmlBuilder:(t,e)=>{var n=te.makeSpan(["inner"],[ct(t.body,e.withPhantom())]),r=te.makeSpan(["fix"],[]);return te.makeSpan(["mord","rlap"],[n,r],e)},mathmlBuilder:(t,e)=>{var n=Wr(Yt(t.body),e),r=new me.MathNode("mphantom",n),s=new me.MathNode("mpadded",[r]);return s.setAttribute("width","0px"),s}});Se({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(t,e){var{parser:n}=t,r=Je(e[0],"size").value,s=e[1];return{type:"raisebox",mode:n.mode,dy:r,body:s}},htmlBuilder(t,e){var n=ct(t.body,e),r=Ot(t.dy,e);return te.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:n}]},e)},mathmlBuilder(t,e){var n=new me.MathNode("mpadded",[St(t.body,e)]),r=t.dy.number+t.dy.unit;return n.setAttribute("voffset",r),n}});Se({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0,allowedInArgument:!0},handler(t){var{parser:e}=t;return{type:"internal",mode:e.mode}}});Se({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(t,e,n){var{parser:r}=t,s=n[0],i=Je(e[0],"size"),o=Je(e[1],"size");return{type:"rule",mode:r.mode,shift:s&&Je(s,"size").value,width:i.value,height:o.value}},htmlBuilder(t,e){var n=te.makeSpan(["mord","rule"],[],e),r=Ot(t.width,e),s=Ot(t.height,e),i=t.shift?Ot(t.shift,e):0;return n.style.borderRightWidth=ye(r),n.style.borderTopWidth=ye(s),n.style.bottom=ye(i),n.width=r,n.height=s+i,n.depth=-i,n.maxFontSize=s*1.125*e.sizeMultiplier,n},mathmlBuilder(t,e){var n=Ot(t.width,e),r=Ot(t.height,e),s=t.shift?Ot(t.shift,e):0,i=e.color&&e.getColor()||"black",o=new me.MathNode("mspace");o.setAttribute("mathbackground",i),o.setAttribute("width",ye(n)),o.setAttribute("height",ye(r));var a=new me.MathNode("mpadded",[o]);return s>=0?a.setAttribute("height",ye(s)):(a.setAttribute("height",ye(s)),a.setAttribute("depth",ye(-s))),a.setAttribute("voffset",ye(s)),a}});function UR(t,e,n){for(var r=En(t,e,!1),s=e.sizeMultiplier/n.sizeMultiplier,i=0;i<r.length;i++){var o=r[i].classes.indexOf("sizing");o<0?Array.prototype.push.apply(r[i].classes,e.sizingClasses(n)):r[i].classes[o+1]==="reset-size"+e.size&&(r[i].classes[o+1]="reset-size"+n.size),r[i].height*=s,r[i].depth*=s}return te.makeFragment(r)}var A8=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],twe=(t,e)=>{var n=e.havingSize(t.size);return UR(t.body,n,e)};Se({type:"sizing",names:A8,props:{numArgs:0,allowedInText:!0},handler:(t,e)=>{var{breakOnTokenText:n,funcName:r,parser:s}=t,i=s.parseExpression(!1,n);return{type:"sizing",mode:s.mode,size:A8.indexOf(r)+1,body:i}},htmlBuilder:twe,mathmlBuilder:(t,e)=>{var n=e.havingSize(t.size),r=Wr(t.body,n),s=new me.MathNode("mstyle",r);return s.setAttribute("mathsize",ye(n.sizeMultiplier)),s}});Se({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(t,e,n)=>{var{parser:r}=t,s=!1,i=!1,o=n[0]&&Je(n[0],"ordgroup");if(o)for(var a="",l=0;l<o.body.length;++l){var u=o.body[l];if(a=u.text,a==="t")s=!0;else if(a==="b")i=!0;else{s=!1,i=!1;break}}else s=!0,i=!0;var c=e[0];return{type:"smash",mode:r.mode,body:c,smashHeight:s,smashDepth:i}},htmlBuilder:(t,e)=>{var n=te.makeSpan([],[ct(t.body,e)]);if(!t.smashHeight&&!t.smashDepth)return n;if(t.smashHeight&&(n.height=0,n.children))for(var r=0;r<n.children.length;r++)n.children[r].height=0;if(t.smashDepth&&(n.depth=0,n.children))for(var s=0;s<n.children.length;s++)n.children[s].depth=0;var i=te.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},e);return te.makeSpan(["mord"],[i],e)},mathmlBuilder:(t,e)=>{var n=new me.MathNode("mpadded",[St(t.body,e)]);return t.smashHeight&&n.setAttribute("height","0px"),t.smashDepth&&n.setAttribute("depth","0px"),n}});Se({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(t,e,n){var{parser:r}=t,s=n[0],i=e[0];return{type:"sqrt",mode:r.mode,body:i,index:s}},htmlBuilder(t,e){var n=ct(t.body,e.havingCrampedStyle());n.height===0&&(n.height=e.fontMetrics().xHeight),n=te.wrapFragment(n,e);var r=e.fontMetrics(),s=r.defaultRuleThickness,i=s;e.style.id<Ve.TEXT.id&&(i=e.fontMetrics().xHeight);var o=s+i/4,a=n.height+n.depth+o+s,{span:l,ruleWidth:u,advanceWidth:c}=Mi.sqrtImage(a,e),h=l.height-u;h>n.height+n.depth+o&&(o=(o+h-n.height-n.depth)/2);var f=l.height-n.height-o-u;n.style.paddingLeft=ye(c);var d=te.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:-(n.height+f)},{type:"elem",elem:l},{type:"kern",size:u}]},e);if(t.index){var p=e.havingStyle(Ve.SCRIPTSCRIPT),g=ct(t.index,p,e),m=.6*(d.height-d.depth),b=te.makeVList({positionType:"shift",positionData:-m,children:[{type:"elem",elem:g}]},e),x=te.makeSpan(["root"],[b]);return te.makeSpan(["mord","sqrt"],[x,d],e)}else return te.makeSpan(["mord","sqrt"],[d],e)},mathmlBuilder(t,e){var{body:n,index:r}=t;return r?new me.MathNode("mroot",[St(n,e),St(r,e)]):new me.MathNode("msqrt",[St(n,e)])}});var E8={display:Ve.DISPLAY,text:Ve.TEXT,script:Ve.SCRIPT,scriptscript:Ve.SCRIPTSCRIPT};Se({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t,e){var{breakOnTokenText:n,funcName:r,parser:s}=t,i=s.parseExpression(!0,n),o=r.slice(1,r.length-5);return{type:"styling",mode:s.mode,style:o,body:i}},htmlBuilder(t,e){var n=E8[t.style],r=e.havingStyle(n).withFont("");return UR(t.body,r,e)},mathmlBuilder(t,e){var n=E8[t.style],r=e.havingStyle(n),s=Wr(t.body,r),i=new me.MathNode("mstyle",s),o={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},a=o[t.style];return i.setAttribute("scriptlevel",a[0]),i.setAttribute("displaystyle",a[1]),i}});var nwe=function(e,n){var r=e.base;if(r)if(r.type==="op"){var s=r.limits&&(n.style.size===Ve.DISPLAY.size||r.alwaysHandleSupSub);return s?Ku:null}else if(r.type==="operatorname"){var i=r.alwaysHandleSupSub&&(n.style.size===Ve.DISPLAY.size||r.limits);return i?WR:null}else{if(r.type==="accent")return Be.isCharacterBox(r.base)?P3:null;if(r.type==="horizBrace"){var o=!e.sub;return o===r.isOver?PR:null}else return null}else return null};gl({type:"supsub",htmlBuilder(t,e){var n=nwe(t,e);if(n)return n(t,e);var{base:r,sup:s,sub:i}=t,o=ct(r,e),a,l,u=e.fontMetrics(),c=0,h=0,f=r&&Be.isCharacterBox(r);if(s){var d=e.havingStyle(e.style.sup());a=ct(s,d,e),f||(c=o.height-d.fontMetrics().supDrop*d.sizeMultiplier/e.sizeMultiplier)}if(i){var p=e.havingStyle(e.style.sub());l=ct(i,p,e),f||(h=o.depth+p.fontMetrics().subDrop*p.sizeMultiplier/e.sizeMultiplier)}var g;e.style===Ve.DISPLAY?g=u.sup1:e.style.cramped?g=u.sup3:g=u.sup2;var m=e.sizeMultiplier,b=ye(.5/u.ptPerEm/m),x=null;if(l){var v=t.base&&t.base.type==="op"&&t.base.name&&(t.base.name==="\\oiint"||t.base.name==="\\oiiint");(o instanceof ci||v)&&(x=ye(-o.italic))}var y;if(a&&l){c=Math.max(c,g,a.depth+.25*u.xHeight),h=Math.max(h,u.sub2);var w=u.defaultRuleThickness,C=4*w;if(c-a.depth-(l.height-h)<C){h=C-(c-a.depth)+l.height;var T=.8*u.xHeight-(c-a.depth);T>0&&(c+=T,h-=T)}var N=[{type:"elem",elem:l,shift:h,marginRight:b,marginLeft:x},{type:"elem",elem:a,shift:-c,marginRight:b}];y=te.makeVList({positionType:"individualShift",children:N},e)}else if(l){h=Math.max(h,u.sub1,l.height-.8*u.xHeight);var $=[{type:"elem",elem:l,marginLeft:x,marginRight:b}];y=te.makeVList({positionType:"shift",positionData:h,children:$},e)}else if(a)c=Math.max(c,g,a.depth+.25*u.xHeight),y=te.makeVList({positionType:"shift",positionData:-c,children:[{type:"elem",elem:a,marginRight:b}]},e);else throw new Error("supsub must have either sup or sub.");var _=m4(o,"right")||"mord";return te.makeSpan([_],[o,te.makeSpan(["msupsub"],[y])],e)},mathmlBuilder(t,e){var n=!1,r,s;t.base&&t.base.type==="horizBrace"&&(s=!!t.sup,s===t.base.isOver&&(n=!0,r=t.base.isOver)),t.base&&(t.base.type==="op"||t.base.type==="operatorname")&&(t.base.parentIsSupSub=!0);var i=[St(t.base,e)];t.sub&&i.push(St(t.sub,e)),t.sup&&i.push(St(t.sup,e));var o;if(n)o=r?"mover":"munder";else if(t.sub)if(t.sup){var u=t.base;u&&u.type==="op"&&u.limits&&e.style===Ve.DISPLAY||u&&u.type==="operatorname"&&u.alwaysHandleSupSub&&(e.style===Ve.DISPLAY||u.limits)?o="munderover":o="msubsup"}else{var l=t.base;l&&l.type==="op"&&l.limits&&(e.style===Ve.DISPLAY||l.alwaysHandleSupSub)||l&&l.type==="operatorname"&&l.alwaysHandleSupSub&&(l.limits||e.style===Ve.DISPLAY)?o="munder":o="msub"}else{var a=t.base;a&&a.type==="op"&&a.limits&&(e.style===Ve.DISPLAY||a.alwaysHandleSupSub)||a&&a.type==="operatorname"&&a.alwaysHandleSupSub&&(a.limits||e.style===Ve.DISPLAY)?o="mover":o="msup"}return new me.MathNode(o,i)}});gl({type:"atom",htmlBuilder(t,e){return te.mathsym(t.text,t.mode,e,["m"+t.family])},mathmlBuilder(t,e){var n=new me.MathNode("mo",[as(t.text,t.mode)]);if(t.family==="bin"){var r=L3(t,e);r==="bold-italic"&&n.setAttribute("mathvariant",r)}else t.family==="punct"?n.setAttribute("separator","true"):(t.family==="open"||t.family==="close")&&n.setAttribute("stretchy","false");return n}});var GR={mi:"italic",mn:"normal",mtext:"normal"};gl({type:"mathord",htmlBuilder(t,e){return te.makeOrd(t,e,"mathord")},mathmlBuilder(t,e){var n=new me.MathNode("mi",[as(t.text,t.mode,e)]),r=L3(t,e)||"italic";return r!==GR[n.type]&&n.setAttribute("mathvariant",r),n}});gl({type:"textord",htmlBuilder(t,e){return te.makeOrd(t,e,"textord")},mathmlBuilder(t,e){var n=as(t.text,t.mode,e),r=L3(t,e)||"normal",s;return t.mode==="text"?s=new me.MathNode("mtext",[n]):/[0-9]/.test(t.text)?s=new me.MathNode("mn",[n]):t.text==="\\prime"?s=new me.MathNode("mo",[n]):s=new me.MathNode("mi",[n]),r!==GR[s.type]&&s.setAttribute("mathvariant",r),s}});var I2={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},T2={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};gl({type:"spacing",htmlBuilder(t,e){if(T2.hasOwnProperty(t.text)){var n=T2[t.text].className||"";if(t.mode==="text"){var r=te.makeOrd(t,e,"textord");return r.classes.push(n),r}else return te.makeSpan(["mspace",n],[te.mathsym(t.text,t.mode,e)],e)}else{if(I2.hasOwnProperty(t.text))return te.makeSpan(["mspace",I2[t.text]],[],e);throw new Me('Unknown type of space "'+t.text+'"')}},mathmlBuilder(t,e){var n;if(T2.hasOwnProperty(t.text))n=new me.MathNode("mtext",[new me.TextNode("")]);else{if(I2.hasOwnProperty(t.text))return new me.MathNode("mspace");throw new Me('Unknown type of space "'+t.text+'"')}return n}});var R8=()=>{var t=new me.MathNode("mtd",[]);return t.setAttribute("width","50%"),t};gl({type:"tag",mathmlBuilder(t,e){var n=new me.MathNode("mtable",[new me.MathNode("mtr",[R8(),new me.MathNode("mtd",[Ro(t.body,e)]),R8(),new me.MathNode("mtd",[Ro(t.tag,e)])])]);return n.setAttribute("width","100%"),n}});var D8={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},M8={"\\textbf":"textbf","\\textmd":"textmd"},rwe={"\\textit":"textit","\\textup":"textup"},F8=(t,e)=>{var n=t.font;if(n){if(D8[n])return e.withTextFontFamily(D8[n]);if(M8[n])return e.withTextFontWeight(M8[n]);if(n==="\\emph")return e.fontShape==="textit"?e.withTextFontShape("textup"):e.withTextFontShape("textit")}else return e;return e.withTextFontShape(rwe[n])};Se({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(t,e){var{parser:n,funcName:r}=t,s=e[0];return{type:"text",mode:n.mode,body:Yt(s),font:r}},htmlBuilder(t,e){var n=F8(t,e),r=En(t.body,n,!0);return te.makeSpan(["mord","text"],r,n)},mathmlBuilder(t,e){var n=F8(t,e);return Ro(t.body,n)}});Se({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(t,e){var{parser:n}=t;return{type:"underline",mode:n.mode,body:e[0]}},htmlBuilder(t,e){var n=ct(t.body,e),r=te.makeLineSpan("underline-line",e),s=e.fontMetrics().defaultRuleThickness,i=te.makeVList({positionType:"top",positionData:n.height,children:[{type:"kern",size:s},{type:"elem",elem:r},{type:"kern",size:3*s},{type:"elem",elem:n}]},e);return te.makeSpan(["mord","underline"],[i],e)},mathmlBuilder(t,e){var n=new me.MathNode("mo",[new me.TextNode("")]);n.setAttribute("stretchy","true");var r=new me.MathNode("munder",[St(t.body,e),n]);return r.setAttribute("accentunder","true"),r}});Se({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(t,e){var{parser:n}=t;return{type:"vcenter",mode:n.mode,body:e[0]}},htmlBuilder(t,e){var n=ct(t.body,e),r=e.fontMetrics().axisHeight,s=.5*(n.height-r-(n.depth+r));return te.makeVList({positionType:"shift",positionData:s,children:[{type:"elem",elem:n}]},e)},mathmlBuilder(t,e){return new me.MathNode("mpadded",[St(t.body,e)],["vcenter"])}});Se({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(t,e,n){throw new Me("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(t,e){for(var n=O8(t),r=[],s=e.havingStyle(e.style.text()),i=0;i<n.length;i++){var o=n[i];o==="~"&&(o="\\textasciitilde"),r.push(te.makeSymbol(o,"Typewriter-Regular",t.mode,s,["mord","texttt"]))}return te.makeSpan(["mord","text"].concat(s.sizingClasses(e)),te.tryCombineChars(r),s)},mathmlBuilder(t,e){var n=new me.TextNode(O8(t)),r=new me.MathNode("mtext",[n]);return r.setAttribute("mathvariant","monospace"),r}});var O8=t=>t.body.replace(/ /g,t.star?"":""),swe=gR;O("\\noexpand",function(t){var e=t.popToken();return t.isExpandable(e.text)&&(e.noexpand=!0,e.treatAsRelax=!0),{tokens:[e],numArgs:0}});O("\\expandafter",function(t){var e=t.popToken();return t.expandOnce(!0),{tokens:[e],numArgs:0}});O("\\@firstoftwo",function(t){var e=t.consumeArgs(2);return{tokens:e[0],numArgs:0}});O("\\@secondoftwo",function(t){var e=t.consumeArgs(2);return{tokens:e[1],numArgs:0}});O("\\@ifnextchar",function(t){var e=t.consumeArgs(3);t.consumeSpaces();var n=t.future();return e[0].length===1&&e[0][0].text===n.text?{tokens:e[1],numArgs:0}:{tokens:e[2],numArgs:0}});O("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");O("\\TextOrMath",function(t){var e=t.consumeArgs(2);return t.mode==="text"?{tokens:e[0],numArgs:0}:{tokens:e[1],numArgs:0}});var L8={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};O("\\char",function(t){var e=t.popToken(),n,r="";if(e.text==="'")n=8,e=t.popToken();else if(e.text==='"')n=16,e=t.popToken();else if(e.text==="`")if(e=t.popToken(),e.text[0]==="\\")r=e.text.charCodeAt(1);else{if(e.text==="EOF")throw new Me("\\char` missing argument");r=e.text.charCodeAt(0)}else n=10;if(n){if(r=L8[e.text],r==null||r>=n)throw new Me("Invalid base-"+n+" digit "+e.text);for(var s;(s=L8[t.future().text])!=null&&s<n;)r*=n,r+=s,t.popToken()}return"\\@char{"+r+"}"});var X3=(t,e,n,r)=>{var s=t.consumeArg().tokens;if(s.length!==1)throw new Me("\\newcommand's first argument must be a macro name");var i=s[0].text,o=t.isDefined(i);if(o&&!e)throw new Me("\\newcommand{"+i+"} attempting to redefine "+(i+"; use \\renewcommand"));if(!o&&!n)throw new Me("\\renewcommand{"+i+"} when command "+i+" does not yet exist; use \\newcommand");var a=0;if(s=t.consumeArg().tokens,s.length===1&&s[0].text==="["){for(var l="",u=t.expandNextToken();u.text!=="]"&&u.text!=="EOF";)l+=u.text,u=t.expandNextToken();if(!l.match(/^\s*[0-9]+\s*$/))throw new Me("Invalid number of arguments: "+l);a=parseInt(l),s=t.consumeArg().tokens}return o&&r||t.macros.set(i,{tokens:s,numArgs:a}),""};O("\\newcommand",t=>X3(t,!1,!0,!1));O("\\renewcommand",t=>X3(t,!0,!1,!1));O("\\providecommand",t=>X3(t,!0,!0,!0));O("\\message",t=>{var e=t.consumeArgs(1)[0];return console.log(e.reverse().map(n=>n.text).join("")),""});O("\\errmessage",t=>{var e=t.consumeArgs(1)[0];return console.error(e.reverse().map(n=>n.text).join("")),""});O("\\show",t=>{var e=t.popToken(),n=e.text;return console.log(e,t.macros.get(n),swe[n],Zt.math[n],Zt.text[n]),""});O("\\bgroup","{");O("\\egroup","}");O("~","\\nobreakspace");O("\\lq","`");O("\\rq","'");O("\\aa","\\r a");O("\\AA","\\r A");O("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`}");O("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");O("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`}");O("","\\mathscr{B}");O("","\\mathscr{E}");O("","\\mathscr{F}");O("","\\mathscr{H}");O("","\\mathscr{I}");O("","\\mathscr{L}");O("","\\mathscr{M}");O("","\\mathscr{R}");O("","\\mathfrak{C}");O("","\\mathfrak{H}");O("","\\mathfrak{Z}");O("\\Bbbk","\\Bbb{k}");O("","\\cdotp");O("\\llap","\\mathllap{\\textrm{#1}}");O("\\rlap","\\mathrlap{\\textrm{#1}}");O("\\clap","\\mathclap{\\textrm{#1}}");O("\\mathstrut","\\vphantom{(}");O("\\underbar","\\underline{\\text{#1}}");O("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');O("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`}}");O("\\ne","\\neq");O("","\\neq");O("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`}}");O("","\\notin");O("","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`}}");O("","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`}}");O("","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`}}");O("","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`}}");O("","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`}}");O("","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`}}");O("","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`}}");O("","\\perp");O("","\\mathclose{!\\mkern-0.8mu!}");O("","\\notni");O("","\\ulcorner");O("","\\urcorner");O("","\\llcorner");O("","\\lrcorner");O("","\\copyright");O("","\\textregistered");O("","\\textregistered");O("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');O("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');O("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');O("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');O("\\vdots","{\\varvdots\\rule{0pt}{15pt}}");O("","\\vdots");O("\\varGamma","\\mathit{\\Gamma}");O("\\varDelta","\\mathit{\\Delta}");O("\\varTheta","\\mathit{\\Theta}");O("\\varLambda","\\mathit{\\Lambda}");O("\\varXi","\\mathit{\\Xi}");O("\\varPi","\\mathit{\\Pi}");O("\\varSigma","\\mathit{\\Sigma}");O("\\varUpsilon","\\mathit{\\Upsilon}");O("\\varPhi","\\mathit{\\Phi}");O("\\varPsi","\\mathit{\\Psi}");O("\\varOmega","\\mathit{\\Omega}");O("\\substack","\\begin{subarray}{c}#1\\end{subarray}");O("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");O("\\boxed","\\fbox{$\\displaystyle{#1}$}");O("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");O("\\implies","\\DOTSB\\;\\Longrightarrow\\;");O("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");O("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}");O("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var z8={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};O("\\dots",function(t){var e="\\dotso",n=t.expandAfterFuture().text;return n in z8?e=z8[n]:(n.slice(0,4)==="\\not"||n in Zt.math&&Be.contains(["bin","rel"],Zt.math[n].group))&&(e="\\dotsb"),e});var j3={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};O("\\dotso",function(t){var e=t.future().text;return e in j3?"\\ldots\\,":"\\ldots"});O("\\dotsc",function(t){var e=t.future().text;return e in j3&&e!==","?"\\ldots\\,":"\\ldots"});O("\\cdots",function(t){var e=t.future().text;return e in j3?"\\@cdots\\,":"\\@cdots"});O("\\dotsb","\\cdots");O("\\dotsm","\\cdots");O("\\dotsi","\\!\\cdots");O("\\dotsx","\\ldots\\,");O("\\DOTSI","\\relax");O("\\DOTSB","\\relax");O("\\DOTSX","\\relax");O("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");O("\\,","\\tmspace+{3mu}{.1667em}");O("\\thinspace","\\,");O("\\>","\\mskip{4mu}");O("\\:","\\tmspace+{4mu}{.2222em}");O("\\medspace","\\:");O("\\;","\\tmspace+{5mu}{.2777em}");O("\\thickspace","\\;");O("\\!","\\tmspace-{3mu}{.1667em}");O("\\negthinspace","\\!");O("\\negmedspace","\\tmspace-{4mu}{.2222em}");O("\\negthickspace","\\tmspace-{5mu}{.277em}");O("\\enspace","\\kern.5em ");O("\\enskip","\\hskip.5em\\relax");O("\\quad","\\hskip1em\\relax");O("\\qquad","\\hskip2em\\relax");O("\\tag","\\@ifstar\\tag@literal\\tag@paren");O("\\tag@paren","\\tag@literal{({#1})}");O("\\tag@literal",t=>{if(t.macros.get("\\df@tag"))throw new Me("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});O("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");O("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");O("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");O("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");O("\\newline","\\\\\\relax");O("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var HR=ye(Ei["Main-Regular"][84][1]-.7*Ei["Main-Regular"][65][1]);O("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+HR+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");O("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+HR+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");O("\\hspace","\\@ifstar\\@hspacer\\@hspace");O("\\@hspace","\\hskip #1\\relax");O("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");O("\\ordinarycolon",":");O("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");O("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');O("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');O("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');O("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');O("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');O("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');O("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');O("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');O("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');O("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');O("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');O("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');O("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');O("","\\dblcolon");O("","\\eqcolon");O("","\\coloneqq");O("","\\eqqcolon");O("","\\Coloneqq");O("\\ratio","\\vcentcolon");O("\\coloncolon","\\dblcolon");O("\\colonequals","\\coloneqq");O("\\coloncolonequals","\\Coloneqq");O("\\equalscolon","\\eqqcolon");O("\\equalscoloncolon","\\Eqqcolon");O("\\colonminus","\\coloneq");O("\\coloncolonminus","\\Coloneq");O("\\minuscolon","\\eqcolon");O("\\minuscoloncolon","\\Eqcolon");O("\\coloncolonapprox","\\Colonapprox");O("\\coloncolonsim","\\Colonsim");O("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");O("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");O("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");O("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");O("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`}}");O("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");O("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");O("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");O("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");O("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");O("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");O("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");O("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");O("\\gvertneqq","\\html@mathml{\\@gvertneqq}{}");O("\\lvertneqq","\\html@mathml{\\@lvertneqq}{}");O("\\ngeqq","\\html@mathml{\\@ngeqq}{}");O("\\ngeqslant","\\html@mathml{\\@ngeqslant}{}");O("\\nleqq","\\html@mathml{\\@nleqq}{}");O("\\nleqslant","\\html@mathml{\\@nleqslant}{}");O("\\nshortmid","\\html@mathml{\\@nshortmid}{}");O("\\nshortparallel","\\html@mathml{\\@nshortparallel}{}");O("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{}");O("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{}");O("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{}");O("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{}");O("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{}");O("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{}");O("\\imath","\\html@mathml{\\@imath}{}");O("\\jmath","\\html@mathml{\\@jmath}{}");O("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`}}");O("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`}}");O("","\\llbracket");O("","\\rrbracket");O("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`}}");O("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`}}");O("","\\lBrace");O("","\\rBrace");O("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`}}");O("","\\minuso");O("\\darr","\\downarrow");O("\\dArr","\\Downarrow");O("\\Darr","\\Downarrow");O("\\lang","\\langle");O("\\rang","\\rangle");O("\\uarr","\\uparrow");O("\\uArr","\\Uparrow");O("\\Uarr","\\Uparrow");O("\\N","\\mathbb{N}");O("\\R","\\mathbb{R}");O("\\Z","\\mathbb{Z}");O("\\alef","\\aleph");O("\\alefsym","\\aleph");O("\\Alpha","\\mathrm{A}");O("\\Beta","\\mathrm{B}");O("\\bull","\\bullet");O("\\Chi","\\mathrm{X}");O("\\clubs","\\clubsuit");O("\\cnums","\\mathbb{C}");O("\\Complex","\\mathbb{C}");O("\\Dagger","\\ddagger");O("\\diamonds","\\diamondsuit");O("\\empty","\\emptyset");O("\\Epsilon","\\mathrm{E}");O("\\Eta","\\mathrm{H}");O("\\exist","\\exists");O("\\harr","\\leftrightarrow");O("\\hArr","\\Leftrightarrow");O("\\Harr","\\Leftrightarrow");O("\\hearts","\\heartsuit");O("\\image","\\Im");O("\\infin","\\infty");O("\\Iota","\\mathrm{I}");O("\\isin","\\in");O("\\Kappa","\\mathrm{K}");O("\\larr","\\leftarrow");O("\\lArr","\\Leftarrow");O("\\Larr","\\Leftarrow");O("\\lrarr","\\leftrightarrow");O("\\lrArr","\\Leftrightarrow");O("\\Lrarr","\\Leftrightarrow");O("\\Mu","\\mathrm{M}");O("\\natnums","\\mathbb{N}");O("\\Nu","\\mathrm{N}");O("\\Omicron","\\mathrm{O}");O("\\plusmn","\\pm");O("\\rarr","\\rightarrow");O("\\rArr","\\Rightarrow");O("\\Rarr","\\Rightarrow");O("\\real","\\Re");O("\\reals","\\mathbb{R}");O("\\Reals","\\mathbb{R}");O("\\Rho","\\mathrm{P}");O("\\sdot","\\cdot");O("\\sect","\\S");O("\\spades","\\spadesuit");O("\\sub","\\subset");O("\\sube","\\subseteq");O("\\supe","\\supseteq");O("\\Tau","\\mathrm{T}");O("\\thetasym","\\vartheta");O("\\weierp","\\wp");O("\\Zeta","\\mathrm{Z}");O("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");O("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");O("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");O("\\bra","\\mathinner{\\langle{#1}|}");O("\\ket","\\mathinner{|{#1}\\rangle}");O("\\braket","\\mathinner{\\langle{#1}\\rangle}");O("\\Bra","\\left\\langle#1\\right|");O("\\Ket","\\left|#1\\right\\rangle");var qR=t=>e=>{var n=e.consumeArg().tokens,r=e.consumeArg().tokens,s=e.consumeArg().tokens,i=e.consumeArg().tokens,o=e.macros.get("|"),a=e.macros.get("\\|");e.macros.beginGroup();var l=h=>f=>{t&&(f.macros.set("|",o),s.length&&f.macros.set("\\|",a));var d=h;if(!h&&s.length){var p=f.future();p.text==="|"&&(f.popToken(),d=!0)}return{tokens:d?s:r,numArgs:0}};e.macros.set("|",l(!1)),s.length&&e.macros.set("\\|",l(!0));var u=e.consumeArg().tokens,c=e.expandTokens([...i,...u,...n]);return e.macros.endGroup(),{tokens:c.reverse(),numArgs:0}};O("\\bra@ket",qR(!1));O("\\bra@set",qR(!0));O("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");O("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");O("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");O("\\angln","{\\angl n}");O("\\blue","\\textcolor{##6495ed}{#1}");O("\\orange","\\textcolor{##ffa500}{#1}");O("\\pink","\\textcolor{##ff00af}{#1}");O("\\red","\\textcolor{##df0030}{#1}");O("\\green","\\textcolor{##28ae7b}{#1}");O("\\gray","\\textcolor{gray}{#1}");O("\\purple","\\textcolor{##9d38bd}{#1}");O("\\blueA","\\textcolor{##ccfaff}{#1}");O("\\blueB","\\textcolor{##80f6ff}{#1}");O("\\blueC","\\textcolor{##63d9ea}{#1}");O("\\blueD","\\textcolor{##11accd}{#1}");O("\\blueE","\\textcolor{##0c7f99}{#1}");O("\\tealA","\\textcolor{##94fff5}{#1}");O("\\tealB","\\textcolor{##26edd5}{#1}");O("\\tealC","\\textcolor{##01d1c1}{#1}");O("\\tealD","\\textcolor{##01a995}{#1}");O("\\tealE","\\textcolor{##208170}{#1}");O("\\greenA","\\textcolor{##b6ffb0}{#1}");O("\\greenB","\\textcolor{##8af281}{#1}");O("\\greenC","\\textcolor{##74cf70}{#1}");O("\\greenD","\\textcolor{##1fab54}{#1}");O("\\greenE","\\textcolor{##0d923f}{#1}");O("\\goldA","\\textcolor{##ffd0a9}{#1}");O("\\goldB","\\textcolor{##ffbb71}{#1}");O("\\goldC","\\textcolor{##ff9c39}{#1}");O("\\goldD","\\textcolor{##e07d10}{#1}");O("\\goldE","\\textcolor{##a75a05}{#1}");O("\\redA","\\textcolor{##fca9a9}{#1}");O("\\redB","\\textcolor{##ff8482}{#1}");O("\\redC","\\textcolor{##f9685d}{#1}");O("\\redD","\\textcolor{##e84d39}{#1}");O("\\redE","\\textcolor{##bc2612}{#1}");O("\\maroonA","\\textcolor{##ffbde0}{#1}");O("\\maroonB","\\textcolor{##ff92c6}{#1}");O("\\maroonC","\\textcolor{##ed5fa6}{#1}");O("\\maroonD","\\textcolor{##ca337c}{#1}");O("\\maroonE","\\textcolor{##9e034e}{#1}");O("\\purpleA","\\textcolor{##ddd7ff}{#1}");O("\\purpleB","\\textcolor{##c6b9fc}{#1}");O("\\purpleC","\\textcolor{##aa87ff}{#1}");O("\\purpleD","\\textcolor{##7854ab}{#1}");O("\\purpleE","\\textcolor{##543b78}{#1}");O("\\mintA","\\textcolor{##f5f9e8}{#1}");O("\\mintB","\\textcolor{##edf2df}{#1}");O("\\mintC","\\textcolor{##e0e5cc}{#1}");O("\\grayA","\\textcolor{##f6f7f7}{#1}");O("\\grayB","\\textcolor{##f0f1f2}{#1}");O("\\grayC","\\textcolor{##e3e5e6}{#1}");O("\\grayD","\\textcolor{##d6d8da}{#1}");O("\\grayE","\\textcolor{##babec2}{#1}");O("\\grayF","\\textcolor{##888d93}{#1}");O("\\grayG","\\textcolor{##626569}{#1}");O("\\grayH","\\textcolor{##3b3e40}{#1}");O("\\grayI","\\textcolor{##21242c}{#1}");O("\\kaBlue","\\textcolor{##314453}{#1}");O("\\kaGreen","\\textcolor{##71B307}{#1}");typeof document<"u"&&document.compatMode!=="CSS1Compat"&&typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype.");var iwe=Es('<canvas class="svelte-1cdddp2"></canvas>');function owe(t,e){Do(e,!1);let n=ut(e,"data",8),r=ut(e,"distributionId",8,"target"),s=ut(e,"xLocation",8,0),i=ut(e,"opacity",8,.5),o=ut(e,"colorMap",8,"Blues"),a=ut(e,"bandwidth",8,30),l=yo(),u=rR[`interpolate${o()}`];function c(f,d=.5,p=0,g="target"){console.log("Plotting heatmap for distribution: ",g);const m=f.arraySync(),b=At.distributionWidth,x=At.distributionHeight,v=at(l).getContext("2d");if(!v)return;v.clearRect(0,0,b,x);let y=ii(m,z=>z[0]),w=_s(m,z=>z[0]),C=ii(m,z=>z[1]),T=_s(m,z=>z[1]);const N=w-y,$=T-C;y-=.1*N,w+=.1*N,C-=.1*$,T+=.1*$;const _=new Array(m.length);for(let z=0;z<m.length;z++)_[z]=[(m[z][0]-y)/(w-y)*b,(m[z][1]-C)/(T-C)*x];console.log("Rescaled data: ",_);const S=b,M=new Array(S).fill(0).map(()=>new Array(S).fill(0)),F=b/S,A=x/S;function E(z){return Math.exp(-.5*z*z)/Math.sqrt(2*Math.PI)}console.log(new Date().toLocaleTimeString());for(let z=0;z<S;z++)for(let B=0;B<S;B++){const G=z*F,j=B*A;let Z=0;for(const[ne,le]of _){const oe=(G-ne)/a(),de=(j-le)/a();Z+=E(oe)*E(de)}M[z][B]=Z}console.log(new Date().toLocaleTimeString());let D=0;for(let z=0;z<S;z++)for(let B=0;B<S;B++)M[z][B]>D&&(D=M[z][B]);console.log(new Date().toLocaleTimeString());const P=v.createImageData(b,x);for(let z=0;z<x;z++)for(let B=0;B<b;B++){const G=M[z][B]/D,j=zi(u(G)),Z=(z*b+B)*4;P.data[Z]=j.r,P.data[Z+1]=j.g,P.data[Z+2]=j.b,P.data[Z+3]=255}v.putImageData(P,0,0),console.log(new Date().toLocaleTimeString())}Ja(()=>(jr(n()),at(l),jr(i()),jr(s()),jr(r())),()=>{n()&&at(l)&&c(n(),i(),s(),r())}),Qa(),el();var h=iwe();w4(h,f=>ka(l,f),()=>at(l)),fo(()=>{Fr(h,"id",r()),Fr(h,"width",At.distributionWidth),Fr(h,"height",At.distributionHeight),Ap(h,"width: "+At.distributionWidth+"px;height: "+At.distributionHeight+"px; left: "+s()+"px; opacity: "+i()+"; background-color: transparent; pointer-events: none;")}),ir(t,h),Mo()}var awe=x4('<svg class="svelte-om0b9n"></svg>');function lwe(t,e){Do(e,!1);const[n,r]=Tu(),s=()=>vr(cve,"$domainRange",n);let i=ut(e,"data",8),o=ut(e,"distributionId",8,"target"),a=ut(e,"xLocation",8,0),l=ut(e,"opacity",8,.5),u=ut(e,"colorMap",8,"Blues"),c=ut(e,"fillColor",8,"#7b7b7b");ut(e,"bandwidth",8,10);let h=ut(e,"showBorder",8,!1),f=ut(e,"borderColor",8,"#7b7b7b"),d=ut(e,"label",8),p=ut(e,"labelIsLatex",8,!1),g=yo();rR[`interpolate${u()}`];function m(y,w,C,T="target"){const N=nn("svg");let $=N.select(`#${T}_latex`);$.empty()?$=N.append("foreignObject").attr("id",T+"_latex"):$.selectAll("*").remove(),$.attr("x",w).attr("y",C).attr("width",300).attr("height",100);const _=$.append("xhtml:div").style("width","100%").style("height","100%").style("display","flex").style("align-items","center").style("justify-content","center").style("font","34px 'KaTeX_Main', serif").style("color","#7b7b7b");katex.render(y,_.node(),{throwOnError:!1})}function b(y,w,C,T="target"){const N=nn("svg");let $=N.select(`#${T}_text`);$.empty()?$=N.append("g").attr("id",T+"_text"):$.selectAll("*").remove(),$.append("text").attr("x",w).attr("y",C).attr("text-anchor","middle").style("font-size","24px").style("font-family","Helvetica, sans-serif").style("fill","#7b7b7b").text(y)}function x(y,w=.9,C=0,T="target",N=4){let $=y.arraySync();const _=xu().domain([s().xMin,s().xMax]).range([0,At.distributionWidth]),S=xu().domain([s().yMin,s().yMax]).range([0,At.distributionHeight]),M=QN().x(E=>_(E[0])).y(E=>S(E[1])).size([At.distributionWidth,At.distributionHeight]).bandwidth(30).thresholds(N)($),F=nn("svg");let A=F.select(`#${T}`);A.empty()?A=F.append("g").attr("id",T).attr("isolation","isolate"):A.selectAll("*").remove(),A.selectAll("path").data(M).enter().append("path").attr("d",H_()).attr("fill",c()).attr("stroke",f()).attr("stroke-width",h()?3:0).attr("stroke-opacity",w).attr("fill-opacity",w).attr("mix-blend-mode","screen").attr("transform",`translate(${C}, 0)`)}Ja(()=>(jr(i()),at(g),jr(l()),jr(a()),jr(o()),jr(d()),jr(p()),At),()=>{i()&&at(g)&&(x(i(),l(),a(),o()),d()&&(p()?(console.log("Label is latex: ",d()),m(d(),a()+At.distributionWidth/2,40,o())):b(d(),a()+At.distributionWidth/2,40,o())))}),Qa(),el();var v=awe();w4(v,y=>ka(g,y),()=>at(g)),fo(()=>{Fr(v,"id",`svg_${o()??""}`),Fr(v,"width",At.distributionWidth),Fr(v,"height",At.distributionHeight),Ap(v,"left: "+a()+"px;")}),ir(t,v),Mo(),r()}function N2(t,e){let n=ut(e,"data",8),r=ut(e,"xLocation",8,0),s=ut(e,"opacity",8,.5),i=ut(e,"labelIsLatex",8,!1),o=ut(e,"label",8),a=ut(e,"distributionId",8),l=ut(e,"colorMap",8,"Blues"),u=ut(e,"displayMode",8,"contour"),c=ut(e,"showBorder",8,!1),h=ut(e,"fillColor",8,"#7b7b7b"),f=ut(e,"borderColor",8,"#7b7b7b");var d=QR(),p=ID(d);{var g=b=>{owe(b,{get data(){return n()},get distributionId(){return a()},get xLocation(){return r()},get opacity(){return s()},get colorMap(){return l()}})},m=(b,x)=>{{var v=y=>{lwe(y,{get data(){return n()},get distributionId(){return a()},get xLocation(){return r()},get opacity(){return s()},get colorMap(){return l()},get label(){return o()},get labelIsLatex(){return i()},get showBorder(){return c()},get fillColor(){return h()},get borderColor(){return f()}})};E2(b,y=>{u()==="contour"&&y(v)},x)}};E2(p,b=>{u()==="heatmap"?b(g):b(m,!1)})}ir(t,d)}var uwe=Es('<div class="display-area svelte-hbt31h"><!> <!> <!></div>');function cwe(t,e){Do(e,!1);const[n,r]=Tu(),s=()=>vr(Cu,"$currentTime",n),i=()=>vr(ha,"$UIState",n),o=()=>vr(A3,"$allTimeSamples",n),a=()=>vr(iR,"$sourceDistributionSamples",n),l=()=>vr(f4,"$targetDistributionSamples",n),u=()=>vr(zc,"$currentDistributionSamples",n);Ja(()=>(s(),i(),o(),zc),()=>{if(s()){let m=Math.floor(s()*i().numberOfSteps);m>=i().numberOfSteps&&(m=i().numberOfSteps-1);const b=Q(()=>o().gather(m));zc.set(b)}}),Qa(),el();var c=uwe(),h=Qt(c);N2(h,{get data(){return a()},xLocation:0,opacity:.25,label:"Source Distribution",distributionId:"source",colorMap:"Blues",showBorder:!0,fillColor:"rgba(25, 131, 255, 0.2)",borderColor:"rgba(25, 131, 255, 1)"});var f=_r(h,2);const d=_2(()=>At.displayAreaWidth-At.distributionWidth);N2(f,{get data(){return l()},get xLocation(){return at(d)},opacity:.25,label:"Data Distribution",distributionId:"target",colorMap:"Blues",showBorder:!0,fillColor:"rgba(25, 131, 255, 0.2)",borderColor:"rgba(25, 131, 255, 1)"});var p=_r(f,2);const g=_2(()=>s()*(At.displayAreaWidth-At.distributionWidth));N2(p,{get data(){return u()},get xLocation(){return at(g)},opacity:.8,label:"",colorMap:"Oranges",fillColor:"rgba(255, 100, 0, 0.3)",borderColor:"rgba(255, 100, 0, 1)",labelIsLatex:!0,showBorder:!0,distributionId:"current"}),Vt(c),fo(()=>Ap(c,`width: ${At.displayAreaWidth}px; height: ${At.displayAreaHeight}px;`)),ir(t,c),Mo(),r()}var hwe=Es('<div><svg class="svelte-qg3rdh"></svg></div>');function fwe(t,e){Do(e,!1);const[n,r]=Tu(),s=()=>vr(h4,"$datasetName",n);let i=ut(e,"data",8),o=ut(e,"distributionId",8,"target"),a=yo();function l(){h4.set(o()),zc.set(js([])),A3.set(js([])),Cu.set(0),ql.set(!1)}async function u(f,d="target"){d.replace(/\s+/g,"_"),f=await f.arraySync();let p=ii(f,$=>$[0]),g=_s(f,$=>$[0]),m=ii(f,$=>$[1]),b=_s(f,$=>$[1]);const x=.2,v=g-p,y=b-m;p-=x*v,g+=x*v,m-=x*y,b+=x*y;const w=xu().domain([p,g]).range([0,At.miniDistributionWidth]),C=xu().domain([m,b]).range([0,At.miniDistributionWidth]),T=nn(at(a));let N=T.select(`#${d}`);N.empty()?N=T.append("g").attr("id",d):N.selectAll("*").remove(),N.selectAll("circle").data(f).enter().append("circle").attr("cx",$=>w($[0])).attr("cy",$=>C($[1])).attr("r",1).attr("fill",At.pointColor)}Ja(()=>(jr(i()),at(a),jr(o())),()=>{i()&&at(a)&&u(i(),o())}),Qa(),el();var c=hwe(),h=Qt(c);w4(h,f=>ka(a,f),()=>at(a)),Vt(c),fo(()=>{zD(c,1,FD(o()===s()?"mini-distribution active-dataset":"mini-distribution inactive-dataset"),"svelte-qg3rdh"),Fr(h,"id",o())}),H8("click",c,l),ir(t,c),Mo(),r()}var dwe=Es('<div class="dataset-menu svelte-1apdfzl"><h1 class="dataset-menu-title svelte-1apdfzl">Datasets</h1> <!></div>');function pwe(t,e){let n=ut(e,"datasetDict",24,()=>({}));var r=dwe(),s=_r(Qt(r),2);S4(s,1,()=>Object.entries(n()),k4,(i,o)=>{let a=()=>at(o)[0],l=()=>at(o)[1];fwe(i,{get data(){return l()},get distributionId(){return a()}})}),Vt(r),ir(t,r)}var mwe=Es('<div id="container" class="explanation-container svelte-1w3w9x"><p class="explanation svelte-1w3w9x">Simple <span id="word1" class="highlight svelte-1w3w9x">source distribution</span> transformed to a complex <span id="word2" class="highlight svelte-1w3w9x">data distribution</span>.</p></div>');function gwe(t){var e=mwe();ir(t,e)}function bwe(){let t=0,e=0;for(;t===0;)t=Math.random();for(;e===0;)e=Math.random();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*e)}function xwe(t){return Array.from({length:t},bwe)}function ywe(t){const e=t.length,n=Array.from({length:e},()=>Array(e).fill(0));for(let r=0;r<e;r++)for(let s=0;s<=r;s++){let i=t[r][s];for(let o=0;o<s;o++)i-=n[r][o]*n[s][o];r===s?n[r][s]=Math.sqrt(i):n[r][s]=i/n[s][s]}return n}function vwe(t,e){const n=t.length,r=Array(n).fill(0);for(let s=0;s<n;s++)for(let i=0;i<=s;i++)r[s]+=t[s][i]*e[i];return r}function wwe(t,e){return t.map((n,r)=>n+e[r])}function XR(t,e,n=1){if(n==1){const r=t.length,s=ywe(e),i=xwe(r),o=vwe(s,i);return wwe(o,t)}else{const r=[];for(let s=0;s<n;s++){const i=XR(t,e);r.push(i)}return js(r)}}var kwe=Es('<div class="container"><div class="title-container svelte-1dzvr9w"><div class="sub-title-container svelte-1dzvr9w"><h1 class="sub-title svelte-1dzvr9w">Learn about diffusion and flow  models with interactive visualization.</h1></div> <a href="https://github.com/helblazer811/DiffusionLab" id="github-logo" target="_blank" class="svelte-1dzvr9w"><img alt="GitHub Logo" class="svelte-1dzvr9w"> Code</a></div> <div class="training-bar-container svelte-1dzvr9w"><!></div> <div class="main-area svelte-1dzvr9w"><div class="main-area-left svelte-1dzvr9w"></div> <div class="main-area-center svelte-1dzvr9w"><!> <!> <!></div> <div class="main-area-right svelte-1dzvr9w"><!></div></div> <div class="footer svelte-1dzvr9w"></div></div>');function Bwe(t,e){Do(e,!1);const[n,r]=Tu(),s=()=>vr(h4,"$datasetName",n);ut(e,"trainModel",8,!1);let i=yo(),o=yo({});function a(N){return fetch(N).then($=>$.json()).then($=>js($.points))}function l(N){N.code==="Space"&&(N.preventDefault(),ql.update($=>!$))}async function u(N){return await s5(N)}function c(N,$,_,S,M,F){const A=Ju(ha);N.onmessage=E=>{const{type:D,result:P}=E.data;if(D==="result"){const z=js(E.data.allSamples);A3.set(z);let B=J(z,[A.numSamples*A.numberOfSteps,2]);B=B.arraySync(),ii(B,G=>G[0]),_s(B,G=>G[0]),ii(B,G=>G[1]),_s(B,G=>G[1]),ql.set(!0)}else D==="status"?console.log("Worker status:",E.data.message):D==="error"&&console.error("Worker error:",E.data.message)},console.log("Calling the worker thread to sample..."),N.postMessage({type:"sample",data:{modelJSONPath:$,modelType:_,modelConfig:S,numSamples:A.numSamples,numberOfSteps:A.numberOfSteps}})}_D(async()=>{const N=Ju(ha);for(const[A,E]of Object.entries(ave)){const D=await a(E);ka(o,{...at(o),[A]:D})}window.addEventListener("keydown",l);const $=N.modelType,_=s();l8[$][_],ka(i,new Worker(new URL(""+new URL("../workers/sampling_worker-DAJ1cKrh.js",import.meta.url).href,import.meta.url),{type:"module"}));const S=at(o)[s()];f4.set(S);const M=XR([0,0],[[1,0],[0,1]],N.numSamples);iR.set(M);const F=new Worker(new URL(""+new URL("../workers/train_worker-DbbKyqhV.js",import.meta.url).href,import.meta.url),{type:"module"});F.onmessage=async A=>{const{type:E,result:D}=A.data;if(E==="result"){const P=A.data.tfModelPath,z=ove[$],B=new z(Rf.dim,Rf.hidden),G=await s5(P);B.setModel(G),B.download()}else E==="status"?console.log("Worker status:",A.data.message):E==="error"&&console.error("Worker error:",A.data.message)}}),q8(()=>{typeof window<"u"&&window.removeEventListener("keydown",l)}),Ja(()=>(s(),at(i),at(o),Rf),()=>{if(s()&&at(i)){ql.set(!1);const N=at(o)[s()];f4.set(N),zc.set(tn([0,2]));const $=Ju(ha).modelType,_=l8[$][s()];u(_).then(S=>{lve.set(S)}),c(at(i),_,$,Rf[$],Ju(ha).numSamples,Ju(ha).numberOfSteps)}}),Qa(),el();var h=kwe(),f=Qt(h),d=_r(Qt(f),2),p=Qt(d);Fr(p,"src",`${jl??""}/github-logo.svg`),A2(),Vt(d),Vt(f);var g=_r(f,2),m=Qt(g);wve(m),Vt(g);var b=_r(g,2),x=_r(Qt(b),2),v=Qt(x);cwe(v,{});var y=_r(v,2);gve(y,{});var w=_r(y,2);gwe(w),Vt(x);var C=_r(x,2),T=Qt(C);pwe(T,{get datasetDict(){return at(o)}}),Vt(C),Vt(b),A2(2),Vt(h),ir(t,h),Mo(),r()}export{Bwe as component};
